<html>
<head>
<title>Restating the obvious about the WM_COMMAND message</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>Restating the obvious about the WM_COMMAND message</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>March 2, 2006 / year-entry #77</td></tr>
<tr><td><b>Tags:</b></td><td>code</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>27</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">I'm satisfied with the MSDN documentation for the WM_COMMAND message, but for the sake of mind-numbing completeness, I'm going to state the obvious in the hope that you, dear readers, can use this technique to fill in the obvious in other parts of MSDN. The one-line summary of the WM_COMMAND message says, "The WM_COMMAND message...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>
I'm satisfied with the MSDN documentation for
<a HREF="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/menus/menureference/menumessages/wm_command.asp">
the <code>WM_COMMAND</code> message</a>,
but for the sake of mind-numbing completeness,
I'm going to state the obvious in the hope that you,
dear readers, can use this technique to
fill in the obvious in other parts of MSDN.
</p>
<p>
The one-line summary of the <code>WM_COMMAND</code> message
says,
"The WM_COMMAND message is sent when the user selects
a command item from a menu,
when a control sends a notification message to its parent window,
or when an accelerator keystroke is translated."
In a nutshell, there are three scenarios that generate a
<code>WM_COMMAND</code> message, namely the three listed above.
You want to think of the menu and accelerator scenarios of the
<code>WM_COMMAND</code> message as special cases of the control scenario.
</p>
<p>
The high-order word of the <code>wParam</code> parameter
"specifies the notification code if the message is from a control".
What does "control" mean here?
Remember that you have to take things in context.
The <code>WM_COMMAND</code> message is being presented in the
context of Win32 in general, and in the context of the window manager
in particular.
Windows such as edit boxes, push buttons, and list boxes
are commonly called "controls", as are all the window classes
in the "common controls library".
In the world of the window manager, a "control" is a window
whose purpose is to provide some degree of interactivity
(which, in the case of the static control, might be no interactivity at all)
in the service of its parent window.
The fact that the <code>WM_COMMAND</code> is used primarily
in the context of dialog boxes further emphasizes the point
that the term "control" here is just a synonym for "child window".
</p>
<p>
What does "notification code" mean here?
Control notification codes are arbitrary 16-bit values defined
by the control itself.
By convention, they are named <code>xxN_xxxx</code>, where the "N"
stands for "notification".
Be careful, however, not to confuse this with notification codes
associated with the <code>WM_NOTIFY</code> message.
Fortunately, every notification code specifies in its documentation
whether it arrives as a <code>WM_COMMAND</code> notification or
a <code>WM_NOTIFY</code> notification.
A modern control designer is more likely to use
<code>WM_NOTIFY</code> notifications since they allow
additional information to be passed with the notification.
The <code>WM_COMMAND</code> message, by comparison, passes
only the notification itself; the other parameters to
the <code>WM_COMMAND</code> message are forced, as we'll see below.
If <code>WM_NOTIFY</code> is superior to <code>WM_COMMAND</code>,
why do some controls use <code>WM_COMMAND</code>?
Because <code>WM_NOTIFY</code> wasn't available until
Windows&nbsp;95.
Controls that were written prior to Windows&nbsp;95 had to
content themselves with the <code>WM_COMMAND</code> message.
</p>
<p>
"If the message is from an accelerator, this value [the high-order
word of the <code>wParam</code> parameter] is 1."
Remember, we're still in the context of the window manager,
and particular in the context of the <code>WM_COMMAND</code>
message.
The accelerator here refers to messages generated by the call to
<code>TranslateAccelerator</code> in the message loop.
</p>
<p>
"If the message is from a menu, this value is zero."
If the <code>WM_COMMAND</code> mesage was triggered by
the user selecting an item from a menu, then the high-order
word of the <code>wParam</code> is zero.
</p>
<p>
The low-order word of the <code>wParam</code> parameter
"specifies the identifier of the menu item, control, or
accelerator."
The identifier of a menu item or accelerator
is the command code you associated
with it in your menu or accelerator template or (in the case of a menu item)
when you manually created the menu item with a function like
<code>InsertMenuItem</code>.
(You probably named your menu item identifiers and accelerator
identifiers <code>IDM_something</code>.)
The identifier of a control is determined by the creator of the
control; recall that the
<code>hMenu</code> parameter to the <code>CreateWindow</code>
and <code>CreateWindowEx</code> functions is treated as a child
window identifier if you're creating a child window.
It is that identifier that the control identifier.
(You can retrieve the identifier for a control by calling the
<code>GetDlgCtrlID</code> function.)
</p>
<p>
Finally, the <code>lParam</code> parameter is the
"handle to the control sending the message if the message is from a control.
Otherwise, this parameter is NULL."
If the notification is generated by a child window
(with a notification code appropriate for that child window, obviously),
then that child window handle is passed as the <code>lParam</code>.
If the notification is generated by an accelerator or a menu,
then the <code>lParam</code> is zero.
</p>
<p>
Notice that nearly all of the parameters to the
<code>WM_COMMAND</code> message are forced, once you've decided
what notification you're generating.
</p>
<p>
If you are generating a notification from a control,
you must pass the notification code in the high word of the
<code>wParam</code>, the control identifier in the low word
of the <code>wParam</code>, and the control handle as the
<code>lParam</code>.
In other words, once you've decided that the
<code>hwndC</code> window wants to send a
<code>CN_READY</code> notification, you have no choice but
to type
</p>
<pre>
SendMessage(GetParent(hwndC), WM_COMMAND,
            MAKEWPARAM(GetDlgCtrlID(hwndC), CN_READY),
            (LPARAM)hwndC);
</pre>
<p>
In other words, all control notifications take the form
</p>
<pre>
SendMessage(GetParent(hwndC), WM_COMMAND,
            MAKEWPARAM(GetDlgCtrlID(hwndC), notificationCode),
            (LPARAM)hwndC);
</pre>
<p>
where <code>hwndC</code> is the control generating the notification
and <code>notificationCode</code> is the notification code.
Of course, you can use <code>PostMessage</code> instead of
<code>SendMessage</code> if you would rather post the notification
rather than sending it.
</p>
<p>
The other two cases (accelerators and menus) are not cases you
would normally code up, since you typically let the
<code>TranslateAccelerator</code> function deal with accelerators
and let the menu system deal with menu identifiers.
But if for some reason, you wanted to pretend that the user
had typed an accelerator or selected a menu item, you can generate
the notification manually by following the rules set out in the
documentation.
</p>
<pre>
// simulate the accelerator IDM_WHATEVER
SendMessage(hwnd, WM_COMMAND,
            MAKEWPARAM(IDM_WHATEVER, 1),
            0);
</pre>
<p>
Here, <code>hwnd</code> is the window that you want to pretend was
the window passed to the <code>TranslateAccelerator</code> function,
and <code>IDM_WHATEVER</code> is the accelerator identifier.
</p>
<p>
Simulating a menu selection is exactly the same, except that
(according to the rules above), you set the high-order word of
the <code>wParam</code> to zero.
</p>
<pre>
// simulate the menu item IDM_WHATEVER
SendMessage(hwnd, WM_COMMAND,
            MAKEWPARAM(IDM_WHATEVER, 0),
            0);
</pre>
<p>
Here, <code>hwnd</code> is the window associated with the menu.
A window can be associated with a menu either by being created
with the menu (having passed the menu handle to the
<code>CreateWindow</code> or <code>CreateWindowEx</code> function
explicitly, or having it done implicitly by including it with the
class registration) or by having been passed explicitly as
the window parameter to a function like
<code>TrackPopupWindow</code>.
</p>
<p>
One significant difference between the accelerator/menu case
and the control notification case is that accelerator and menu
identifiers are defined by the calling application,
whereas control notifications are defined by the control.
</p>
<p>
You may have noticed the opportunity to "pun"
the control notification codes.
If a control defines a notification code as zero, then it will
"look like" a menu item selection, since the high-order word
of the <code>wParam</code> in the case of a menu item selection
is zero.
The button control takes advantage of this pun:
</p>
<pre>
#define BN_CLICKED          0
</pre>
<p>
This means that when the user clicks a button control,
the <code>WM_COMMAND</code> message that is generated
"smells like" a menu selection notification.
You probably take advantage of this in your dialog procedure
without even realizing it.
</p>
<p>
(The static control also takes advantage of this pun:
</p>
<pre>
#define STN_CLICKED         0
</pre>
<p>
but in order for the static control to generate the
<code>STN_CLICKED</code> notification,
you have to set the <code>SS_NOTIFY</code> style.)
</p>
<p>
I stated at the start that the accelerator and menu scenarios
are just special cases of the control scenario.
If you take the pieces of the <code>WM_COMMAND</code> message
apart, you'll see that they fall into two categories:
</p>
<ul>
<li>What happened? (Notification code.)
<li>Whom did it happen to? (Control handle and ID.)
</ul>
<p>
In the case of a menu or an accelerator, the "What happened?"
is "The user clicked on the menu (0)" or
"The user typed the accelerator (1)".
The "Whom did it happen to?" is "This menu ID" or "This accelerator ID".
Since the notification is not coming from a control, the control
handle is <code>NULL</code>.
</p>
<p>
I apologize to all you Win32 programmers for whom
this is just stating the obvious.
</p>
<p>
Now that you're an expert on the <code>WM_COMMAND</code> message,
perhaps you can solve
<a HREF="http://groups.google.com/group/comp.os.ms-windows.programmer.win32/msg/9d4372f762ad5c68">
this person's problem</a>.</p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (27)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-351173">
				<div id="div-comment-351173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">AsmGuru62</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351173">
			March 2, 2006 at 12:35 pm</a>		</div>

		<p>I am not sure, but &quot;(HMENU) 0&quot; is suspicious. The control ID (child window ID) should not be zero.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-351203">
				<div id="div-comment-351203" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">KiwiBlue</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351203">
			March 2, 2006 at 1:26 pm</a>		</div>

		<p>[quote]<br />
<br />I&#8217;ve written Windows code, and I don&#8217;t know the particulars of WM_COMMAND.<br />
<br />[/quote]</p>
<p>Looks like Windows code you&#8217;ve writen was a bunch of &quot;declare sub&quot; in VB, dude.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-351213">
				<div id="div-comment-351213" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Gabe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351213">
			March 2, 2006 at 1:34 pm</a>		</div>

		<p>JD: There are 2 basic types of questions that beginners tend to ask.</p>
<p>One is &quot;How do I do X?&quot; In that case, the user knows what he wants to do but simply doesn&#8217;t know where to look, and a quick redirect to the correct term or page of documention (i.e. &quot;look up WM_COMMAND in MSDN&quot;) will solve the problem. Even with 20 years of experience I still need to ask these questions when learning a new environment or language.</p>
<p>The other question is &quot;Why isn&#8217;t X working?&quot; Sometimes X is difficult, even for non-beginners. In this case though, he knew that WM_COMMAND was what he needed, he just seemingly ignored all the documentation for it.</p>
<p>What I&#8217;m interested in, though, is how this differed in 16-bit Windows. Back then WPARAMs were actually word-length, so they didn&#8217;t have a high word. How did WM_COMMAND work, or what was it used for, then?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-351243">
				<div id="div-comment-351243" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">lolerskatez!</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351243">
			March 2, 2006 at 1:52 pm</a>		</div>

		<p>Im 13373r than j00 a11! Wargh check out ma size of ma controlz!</p>
<p>ROFLCOPTER!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-351263">
				<div id="div-comment-351263" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">KiwiBlue</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351263">
			March 2, 2006 at 2:05 pm</a>		</div>

		<p>Gabe, in Win16 32-bit LPARAM contained both control handle and notification code &#8211; it was possible because handles were 16-bit. LOWORD(lParam) was handle, HIWORD(lParam) was notification code.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-351273">
				<div id="div-comment-351273" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mike</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351273">
			March 2, 2006 at 2:06 pm</a>		</div>

		<p>Give a man a fish and he&#8217;ll eat for a day.<br />
<br />Try to teach a man to fish and he&#8217;ll bitch at you for not just giving him the fish.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-351283">
				<div id="div-comment-351283" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Daniel</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351283">
			March 2, 2006 at 2:13 pm</a>		</div>

		<p>Mike:<br />
<br />&quot;Try to teach a man to fish and he&#8217;ll bitch at you for not just giving him the fish.&quot;<br />
<br />Thanks for the laugh! You are so right.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-351293">
				<div id="div-comment-351293" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">8</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351293">
			March 2, 2006 at 2:30 pm</a>		</div>

		<p>You&#8217;ve just made it more confusing, it doesn&#8217;t happen much, and I don&#8217;t like to admit it, but this time the MSDN docs are more clear then yours.</p>
<p>Now that we&#8217;re restating the obvious anyway and I&#8217;m confused&#8230; That the WM_COMMAND from a clicked button &quot;smells like&quot; a menu selection is very useful. But to make it almost exactly the same instead of havig it smell like it, the same ID?_* has to be used for both the accelerator and the button control&#8230; Right?</p>
<p>And I could not find any information on TrackPopupWindow. I tried this:<br />
<br /><a rel="nofollow" target="_new" href="http://search.msdn.microsoft.com/search/results.aspx?qu=TrackPopupWindow&amp;View=msdn&amp;st=b&amp;c=4&amp;s=1&amp;swc=4" rel="nofollow">http://search.msdn.microsoft.com/search/results.aspx?qu=TrackPopupWindow&#038;View=msdn&#038;st=b&#038;c=4&#038;s=1&#038;swc=4</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-351303">
				<div id="div-comment-351303" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">KiwiBlue</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351303">
			March 2, 2006 at 2:46 pm</a>		</div>

		<p>I guess TrackPopupWindow should be TrackPopupMenu[Ex] instead.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-351313">
				<div id="div-comment-351313" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jay B</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351313">
			March 2, 2006 at 4:32 pm</a>		</div>

		<p>You know&#8230; sometimes even the blatantly obvious can stare you in the face and you overlook it. &nbsp;It happens to everyone at one time or another.</p>
<p>Sometimes it just helps to have a fresh set of eyes look at something. &nbsp;Sometimes its good to leave a problem alone for a bit and come back to it with your own fresh set of eyes.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-351323">
				<div id="div-comment-351323" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Chris Moorhouse</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351323">
			March 2, 2006 at 5:25 pm</a>		</div>

		<p>I know jack about Win32, but I love trying to solve these. Who needs the Times&#8217; crossword when you have Raymond and Larry? The downside is that I am usually the first to get caught in labrynthine snarl that is MSDN.</p>
<p>Three failure points occur to me:<br />
<br />1)Russell expects the control ID in the notification to be 0, and it&#8217;s not. (HMENU) 0 may somehow transform into 1000, I don&#8217;t know and I&#8217;m having trouble finding out. Looks like a cast to me. At any rate, while there may be reasons not to use 0 here, it doesn&#8217;t say so in the linked documentation.</p>
<p>2)Russell is expecting the ID to appear in the HIWORD of the wParam. It comes in the LOWORD. This is mentioned in the linked documentation, and Raymonds reaction seems to imply that this is the problem.</p>
<p>3)Russell is, as he states, listening in the wrong place for this message. He&#8217;s trying to have it recieved by the combobox, when it&#8217;s the combobox&#8217;s parent that should be recieving it. This isn&#8217;t terribly clear from the linked documentation; it seems to be saying that WM_COMMAND is a seperate message that is sent when a control sends some other message to it&#8217;s parent.</p>
<p>If you read the rest of the thread, #2 turns out not to be the problem, that is just a typo in Russell&#8217;s post (or so he claims). #3 appears to be the issue. He would have found this out if he&#8217;d read the docs for CBN_SELENDOK more carefully, but that&#8217;s not what Raymond posted. Raymond is either being overly subtle about his sarcasm (very likely), or he didn&#8217;t read the whole thread.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-oldnewthing bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-351343">
				<div id="div-comment-351343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351343">
			March 2, 2006 at 5:36 pm</a>		</div>

		<p>The problem is #3, as Norman Bullen pointed out later in the thread:<br />
<br /><a rel="nofollow" target="_new" href="http://groups.google.com/group/comp.os.ms-windows.programmer.win32/msg/c2d8d7e6d9588b3b" rel="nofollow">http://groups.google.com/group/comp.os.ms-windows.programmer.win32/msg/c2d8d7e6d9588b3b</a></p>
<p>The very first sentence of the WM_COMMAND documentation says that WM_COMMAND is sent &quot;when a control sends a notification message to its parent window&quot;. If you think this could be made clearer, please elaborate.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-oldnewthing bypostauthor even thread-even depth-1" id="comment-351363">
				<div id="div-comment-351363" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351363">
			March 2, 2006 at 6:45 pm</a>		</div>

		<p>But it isn&#8217;t &quot;the&quot; notification message sent by a control to its parent. There are other notifications such as WM_NOTIFY and WM_PARENTNOTIFY.</p>
<p>And how would that fit into the rest of the sentence? Don&#8217;t forget the menu and accelerator scenarios in the intro blurb.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-351373">
				<div id="div-comment-351373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Chris Moorhouse</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351373">
			March 2, 2006 at 6:46 pm</a>		</div>

		<p>&quot;A telegram is sent when we draw your ticket, when we send a telegram to the winner after judging all entries, or when all other contestants are eliminated.&quot;</p>
<p>How is it obvious to us that the subject of the sentence (the telegram in the main clause) is the same thing as the subject(?) of the second conditional clause (the telegram to the winner)? If they are indeed the same thing, why mention them seperately? The fact that that sentence in the documentation metions the word &quot;message&quot; twice similarily raises the possibility, in my mind, that we&#8217;re talking about two seperate messages.</p>
<p>I get the feeling that the obviousness of this solution to Russell&#8217;s problem lies, as you say, in the context of the Win32 API. Someone familiar with its ins and outs is likely saying &quot;Of course it&#8217;s the same message! What other message could there possibly be?&quot; at this point. But where else can someone with less experience turn to when unfamiliar with this message and its context?</p>
<p>What Russell did miss was the third sentence of the documentation of the CBN_SELENDOK, which more clearly indicates that the one is wrapped within the other. That&#8217;s what cleared this up for me, even before I read the remainder of the thread.</p>
<p>I feel really nervous about offering advice here, but since you asked, I&#8217;m gonna. It may be possible to reduce confusion by dropping the word &#8216;message&#8217; in reference to the notification enclosed in the WM_COMMAND (or even replace &#8216;message&#8217; with &#8216;code&#8217;, so as to match the documentation in the wParam parameter), but there may be naming conventions or rules in place that would make this a less than optimal solution. We might do better to use an extra sentence or two instead.</p>
<p>&quot;The WM_COMMAND message is sent when the user selects a command item from a menu or when an accelerator keystroke is translated. It is also the message sent to a control&#8217;s parent window when certain actions are taken on that control; in this case the WM_COMMAND message encloses a notification code related to that action.&quot;</p>
<p>This probably violates all sorts of naming specs and conventions. Just thought I&#8217;d try.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-351393">
				<div id="div-comment-351393" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.delovski.hr' rel='external nofollow' class='url'>Igor Delovski</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351393">
			March 2, 2006 at 7:41 pm</a>		</div>

		<p>As I was learning this from Petzold, I had to draw myself some sort of spreadsheet to understand it.</p>
<p>My wm_command handler starts like this:</p>
<p>static int &nbsp;StdOnWM_Command (HWND hwnd, WPARAM wParam, LPARAM lParam)<br />
<br />{<br />
<br /> &nbsp; short &nbsp; &nbsp; &nbsp; wNotifyCode = HIWORD (wParam); &nbsp; // notification code, 0 if menu, 1 if accel<br />
<br /> &nbsp; short &nbsp; &nbsp; &nbsp; item_id &nbsp; &nbsp; = LOWORD (wParam); &nbsp; // item, control, or accelerator identifier<br />
<br /> &nbsp; HWND &nbsp; &nbsp; &nbsp; &nbsp;ctlHwnd &nbsp; &nbsp; = (HWND) &nbsp;lParam; &nbsp; &nbsp;// handle of control, NULL if menu</p>
<p>&#8230;</p>
<p>plus, there&#8217;s something I did not expect until it bite me: edit box recieves notifications during its creation, but if you don&#8217;t have everything set up and initialized &nbsp;properly at the time, it can produce random crashes.</p>
<p>It drove me crazy!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-351403">
				<div id="div-comment-351403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Igor Delovski</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351403">
			March 2, 2006 at 7:47 pm</a>		</div>

		<p>&#8230; edit box recieves above mentioned notification on WM_CREATE only if it has initial text.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-351193">
				<div id="div-comment-351193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">JD</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351193">
			March 2, 2006 at 1:15 pm</a>		</div>

		<p>LOL</p>
<p>OMG that Russell didn&#8217;t even *read* MSDN on WM_COMMAND! It says right there &quot;The high-order word specifies the notification code if the message is from a control&quot; and he&#8217;s passing (HMENU) 0! &nbsp;Haha! Talk about missing the obvious!</p>
<p>ROFLMAO</p>
<p>Is that the response you&#8217;re looking for? Raymond, you&#8217;re an &#8230; well you clearly demonstrate the old-skool Win32 devs who look down on devs who make mistakes.</p>
<p>Very little of what you wrote above is &quot;obvious&quot; in the sense that normal people in this world use the term. Perhaps you have been working with the Windows APIs for over a decade and this is second nature to you, and you have had to debug and diagnose problems due to developers who made these kinds of mistakes, and that has made you insensitive.</p>
<p>I&#8217;ve written Windows code, and I don&#8217;t know the particulars of WM_COMMAND. The info you laid out above is useful, and not directly obvious from the MSDN article. A nice table illustrating the three scenarios (control, menu, accelerator) and what they fill in the params with would be an improvement to the article and make it more &#8216;obvious&#8217;.</p>
<p>Sure it&#8217;s easy to say &quot;RTFM n00b, it&#8217;s right freaking there&quot; and bemoan how these people should be doing their homework and *thinking* through the problem. But from the question it seems that Russell (&#8216;this person&#8217;) did do some due diligence and has simply barked up the wrong tree.</p>
<p>Your insight here was welcome and use, the attitude that this is belaboring the obvious (and implying that it&#8217;s a waste of your time to impart such wisdom directly to the plebes) is odious and reflects badly on you.</p>
<p>Why does it make you feel better to hand out some condescention (OMG did I spell that wrong?) with the fishing pole when someone asks for a fish? I guess you&#8217;re the drill sargeant (lol learn2spell, n00b) whose rough on his men but earns their respect? Do continue.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-351353">
				<div id="div-comment-351353" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Miral</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351353">
			March 2, 2006 at 6:35 pm</a>		</div>

		<p>How about &quot;WM_COMMAND *is* the notification message sent by a control to its parent window&quot;. &nbsp;No ambiguity there. &nbsp;There&#8217;s definitely ambiguity in the MSDN statement, although I think most people will parse it correctly.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-351463">
				<div id="div-comment-351463" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351463">
			March 3, 2006 at 7:10 am</a>		</div>

		<blockquote><p>
  Simulating a menu selection is exactly the<br />
  <br />&gt; same, except that (according to the rules<br />
  <br />&gt; above), you set the high-order word of the<br />
  <br />&gt; wParam to zero.</p>
<p>That&#8217;s obvious if you have some way of knowing which of the above rules is the obvious one to add an invisible phrase to. &nbsp;If you guess wrong about which rule, you might not even add an invisible phrase, you might just obey the rule where you have to say which control is sending the message. &nbsp;The invisible phrase that needs adding is exactly this, &quot;Simulating a menu selection, you set the high-order word of the wParam to zero&quot;.</p>
<p>Another needed addition to the page on WM_COMMAND would say &quot;(except when the notification is sent by WM_NOTIFY or other message, as described in documentation for the individual control)&quot;.</p>
<p>Also a bunch of pages on notification-style notifications need some editing in order to distinguish the constant as a constant, and say what typedef identifier has to be used in declaring a variable. &nbsp;I copied some stuff from the MSDN page on one notification (forgot which one, sorry) and it wouldn&#8217;t compile because the stated syntax resulted in using a constant as a typename. &nbsp;I never did find out what the correct name of the typedef identifier was. &nbsp;I gave up and found some other way to code around it. &nbsp;Later I noticed a bunch of descriptions of notifications suffer from the same writing style.
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-oldnewthing bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-351513">
				<div id="div-comment-351513" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351513">
			March 3, 2006 at 11:43 am</a>		</div>

		<p>Norman, please be specific. Where do you want the parenthetical remark added? Where are the &quot;bunch of pages&quot;?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-351643">
				<div id="div-comment-351643" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">JD</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351643">
			March 5, 2006 at 5:22 pm</a>		</div>

		<p>It doesn&#8217;t have to be a parenthetical. Just explain as you did here. Or put in a small table:</p>
<p>MESSAGE SOURCE: Menu<br />
<br />WPARAM (high part): 0<br />
<br />WPARAM (low part): IDM code for menu<br />
<br />LPARAM: 0</p>
<p>MESSAGE SOURCE: Accelerator<br />
<br />WPARAM (high part): 1<br />
<br />WPARAM (low part): IDM code for accelerator<br />
<br />LPARAM: 0</p>
<p>MESSAGE SOURCE: Control<br />
<br />WPARAM (high part): notification code (defined by control)<br />
<br />WPARAM (low part): Control ID<br />
<br />LPARAM: handle to control window</p>
<p>Quibble about the wording if you want, but a table makes this clearer that there are threee cases and which params are what. Parsing it is much easier than parentheticals or trying to change a word or two. &nbsp;<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-351663">
				<div id="div-comment-351663" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351663">
			March 5, 2006 at 10:58 pm</a>		</div>

		<p>Friday, March 03, 2006 11:43 AM by oldnewthing</p>
<p>&gt; Norman, please be specific. Where do you<br />
<br />&gt; want the parenthetical remark added?</p>
<p>Thank you for your interest. &nbsp;I think that the MSDN page on WM_COMMAND is not as obvious as you think it is, for the reasons I stated. &nbsp;I already did run into problems and got help from MVPs (or maybe one MVP and one other ordinary newsgroup participant). &nbsp;They explained that when simulating a menu invocation we have to disobey the instructions about saying which control sent the command, we have to make it look as though the command came from the menu not from the control. &nbsp;When reading your posting and seeing that you cited someone else with a variation on the same problem, I was relieved to see I wasn&#8217;t the only one.</p>
<p>&gt; Where are the &quot;bunch of pages&quot;?</p>
<p>Various notification messages from individual controls. &nbsp;MSDN has subsections on individual controls, including subsubsections on the messages, notifications, structures, etc. for each individual controls. &nbsp;Each notification gets its own page. &nbsp;A bunch of them confuse constants (a numeric value saying which kind of notification) with datatypes (what kind of structure is pointed to by a pointer), and in one case I never could figure out what the datatype was supposed to be.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-oldnewthing bypostauthor even thread-even depth-1" id="comment-351683">
				<div id="div-comment-351683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351683">
			March 6, 2006 at 2:50 am</a>		</div>

		<p>&quot;when simulating a menu invocation we have to disobey the instructions about saying which control sent the command, we have to make it look as though the command came from the menu not from the control.&quot;</p>
<p>Um, the rule about which control sent the command doesn&#8217;t apply if you want to simulate a menu action; it applies if you want to simulate a control, which you aren&#8217;t. If you want to simulate a menu, then follow the menu rules. You&#8217;re not disobeying anything.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-351693">
				<div id="div-comment-351693" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351693">
			March 6, 2006 at 4:05 am</a>		</div>

		<p>} lParam<br />
<br />} Handle to the control sending the message if<br />
<br />} the message is from a control. Otherwise,<br />
<br />} this parameter is NULL.</p>
<p>Handle to the control sending the message if the message is from a control (except if the message is a simulated menu command even when it was sent from a control). &nbsp;Otherwise (including if the message is a simulated menu command sent from a control) this parameter is NULL.</p>
<p>How can you say that the page makes that obvious?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-351713">
				<div id="div-comment-351713" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">8</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-351713">
			March 6, 2006 at 6:13 am</a>		</div>

		<p>Because it says what it is, how it is? </p>
<p>IMHO it&#8217;s safe for the docs to assume that the reader writes the window procedures and Send or Post Message calls, or atleast knows thoroughly about them. And if you don&#8217;t care about a certain WM_COMMAND you received, return FALSE.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-355403">
				<div id="div-comment-355403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-355403">
			March 16, 2006 at 5:27 am</a>		</div>

		<p>Friday, March 03, 2006 11:43 AM by oldnewthing<br />
<br />&gt; Where are the &quot;bunch of pages&quot;?</p>
<p>Since I needed to look at NMHDR yesterday, it reminded me. &nbsp;There are a bunch of structures that start with an NMHDR, and depending on the kind of notification, the application should cast the pointer to a type that points to the larger structure. &nbsp;There are probably identifiers that are typedef&#8217;ed for the structure and pointer types, but MSDN isn&#8217;t saying. &nbsp;I couldn&#8217;t figure out what to cast it to.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-632823">
				<div id="div-comment-632823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://bobobobo.wordpress.com/2008/02/09/windows-function-references/' rel='external nofollow' class='url'>Windows function references &laquo; Bobobobo&#8217;s Weblog</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060302-10/?p=32093#comment-632823">
			May 26, 2008 at 11:29 am</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://bobobobo.wordpress.com/2008/02/09/windows-function-references/" rel="nofollow">http://bobobobo.wordpress.com/2008/02/09/windows-function-references/</a></p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

