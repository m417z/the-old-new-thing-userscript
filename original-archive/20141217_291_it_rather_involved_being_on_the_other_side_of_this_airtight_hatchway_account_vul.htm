<html>
<head>
<title>It rather involved being on the other side of this airtight hatchway: Account vulnerable to Active Directory administrator</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>It rather involved being on the other side of this airtight hatchway: Account vulnerable to Active Directory administrator</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>December 17, 2014 / year-entry #292</td></tr>
<tr><td><b>Tags:</b></td><td>other</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>45</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">A security vulnerability report came in that went something like this: Disclosure of arbitrary data from any user An attacker can obtain arbitrary data from any user by means of the following steps: Obtain administrative access on the domain controller. Stop the XYZZY service. Edit the XYZZY.DAT file in a hex editor and changes the...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>A security vulnerability report came in that went something like this:</p>
<blockquote class="q"><p>  <b>Disclosure of arbitrary data from any user</b> </p>
<p> An attacker can obtain arbitrary data from any user by means of the following steps: </p>
<ol>
<li>Obtain administrative access on the domain controller. </li>
<li>Stop the XYZZY service. </li>
<li>Edit the XYZZY.DAT file in a hex editor     and changes the bytes starting     at offset 0x4242 as follows: </li>
<li>... </li>
</ol>
</blockquote>
<p> There's no point continuing, because the first step assumes that you are on the other side of the airtight hatchway. If you have compromised the domain controller, then you control the domain. From there, all the remaining steps are just <a href="http://blogs.msdn.com/b/oldnewthing/archive/2009/04/09/9539191.aspx"> piling on style points and cranking up the degree of difficulty</a>. </p>
<p> A much less roundabout attack is as follows: </p>
<blockquote class="q"><ol>
<li>Obtain administrative access on the domain controller. </li>
<li>Deploy a logon script to all users that     <i>does whatever you want</i>. </li>
<li>Wait for the user to log in next, and your script will     DO ANYTHING YOU WANT. </li>
</ol>
</blockquote>
<p> No, wait, I can make it even easier. </p>
<blockquote class="q"><ol>
<li>Obtain administrative access on the domain controller. </li>
<li>Change the victim's password. </li>
<li>Log on as that user and DO ANYTHING YOU WANT. </li>
</ol>
</blockquote>
<p> You are the domain administrator. You already pwn the domain. That you can pwn a domain that you pwn is really not much of a surprise. </p>
<p> This is why it is important to choose your domain administrators carefully. </p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (45)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment byuser comment-author-entegygmail-com even thread-even depth-1" id="comment-1167003">
				<div id="div-comment-1167003" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Entegy' rel='external nofollow' class='url'>Entegy</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167003">
			December 17, 2014 at 7:14 am</a>		</div>

		<p>Man, they didn&#39;t even pretend this time around. Step one was essentially &quot;pick run as admin from context menu&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1167013">
				<div id="div-comment-1167013" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167013">
			December 17, 2014 at 7:14 am</a>		</div>

		<p>I&#39;ve seen stuff like this come up due to the Stupidity of the S-Ox law. The reset password is detected very quickly which is good enough but the direct attacks won&#39;t be.</p>
<p>As late as XP we had a solution: remove Domain Administrators from the Administrators group. Vista puts it back.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167023">
				<div id="div-comment-1167023" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">henke37</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167023">
			December 17, 2014 at 7:14 am</a>		</div>

		<p>Admins being able to do whatever they want? Shocking!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1167053">
				<div id="div-comment-1167053" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Kirillenseer</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167053">
			December 17, 2014 at 7:41 am</a>		</div>

		<p>I&#39;d really like to know who&#39;s stupid enough to pull that off.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alegrigoriev even thread-even depth-1" id="comment-1167063">
				<div id="div-comment-1167063" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/alegr1' rel='external nofollow' class='url'>alegr1</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167063">
			December 17, 2014 at 8:05 am</a>		</div>

		<p>There is a subtle difference.</p>
<p>Resetting the password will have the user noticing that. This may also cause loss of access to encrypted files.</p>
<p>Having a local administrator access to the computer will not get you access to the user&#39;s encrypted files, if the recovery certificate is removed from the computer.</p>
<p>But if you run a script in the login context of the user, you can get all their encrypted files, and the user will not notice that. Ed Snowden likes that.</p>
<div class="post">[<em>Doesn&#39;t matter, because the domain administrator will set up the domain controller as the recovery agent. The intended purpose is so that if you lose your encryption key, you can ask the domain controller for a backup copy. But it also means that the domain administrator can decrypt all your stuff. &quot;This is why it is important to choose your domain administrators carefully.&quot; -Raymond</em>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1167073">
				<div id="div-comment-1167073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Freddie</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167073">
			December 17, 2014 at 8:50 am</a>		</div>

		<p>Looks like time for a follow-on to the venerable MS07-052:</p>
<p>MS14-052: &nbsp;Administrator privileges result in administrator privileges.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-entegygmail-com even thread-even depth-1" id="comment-1167083">
				<div id="div-comment-1167083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Entegy' rel='external nofollow' class='url'>Entegy</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167083">
			December 17, 2014 at 8:57 am</a>		</div>

		<p>Is there something special about MS07-052? Or was that just a random number and it happens to map to a legit vulnerability?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-iboyd odd alt thread-odd thread-alt depth-1" id="comment-1167093">
				<div id="div-comment-1167093" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/IanBoyd' rel='external nofollow' class='url'>IanBoyd</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167093">
			December 17, 2014 at 9:02 am</a>		</div>

		<p>@Entegy I believe he is trying to imply that allowing Domain Admins to create logon scripts is a &quot;Remote Code Execution vulnerability&quot;. I believe he is confusing &quot;remote code execution vulnerability&quot; with &quot;not remote code execution vulnerability&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167103">
				<div id="div-comment-1167103" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167103">
			December 17, 2014 at 9:08 am</a>		</div>

		<p>Entegy, IanBoyd: <a rel="nofollow" target="_new" href="http://blogs.msdn.com/b/oldnewthing/archive/2007/08/07/4268706.aspx#4282521">blogs.msdn.com/&#8230;/4268706.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1167113">
				<div id="div-comment-1167113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Hildar</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167113">
			December 17, 2014 at 9:10 am</a>		</div>

		<p>Better report this security bug now! If an attacker can get physical access to a (writeable) Domain Controller, they can, through a convoluted method, set everyone&#39;s desktop to cat pictures!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167163">
				<div id="div-comment-1167163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Brad</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167163">
			December 17, 2014 at 2:09 pm</a>		</div>

		<p>I appreciate and enjoy these &quot;airtight hatchway&quot; posts. But I think they show the disconnect that software designers have with ordinary people. Ordinary people don&#39;t expect that domain administrators can read everyone&#39;s documents.</p>
<p>I actually think a lot of security problems come down to the fact that the design of the security policies in Operating Systems doesn&#39;t account for user psychology very well at all (i.e. programmers are crappy psychologists).</p>
<p>There certainly are other ways it could work that would prevent this sort of thing (e.g. shared secrets, etc.).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-mngoldeneagle odd alt thread-odd thread-alt depth-1" id="comment-1167183">
				<div id="div-comment-1167183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/MNGoldenEagle' rel='external nofollow' class='url'>MNGoldenEagle</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167183">
			December 17, 2014 at 2:37 pm</a>		</div>

		<p>@Brad: There are, but it&#39;s not easy to keep the balance between security strength vs usability. &nbsp;It ultimately has to do with the fact that it&#39;s really hard to share secrets and keep them secret. &nbsp;The more the secret is shared, the less of a secret it is/may be. &nbsp;You can make the secret harder to understand, but that intrinsically makes communication more difficult. &nbsp;The same parallels are seen in computer science as well.</p>
<p>Then you have the whole &quot;this should be secret even though you don&#39;t really know that&quot; thing, like what UAC is supposed to help with. &nbsp;The problem is that ultimately for most people computers are appliances that are used to fulfill tasks, not objects of value that need to be protected (at least, not software-wise). &nbsp;Making users understand that requires them to completely rethink what computers are, which isn&#39;t practical. &nbsp;This is why the major OS companies lock down application functionality very tightly for consumer-based devices: if the user doesn&#39;t understand the value, then the OS needs to protect the user.</p>
<p>It kind of sucks for power users and administrators who enjoy the flexibility of running arbitrary programs and scripts, but then again, that&#39;s what rooting and Windows Desktop is for.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-hikari even thread-even depth-1" id="comment-1167193">
				<div id="div-comment-1167193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Chris+Crowther' rel='external nofollow' class='url'>Chris Crowther</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167193">
			December 17, 2014 at 3:31 pm</a>		</div>

		<p>You can&#39;t really use technical solutions to fix non-technical problems. &nbsp;If you don&#39;t trust someone with administrative rights then don&#39;t make them an administrator. &nbsp;That&#39;s really the only solution you have to the &quot;problem&quot; of &quot;administrators can do anything they want&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-harry-johnston odd alt thread-odd thread-alt depth-1" id="comment-1167203">
				<div id="div-comment-1167203" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Harry+Johnston' rel='external nofollow' class='url'>Harry Johnston</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167203">
			December 17, 2014 at 4:13 pm</a>		</div>

		<p>@Joshua: removing Domain Administrators from the Administrators group doesn&#39;t achieve much anyway. &nbsp;Group policy would be the easiest way for a rogue administrator to bypass it, though there are plenty of other methods, even without resetting passwords. &nbsp;(For one thing, a domain administrator has access to the Kerberos master secret, so could construct forged access tokens.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167213">
				<div id="div-comment-1167213" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167213">
			December 17, 2014 at 5:15 pm</a>		</div>

		<p>@Harry Johnson: With that removed we can block GPO updates permanently then audit the existing policy. Forging the kerberos ticket doesn&#39;t do anything with the server service disabled. Resetting the password works, but that&#39;s intentional and noisy.</p>
<div class="post">[<em>If you distrust the domain so much, then why did you join the domain? -Raymond</em>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cheong odd alt thread-odd thread-alt depth-1" id="comment-1167233">
				<div id="div-comment-1167233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/cheong00' rel='external nofollow' class='url'>cheong00</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167233">
			December 17, 2014 at 6:01 pm</a>		</div>

		<p>Some people prefer TrueCrypt over BitLocker because of this &#8211; it&#39;s not controlled by GP so if the domain controller got compromised, the attackers don&#39;t have immediate access to your documents.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167243">
				<div id="div-comment-1167243" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">meh</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167243">
			December 17, 2014 at 6:12 pm</a>		</div>

		<p>I usually remember to encrypt all my truly confidential files with my own private key, which I store in C:miscpins_and_keys.txt in case I forget it.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-harry-johnston odd alt thread-odd thread-alt depth-1" id="comment-1167253">
				<div id="div-comment-1167253" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Harry+Johnston' rel='external nofollow' class='url'>Harry Johnston</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167253">
			December 17, 2014 at 6:51 pm</a>		</div>

		<p>@Joshua: well &#8230; maybe. &nbsp;A rogue domain admin could change the password and then change it back again straight away (tricky, but not impossible) or subvert the password verification process. &nbsp;But if the machine isn&#39;t accessible over the network anyway, and assuming that the attacker doesn&#39;t have physical access, I don&#39;t suppose that would matter.</p>
<p>I think you&#39;d be better off not joining the machine(s) to the domain in the first place, though. &nbsp;I&#39;m not convinced that &quot;security by hacking&quot; is a sound approach.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167273">
				<div id="div-comment-1167273" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167273">
			December 17, 2014 at 8:18 pm</a>		</div>

		<p>[If you distrust the domain so much, then why did you join the domain? -Raymond]</p>
<p>To use single sign-on to access domain resources.</p>
<div class="post">[<em>Then you have a social problem, not a technology problem. The domain administrator said, &quot;All computers which access domain resources must adhere to the following policies&#8230;&quot; You don&#39;t want to adhere to those policies. You need to talk to your domain administrator and work out some sort of agreement, say, to exempt your computer from some of the domain policies. -Raymond</em>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1167173">
				<div id="div-comment-1167173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167173">
			December 17, 2014 at 2:30 pm</a>		</div>

		<p>@Brad: So, you think you can design an OS for which the administrator cannot arrange to read other people&#39;s documents. Did you consider the administrator enabling the kernel debugger to change the kernel behavior against your design? Did you think about the administrator replacing the OS on disk with a modified version that does some checks differently? Did you think about how to apply updates at all?</p>
<p>The necessary constraint to make this even *possible* is the authoritative code signing and hardware enforcement rejected by the marketplace.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167283">
				<div id="div-comment-1167283" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Harry Johnston</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167283">
			December 17, 2014 at 11:28 pm</a>		</div>

		<p>@Joshua: Sounds like a lot of trouble just to avoid people having to re-enter their password occasionally, but YMMV. </p>
<p>(I think there are third-party SSO solutions, FWIW, but I don&#39;t know how well they work.)</p>
<p>Rather than removing Domain Admins from the Administrators group (since that doesn&#39;t work post-XP) couldn&#39;t you assign &quot;deny access to this computer from the network&quot;, et. al., to the Domain Admins group? &nbsp;I think it would have the same effect.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1167313">
				<div id="div-comment-1167313" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Steve</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167313">
			December 18, 2014 at 2:32 am</a>		</div>

		<p>We&#39;ve just had external security consultants in and they&#39;ve come back with a whole host of these &#39;faults&#39;. </p>
<p>Having insisted on being provided with a domain account, and a username/password pair set up with full admin access to one of our systems, they then had the bare-faced cheek to submit the fact that they could amend data as a high level risk. The trouble is that the eventual report gets read by organisational high-level, but non-technical, people, who see the flag for the high level risk and go into full blame and panic mode; it&#39;s then up to us to try to convince them that the pen testers were already on the other side of the metaphorical hatch-way. But the consultants must be right, because we paid them lots of money.</p>
<p>At least they didn&#39;t submit the fault the same bunch flagged as a high level risk three years ago; that all of our web servers were exposing port 80. Man, that was a fun one to make go away &#8230; </p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167323">
				<div id="div-comment-1167323" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Lev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167323">
			December 18, 2014 at 4:06 am</a>		</div>

		<p>@Steve Well you shouldn&#39;t have given them admin access.</p>
<p>Also, how about intentionally creating vulnerabilities in order to check whether the consultants find them?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1167333">
				<div id="div-comment-1167333" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">DosFreak</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167333">
			December 18, 2014 at 5:16 am</a>		</div>

		<p>What&#39;s this with not being able to remove Domain Admins? IIRC, the group is added on connecting a computer to the domain but not added afterwords. A GPP push to administer the local administrators group takes care of the initial problem and by default runs every 90 minutes anyway. Obviously this doesn&#39;t prevent a Domain Admin from doing anything they want but it is an extra layer of security.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167363">
				<div id="div-comment-1167363" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167363">
			December 18, 2014 at 6:30 am</a>		</div>

		<p>Steve understands the actual driving force.</p>
<p>[ ] Only accountants have access to machines with accounting records.</p>
<p>[ ] Use of single signon to disable accounts of people leaving.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1167373">
				<div id="div-comment-1167373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Eddie</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167373">
			December 18, 2014 at 6:55 am</a>		</div>

		<p>I love these non-vulnerability articles. &nbsp;The categories box should now read like the following:</p>
<p>Code</p>
<p>History</p>
<p>It Rather Involved</p>
<p>Non-Computer</p>
<p>Other (Computer)</p>
<p>Tips/Support</p>
<p>All tags</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167413">
				<div id="div-comment-1167413" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167413">
			December 18, 2014 at 8:05 am</a>		</div>

		<p>At a few companies where I&#39;ve worked, the problem wasn&#39;t finding Domain Administrators who could be trusted with secrets, but rather finding Domain Administrators who weren&#39;t completely incompetent.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alegrigoriev odd alt thread-odd thread-alt depth-1" id="comment-1167423">
				<div id="div-comment-1167423" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/alegr1' rel='external nofollow' class='url'>alegr1</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167423">
			December 18, 2014 at 8:30 am</a>		</div>

		<p>@Steve:</p>
<p>If I were the security consultant, I would have written your org up for giving domain admin credentials to a third party (me).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167463">
				<div id="div-comment-1167463" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ex-DonH</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167463">
			December 18, 2014 at 10:18 am</a>		</div>

		<p>I cannot begin to tell you how many times this was reported during AD development. &nbsp;The fundamental solution to guarding against the guy who has complete control over your computer must be based on things that are not part of your computer, such as a security camera aimed at the administrative console and/or a guard with a gun.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1167533">
				<div id="div-comment-1167533" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Andre</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167533">
			December 18, 2014 at 3:17 pm</a>		</div>

		<p>Ironically enough, today a Linux &quot;vulnerability&quot; named &quot;Grinch&quot; makes the news that is exactly the same thing.</p>
<p>Users in the &quot;wheel&quot; group (when configured to give sudo rights) can use sudo to become root. So the linux version of &quot;an admin has admin rights&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167553">
				<div id="div-comment-1167553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">rwww</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167553">
			December 18, 2014 at 5:01 pm</a>		</div>

		<p>@ex-DonH: A guard is unlikely to have the knowledge and experience to understand what the admin is doing. A security camera might be helpful in post-incident forensics &#8211; or if there&#39;s another (competent) admin watching the feed with her/his finger on the &quot;big red button&quot; to kill the console session if needed.</p>
<p>One company I used to work for, admin access to certain sensitive servers was limited to text consoles connected via serial port &#8211; with a hardened box between each server and the serial terminals. In the box was a simple processor (program run from ROM) that (a) logged everything and (b) required 2 admins at terminals in separate rooms with one entering commands and the other confirming the commands. The 2 could discuss, via intercom (recorded), what needed to be done. In order to minimize the possibility of collusion, admins were randomly paired at the start and middle of each work shift. Also, members of a pair were not allowed to take a break at same time (except lunch, because new pairings would be done when they returned to work).</p>
<p>(At some point, monitors to display graphics were added, but all actual interaction remained via the serial text consoles.)</p>
<p>I&#39;m not sure how effective this really was, but, eventually, the CFO pursuaded the CIO it was too expensive, so a third of the admins were laid off and they rely solely on the logging. (Or did. I don&#39;t know what they do now.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cheong odd alt thread-odd thread-alt depth-1" id="comment-1167563">
				<div id="div-comment-1167563" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/cheong00' rel='external nofollow' class='url'>cheong00</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167563">
			December 18, 2014 at 5:10 pm</a>		</div>

		<p>@Andre: Wheel group member uses &quot;sudo&quot; to switch to root all the time they need &quot;real&quot; administrative access. Kind of the point like why UAC is created on Windows (with slightly different context). Is this even a &quot;news&quot;?</p>
<p>I think people who assigned to do Linux vulnerability check should have known better.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cheong even thread-even depth-1" id="comment-1167593">
				<div id="div-comment-1167593" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/cheong00' rel='external nofollow' class='url'>cheong00</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167593">
			December 18, 2014 at 10:39 pm</a>		</div>

		<p>@Harry Johnston: I now read the report too. What is say is like what Raymond set in the past: If you put your home user to &quot;Power Users&quot; group, there&#39;s little difference on putting it to &quot;Administrators&quot; group.</p>
<p>(The report involves someone able to install packages that requires &quot;root&quot; access to set the an executable file with &quot;setguid&quot; bit with &quot;pkcon&quot;, and claims if attacks can get package with vulnerability with your update repository, you can be pwned.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-harry-johnston odd alt thread-odd thread-alt depth-1" id="comment-1167583">
				<div id="div-comment-1167583" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Harry+Johnston' rel='external nofollow' class='url'>Harry Johnston</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167583">
			December 18, 2014 at 5:33 pm</a>		</div>

		<p>@Andre: reading the vulnerability report, it seems to me that the point is that there are supposed to be restrictions on sudo, and they&#39;ve found a way to bypass them. &nbsp;For example, in the default configuration you&#39;re supposed to have to put your password in (in case it isn&#39;t really you issuing the command) and this issue means that you don&#39;t need to after all.</p>
<p>Also, it is common enough to configure the system to allow certain non-admin users to issue specific commands (and *only* those commands) via sudo, and it sounds as though they&#39;ve bypassed that as well.</p>
<p>All in all, sounds like a legitimate issue to me.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167603">
				<div id="div-comment-1167603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Engywuck</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167603">
			December 18, 2014 at 10:47 pm</a>		</div>

		<p>I&#39;d rather expect the same people claiming &quot;Administrators should never be able to read my files&quot; are the same that come with &quot;why can&#39;t you recover the files of coworker X why got fired recently?&quot; when this could (would) be implemented. There simply *has* to be a way for at least file recovery.</p>
<p>Which leads me to another group which should be selected carefully: Backup Administrators (and in some cases Operators). Sure, there *may* exist some systems which only save hardware-encrypted data with a non-removable (non-copyable) hardware token and require multi-person authentication before recovery, but most systems I know allow the Backup Admin to restore any file to anywhere. Which means that even restore of the SID won&#39;t help too much against rogue Backup Admins. Especially if they are the same as the Domain Admins, as in many smallish organisations.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1167733">
				<div id="div-comment-1167733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167733">
			December 19, 2014 at 10:52 am</a>		</div>

		<p>[Then you have a social problem, not a technology problem.]</p>
<p>No, we have a Congress problem. Engywuck posted in detail deranged manner of mind that leads to wanting this set of technical behaviors. If we replace &quot;Administrators should never be able to read my files&quot; with &quot;Administrators should never be able to read my files without being caught&quot; we have something close enough to doable that we can fool the auditors we did it and so make it appear to the judge we complied with the law for which there can be no compliance.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167743">
				<div id="div-comment-1167743" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ex-DonH</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167743">
			December 19, 2014 at 11:38 am</a>		</div>

		<p>@rwww, the guard is there to shoot the admin if he touches the camera.</p>
<p>I kid on the mechanism, but I think we agree on the fundamentals: you cannot use a system to monitor or control the actions of someone who has complete control over that very same system. &nbsp;Use an external system whose details depend on your level of paranoia.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-fjeldse odd alt thread-odd thread-alt depth-1" id="comment-1167753">
				<div id="div-comment-1167753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Erik+F' rel='external nofollow' class='url'>Erik F</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167753">
			December 19, 2014 at 2:14 pm</a>		</div>

		<p>@Joshua: Given that an admin can basically do anything, it&#39;s not very surprising that they can mess with audit trails too; some trust in the admin is required, or else they shouldn&#39;t be an admin! If you absolutely need to prevent unauthorized admin logins, the only thing I can think of is only give out admin accounts that require RSA tokens or something similar (which you can then lock away.)</p>
<p>Also, pretty well anyone can read your data without getting caught if they have physical access to the computer; all they need is a spare hard drive and a disk duplicator.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167783">
				<div id="div-comment-1167783" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Harry Johnston</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167783">
			December 20, 2014 at 1:33 pm</a>		</div>

		<p>@cheong00: not quite the same, IMO. &nbsp;Power Users was *always* equivalent to Administrators, from day one, in any configuration, and by design. &nbsp;Wheel only became equivalent to root when the new authorization system was introduced, and it was unintentional. &nbsp;(Disclaimer: I&#39;m simply assuming the report is factually correct as far as that goes; I don&#39;t have any personal knowledge on the subject.)</p>
<p>@Joshua: half tongue-in-cheek, but what if you made your domain administrators obtain whatever certification the accountants have?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cheong odd alt thread-odd thread-alt depth-1" id="comment-1167813">
				<div id="div-comment-1167813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/cheong00' rel='external nofollow' class='url'>cheong00</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167813">
			December 21, 2014 at 5:38 pm</a>		</div>

		<p>@Harry Johnston: Actually &quot;wheel&quot; group exist a lot longer than that. It&#39;s introduced around the time when &quot;sudo&quot; is invented as a way to persuade administrators not to use &quot;root&quot; for their everyday use anymore.</p>
<p>By definition, if you don&#39;t want someone to have &quot;root&quot; access to your system, you should never put him/her into wheel group.</p>
<p>Also, one of the goals of &quot;PackageKit&quot; is to reduce the number of &quot;security prompt&quot; user encountered (Like the fine-tuned UAC behavior in Win7 when comparing with Vista). </p>
<p>So the fact that you can install programs without re-entering password is not intentional. It&#39;s by design too.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cheong even thread-even depth-1" id="comment-1167833">
				<div id="div-comment-1167833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/cheong00' rel='external nofollow' class='url'>cheong00</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167833">
			December 21, 2014 at 10:09 pm</a>		</div>

		<p>@Harry Johnston: Actually, you edit /etc/sudoers to allow non-wheel users to run root-access required commands, with or without passwords.</p>
<p><a rel="nofollow" target="_new" href="https://help.ubuntu.com/community/Sudoers">help.ubuntu.com/&#8230;/Sudoers</a> (note that in this documentation, the admin group is wheel group in other Linux systems)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1167843">
				<div id="div-comment-1167843" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Harry Johnston</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167843">
			December 21, 2014 at 10:29 pm</a>		</div>

		<p>@cheong00: ah, my mistake then. &nbsp;Thanks for clearing that up. &nbsp;I see the latest news on &quot;grinch&quot; is that it is pretty much exactly as you originally claimed: a non-issue.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167823">
				<div id="div-comment-1167823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Harry Johnston</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167823">
			December 21, 2014 at 6:58 pm</a>		</div>

		<p>@cheong00: as I understand it, you *have* to put someone in the wheel group if you want them to be able to sudo. &nbsp;Is that not true? &nbsp;Of necessity, in some scenarios, that includes people who shouldn&#39;t have unrestricted root access, but need to be able to run certain specific commands as root &#8211; to pick an example from my workplace at random, starting and stopping a web server. &nbsp;That&#39;s documented functionality; you can configure sudo to only allow certain users to issue specific commands. &nbsp;If it&#39;s true that a bug means they can run arbitrary commands, instead of just the ones they&#39;re supposed to be able to, then that&#39;s a security vulnerability by any reasonable definition.</p>
<p>By way of analogy, I have a system service installed on some of my Windows machines that is configured so that any user can start and stop it. &nbsp;If Windows had a bug that meant those users could start and stop *any* service, rather than just the one that is configured to allow it, that would be a security vulnerability. &nbsp;Surely in that case you wouldn&#39;t say, &quot;if you don&#39;t want someone to be able to start and stop any service, don&#39;t give them permission to start and stop your service&quot;? &nbsp;How is being able to run an arbitrary sudo command instead of a specific one any different?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1167893">
				<div id="div-comment-1167893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anon</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167893">
			December 22, 2014 at 8:26 am</a>		</div>

		<p>@Joshua</p>
<p>No such legislation exists. It is a gross misreading.</p>
<p>But I work with accountants, and I&#39;ve come to expect them to generally not understand the law.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1167923">
				<div id="div-comment-1167923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Skyborne</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141217-00/?p=43373#comment-1167923">
			December 22, 2014 at 9:36 am</a>		</div>

		<p>@Harry Johnston: sudo access is restricted by the intersection of PAM and sudoers configurations, and the defaults set by popular distros grant wide permissions to use sudo to &quot;all members of the wheel group&quot;. &nbsp;Generally they can run any command; frequently as any user (and not just root, which is basically equivalent, thanks to `sudo su &#8211; otheruser`); and in certain cases like Amazon EC2 instances, maybe even *passwordless* rights.</p>
<p>So while yes, the default answer is &quot;sudo doesn&#39;t work unless you&#39;re wheel,&quot; that&#39;s also completely configurable.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

