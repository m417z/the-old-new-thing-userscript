<html>
<head>
<title>Beware the Image File Execution Options key</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>Beware the Image File Execution Options key</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>December 19, 2005 / year-entry #390</td></tr>
<tr><td><b>Tags:</b></td><td>other</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>20</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">Beware the Image File Execution Options key (more). Its power can be used for evil as well as for good. Its intended use is to force a program to run under a debugger regardless of how it is launched (and secondarily to alter how the system treats the program). It's handy if you need to...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>Beware <a href="http://blogs.msdn.com/junfeng/archive/2004/04/28/121871.aspx"> the Image File Execution Options key</a> (<a href="http://blogs.msdn.com/greggm/archive/2005/02/21/377663.aspx">more</a>). Its power can be used for evil as well as for good.</p>
<p> Its intended use is to force a program to run under a debugger regardless of how it is launched (and secondarily to alter how the system treats the program). It's handy if you need to debug a program "in the wild" rather than under the controlled environment of your favorite IDE. For example, you can use it if you want to debug how a program runs when it is launched by some other program you can't debug. </p>
<p> Two things people often forget: </p>
<ul>
<li>If you err in specifying the debugger, the program won't launch     at all.     For example, if you get the path to the debugger wrong     or if you subsequently uninstall the debugger,     you'll get ERROR_FILE_NOT_FOUND when you try to run the target     program since the system can't find the debugger. </li>
<li>Remember to delete the entry for your program when you no     longer need it.     Otherwise you'll wonder why the debugger keeps launching     for no apparent reason. </li>
</ul>
<p> Evil can be done with the Image File Execution Options key. Malware can install themselves as the "debugger" for a frequently-run program (such as Explorer) and thereby inject themselves into the execution sequence. </p>
<p> Note that the ability to use the Image File Execution Options key for evil purposes is not a security hole. To modify the key in the first place requires administrator permissions. Consequently, anybody who can exploit this feature already owns your machine. </p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (20)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-331353">
				<div id="div-comment-331353" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">GregM</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-331353">
			December 19, 2005 at 10:58 am</a>		</div>

		<p>Thank you!!!!</p>
<p>I wish I knew about this YEARS ago.  It&#8217;s always a pain to try to debug startup problems that only happen when a user double-clicks on one of your files in Windows Explorer.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-aaron-margosis odd alt thread-odd thread-alt depth-1" id="comment-331363">
				<div id="div-comment-331363" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Aaron+Margosis' rel='external nofollow' class='url'>Aaron Margosis</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-331363">
			December 19, 2005 at 11:08 am</a>		</div>

		<p>One non-debugging use (for good):  Process Explorer (from SysInternals.com) can make itself a replacement for Task Manager.  The IFEO key is how it does that.</p>
<p>The fact that it can be used for Evil is why IFEO keys are listed by SysInternals&#8217; &quot;AutoRuns&quot; utility.  But as Raymond alludes, if the bad guys have inserted an IFEO key, they can also load a kernel-mode rootkit that can completely hide the fact that they&#8217;ve done so.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-331383">
				<div id="div-comment-331383" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://mcfunley.com' rel='external nofollow' class='url'>Dan McKinley</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-331383">
			December 19, 2005 at 11:25 am</a>		</div>

		<p>It can also be used for high comedy. </p>
<p><a rel="nofollow" target="_new" href="http://mcfunley.com/cs/blogs/dan/archive/2005/06/23/448.aspx" rel="nofollow">http://mcfunley.com/cs/blogs/dan/archive/2005/06/23/448.aspx</a><br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-331453">
				<div id="div-comment-331453" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Cheong</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-331453">
			December 19, 2005 at 9:32 pm</a>		</div>

		<p>Dan McKinley,</p>
<p>    Your comment make me think of the idea for commercial spys to steal information.</p>
<p>    In a less secure company where staffs share workstations and everyone has admin right login, one can easily use prewritten programs to inject the key to other users registry, then have others run the background program to steal information using their identity. </p>
<p>    The spy will just have to remember to wipe the key out when completed, and the database log will only show the ID of another staff have downloaded suspiciously huge amount of data.</p>
<p>    How do others think? I&#8217;ll be glad to know this won&#8217;t be the case for whatever reason.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-331463">
				<div id="div-comment-331463" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://mcfunley.com' rel='external nofollow' class='url'>Dan McKinley</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-331463">
			December 19, 2005 at 10:19 pm</a>		</div>

		<p>I think that&#8217;s basically what Raymond is saying. I gave a fairly benign abuse of the debugger value, but running users as admins opens you up to malware that takes advantage of it.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-331473">
				<div id="div-comment-331473" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-331473">
			December 19, 2005 at 10:58 pm</a>		</div>

		<p>If you insert a Sony CD into your machine while logged in with administrative privileges, then Sony 0wns your machine.  So why did Sony bother constructing a rootkit?  They 0wn your machine.</p>
<p>Well, Sony constructed a rootkit because they wanted to make it difficult for you to discover that they 0wn your machine.  Malware does benefit by making it hard for you to notice it&#8217;s there.</p>
<p>Of course we can&#8217;t do away with such an important debugging tool, but maybe something can be done.  Consider that blank passwords, even when they are the correct passwords, no longer authenticate incoming network connections.  Maybe the Image File Execution Options key can be made more restrictive, maybe only allowing the launching of known debuggers so that the user knows it&#8217;s happening.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-331483">
				<div id="div-comment-331483" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Aaron</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-331483">
			December 19, 2005 at 11:24 pm</a>		</div>

		<p>You don&#8217;t think thats a security hole?  How many people run the different versions of Windows out there as a non-admin?</p>
<p>I&#8217;ve never run as anything other than an Admin.  Windows just doesn&#8217;t seem designed for you to switch users or something when you want to do an Admin task&#8230; Maybe thats just cause I have used it for awhile, but I gotta figure there are tons of people like me out there.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-dean-harding odd alt thread-odd thread-alt depth-1" id="comment-331493">
				<div id="div-comment-331493" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Dean+Harding' rel='external nofollow' class='url'>Dean Harding</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-331493">
			December 19, 2005 at 11:45 pm</a>		</div>

		<p>But that&#8217;s the point, Aaron, if you&#8217;re already running as an admin then there&#8217;s nothing that these keys will give you that you can&#8217;t do already. It&#8217;s only a security problem if they gave you MORE power than you would normally have. For example, if you were already an admin there&#8217;s no reason why you couldn&#8217;t just copy your malicious executable over C:WINDOWSnotepad.exe.</p>
<p>The security hole is the fact that you&#8217;re running as an admin in the first place, not the fact that an admin can modify those keys.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-331523">
				<div id="div-comment-331523" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://slashstar.com/blogs/tim/' rel='external nofollow' class='url'>Tim Marman</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-331523">
			December 20, 2005 at 9:45 am</a>		</div>

		<p>Yeah, I wrote about using this for comedy back in 2004 in a post entitled &quot;How to Have Fun&#8230; At the expense of your coworkers&quot;.</p>
<p><a rel="nofollow" target="_new" href="http://slashstar.com/blogs/tim/archive/2004/07/12/751.aspx" rel="nofollow">http://slashstar.com/blogs/tim/archive/2004/07/12/751.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-332063">
				<div id="div-comment-332063" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.mastropaolo.com' rel='external nofollow' class='url'>Purplet [italy]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-332063">
			December 21, 2005 at 4:17 am</a>		</div>

		<p>Norman, what is a  &quot;known debugger&quot; ?</p>
<p>There is a whole bunch of debuggers from different vendors, open source or in house developed.</p>
<p>The power of choosing which ones are trusted debuggers and which ones aren&#8217;t won&#8217;t choose the fair competition price..</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-332073">
				<div id="div-comment-332073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.mastropaolo.com' rel='external nofollow' class='url'>Purplet [italy]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-332073">
			December 21, 2005 at 4:18 am</a>		</div>

		<p>Typo : &quot;won&#8217;t *choose* the fair competition price&quot; is &quot;won&#8217;t *win* the fair competition price&quot; ;)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-332533">
				<div id="div-comment-332533" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-332533">
			December 21, 2005 at 10:26 pm</a>		</div>

		<p>Wednesday, December 21, 2005 4:17 AM by Purplet [italy]<br />
<br />&gt; Norman, what is a &quot;known debugger&quot; ?</p>
<p>I meant one that&#8217;s known to the currently running system, e.g. if the administrator has installed Visual Studio 6 and Visual Studio 2005 beta 1 and WinDbg then probably 3 debuggers have been registered.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-333323">
				<div id="div-comment-333323" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mike Fried</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-333323">
			December 30, 2005 at 4:39 pm</a>		</div>

		<p>Norman Diamond wrote: &quot;I meant one that&#8217;s known to the currently running system, e.g. if the administrator has installed Visual Studio 6 and Visual Studio 2005 beta 1 and WinDbg then probably 3 debuggers have been registered.&quot;</p>
<p>So that just requires an extra step of registering a debugger so you can set it on .exe files. It&#8217;s an extra hoop that doesn&#8217;t make a significant difference in the complexity of the attack, and most users don&#8217;t know what a debugger is, and never launch one intentionally.</p>
<p>I&#8217;m going to repeat the mantra: Once someone gets root on your PC the game is over. They own your system. The barriers you throw up only complicate the computer for the technical user. The average user isn&#8217;t skilled enough to know the difference between a debugger and an anti-virus. They just don&#8217;t care. Your added check wouldn&#8217;t prevent the hackers from having their way with your system once you gave them root.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-333353">
				<div id="div-comment-333353" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anon</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-333353">
			January 1, 2006 at 11:00 am</a>		</div>

		<p>Unfortunately there is a lot of software out there that assumes it is running in admin mode, and doesn&#8217;t work properly otherwise. Including some MS stuff. This forces users to run in admin mode. There needs to be an education effort with both developers and users that this behaviour is a very very bad thing.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-346493">
				<div id="div-comment-346493" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/jmstall/archive/2006/02/16/ifeo_managed_debugging.aspx' rel='external nofollow' class='url'>Mike Stall's .NET Debugging Blog</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-346493">
			February 16, 2006 at 2:16 pm</a>		</div>

		<p>Be careful&amp;amp;nbsp; of Image File Execution Options (IFEO) with managed debugging &#8211; it won&#8217;t work like you&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-379103">
				<div id="div-comment-379103" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/oldnewthing/archive/2006/05/10/594537.aspx' rel='external nofollow' class='url'>The Old New Thing</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-379103">
			May 10, 2006 at 10:00 am</a>		</div>

		<p>You&#8217;ve already lost the game.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-470963">
				<div id="div-comment-470963" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/whaggard/archive/2007/02/08/image-file-execution-options.aspx' rel='external nofollow' class='url'>Wes' Puzzling Blog</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-470963">
			February 8, 2007 at 10:28 pm</a>		</div>

		<p>Every now and than while debugging I need to either determine when a dll/module is loaded or need to</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-470973">
				<div id="div-comment-470973" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://puzzleware.net/blogs/archive/2007/02/08/Image-File-Execution-Options.aspx' rel='external nofollow' class='url'>Wes' Blog</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-470973">
			February 8, 2007 at 10:29 pm</a>		</div>

		<p>Every now and than while debugging I need to either determine when a dll/module is loaded or need to</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-690943">
				<div id="div-comment-690943" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.avertlabs.com/research/blog/index.php/2008/12/09/image-file-execution-options/' rel='external nofollow' class='url'>Computer Security Research - McAfee Avert Labs Blog</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-690943">
			December 9, 2008 at 5:41 pm</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://www.avertlabs.com/research/blog/index.php/2008/12/09/image-file-execution-options/" rel="nofollow">http://www.avertlabs.com/research/blog/index.php/2008/12/09/image-file-execution-options/</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-691223">
				<div id="div-comment-691223" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.charged.co.za/security/image-file-execution-options' rel='external nofollow' class='url'>Image File Execution Options | CHARGED's Digital Lifestyle at Work or Play</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20051219-11/?p=32923#comment-691223">
			December 10, 2008 at 12:16 pm</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://www.charged.co.za/security/image-file-execution-options" rel="nofollow">http://www.charged.co.za/security/image-file-execution-options</a></p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

