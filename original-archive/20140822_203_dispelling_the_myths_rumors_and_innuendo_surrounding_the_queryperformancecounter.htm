<html>
<head>
<title>Dispelling the myths, rumors, and innuendo surrounding the QueryPerformanceCounter function</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>Dispelling the myths, rumors, and innuendo surrounding the QueryPerformanceCounter function</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>August 22, 2014 / year-entry #204</td></tr>
<tr><td><b>Tags:</b></td><td>code</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>28</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">The Query­Performance­Counter function has been the subject of much rumor and innuendo. In response to all the confusion, the kernel folks put together a page which tries to settle the controversy once and for all. It discusses the history of QPC over the ages, the problems it had on earlier versions of Windows or older...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p> The <code>Query&shy;Performance&shy;Counter</code> function has been the subject of much rumor and innuendo. In response to all the confusion, the kernel folks put together a page which <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dn553408(v=vs.85).aspx"> tries to settle the controversy once and for all</a>. It discusses the history of QPC over the ages, the problems it had on earlier versions of Windows or older firmware (which is probably where a lot of the myths started), its interaction with hypervisors, offers guidance on how to use it and its alternatives, and includes a very nice Q&amp;A.</p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (28)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment byuser comment-author-wndsks even thread-even depth-1" id="comment-1145903">
				<div id="div-comment-1145903" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/skSdnW' rel='external nofollow' class='url'>skSdnW</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1145903">
			August 22, 2014 at 7:26 am</a>		</div>

		<p>&quot;QPC was introduced in Windows 2000 and Windows XP &#8230;&quot; <a href="http://wayback.archive.org/web/20021027042409/http://msdn.microsoft.com/library/en-us/winui/WinUI/WindowsUserInterface/Windowing/Timers/TimerReference/TimerFunctions/QueryPerformanceCounter.asp" rel="nofollow" target="_new">wayback.archive.org/&#8230;/QueryPerformanceCounter.asp</a> says Windows NT 3.1. How am I supposed to trust the rest of this document when it starts off this way?</p>
<div class="post">[<em>MSDN gradually loses its memory of products that are no longer in support. This makes sense in that you don&#39;t want MSDN to tell you about potential behaviors that no longer apply (imagine if <code>Interlocked&shy;Increment</code> still documented the old behavior where <a href="http://blogs.msdn.com/b/oldnewthing/archive/2004/05/06/127141.aspx">it only returned the sign of the result</a>), but it makes articles about history feel odd. (I guess the article in question could have started with &quot;Versions of Windows prior to Windows 2000 are not covered by this article.&quot;) -Raymond</em>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1145913">
				<div id="div-comment-1145913" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">OldFart</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1145913">
			August 22, 2014 at 7:54 am</a>		</div>

		<p>Interesting article. &nbsp;I like this new GetSystemTimePreciseAsFileTime function. &nbsp;I wonder how much argument went into deciding where to insert the word &quot;Precise&quot; in the function name.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alegrigoriev even thread-even depth-1" id="comment-1145923">
				<div id="div-comment-1145923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/alegr1' rel='external nofollow' class='url'>alegr1</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1145923">
			August 22, 2014 at 8:14 am</a>		</div>

		<p>First they fudged GetSystemTime functions by letting the clock correction to move time back. Now they invented the new function instead of fixing the old one.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1145933">
				<div id="div-comment-1145933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">UseSmallIcons</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1145933">
			August 22, 2014 at 8:33 am</a>		</div>

		<p>@alegr1</p>
<p>They couldn&#39;t fix the old one because there will already be people relying on how it currently works. Once it&#39;s out there, removing it or changing it&#39;s behaviour is something that is very hard to do, regardless of whether or not the current behaviour is &quot;broken&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1145953">
				<div id="div-comment-1145953" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Michael Kohne</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1145953">
			August 22, 2014 at 8:34 am</a>		</div>

		<p>Nice! I&#39;m glad they cleared all that up, it&#39;s been a long time coming.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1145963">
				<div id="div-comment-1145963" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1145963">
			August 22, 2014 at 9:16 am</a>		</div>

		<p>[MSDN gradually loses its memory of products that are no longer in support.]</p>
<p>Since offline manuals have fallen out of use, I foresee a problem in the future where documentation for Vista cannot be obtained.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1145983">
				<div id="div-comment-1145983" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Deduplicator</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1145983">
			August 22, 2014 at 9:46 am</a>		</div>

		<p>Regarding &quot;MSDN gradually loses its memory of products that are no longer in support.&quot;</p>
<p>In limited ways, that might make sense. But please do not make it gratuitiously hard on people searching for info on dated platforms, for example because they have to / finally are allowed to migrate some sources to the new OS.</p>
<p>Capping the introduced-in to the oldest still supported platform means that information is simply wrong.</p>
<p>Removing the details how the unsupported older version differed makes sense, but at least allude to it with a blanket &quot;versions prior to X had different behavior&quot; where applicable. For bonus points, link to an older version which has those details (MSDN accumulates slightly different versions of all kind of documentation anyway, lets make that somewhat useful).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1145993">
				<div id="div-comment-1145993" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Wear</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1145993">
			August 22, 2014 at 10:30 am</a>		</div>

		<p>@Deduplicator It&#39;s not wrong if you look at it from the MSDN point of view. Basically they&#39;re taking the position that unsupported versions of the software outright don&#39;t exist and never did. So it&#39;s true that they were introduced in those versions because there are no prior versions.</p>
<p>It&#39;s like that thing in the Wing Commander movie where they don&#39;t acknowledge pilots that have died. </p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-davebacher even thread-even depth-1" id="comment-1146013">
				<div id="div-comment-1146013" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Dave+Bacher' rel='external nofollow' class='url'>Dave Bacher</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146013">
			August 22, 2014 at 10:52 am</a>		</div>

		<p>If I recall correctly &#8212; the API was added for either Video for Windows or the Multimedia extensions as part of Windows 3.1/3.11wg, because you needed a higher resolution timer than WM_TIMER or the 18.2hz timer for those purposes. &nbsp;Typically you were decoding the video frames as quickly as you could, and using some combination of WM_USER and Invalidate that I don&#39;t recall right off the top of my head. &nbsp;Or at least, that&#39;s how it worked in the code that I worked with &#8212; which typically used two DIBs for the buffers and tried to treat it like a DOS-mode VGA then.</p>
<p>The article might start at that point because that&#39;s when kernel took over responsibility for it, though. &nbsp;That would be consistent with the Windows 2000 time frame. &nbsp;But the API was available before that, and so saying &quot;was introduced in&quot; is probably the part that is flawed.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1146033">
				<div id="div-comment-1146033" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">SimonRev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146033">
			August 22, 2014 at 11:54 am</a>		</div>

		<p>@Dave, your description sounds a bit more like the multimedia timer (timeSetEvent and &nbsp;timeGetTime) than the QueryÂ­PerformanceÂ­Counter </p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1146043">
				<div id="div-comment-1146043" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Greg M</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146043">
			August 22, 2014 at 12:22 pm</a>		</div>

		<p>&quot;Capping the introduced-in to the oldest still supported platform means that information is simply wrong.&quot;</p>
<p>While that&#39;s true, it doesn&#39;t say &quot;introduced-in&quot;, it says &quot;Minimum Supported&quot;, and those OSes aren&#39;t supported any more. &nbsp;That doesn&#39;t make it incredibly helpful, but it&#39;s not as outright wrong as &quot;introduced-in&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1146053">
				<div id="div-comment-1146053" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Voigt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146053">
			August 22, 2014 at 12:36 pm</a>		</div>

		<p>@GregM: In this particular case, it does say &quot;introduced in&quot;. &nbsp;You&#39;re right that moving the goalpost for &quot;Minimum Supported&quot; isn&#39;t outright false, just confusing because of the multiple meanings of &quot;supported&quot;. &nbsp;But the sentence under discussion here is false.</p>
<p>Similarly, mentions of pre-2000 versions could still have been avoided without making a flatly false statement by saying &quot;has been available since Windows 2000&quot; (true but potentially misleading).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1146063">
				<div id="div-comment-1146063" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Tim!</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146063">
			August 22, 2014 at 12:43 pm</a>		</div>

		<p>@Greg M: It does say &quot;introduced in&quot;: just after the first header &quot;QPC support in Windows versions&quot;. &nbsp;I don&#39;t see &quot;Minimum Supported&quot;. &nbsp;I think you&#39;re looking at a different page than the one Raymond linked.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1146073">
				<div id="div-comment-1146073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Greg M</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146073">
			August 22, 2014 at 1:48 pm</a>		</div>

		<p>I was looking at the MSDN page for the function, not the discussion page. &nbsp;The article is in fact completely wrong. &nbsp;:)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1146083">
				<div id="div-comment-1146083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alwaze Leery</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146083">
			August 22, 2014 at 1:51 pm</a>		</div>

		<p>Q: &quot;How do I determine and validate that QPC works on my machine? &quot;</p>
<p>A: &quot;You don&#39;t need to perform such checks.&quot;</p>
<p>What a great answer! &nbsp;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1146093">
				<div id="div-comment-1146093" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Azarien</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146093">
			August 22, 2014 at 2:01 pm</a>		</div>

		<p>&quot;All computers that shipped with Windows Vista and Windows Server 2008 used a platform counter&quot;</p>
<p>Umm, but what about a computer that shipped with older version of Windows and was later upgraded?</p>
<p>So this cannot be relied upon.</p>
<div class="post">[<em>The upgrade would have failed with &quot;Sorry, your computer cannot run Windows Vista.&quot; In the same way that all computers that shipped with Windows 8 support SSE2. -Raymond</em>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1146103">
				<div id="div-comment-1146103" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146103">
			August 22, 2014 at 2:40 pm</a>		</div>

		<p>[In the same way that all computers that shipped with Windows 8 support SSE2. -Raymond]</p>
<p>Having seen some W8 errors for unsupported hardware, I&#39;d say that much improvement in that area is needed.</p>
<p>The bootstrapper doesn&#39;t check for most things and kernel bluescreens on boot with a nonsensical error message. (Not possible to change config on the setup CD to disable the &quot;friendly&quot; messages and read off the actual codes.)</p>
<p>For that matter the change in W8.1 is really obnoxious in that it doesn&#39;t have the module offset address anymore. I&#39;m sure you think the module offset address is worthless to the consumer. Not so. A Google search for the two codes one after the other has a pretty good chance of finding forum posts of others having the same problem with a good chance of potential solutions or explanations.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-yuhong-bao odd alt thread-odd thread-alt depth-1" id="comment-1146123">
				<div id="div-comment-1146123" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Yuhong+Bao' rel='external nofollow' class='url'>Yuhong Bao</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146123">
			August 22, 2014 at 5:33 pm</a>		</div>

		<p>[The upgrade would have failed with &quot;Sorry, your computer cannot run Windows Vista.&quot; In the same way that all computers that shipped with Windows 8 support SSE2. -Raymond]</p>
<p>Then it should say &quot;runs&quot;, not &quot;shipped with&quot;.</p>
<div class="post">[<em>If the only things people can complain about are minor editing issues, then I guess this means that the article is pretty good. -Raymond</em>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1146163">
				<div id="div-comment-1146163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Deduplicator</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146163">
			August 23, 2014 at 7:32 am</a>		</div>

		<p>@Raymond: Ah, but we can always disagree with them being minor ;-)</p>
<p>And for those poor souls having to support software on / migrate from ms-unsupported legacy-systems, they certainly aren&#39;t.</p>
<p>Just yesterday heard someone curse about having to learn COBOL for a production-system, which is expected to still run in a decade&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1146173">
				<div id="div-comment-1146173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Klimax</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146173">
			August 23, 2014 at 1:21 pm</a>		</div>

		<p>&quot;All computers that shipped with Windows Vista and Windows Server 2008 used a platform counter&quot;</p>
<p>Umm, but what about a computer that shipped with older version of Windows and was later upgraded?</p>
<p>So this cannot be relied upon.</p>
<p>[The upgrade would have failed with &quot;Sorry, your computer cannot run Windows Vista.&quot; In the same way that all computers that shipped with Windows 8 support SSE2. -Raymond]</p>
<p>Interesting. Windows 7 will install on Pentium II/III machine. (440BX chipset) Might be interesting what source is in use&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1146183">
				<div id="div-comment-1146183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146183">
			August 23, 2014 at 4:31 pm</a>		</div>

		<p>@Klimax: &quot;Interesting. Windows 7 will install on Pentium II/III machine. (440BX chipset) Might be interesting what source is in use&#8230;&quot;</p>
<p>None. The logic probably goes &quot;Oh only one care. I can use RDTSC instruction unsynced.&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-yuhong-bao odd alt thread-odd thread-alt depth-1" id="comment-1146193">
				<div id="div-comment-1146193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Yuhong+Bao' rel='external nofollow' class='url'>Yuhong Bao</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146193">
			August 23, 2014 at 5:18 pm</a>		</div>

		<p>@Klimax: According to the article it would be the ACPI PMT.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1146203">
				<div id="div-comment-1146203" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">voo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146203">
			August 24, 2014 at 10:07 am</a>		</div>

		<p>@Yuhong Bao: I doubt that &#8211; the rtdsc instruction is by definition invariant on a system with one core, no frequency changes and no out of order execution (remember the good old time when cpus were oh so very simple?)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1146223">
				<div id="div-comment-1146223" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">smf</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146223">
			August 25, 2014 at 2:20 am</a>		</div>

		<p>I wonder how many people use this and what problems they come up against.</p>
<p><a rel="nofollow" target="_new" href="http://forums.mydigitallife.info/threads/46840-Windows-8-CPU-Feature-Patch-(Bypass-Windows-8-CPU-feature-checks)">forums.mydigitallife.info/&#8230;/46840-Windows-8-CPU-Feature-Patch-(Bypass-Windows-8-CPU-feature-checks)</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1146383">
				<div id="div-comment-1146383" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">fms</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146383">
			August 26, 2014 at 4:41 am</a>		</div>

		<p>@smf, Years ago I installed W98 on a Cyrix CPU (maybe something else, some other exotic chip). That chip didn&#39;t support the CMPXCHG instruction, and so the installer refused.</p>
<p>To bypass that I started installation on another box, and on the first reboot I put the harddisk in the Cyrix box. I cannot recall to have had any illegal instruction BSOD. So either that instruction was never used (hardly believable), or the chip /said/ it didn&#39;t support it, but actually did, or did a simple XCHG instead, or the OS felt back on legacy code from W95, which didn&#39;t need (and use?) that instruction.</p>
<p>The box was not extremely instable either.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1146543">
				<div id="div-comment-1146543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">A</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146543">
			August 27, 2014 at 5:49 am</a>		</div>

		<p>Unfortunately this article neglects to mention and explain two important timing features and how they are used and more importantly how they SHOULD be used in relation to/as compared to QPC:</p>
<p>Multimedia Timers (TimeGetTime)</p>
<p>Timer Queues/Synchronization (CreateTimerQueueTimer, etc.), which seem to be intended to obsolete Multimedia Timers (As seen here: <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd757634%28v=vs.85%29.aspx" rel="nofollow" target="_new">msdn.microsoft.com/&#8230;/dd757634%28v=vs.85%29.aspx</a>)</p>
<p>And since those are not mentioned, we still have no explanation for behaviour like this: <a href="http://omeg.pl/blog/2011/11/on-winapi-timers-and-their-resolution/" rel="nofollow" target="_new">omeg.pl/&#8230;/on-winapi-timers-and-their-resolution</a></p>
<p>Maybe you could ask the kernel folks if they might consider additionally addressing these as well in a future update of the article, or something like that? :)</p>
<div class="post">[<em>Timer queues are not intended to replace multimedia timers. They are the opposite of multimedia timers! Timer queues have high latency because of, y&#39;know, queueing. -Raymond</em>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1146553">
				<div id="div-comment-1146553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">A</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146553">
			August 27, 2014 at 5:57 am</a>		</div>

		<p>Also, this article is missing a reference to KB938448 (<a rel="nofollow" target="_new" href="http://support.microsoft.com/kb/938448/en">support.microsoft.com/&#8230;/en</a>), which it probably needs.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1146803">
				<div id="div-comment-1146803" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Gabe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140822-01/?p=163#comment-1146803">
			August 29, 2014 at 5:38 am</a>		</div>

		<p>Raymond: I think A was referring to the part of the MSDN docs for timeSetEvent that say &quot;This function is obsolete. New applications should use CreateTimerQueueTimer&quot;.</p>
<p>Perhaps it should say that it is obsolete for non-multimedia situations, because the current wording certainly implies that no new application should use it. And the timer queue docs say nothing about latency or what kind of applications may be inappropriate for use.</p>
<div class="post">[<em>I&#39;m not sure why that recommendation is there. CreateTimerQueueTimer is another way to create a periodic timer, but it is high latency due to queueing. -Raymond</em>]</div>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

