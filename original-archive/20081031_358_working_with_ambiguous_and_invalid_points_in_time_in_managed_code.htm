<html>
<head>
<title>Working with ambiguous and invalid points in time in managed code</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>Working with ambiguous and invalid points in time in managed code</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>October 31, 2008 / year-entry #359</td></tr>
<tr><td><b>Tags:</b></td><td>code;time</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>16</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">Public Service Announcement: Daylight Saving Time ends in most parts of the United States this weekend. I pointed out some time ago that Win32 and .NET deal with daylight saving time differently. Specifically, Win32 always deals with the time zone you are currently in (even if it's not the time zone that corresponds to the...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>Public Service Announcement: Daylight Saving Time ends in most parts of the United States this weekend.</p>
<p> I pointed out <a href="http://blogs.msdn.com/oldnewthing/archive/2003/10/24/55413.aspx"> some time ago</a> that Win32 and .NET deal with daylight saving time differently. Specifically, Win32 always deals with the time zone you are currently in (even if it's not the time zone that corresponds to the timestamp you are manipulating), whereas .NET deals with the time zone that was in effect at the time the timestamp was generated. </p>
<p> For more details on the latter, I refer you to Josh Free from <a href="http://blogs.msdn.com/bclteam/"> the BCL Team Blog</a>, who some time ago explained <a href="http://blogs.msdn.com/bclteam/archive/2007/06/11/system-timezoneinfo-working-with-ambiguous-and-invalid-points-in-time-josh-free.aspx"> how to work with ambiguous and invalid points in time</a> in managed code. </p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (16)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-678923">
				<div id="div-comment-678923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373#comment-678923">
			October 31, 2008 at 10:27 am</a>		</div>

		<p>This will all be moot once people wake up and abolish this hack. &nbsp;Give me Zulu time or give me death.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-678933">
				<div id="div-comment-678933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Karellen</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373#comment-678933">
			October 31, 2008 at 10:46 am</a>		</div>

		<p>John &gt; Commenters to the original article also point out that timestamps should be stored and manipulated as UTC, and that they should be displayed/taken as user input in the local time format.</p>
<p>Where user input is ambiguous or invalid, the UI needs to get clarification, but then that&#8217;s always the case with validating user input.</p>
<p>Once it&#8217;s in the system, it should never be a problem.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-679013">
				<div id="div-comment-679013" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jim Lyon</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373#comment-679013">
			October 31, 2008 at 12:01 pm</a>		</div>

		<p>Karellen,</p>
<p>Unfortunately, it&#8217;s not that simple. Consider a calendar manager, and a recurring meeting that happens every Friday at 2:00 PM. With high probability, this means 2:00 PM local time, even when daylight savings time kicks in or out.</p>
<p>Furthermore, it probably means 2:00 PM local, even if Congress changes the daylight savings time rules after the meeting was scheduled.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-679023">
				<div id="div-comment-679023" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alexandre Grigoriev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373#comment-679023">
			October 31, 2008 at 12:07 pm</a>		</div>

		<p>The worst part is that the displayed time for dates beyond daylight time also shifts one hour. In Windows Explorer.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-679033">
				<div id="div-comment-679033" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Tony</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373#comment-679033">
			October 31, 2008 at 12:07 pm</a>		</div>

		<p>Oh! That&#8217;s the reason a Windows Smart Phone alarm rings an hour early after the DST switch, if you program the alarm before the switch!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-679043">
				<div id="div-comment-679043" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Bahbar</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373#comment-679043">
			October 31, 2008 at 12:17 pm</a>		</div>

		<p>@Jim Lyon:</p>
<p>What you describe has intersting implications when going global.</p>
<p>Say someone in California wants to schedule a recurring meeting Friday 2pm. Now, try and import that meeting inside a German calendar. The meeting invite has to really be handled as &quot;2pm current DST-correct pacific time&quot;, no matter what the time zone in Germany is. So&#8230; It would have an 8 hour difference this week, but 9 last week or next week (we are right in the week where Europe switched but not most of US).</p>
<p>In fact, what you really want to store is which timezone the invite was created in, no matter what timezone it will be used in.</p>
<p>Well, unless of course the person who created the invite wanted to schedule it at 3am German time. I never found a way in most Calendars to specify which time-zone I wanted to schedule my meeting in without changing my environment itself.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-679083">
				<div id="div-comment-679083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://LyonTamers.com/blogs/jimlyon' rel='external nofollow' class='url'>Jim Lyon</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373#comment-679083">
			October 31, 2008 at 2:02 pm</a>		</div>

		<p>Bahbar said: &nbsp;I never found a way in most Calendars to specify which time-zone I wanted to schedule my meeting in without changing my environment itself.</p>
<p>This is partly because, to the best of my knowledge, there aren&#8217;t any operating systems that track time changes for more than one locale at a time. World-wide, daylight savings time transitions occur at about 100 different times.</p>
<p>All of which goes to show that the notion of &quot;store it in UTC and don&#8217;t worry&quot; is overly simplistic.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-679153">
				<div id="div-comment-679153" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blog.henning.makholm.net/' rel='external nofollow' class='url'>Henning Makholm</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373#comment-679153">
			October 31, 2008 at 6:50 pm</a>		</div>

		<p>@Jim Lyon:</p>
<p>To be fair, Karellen was talking about timeSTAMPS, i.e. references to single, definite points on a global timescale. For these, storing things as UTC does solve everyting.</p>
<p>Finding out which point in absolute time to speak about in the first place is a different can of worms, but still mostly a user-interface one.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-679183">
				<div id="div-comment-679183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mr Cranky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373#comment-679183">
			October 31, 2008 at 8:25 pm</a>		</div>

		<p>I think we&#8217;ve covered once again why DST is one of the most brain-dead dumbass stupid ideas the universe has ever conceived. &nbsp;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-679233">
				<div id="div-comment-679233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Karellen</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373#comment-679233">
			November 1, 2008 at 4:36 am</a>		</div>

		<p>Mr Cranky &gt; I can agree on that one!</p>
<p>FFS &#8211; if you want more daylight in your evenings over the summer, get up an hour earlier and work 7 &#8211; 5 instead of 8 &#8211; 6. You get the same effect, only you don&#8217;t need to make all the clocks in the damn country wrong!</p>
<p>I hardly know anyone who doesn&#8217;t have this sort of latitude in their working hours these days.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-679243">
				<div id="div-comment-679243" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Aaargh!</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373#comment-679243">
			November 1, 2008 at 11:25 am</a>		</div>

		<blockquote><p>
  &quot;I never found a way in most Calendars to specify which time-zone I wanted to schedule my meeting in without changing my environment itself.&quot;
</p></blockquote>
<p>Apple&#8217;s iCal can do this. In preferences -&gt; Advanced check the &quot;Turn on time zone support&quot; box.</p>
<p>You can now select the time zone for each event and also change which time zone iCal is currently using for displaying events (top right of the window).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-679263">
				<div id="div-comment-679263" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">KG2V</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373#comment-679263">
			November 1, 2008 at 12:16 pm</a>		</div>

		<p>&quot;FFS &#8211; if you want more daylight in your evenings over the summer, get up an hour earlier and work 7 &#8211; 5 instead of 8 &#8211; 6. You get the same effect, only you don&#8217;t need to make all the clocks in the damn country wrong!&quot;</p>
<p>I already work 7 &#8211; 3:30. &nbsp;They won&#8217;t let me start at 6:00am (I usually get in the door around 6:20, and do my OT before the day starts)</p>
<p>(me? &nbsp;An early bird? &nbsp;what gives you that idea. &nbsp;Feels strange going to bed when it&#8217;s still light out in late June (hint, when you get up at 4:00am, bedtime comes real early)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-679273">
				<div id="div-comment-679273" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blog.henning.makholm.net/' rel='external nofollow' class='url'>Henning Makholm</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373#comment-679273">
			November 1, 2008 at 3:10 pm</a>		</div>

		<p>I want more daylight in the evenings all year. Why do we have to go back to winter time?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-679323">
				<div id="div-comment-679323" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jules</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373#comment-679323">
			November 2, 2008 at 8:55 am</a>		</div>

		<p>Random managed code / date handling story: I once installed Windows on a machine whose BIOS date was wrong. &nbsp;I mean well and truly wrong. &nbsp;I mean, so wrong that it is (1) a valid date and time for NTFS yet (2) not a valid date and time as far as the CLI&#8217;s filesystem handling code is concerned.</p>
<p>Result: all .NET applications throw an exception on startup, because they try to read the timestamp on the global assembly cache directory, and fail. &nbsp;Oops.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-679333">
				<div id="div-comment-679333" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jules</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373#comment-679333">
			November 2, 2008 at 8:58 am</a>		</div>

		<p>Henning Makholm: good point.</p>
<p>Think of it this way. &nbsp;Most people work 9-5 (or some similar timeframe). &nbsp;That&#8217;s symmetrical around 1pm. &nbsp;The day (when we&#8217;re not in DST) is symmetrical around noon. &nbsp;Something&#8217;s wrong there. &nbsp;The day&#8217;s biased towards mornings being brighter and evenings darker&#8230;?!</p>
<p>DST all year round. &nbsp;It&#8217;s the only way that makes sense.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-680233">
				<div id="div-comment-680233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mr Cranky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081031-00/?p=20373#comment-680233">
			November 4, 2008 at 7:19 pm</a>		</div>

		<p>@Jules, Henning Makholm:</p>
<p>Apparently, you two need another couple of whacks with the clue stick. &nbsp;Try to understand that the universe, the space-time continuum, and your dog do not care what number you assign to any particular part of the day. &nbsp;If you feel you want more daylight after work, then get your ass out of bed earlier and leave work earlier. &nbsp;But f*****g around with clocks not only does nothing to actually accomplish what you want, it causes some serious problems that have already wasted man-centuries of programming time. &nbsp;So stop it. &nbsp;Now.</p>
<p>btw, I work &lt;7-16&lt; most days. &nbsp;Is that balanced enough for you?</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

