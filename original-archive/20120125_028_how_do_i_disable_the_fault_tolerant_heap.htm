<html>
<head>
<title>How do I disable the fault-tolerant heap?</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>How do I disable the fault-tolerant heap?</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>January 25, 2012 / year-entry #29</td></tr>
<tr><td><b>Tags:</b></td><td>code</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20120125-00/?p=8463</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>10</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">A while back, I linked to a talk by Silviu Calinoiu on the fault-tolerant heap. But what if you don't want the fault-tolerant heap? For example, during program development, you probably want to disable the fault-tolerant heap for your program: If the program is crashing, then it should crash so you can debug it! Method 1...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>A while back, I <a href="http://blogs.msdn.com/b/oldnewthing/archive/2010/03/31/9987780.aspx"> linked to</a> a talk by Silviu Calinoiu on <a href="https://channel9.msdn.com/shows/Going+Deep/Silviu-Calinoiu-Inside-Windows-7-Fault-Tolerant-Heap/"> the fault-tolerant heap</a>. But what if you don't want the fault-tolerant heap? For example, during program development, you probably want to disable the fault-tolerant heap for your program: If the program is crashing, then it should <i>crash</i> so you can debug it!</p>
<p> Method&nbsp;1 is to <a href="http://msdn.microsoft.com/library/dd744764.aspx"> disable the fault-tolerant heap globally</a>. While this prevents the fault-tolerant heap from auto-activating in the future, it does not go back and undo activations that were enabled in the past. In other words, you have to remember to do this <i>before</i> your application crashes for the first time. </p>
<p> Therefore, you probably want to combine Method&nbsp;1 with Method&nbsp;2 on the same page, where it gives instructions on how to reset the list of applications for which the fault-tolerant heap is enabled. </p>
<p> Mario Raccagni provides a third way of disabling the fault tolerant heap, this time for one specific process instead of globally. <a href="http://blogs.msdn.com/b/itasupport/archive/2009/10/08/come-disabilitare-il-fault-tolerant-heap.aspx"> His explanation is in Italian</a>, so you get to exercise your translation skills. </p>
<p> tl;dr version: Go to the <code>HKEY_<wbr>LOCAL_<wbr>MACHINE</wbr></wbr></code> and <code>HKEY_<wbr>CURRENT_<wbr>USER</wbr></wbr></code> versions of <code>Software\<wbr>Microsoft\<wbr>Windows NT\<wbr>CurrentVersion\<wbr>AppCompatFlags\<wbr>Layers\<wbr></wbr></wbr></wbr></wbr></wbr></wbr></code><i>your_application.exe</i> and delete the <code>Fault&shy;Tolerant&shy;Heap</code> entry. </p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (10)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-962833">
				<div id="div-comment-962833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mike Edenfield</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120125-00/?p=8463#comment-962833">
			January 25, 2012 at 7:11 am</a>		</div>

		<p>Best part of Mario&#39;s article: watching Google try to translate &quot;Il Debug Ã¨ lentisssssssiiiiimo.&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-962863">
				<div id="div-comment-962863" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Henning Makholm</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120125-00/?p=8463#comment-962863">
			January 25, 2012 at 7:45 am</a>		</div>

		<p>I&#39;d love to combine Method 1 with Method 2, but &#8230; what is Method 2, actually? Did a paragraph fall out?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-962873">
				<div id="div-comment-962873" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Aaron.E</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120125-00/?p=8463#comment-962873">
			January 25, 2012 at 8:06 am</a>		</div>

		<p>@Henning</p>
<p>Method 2, from the MSDN link: &nbsp;Rundll32.exe fthsvc.dll,FthSysprepSpecialize</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-962893">
				<div id="div-comment-962893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anonymous Coward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120125-00/?p=8463#comment-962893">
			January 25, 2012 at 12:18 pm</a>		</div>

		<p>Well, I guess we cannot really call ourselves literate as programmers if we aren&#39;t fluent in Italian.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-962923">
				<div id="div-comment-962923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Roger</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120125-00/?p=8463#comment-962923">
			January 25, 2012 at 3:18 pm</a>		</div>

		<p>Software that (accidentally/maliciously) does this in their installation would fail Win2k8R2 logo cert right?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-962933">
				<div id="div-comment-962933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nick Lowe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120125-00/?p=8463#comment-962933">
			January 25, 2012 at 5:39 pm</a>		</div>

		<p>Method 3: If you can, develop under Server 2008 R2 which does not have the fault-tolerant heap! :)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-962953">
				<div id="div-comment-962953" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Worf</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120125-00/?p=8463#comment-962953">
			January 26, 2012 at 12:17 am</a>		</div>

		<p>#Aaron.C: Is that function a proper prototype for Rundll32? Or is it gonna cause some future developer some pain in maintaining rundll32 because it&#39;s been hacked to do things it really shouldn&#39;t?</p>
<p>And by &quot;future developer&quot;, I really mean Raymond.</p>
<p><a rel="nofollow" target="_new" href="http://blogs.msdn.com/b/oldnewthing/archive/2011/09/09/10208136.aspx" rel="nofollow">blogs.msdn.com/&#8230;/10208136.aspx</a></p>
<p><a rel="nofollow" target="_new" href="http://blogs.msdn.com/b/oldnewthing/archive/2004/01/15/58973.aspx" rel="nofollow">blogs.msdn.com/&#8230;/58973.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-962973">
				<div id="div-comment-962973" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">voo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120125-00/?p=8463#comment-962973">
			January 26, 2012 at 5:11 am</a>		</div>

		<p>@Worf I&#39;d hope that an official KB wouldn&#39;t use a method explicitly forbidden by the documentation, but who knows &#8211; they could just assume Raymond will fix it anyhow ;)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-963213">
				<div id="div-comment-963213" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">petes</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120125-00/?p=8463#comment-963213">
			January 26, 2012 at 1:25 pm</a>		</div>

		<p>Oh, the irony! &nbsp;My Windows 7 machine blue-screened while watching Silviu&#39;s video!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-963513">
				<div id="div-comment-963513" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120125-00/?p=8463#comment-963513">
			January 29, 2012 at 2:33 am</a>		</div>

		<p>Couldn&#39;t visual studio do this automatically for exes it compiles?</p>
<div class="post">[<i>I guess I don&#39;t understand what you&#39;re saying. Are you saying that every VS-complied EXE should disable the fault-tolerant heap? -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

