<html>
<head>
<title>Beware of roaming user profiles</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>Beware of roaming user profiles</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>June 30, 2005 / year-entry #169</td></tr>
<tr><td><b>Tags:</b></td><td>code</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>38</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">One of the less-known features of Windows is the roaming user profile. I know that this is not well-known because I often see suggestions that fail to take the roaming user profile scenario into account. Indeed, if your program behaves badly enough, you can cause data loss. (More on this later.) What is a roaming...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>One of the less-known features of Windows is the <a href="http://www.microsoft.com/technet/treeview/default.asp?url=/technet/prodtechnol/winxppro/reskit/prdc_mcc_pqoe.asp"> roaming user profile</a>. I know that this is not well-known because I often see suggestions that fail to take the roaming user profile scenario into account. Indeed, if your program behaves badly enough, you can cause data loss. (More on this later.)</p>
<p> What is a roaming user profile? </p>
<p> Well, your user profile is the collection of things that reside under your <code>%USERPROFILE%</code> directory. (This is not quite true, but it's a good enough approximation for the purpose of this discussion. An important exception will be noted next time.) Your per-user registry is kept in <code>%USERPROFILE%\ntuser.dat</code>, so your per-user registry is part of your user profile. </p>
<p> In highly managed environments (corporations), system administrators can set up user profiles on a centralized server, so that users log onto any machine and have available their files and settings. This is accomplished by copying the user profile from the server when the user logs on and copying it back to the server when the user logs off. (Of course, <a href="http://support.microsoft.com/kb/q146192/"> there is also caching involved</a> to save time if the user logs back onto the same machine.) </p>
<p> What does this mean for you, the programmer? </p>
<p> For one thing, it means that the path to the user's profile can change from one logon session to the next. If the user runs your program from Computer&nbsp;A, their user profile directory might be <code>C:\Documents and Settings\Fred</code>, but when they log off from Computer&nbsp;A and log on to Computer&nbsp;B, the directory to their user profile might change to <code>C:\WINNT\Profiles\Fred</code>. In particular, that file that used to be at <code>C:\Documents and Settings\Fred\My Documents\Proposal.txt</code> has moved to <code>C:\WINNT\Profiles\Fred\My Documents\Proposal.txt</code>. If your program has a feature where it offers a list of recently-used files (or auto-opens the most recently used file), you may find that the file no longer exists at its old location. The solution is to use profile-relative paths, or even better, shell virtual folder-relative paths (e.g., recording the path relative to CSIDL_MYDOCUMENTS), so that when the profile roams to a machine with a different user profile path, your program can still find its files. </p>
<p> For another thing, you cannot just cruise through the <code>HKEY_LOCAL_MACHINE\<wbr>SOFTWARE\<wbr>Microsoft\<wbr>Windows&nbsp;NT\<wbr>CurrentVersion\<wbr>ProfileList</wbr></wbr></wbr></wbr></wbr></code> registry key <a href="http://www.jsiinc.com/SUBO/tip7400/rh7429.htm"> expecting to find all the user profiles</a> and <a href="http://groups-beta.google.com/group/microsoft.public.scripting.vbscript/msg/1f948e8690039b43"> possibly even modify them</a>, because the copy of the user profile on the local computer might not be the authoritative one. If the profile is a cached roaming profile, then any changes you make will either (1)&nbsp;be lost when the user roams back to the computer after using another computer, or (2)&nbsp;cause the local profile to be considered newer than the master copy on the server, causing the changes the user made to the copy on the server to be lost! (Which of the two bad scenarios you find yourself in depends on the time you change the cached profile and the time the target user logs off that other computer.) </p>
<p> Another consequence of roaming user profiles is that your program can effectively see itself changing versions constantly. If Computer&nbsp;A has version&nbsp;1.0 of your program and Computer&nbsp;B has version&nbsp;2.0, then as the profile roams between the two computers, both versions&nbsp;1.0 and&nbsp;2.0 will be operating on the user profile in turn. If versions&nbsp;1.0 and&nbsp;2.0 use the same registry keys to record their settings, then your registry formats had better be both upward- and downward-compatible. This is a particularly painful requirement for operating system components, which consequently need to maintain bidirectional registry format compatibility with systems as old as Windows&nbsp;NT&nbsp;4. (Windows&nbsp;NT&nbsp;3.51 had a different model for roaming user profiles.) </p>
<p> Yet another consequence of roaming user profiles applies to services. Prior to Windows&nbsp;XP, if a service holds a registry key open after the user logged off, then the registry hive cannot be unloaded and consequently (1)&nbsp;consumes memory for that profile even though the user is no longer logged on, and (2)&nbsp;prevents the user's local registry changes from being copied back to the server. This "hive leakage" problem was so rampant that in Windows&nbsp;XP, the profile unload code takes a more aggressive stance against services that hold keys open too long. You can read more about the changes to registry hive roaming in the Resource Kit article linked at the top of this entry. </p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (38)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-287873">
				<div id="div-comment-287873" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Matt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-287873">
			June 30, 2005 at 10:46 am</a>		</div>

		<p>My first experience with roaming profiles was at school with NT4.  I was using some computers that were prevented (by helpful administrators) from saving files to anywhere except for the Desktop.  I was running massive simulations, so I used multiple computers at the same time, saving everything to multiple Desktops.  Well, I logged off from all of the computers, and because I managed to logoff last on the computer with no useful files on the desktop, when I logged back in to the same user, I found&#8211;no useful files on the desktop!  In my harried state after 12+ hours of simulations, I had naively assumed that the desktops were not cached, or would do some sort of file merge or something.  Apparently not.  Dataloss, indeed.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-larryosterman odd alt thread-odd thread-alt depth-1" id="comment-287883">
				<div id="div-comment-287883" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Larry+Osterman+%5BMSFT%5D' rel='external nofollow' class='url'>Larry Osterman [MSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-287883">
			June 30, 2005 at 11:07 am</a>		</div>

		<p>The hive unload problem is even worse.  The hive keeps a reference to the user&#8217;s token.</p>
<p>Because of this, if you&#8217;re running with certain 3rd party authentication systems that enforce single sign on (you can only be logged into one computer at a time), the leaked hive means that the user can never log onto another computer until this computer is rebooted.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-287893">
				<div id="div-comment-287893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">asdf</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-287893">
			June 30, 2005 at 11:32 am</a>		</div>

		<p>Your example seems like an insane thing to do. If I understand you correctly, the program is given an absolute path to the file to begin with and you&#8217;re suggesting we should take that path and map it to a path relative to the %USERPROFILE% (if it actually is relative to that) if it needs to store it?</p>
<p>The dumb thing (IMHO) about CSIDLs are that barely any of them are mapped to environment variables so you either have to convert it to an absolute path when writing it or write out the CSIDL and the relative path (unless I&#8217;ve missed something). If you ever have to present that path to the user to edit, it always is in absolute form and your app is supposed to be clairvoyant now to decide if the user now wants it relative to that CSIDL still or as an absolute path. Environment variables (or something similar) would have made it much cleaner.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-287903">
				<div id="div-comment-287903" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/jonathanh/archive/2004/05/02/124900.aspx' rel='external nofollow' class='url'>Jonathan Hardwick</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-287903">
			June 30, 2005 at 11:56 am</a>		</div>

		<p>I might bitch about eating our own dogfood, but a lot of the time it&#8217;s actually pretty damn tasty.<br />
<br />For&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-287913">
				<div id="div-comment-287913" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">boxmonkey</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-287913">
			June 30, 2005 at 12:08 pm</a>		</div>

		<p>As far as I&#8217;m concerned, roaming profiles are broken technolgy.</p>
<p>Does not work as intended. At my company, we found that it caused way more problems than it fixed, so they decided to abandon roaming profiles (after spending 3+ years trying to get them to work properly) and moved back to local profiles in all cases except for the mandatory roaming profiles, which are the only ones that ever worked properly.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-patriotb odd alt thread-odd thread-alt depth-1" id="comment-287923">
				<div id="div-comment-287923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">PatriotB</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-287923">
			June 30, 2005 at 12:16 pm</a>		</div>

		<p>Then there&#8217;s the issue of &quot;Application Data&quot; vs. &quot;Local SettingsApplication Data.&quot;  The former roams with the profile by default, the latter does not.  Many apps put everything in Application Data when certain things should be in Local SettingsApplication Data so they don&#8217;t add unnecessarily to the size of the roaming profile.</p>
<p>One prime example of this is Firefox&#8217;s cache.  It is stored in Application Data.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-287933">
				<div id="div-comment-287933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Cooke</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-287933">
			June 30, 2005 at 12:16 pm</a>		</div>

		<p>Hmm. I&#8217;d never actually used roaming profiles before, and just assumed that they&#8217;d mount the remote profile directory rather than copying it and syncing it. What happens if a user logs in to two systems at once?</p>
<p>I think I can see now why my old university didn&#8217;t implement roaming profiles: they had different software everywhere depending on which department was responsible for a given set of computers and students often logged in on several machines simultaneously. I suppose also the fact that it was a hetrogenous environment with Macs and UNIX boxes as well as Windows machines played into it, though some degree of interop was obtained by having global &quot;home directories&quot; which mounted as $HOME on the UNIX machines and H: (which was also &quot;My Documents&quot;) on the Windows machines. I&#8217;m not sure what it did on the Macs, as I never logged into one.</p>
<p>It&#8217;s a shame, though, that roaming profiles don&#8217;t work better. I&#8217;m always cursing and weeping when I have to use someone else&#8217;s computer, or another one of my own that I&#8217;ve not applied my lastest favorite configuration change to, or the latest upgrade to my web browser, or whatever. I just wish that all machines in the world would work the way I want, regardless of whose machine it is and without me having to maintain them all separately. Not really feasible in practice, but in an ideal world&#8230;..</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-287943">
				<div id="div-comment-287943" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">KJK::Hyperion</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-287943">
			June 30, 2005 at 12:53 pm</a>		</div>

		<p>Why use roaming profiles at all, in this time and age? In Windows 2000 a new group policy was introduced that redirects the &quot;roamable&quot; parts of user profiles to an UNC path on each logon (there remains the issue of registry hives, which can&#8217;t be loaded over a network and must be still roamed the old way &#8211; are they at least merged key-by-key, or the most recent hive wins as a whole?)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-287963">
				<div id="div-comment-287963" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">irf</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-287963">
			June 30, 2005 at 1:15 pm</a>		</div>

		<p>I haven&#8217;t used roaming profiles very much, but it&#8217;s always seemed to me this would only really work if all the apps were also installed as part of the roaming profile. Otherwise, once you get past cosmetic things like wallpaper and color schemes, there are just too many things that can cause inconsistencies, even if the apps are written &quot;correctly&quot; (which I bet many (most?) are not). But if you do all that it seems like it&#8217;s getting closer to a full-blown terminal-server model than a roaming profile model. Still, anything less than seems impractical to me.</p>
<p>I have had some experience with environments where &quot;My Documents&quot; is mapped to a network path instead of the local drive, and while I do recognize the benefits of this for backup and even roaming purposes, even this causes problems. Things that come to mind are my inability to create shared folders there, and the fact that managed apps that are built there run with restricted security policy. It&#8217;s also really hard to find that path when I&#8217;m connected over VPN, if I don&#8217;t happen to remember it.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-287973">
				<div id="div-comment-287973" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mike Swaim</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-287973">
			June 30, 2005 at 1:52 pm</a>		</div>

		<p>We had problems with roaming profiles, too. A user would log into a machine, customize our app, and then log into a second machine, not see his customizations, and call us to complain.<br />
<br />  This happened fairly often since our users ran 2 machines w/ 3 displays per machine.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-287993">
				<div id="div-comment-287993" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Bill</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-287993">
			June 30, 2005 at 3:15 pm</a>		</div>

		<p>I have always wondered why there isn&#8217;t something more like NFS mounted home directories in *nix under windows?  I have tried setting up roaming profiles, but even in a small setup (200 users, 100 machines) the wasted bandwidth, disk and time were huge and  the ability to log in to multiple machines and use the same files on both was missing entirely.</p>
<p>It seems to me that every peice needed to make this happen is in there somewhere.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-288003">
				<div id="div-comment-288003" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">mallardtheduck</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288003">
			June 30, 2005 at 3:35 pm</a>		</div>

		<p>I tried roaming profiles once, worked fine when all the machines were similarly-configured NT4 boxes. Then I upgraded one to 2000 for testing purposes, when I logged in with my NT4 profile on the 2000 box it worked, but when I logged back into the NT4 box it had messed up my taskbar settings and caused the &#8216;Network&#8217; control panel to vanish in such a way that I eventually had to create a shortcut to the cpl file on my desktop.<br />
<br />Cross-OS version roaming profiles? BAD IDEA.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-288013">
				<div id="div-comment-288013" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">pcooper</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288013">
			June 30, 2005 at 3:45 pm</a>		</div>

		<p>I love roaming profiles. I just wish that more programs knew enough to use Local Settings/Application Data instead of just Application Data.</p>
<p>Google Earth wants to install most of itself, including its cache I think, into my roaming profile. So does Opera, as well as most Java programs that I&#8217;ve seen.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-288063">
				<div id="div-comment-288063" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Yoni</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288063">
			June 30, 2005 at 6:46 pm</a>		</div>

		<p>One thing I hate about Windows is the name of the home directory.</p>
<p>C:Documents and SettingsYoni<br />
<br />How does that make sense? In POSIX: /home/Yoni</p>
<p>You may argue that you can shorten that to %USERPROFILE%.<br />
<br />The immediate counterargument is bash&#8217;s: ~</p>
<p>You said:<br />
<br />&quot;In particular, that file that used to be at C:Documents and SettingsFredMy DocumentsProposal.txt has moved to C:WINNTProfilesFredMy DocumentsProposal.txt.&quot;</p>
<p>This is not a feature that programs should look out for. This is a design fault of roaming profiles in Windows. The directory should be the same, always.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-288073">
				<div id="div-comment-288073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Moz</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288073">
			June 30, 2005 at 7:28 pm</a>		</div>

		<p>I assume this breaks most dreadfully if there&#8217;s not enough disk space for the profile on the target machine? On a related note, is it possible to shrink the ntuser.dat file? I find that after a while that file gets very big and fragmented.</p>
<p>What if I save a document as  %USERPROFILE%&#8230;.xxx..foo.txt?<br />
<br />Should the app call PsychicUntanglePath() to find out whether that file should roam?<br />
<br />Or does that break at the first ..? Or should the app resolve it to an absolute path before trying to match it against all the various system paths (&amp;PROGRAM FILES%, %WINDOWS% etc etc)</p>
<p>And for a real laugh, move your My Documents folder and watch lots of programs break. Even just to d:My Documents. I only did that once. Ditto putting Program Files on D: (hello the Office team, are you there?)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-288083">
				<div id="div-comment-288083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Cooke</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288083">
			June 30, 2005 at 8:18 pm</a>		</div>

		<p>My &quot;My Documents&quot; directory is at &quot;L:My Documents&quot; (it&#8217;s a mounted network path from some other machine on my LAN here)</p>
<p>I&#8217;ve never had any considerable trouble. I guess, though, that not really using any programs that treat that directory as special helps. I think that it&#8217;s true to say that most of the programs I use under Windows these days aren&#8217;t really proper Windows programs.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-288093">
				<div id="div-comment-288093" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Moz</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288093">
			June 30, 2005 at 8:42 pm</a>		</div>

		<p>I suspect that when you first moved it some things broke. But from experience, every time I move it some things break. Too bad if at work I have it on C and at home its on D.</p>
<p>This is different from not allowing a &quot;c:program files&quot; folder, which itself is enough to break some programs.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-288113">
				<div id="div-comment-288113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288113">
			June 30, 2005 at 10:07 pm</a>		</div>

		<p>One machine had one single hard disk which had been partitioned as one single partition (a whopping 504MB), so Windows 95 and Office 95 were installed on C:.</p>
<p>Another machine had two hard disks which could not be merged into one logical single partition in Windows 95, so Windows 95 was on C: and Office 95 was on D:.</p>
<p>Roaming partitions brilliantly kept the Start menus in sync.</p>
<p>If I recall correctly, it wasn&#8217;t even necessary to have any applications and it wasn&#8217;t even necessary to have more than one partition on either machine.  Just have one machine with all default settings from the Windows 95 installation log in to the domain, log out, and another machine with all default settings from the Windows 95 installation log in to the domain.  And vice-versa.  The registry from the Japanese machine would get shoved into the registry of the US machine and vice-versa.  The Japanese machine could understand 90% of the characters that got shoved into its registry but not vice-versa.  In neither case was the result pleasant.</p>
<p>In neither case did we have to worry about getting to the stage of &quot;Indeed, if your program behaves badly enough,&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-288133">
				<div id="div-comment-288133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">pUnk</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288133">
			June 30, 2005 at 11:30 pm</a>		</div>

		<p>Release Engineering dept. will be happy &#8211; a new item for the readme:</p>
<p>1. Not compatible with &quot;large fonts&quot;.<br />
<br />&#8230;<br />
<br />x. Not compatible with roaming profiles.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-288143">
				<div id="div-comment-288143" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Michael</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288143">
			June 30, 2005 at 11:45 pm</a>		</div>

		<blockquote><p>
  Many apps put everything in Application Data when certain things should be in Local SettingsApplication Data &#8230; </p>
<p>&gt; One prime example of this is Firefox&#8217;s cache. It is stored in Application Data. </p>
<p>The bug (active since 2000) was marked as fixed; supposedly next major release of Firefox should fix it (it took them just 6 years :().<br />
  
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-288163">
				<div id="div-comment-288163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://runesbike.com/' rel='external nofollow' class='url'>Rune Moberg</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288163">
			July 1, 2005 at 3:36 am</a>		</div>

		<p>Sort of related:</p>
<p>In <a rel="nofollow" target="_new" href="http://msdn.microsoft.com/library/en-us/dnwue/html/ch11d.asp" rel="nofollow">http://msdn.microsoft.com/library/en-us/dnwue/html/ch11d.asp</a> (&quot;Windows User Experience Guidelines&quot;) it says under &quot;uninstallation&quot;:</p>
<p>&quot;Remember to remove registry entries and shortcuts your application may have placed in the Start menu hierarchy. However, when removing your application&#8217;s folder structure be careful not to delete any user-created files&quot;</p>
<p>Well, &quot;registry entries in the start menu&quot; aside; Does this mean I should wipe my app&#8217;s registry entries under HKCU, or should I consider these &quot;user-created files&quot; and leave them alone?</p>
<p>I expect that when dealing with roaming profiles, after uninstalling my app on computer A the user still expects to retain his settings when logging onto computer B to run the app from there. </p>
<p>So&#8230; Preserve everything under HKCU then? Many uninstallers fail to do this.</p>
<p>&#8212;<br />
<br />Rune</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-288173">
				<div id="div-comment-288173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.foxyshadis.com' rel='external nofollow' class='url'>foxyshadis</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288173">
			July 1, 2005 at 5:21 am</a>		</div>

		<p>&quot;On a related note, is it possible to shrink the ntuser.dat file? I find that after a while that file gets very big and fragmented.&quot;</p>
<p>There are a lot of programs out there that can defragment the registry (and MFT and such). Personally, I use system mechanic to do it at every startup, but I don&#8217;t think it works for server editions; I know there are many others. I think some of them just call an nt function, but I don&#8217;t know what.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-288183">
				<div id="div-comment-288183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Cooke</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288183">
			July 1, 2005 at 6:30 am</a>		</div>

		<p>Yoni,<br />
<br />You can&#8217;t rely on the home directory being /home/USERNAME on a UNIX system. At the university I mentioned in an earlier comment, the home directories (which, if you recall, are mounted from elsewhere) are at /ufs/fsb04/users/USERNAME, where fsb04 is the name of the server my home directory happened to live on. Also, most systems have root&#8217;s home directory at /root rather than /home/root. Far better to just use $HOME, and not start second-guessing the system.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-288193">
				<div id="div-comment-288193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Daniel</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288193">
			July 1, 2005 at 7:27 am</a>		</div>

		<p>My experience with roaming user profiles has beem very traumatic. You see, when you create an user, the default is XP is to use a roaming profile. If you logoff or shutdown before changing this setting, your profile is saved in your domain controller. Ok, now one year latter I got a brand new computer, and the first time I log on the network it will load that old profile. Oh, and did I mention that I live in Brazil and my first PC had a Brazilian-Portuguese XP and the second one an English XP? When I had a look in the mess at the Start Menu my first thought was to do a complete reinstall (actually, I just logged as local Admin, deleted my user, deleted the saved profile in the domain controller and started all over). I work in a small company and it is very commom for someone to log into someone else&#8217;s computer. When you log the first time in an XP computer, we have to remember to turn off the !@#$%&amp;* roaming profile.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-288153">
				<div id="div-comment-288153" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">DWalker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288153">
			July 1, 2005 at 1:01 am</a>		</div>

		<p>One thing that, crazily, doesn&#8217;t even take into account your OWN LOCAL location for Documents and Settings is when you download a saved MSDN Webcast.  </p>
<p>You end up downloading an EXE, which is a self-extracting file created with WinZip.  It asks you &quot;Would you like to download the presentation onto your desktop?&quot; [download here means extract].  You can&#8217;t supply another path.  </p>
<p>If you say yes, it unzips the WMV into a *hardcoded* and unchangeable location of C:Documents and SettingsAll UsersDesktop.  </p>
<p>MY computer happens to have its &quot;all users&quot; desktop at C:Documents and SettingsAll Users.WINDOWSDesktop, but do the people who package the MSDN Webcasts for download care?  Apparently not.</p>
<p>I have e-mailed them to ask what all this madness is, and we&#8217;ll see what their response is&#8230;</p>
<p>David Walker</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-288203">
				<div id="div-comment-288203" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://mike.filespanker.com' rel='external nofollow' class='url'>Mike Owens</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288203">
			July 1, 2005 at 8:28 am</a>		</div>

		<p>Regarding the home directory on Unix-ish OSes, $HOME is not guaranteed to be set, and its use sometimes leads to problems very similar to the issues discussed here on Windows. (Usually trying to write in /, or just putting everything in the cwd).</p>
<p>The normal way to attain the user&#8217;s home directory is use the pw_dir member of the struct passwd returned by getpwuid or getpwuid_r.  You can check out some docs here: <a rel="nofollow" target="_new" href="http://www.opengroup.org/onlinepubs/007908799/xsh/pwd.h.html" rel="nofollow">http://www.opengroup.org/onlinepubs/007908799/xsh/pwd.h.html</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-universalis even thread-even depth-1" id="comment-288213">
				<div id="div-comment-288213" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Universalis</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288213">
			July 1, 2005 at 9:42 am</a>		</div>

		<p>For moderate user-friendliness in &quot;last used file&quot; lists, is there an inverse of ExpandEnvironmentStrings() anywhere, or do we have to roll our own?<br />
<br />It wouldn&#8217;t solve everything, but at least it should help with the %USERPROFILE% case.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-288373">
				<div id="div-comment-288373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Steve Loughran</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288373">
			July 1, 2005 at 2:12 pm</a>		</div>

		<p>I dont really care that my code doesnt work with roaming profiles, as I have never encountered them to work properly.</p>
<p>1. I may have different policies on different boxes, and I dont want them to move.</p>
<p>2. on a big site (i.e. mit), you dont want your profile cached on all the machines; you end up with a purging system</p>
<p>3. no adequate merge of multiple profiles. Its too built around the &quot;one user, one machine&quot; model, and not &quot;one user, one laptop, 3 VMware images and two remote desktop logins&quot;</p>
<p>I use groove to sync a large directory tree across all my windows boxes, all personal stuff lives there, where it is synchronized seamlessly round the world. One XP VM in the office acts as the always-available master, and also runs spambayes on outlook 7&#215;24 to filter spam. On the laptop the directory tree is nailed down with encrypted files, the key held in the laptops TPM. It all works really well.</p>
<p>Instead of blaming us developers for not supporting roaming profiles, lets all just recognise that they have always been broken, and move on.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-288503">
				<div id="div-comment-288503" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/jonathanh/archive/2004/05/02/124900.aspx' rel='external nofollow' class='url'>Jonathan Hardwick</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288503">
			July 2, 2005 at 3:13 am</a>		</div>

		<p>I might bitch about eating our own dogfood, but a lot of the time it&#8217;s actually pretty damn tasty.<br />
<br />For&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-288633">
				<div id="div-comment-288633" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Stefan Kanthak</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-288633">
			July 3, 2005 at 4:22 pm</a>		</div>

		<p>Yoni:<br />
<br />don&#8217;t confuse %UserProfile% and %HomeDrive%%HomePath%!<br />
<br />The latter can be set in the user account and defaults to %UserProfile% if not.<br />
<br />So just configure your system as you like, but don&#8217;t complain that you don&#8217;t know its options.</p>
<p>Moz (and others):<br />
<br />%ProgramFiles% (and %CommonProgramFiles% too) as well as the parent directory of %UserProfile% and %AllUsersProfile% can easily be moved away from %SystemDrive% and work as expected.<br />
<br />You just have to do it right: from Windows 2000 onwards use WINNT.SIF to redirect these folders (or correct ALL references in the registry and user profiles when you these directories later on).</p>
<p>I&#8217;ve dozens of installations here where neither a C: nor a D: drive exists, %SystemRoot% resides on E:, %ProgramFiles% on F: and the user profiles on G:.<br />
<br />It&#8217;s even possible to separate %ProgramFiles% and the user profiles from %SystemRoot% WITHOUT changing the path: reparse points exists, I can prepare a hard drive with 3 (primary) partitions and mount #2 and #3 into Program Files and Documents and Settings on #1 before I start the setup.</p>
<p>Yes, there are some evil programs resp. their installers which have &quot;C:Program Files&quot; hardcoded, but they would fail on every non-english installation where &quot;Program iles&quot; is localized too!<br />
<br />These are the programs that I discard. If their vendor is not flexible enough to adapt to my liking he won&#8217;t earn my money.<br />
<br />It&#8217;s that simple.</p>
<p>Stefan</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-299543">
				<div id="div-comment-299543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/oldnewthing/archive/2005/08/22/454487.aspx' rel='external nofollow' class='url'>The Old New Thing</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-299543">
			August 22, 2005 at 10:00 am</a>		</div>

		<p>Things you ought to do though you may not personally benefit from it.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-299823">
				<div id="div-comment-299823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/michkap/archive/2005/08/22/454561.aspx' rel='external nofollow' class='url'>Sorting It All Out</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-299823">
			August 22, 2005 at 12:39 pm</a>		</div>

		<p>I read Raymond Chen&#8217;s post entitled How do you convince developers to pay their &amp;quot;taxes&amp;quot;? with interest&#8230;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-343303">
				<div id="div-comment-343303" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/oldnewthing/archive/2006/02/06/525700.aspx' rel='external nofollow' class='url'>The Old New Thing</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-343303">
			February 6, 2006 at 10:00 am</a>		</div>

		<p>Not all folders in the user profile are stored in the user profile.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-348703">
				<div id="div-comment-348703" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/oldnewthing/archive/2006/02/22/536920.aspx' rel='external nofollow' class='url'>The Old New Thing</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-348703">
			February 22, 2006 at 10:00 am</a>		</div>

		<p>It&#8217;s not free, so spend it wisely.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-348713">
				<div id="div-comment-348713" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.ugidotnet.org/lbarbieri/archive/2006/02/22/35377.aspx' rel='external nofollow' class='url'>Lorenzo Barbieri @ UGIblogs!</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-348713">
			February 22, 2006 at 10:04 am</a>		</div>

		
		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-444853">
				<div id="div-comment-444853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.gooli.org/blog/desktop-apps-could-fight-back/' rel='external nofollow' class='url'>goolife &raquo; Blog Archive &raquo; Desktop apps could fight back</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-444853">
			November 24, 2006 at 1:26 pm</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://www.gooli.org/blog/desktop-apps-could-fight-back/" rel="nofollow">http://www.gooli.org/blog/desktop-apps-could-fight-back/</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-596643">
				<div id="div-comment-596643" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://gluft.wordpress.com/2008/01/31/links-for-2008-02-01/' rel='external nofollow' class='url'>links for 2008-02-01 &laquo; packet filter</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-596643">
			January 31, 2008 at 10:22 pm</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://gluft.wordpress.com/2008/01/31/links-for-2008-02-01/" rel="nofollow">http://gluft.wordpress.com/2008/01/31/links-for-2008-02-01/</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-663543">
				<div id="div-comment-663543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/michkap/archive/2008/09/02/8918959.aspx' rel='external nofollow' class='url'>Sorting it all Out</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050630-20/?p=35143#comment-663543">
			September 2, 2008 at 10:31 am</a>		</div>

		<p>So the question that came in was along the following lines: We have Windows Server 2003 installed with</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

