<html>
<head>
<title>Clap and the filter graph claps with you</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>Clap and the filter graph claps with you</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>April 7, 2009 / year-entry #104</td></tr>
<tr><td><b>Tags:</b></td><td>history</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>19</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">One of my colleagues was a fount of ideas, some of them crazy, some of them clever, and some of them both. I think this one counts as both. To render multimedia content with DirectShow, you build a so-called filter graph. A filter graph represents a series of transformations that are applied to data as...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>One of my colleagues was a fount of ideas, some of them crazy, some of them clever, and some of them both. I think this one counts as both.</p>
<p> To render multimedia content with DirectShow, you build a so-called filter graph. A filter graph represents a series of transformations that are applied to data as it travels through the graph. For example, bytes from a video file may go through a splitter filter which separates the audio from the video data, then the two data streams each go through a respective audio and video decoder, which converts the compressed data into uncompressed sound or video data, and then to a render device which actually plays the sound samples out the speaker or puts the video image on the screen. </p>
<p> One of the components of a filter graph is the <a href="http://msdn2.microsoft.com/en-us/library/ms787549.aspx"> reference clock</a>. The purpose of the reference clock is to keep track of time, so that all the parts of the filter graph produce their output in a synchronized manner. If there weren't something keeping track of this, the audio would fall out of sync with the video. </p>
<p> My colleague decided to create an unusual reference clock. Whereas most reference clocks are based off of real-world time, my colleague's reference clock started by taking input from the microphone. It did some analysis of the volume of the incoming sound stream and detected when there were loud impulses of sound. It then generated a stream of clock ticks based on the rate at which those impulses were detected. </p>
<p> In other words, the clock was driven by clapping. </p>
<p> I was lucky enough to be one of the first people to see this crazy reference timer in action. First, you started up the application and picked a video clip. The video clip just sat there. As you started clapping, the video clip started playing. If you clapped at about 80 beats per minute, the video clip played at its normal speed. If you clapped faster, the video clip ran faster. If you clapped slower, the video clip ran slower. If you stopped clapping, the video clip stopped. </p>
<p> It was freaky cool. </p>
<p> Totally useless, but freaky cool. </p>
<p> <b>Update</b>: Commenter hexatron <a href="http://blogs.msdn.com/oldnewthing/archive/2009/04/07/9534758.aspx#9537013"> pointed out</a> that the <a href="http://msdn.microsoft.com/en-us/library/dd390675.aspx"> Metronome</a> sample does the same thing as my colleague's crazy reference clock. I don't know if it's literally the same code, but it's functionally equivalent. </p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (19)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-724533">
				<div id="div-comment-724533" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">pcooper</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724533">
			April 7, 2009 at 10:15 am</a>		</div>

		<p>I don&#8217;t suppose that the code could be released that does this?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-724543">
				<div id="div-comment-724543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ami Cusbreaf</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724543">
			April 7, 2009 at 10:16 am</a>		</div>

		<p>In other news, Raymond&#8217;s friend received a subpeona from patent attorneys representing the makers of The Clapper. &nbsp;They claim their patent on turning devices on and off through a clap of the hands also covers controlling audio and video playback through software. &nbsp;They are demanding that he cease and desist having crazy and clever, ummm&#8230; new and innovative, ideas, reimburse them for all legal fees, and fork over his life savings.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-nathan_works even thread-even depth-1" id="comment-724553">
				<div id="div-comment-724553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/nathan_works' rel='external nofollow' class='url'>nathan_works</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724553">
			April 7, 2009 at 10:18 am</a>		</div>

		<p>I wonder if this could be setup with a feedback loop for bad sit-coms, where the laugh-track is what drives the playing of the show (versus clapping)..</p>
<p>Not that it would make the shows any more entertaining, but the feedback loop would be interesting..</p>
<p>Or tie it into watching something like &quot;The Price is Right&quot; where there is much audience clapping..</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-724563">
				<div id="div-comment-724563" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724563">
			April 7, 2009 at 10:35 am</a>		</div>

		<p>I think it would be more fun to yell profanities into the microphone, but maybe that&#8217;s just me.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-724583">
				<div id="div-comment-724583" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ton</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724583">
			April 7, 2009 at 11:00 am</a>		</div>

		<p>Brilliant but a sad waste of talent&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-724593">
				<div id="div-comment-724593" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">RobO</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724593">
			April 7, 2009 at 11:02 am</a>		</div>

		<p>How about playing it the drum solo from In-A-Gadda-Da-Vida?</p>
<p>Maybe you could use it to force one music video to play to the beat of another song, like playing Everybody Wants to Rule the World with Ailen Ant Farm&#8217;s Smooth Criminal as the reference timer.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-724603">
				<div id="div-comment-724603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">someone else</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724603">
			April 7, 2009 at 11:02 am</a>		</div>

		<p>I expect this in the next (DirectX|Platform) SDK.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-724613">
				<div id="div-comment-724613" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Paul Williams</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724613">
			April 7, 2009 at 11:19 am</a>		</div>

		<p>That is way cool. &nbsp;Thank you for sharing.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-724623">
				<div id="div-comment-724623" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">keith</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724623">
			April 7, 2009 at 3:32 pm</a>		</div>

		<p>Is there a reference work that this was designed to &#8212; like mp3 compression and Suzanne Vega&#8217;s &quot;Tom&#8217;s Diner&quot;, or the 74 minute length of a CD and a specific performance of Beethoven&#8217;s 9th?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-724633">
				<div id="div-comment-724633" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">hexatron</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724633">
			April 7, 2009 at 7:35 pm</a>		</div>

		<p>The Metronome example of the Direct X SDK makes writing a new reference clock extremely simple. I used it to sync a movie to some other onscreen animation.</p>
<p>Connecting the filter properly is harder than writing it (at least in C++, where each pin seems to be about 20 lines of tedious code).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-724643">
				<div id="div-comment-724643" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jolyon Smith</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724643">
			April 7, 2009 at 7:41 pm</a>		</div>

		<p>In the music gadgets biz (keyboards, recording, FX etc), this sort of thing is called &quot;Tap Tempo&quot;, although admittedly it usually involves tapping a button or pad (hence: &quot;TAP Tempo&quot;), rather than clapping, but the principle is the same.</p>
<p>Even with video I can see that the ability to set/adjust tempo rythmically could be very useful if trying to achieve a beat synergy (as opposed to precise &quot;synchronization&quot;) between some piece of video and soundtrack audio (during the mixing stage).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-724653">
				<div id="div-comment-724653" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://adc-arab.info/vb/' rel='external nofollow' class='url'>][ThE_LuNaTiC][</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724653">
			April 7, 2009 at 8:14 pm</a>		</div>

		<p>Heads up for your friend and his crazy thoughts, That&#8217;s one hell of an idea he got there lol.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-724693">
				<div id="div-comment-724693" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Worf</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724693">
			April 8, 2009 at 2:23 am</a>		</div>

		<p>Hrm&#8230;</p>
<p>If that reference clock was a DirectShow object, you could possibly use it with the DirectShow Graph Builder program&#8230;</p>
<p>I never played much with DirectShow other than fight with it trying to get my camera source to work. That might make for interesting &quot;stop motion&quot; effects with a wonky reference clock. Though, camera sources are often special in that generate the reference clock so you can tell if you&#8217;re dropping frames or falling behind.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-724713">
				<div id="div-comment-724713" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Gabest</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724713">
			April 8, 2009 at 2:42 am</a>		</div>

		<p>As hexatron already mentioned it, it is the metronom sample. For those who were looking for the source.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-724663">
				<div id="div-comment-724663" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://lambert.geek.nz/' rel='external nofollow' class='url'>Miral</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724663">
			April 7, 2009 at 8:14 pm</a>		</div>

		<p>It&#8217;d be cool if this could be downloaded from somewhere. &nbsp;Can you ask your colleague if they&#8217;re amenable?</p>
<p>(Sure, it&#8217;s not very *practical*. &nbsp;But it&#8217;d be fun to play with.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-724733">
				<div id="div-comment-724733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">PinkDuck</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724733">
			April 8, 2009 at 8:31 am</a>		</div>

		<p>Why did Raymond choose to use &quot;based off of&quot; instead of &quot;based on&quot; or &quot;based upon&quot;?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-724743">
				<div id="div-comment-724743" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">someone else</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724743">
			April 8, 2009 at 9:06 am</a>		</div>

		<p>Holy crap, this is great!</p>
<p>For those trying it out, my psychic powers tell me that the nonexistent README.TXT (what is this, open source??) instructs you set the microphone as the audio recording device.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-724773">
				<div id="div-comment-724773" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James Schend</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724773">
			April 8, 2009 at 11:41 am</a>		</div>

		<p>PinkDuck:</p>
<p>He&#8217;s in Washington. &quot;Based off of&quot; is what&#8217;s said here, probably a regional thing. &quot;Based on&quot; would be acceptable, but &quot;based upon&quot; would just sound weird, or snobby.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-724793">
				<div id="div-comment-724793" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Caliban Darklock</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20090407-00/?p=18613#comment-724793">
			April 8, 2009 at 12:11 pm</a>		</div>

		<p>I totally want this. It would be a great way to synchronise video to percussion. I wonder if something similar was used in that dancer thingy?</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

