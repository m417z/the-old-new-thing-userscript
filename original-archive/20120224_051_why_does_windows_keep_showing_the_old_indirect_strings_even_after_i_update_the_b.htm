<html>
<head>
<title>Why does Windows keep showing the old indirect strings even after I update the binary?</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>Why does Windows keep showing the old indirect strings even after I update the binary?</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>February 24, 2012 / year-entry #52</td></tr>
<tr><td><b>Tags:</b></td><td>other</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>30</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">If your application uses indirect localized string resources, and you update the application, you may find that Windows keeps using the old string from the previous version of the application. For example, suppose that you set the localized name for a shortcut to @C:\Program Files\Contoso\Contoso.exe,-1, and in version 1 of your program, you have LANGUAGE LANG_ENGLISH,...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>
If your application uses indirect localized string resources,
and you update the application, you may find that Windows
keeps using the old string from the previous version of the
application.
</p>
<p>
For example,
suppose that you set the localized name for a shortcut to
<code>@C:\<wbr>Program Files\<wbr>Contoso\<wbr>Contoso.exe,<wbr>-1</code>,
and in version&nbsp;1 of your program,
you have
</p>
<pre>
LANGUAGE LANG_ENGLISH, SUBLANG_NEUTRAL
STRINGTABLE
BEGIN
1 "Contoso Document Services"
END

LANGUAGE LANG_GERMAN, SUBLANG_NEUTRAL
STRINGTABLE
BEGIN
1 "Contoso Dokumentdienste"
END
</pre>
<p>
For version&nbsp;2, your marketing team decides that the
program should really be called
<i>Contoso Document <u>System</u></i>,
so you change the resource file to read
</p>
<pre>
LANGUAGE LANG_ENGLISH, SUBLANG_NEUTRAL
STRINGTABLE
BEGIN
1 "Contoso Document System"
END

LANGUAGE LANG_GERMAN, SUBLANG_NEUTRAL
STRINGTABLE
BEGIN
1 "Contoso Dokumentsystem"
END
</pre>
<p>
The user upgrades to version&nbsp;2 of your program, but the
shortcut on the Start menu still reads
<i>Contoso Document Services</i>.
What's going on?
</p>
<p>
The shell keeps a cache of indirect localized strings because
loading a DLL just to read a string out of it is pretty expensive.
This cache is keyed by the string location specifier,
and since your string location specifier hasn't changed
from its previous value of
<code>@C:\<wbr>Program Files\<wbr>Contoso\<wbr>Contoso.exe,<wbr>-1</code>,
the shell continues using the value it stored away in its cache,
which if the user had previously been using version&nbsp;1 of your
program, is the string <i>Contoso Document Services</i>.
</p>
<p>
Some people, having discovered this behavior, have tried to go in
and tinker with the shell's internal cache of indirect localized strings,
but such a technique is doomed to failure because the location of that
cache changes pretty regularly,
and besides, it's an internal implementation detail.
(And even if you find it and manage to fiddle with it,
you only fix the problem for the current user.
Other users will still have the stale cache entry.)
</p>
<p>
The best solution is to treat indirect strings as locked:
Once you decide what a string should say, you can't change it.
When you issue version&nbsp;2 of <code>Contoso.exe</code>,
you can create a second string
</p>
<pre>
LANGUAGE LANG_ENGLISH, SUBLANG_NEUTRAL
STRINGTABLE
BEGIN
1 "Contoso Document Services" // shortcuts from version 1.0 use this
2 "Contoso Document System" // shortcuts from version 2.0 use this
END

LANGUAGE LANG_GERMAN, SUBLANG_NEUTRAL
STRINGTABLE
BEGIN
1 "Contoso Dokumentdienste" // shortcuts from version 1.0 use this
2 "Contoso Dokumentsystem" // shortcuts from version 2.0 use this
END
</pre>
<p>
and have the installer for version&nbsp;2.0 create a shortcut
whose indirect localized string specifier is
</p>
<pre>
@C:\Program Files\Contoso\Contoso.exe,-<font COLOR=red>2</font>
</pre>
<p>
I admit that this method is rather clumsy and requires more attention
on the part of the developer.
Everybody wants the "cheap" way out, where the definition of "cheap"
is not "cheapest for the customer" but rather "cheapest for me,
the developer, because there's a new episode of
<i>Doctor Who</i>
tonight and I don't want to miss it."
</p>
<p>
We saw last time that
<a HREF="http://blogs.msdn.com/b/oldnewthing/archive/2012/02/23/10271263.aspx">
the format for indirect localized string resources</a>
has room for a comment.
And it's the comment that we can take advantage of here.
The shell uses the entire string location specifier as the key for
its cache lookup, and that string <i>includes the comment</i>.
Therefore, if you simply change the comment, that results in a cache
miss, and the shell will go and re-fetch the string.
</p>
<p>
<pre>
@C:\Program Files\Contoso\Contoso.exe,-1<font COLOR=red>;v2</font>
</pre>
<p>
By appending a <code>;v2</code> to the string, you made it different
from its predecessor, which means that the string cached by the
predecessor won't be used.
</p>
<p>
As I noted, this is cheap for the developer, but not necessarily
cheap for the customer.
Suppose the customer copied the shortcut to Contoso version&nbsp;1
to their desktop,
then upgraded to version&nbsp;2.
The upgrade replaces the shortcut in the Start menu, but the
copy on the desktop remains unchanged.
You now have a shortcut on the desktop whose indirect string is
</p>
<pre>
@C:\Program Files\Contoso\Contoso.exe,-1
</pre>
<p>
and a shortcut on the Start menu whose indirect string is
</p>
<pre>
@C:\Program Files\Contoso\Contoso.exe,-1;v2
</pre>
<p>
Since the shortcut on the desktop was created while version&nbsp;1
was still installed on the computer,
its name will read <i>Contoso Document Services</i>
because that was the contents of string&nbsp;1.
On the other hand, the shortcut on the Start menu will read
<i>Contoso Document System</i> because its use of the <code>;v2</code>
forced the shell to go back and look again,
and this time it sees the revised string.
So far so good.
</p>
<p>
But then the user does something which causes the cache to be pruned,
like, say,
<a HREF="http://blogs.msdn.com/b/oldnewthing/archive/2006/04/24/582153.aspx">
changing their UI language to German</a>.
The shell says,
"Okay, the UI language changed, I need to go reload all these
indirect strings because MUI is going to change them to the new language."
The shell sees the shortcut on the Start menu, reads string&nbsp;1
out of <code>Contoso.exe</code>, and gets
<i>Contoso Dokumentsystem</i>.
The shell then sees the shortcut on the desktop, reads string&nbsp;1
out of <code>Contoso.exe</code>, and gets...
<i>Contoso Dokumentsystem</i>.
Not <i>Contoso Dokumentdienste</i>.
</p>
<p>
Notice that the name of the shortcut on the desktop was silently
upgraded to Contoso version&nbsp;2.
</p>
<p>
Even if the user changes the language back to English in an attempt
to get things back to the way they were, it won't work.
The shell sees the shortcut on the Start menu, reads string&nbsp;1
out of <code>Contoso.exe</code>, and gets
<i>Contoso Document System</i>.
The shell then sees the shortcut on the desktop, reads string&nbsp;1
out of <code>Contoso.exe</code>, and gets
<i>Contoso Document System</i>,
not <i>Contoso Document Service</i>.
The original string from the first version of <code>Contoso.exe</code>
is already gone; the only way to get it back is to reinstall
Contoso version&nbsp;1.
</p>
<p>
But at least you didn't miss your TV show.
</p>
<p>
<b>Bonus chatter</b>:
The one case I can think of where the cheap way out is
acceptable is when you are issuing a prerelease version.
For your prerelease versions, you can append
<code>;prerelease build xxxxx</code> to your string
location specifier (where <code>xxxxx</code> is the build number),
so that each time the user upgrades
to a new build, the string is reloaded from scratch.
This still has the same problem described above if the user
has data left over from a previous build, but since it's
a prerelease build, you can just declare that as not a
supported configuration.</p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (30)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-968133">
				<div id="div-comment-968133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">asf</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968133">
			February 24, 2012 at 7:07 am</a>		</div>

		<p>Can shortcuts even store indirect strings? Or are you talking about desktop.ini?</p>
<div class="post">[<i><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb774955(v=vs.85).aspx" rel="nofollow">You can put indirect strings into shortcuts too</a>. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-968143">
				<div id="div-comment-968143" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Eric Fournier</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968143">
			February 24, 2012 at 7:14 am</a>		</div>

		<p>I&#39;m confused. Isn&#39;t it a GOOD thing that the desktop shortcut also got updated?</p>
<div class="post">[<i>You truncated the question. Is it a good thing that the desktop shortcut got updated <span style="text-decoration:underline;">at some unpredictable point in the future</span>. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-968153">
				<div id="div-comment-968153" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/analisnudesette_4000_hotmail.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>analisnudesette@hotmail.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968153">
			February 24, 2012 at 8:12 am</a>		</div>

		<p>Presumably icons are cached by the shell in the same way, which explains a lot.</p>
<p>The shell doesn&#39;t need to load the DLL to check if the cached strings are still likely to be valid. Checking the DLL&#39;s date would solve the problem in most cases (and it&#39;d be forgiveable for caching to go wrong in cases where two DLL versions had identical datestamps).</p>
<p>Of course, checking the date every time the string was used would be too expensive, but the shell could at least check it occasionally. Caches that never verify their validity are rather non-brilliant.</p>
<div class="post">[<i>&quot;Occasionally, Explorer stops responding for several minutes.&quot; Try debugging that. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-968163">
				<div id="div-comment-968163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Oh</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968163">
			February 24, 2012 at 8:59 am</a>		</div>

		<p>Is there really a new episode of Dr. Who tonight?!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-968173">
				<div id="div-comment-968173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Boris</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968173">
			February 24, 2012 at 9:11 am</a>		</div>

		<p>@Oh, no, not until this fall, unfortunately.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-968183">
				<div id="div-comment-968183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">JM</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968183">
			February 24, 2012 at 9:44 am</a>		</div>

		<p>InvalidateIndirectStringCache(LPCTSTR lpModule) or even InvalidateShellCaches(LPCTSTR lpModule) would cause unacceptable missing of Doctor Who episodes for the MS developers, I take it? :-)</p>
<p>I&#39;m just teasing here, but the knife cuts both ways. If this is such a common scenario that it requires &quot;careful attention&quot; from the application developers, MS could choose to make it slightly less painful for end users as well by making it easy. I don&#39;t know where it would end up on the -100 points scale, mind you. In any case, it shouldn&#39;t take &quot;several minutes&quot; for a single module. It would be included in the installation/upgrade time, which to end users (sad to say) is an acceptable time to be unresponsive and slow anyway, if my personal experiences are any indication.</p>
<div class="post">[<i>This imaginary <code>Invalidate&shy;Indirect&shy;String&shy;Cache</code> wouldn&#39;t solve the problem, since it couldn&#39;t invalidate the caches of other users. -Raymond</i></div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-968193">
				<div id="div-comment-968193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">SimonRev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968193">
			February 24, 2012 at 9:45 am</a>		</div>

		<p>But when Raymond queued this post Dr. Who was airing new episodes in the spring (if he had queued this for the end of April or May and Dr. Who hadn&#39;t moved to a fall schedule, he might well have gotten a lot of folks excited)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-968213">
				<div id="div-comment-968213" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">asf</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968213">
			February 24, 2012 at 11:25 am</a>		</div>

		<p>@Raymond: The docs don&#39;t say anything about indirect strings, only a user comment but that does not list the minimum OS. All the protocol specification ([MS-SHLLINK].pdf) says is: &quot;NAME_STRING: An optional structure that specifies a description of the shortcut that is displayed to end users to identify the purpose of the shell link. This structure MUST be present if the HasName flag is set.&quot;</p>
<p>It does work on WinXP, did not test on 2000&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-968223">
				<div id="div-comment-968223" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">JM</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968223">
			February 24, 2012 at 11:36 am</a>		</div>

		<p>@Raymond: if the user is upgrading the application for other users, they should also be able to invalidate shell caches for other users. If the user is not upgrading the application for other users, then those users&#39; caches don&#39;t need invalidating.</p>
<p>I don&#39;t actually develop multi-user apps, so I&#39;m probably missing something?</p>
<div class="post">[<i>And what if the other users&#39; profiles are not accessible because they are on a roaming profile server you don&#39;t have access to? (And in a corporate environment &quot;all other users&quot; can run in the tens of thousands.) -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-968253">
				<div id="div-comment-968253" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">JM</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968253">
			February 24, 2012 at 11:52 am</a>		</div>

		<p>Of course, if you put a gun to my head I can work around that issue too: defer the cache update by keeping a local list of updates-to-process. Implementing this so it gets tracked across profiles properly is of course not trivial.</p>
<p>&quot;And what if the application is stored on a network so it&#39;s not updated locally, and someone logs in from across the world to use the upgraded version of the application?&quot;</p>
<p>Then push the update to the domain controllers.</p>
<p>&quot;This feature started off at -100 points, care to guess how far it&#39;s come along since then?&quot;</p>
<p>Shut up, imaginary version of Raymond.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-968263">
				<div id="div-comment-968263" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">NP</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968263">
			February 24, 2012 at 12:12 pm</a>		</div>

		<p>What about using the modified date on the shortcut as a key for the cache? When the binary is updated, the shortcut can also be refreshed by changing only its last modified date. Then, the cache would beinvalidated for this shortcut only. What am I missing?</p>
<div class="post">[<i>You would have to find every copy of the shortcut the user ever made. What if the user copied it to a USB thumb drive? -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-968273">
				<div id="div-comment-968273" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">chentiangemalc</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968273">
			February 24, 2012 at 12:25 pm</a>		</div>

		<p>This very rarely causes any issues&#8230;.for explorer please always take the highest performing design! I would think even date check to validate cache would be too slow, some people have hundreds of shortcuts on their desktop/startmenu.</p>
<div class="post">[<i>The date check can be very expensive if the target DLL is on slow media (DVD) or a slow network. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-tonyschr even thread-even depth-1" id="comment-968283">
				<div id="div-comment-968283" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Tony+Schreiner+%5BMSFT%5D' rel='external nofollow' class='url'>Tony Schreiner [MSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968283">
			February 24, 2012 at 12:36 pm</a>		</div>

		<p>This is shortsighted design for a cache. Thankfully (and partly because of me) there&#39;s a way in Win7 to do reliable MUI cache invalidation. I haven&#39;t tested it in a while and assume this is the subject of a future post, so I won&#39;t reveal the secret.</p>
<p>Not that long ago I had to write code to enumerate user profiles in the registry, load the hive for that user, and clear the cached value (which is in different places on XP vs. Vista). We punted on the issue of roaming profiles. Look for the source in IECleanup.exe.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-maurits odd alt thread-odd thread-alt depth-1" id="comment-968293">
				<div id="div-comment-968293" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Maurits+%5BMSFT%5D' rel='external nofollow' class='url'>Maurits [MSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968293">
			February 24, 2012 at 4:27 pm</a>		</div>

		<p>&gt; The shell keeps a cache of indirect localized strings</p>
<p>Can&#39;t this cache be invalidated when the target .dll is written to? &nbsp;Or is the shell not notified when this happens?</p>
<div class="post">[<i>What if the target DLL is written to while you are logged off? And wouldn&#39;t this require the shell to monitor all DLLs which appear in the cache? -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-968243">
				<div id="div-comment-968243" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">JM</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968243">
			February 24, 2012 at 11:49 am</a>		</div>

		<p>@Raymond: that&#39;s what I meant by &quot;missing something&quot;.</p>
<p>Of course, what you describe is pretty awful &#8212; with a design like that you can *never* invalidate any cache stored in a roaming profile, except on an ad-hoc basis (and you might as well not bother with that, viz. the &quot;Explorer stops working for several minutes&quot; issue). Someone clever once said that &quot;a cache with a bad policy is another name for a memory leak&quot;. I suppose a cache that can&#39;t update is indistinguishable from a pain in the neck for developers. :-)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-968303">
				<div id="div-comment-968303" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">asdbsd</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968303">
			February 25, 2012 at 12:02 am</a>		</div>

		<p>Why not have a second cache with DLL update times, common to all users? When indirect string gets cached, the DLL is registered there. The system monitors FS for changes to those DLLs. Then, when indirect string is taken from the cache, it&#39;s time of caching is compared to the corresponding DLL update time, and if it&#39;s different, the string&#39;s invalidated.</p>
<p>In this common cache instead of DLL names you might store hashes. I wonder if this still qualifies as a privacy leak.</p>
<div class="post">[<i>There are so many things wrong with this I don&#39;t know where to begin. At least two security flaws, possibly three depending on how you count. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alexcohn even thread-even depth-1" id="comment-968313">
				<div id="div-comment-968313" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Alex+Cohn' rel='external nofollow' class='url'>Alex Cohn</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968313">
			February 25, 2012 at 1:05 am</a>		</div>

		<p>[What if the user copied it to a USB thumb drive? -Raymond]</p>
<p>That&#39;s a good one. If I plug in the portable disk into different computers, it will show up with very different text and icon, too?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-968323">
				<div id="div-comment-968323" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ender</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968323">
			February 25, 2012 at 1:57 am</a>		</div>

		<p>Let&#39;s be real: how often do you update the indirect string without also modifying/replacing the shortcut?</p>
<div class="post">[<i>Often enough that people ask this question because they updated the indirect string without also modifying the shortcut. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-968333">
				<div id="div-comment-968333" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Neil</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968333">
			February 25, 2012 at 2:31 am</a>		</div>

		<p>There&#39;s no need to retain the old index 1 string because that&#39;s a solved problem. Or else how does Windows cope with roaming your profile to a computer that doesn&#39;t actually have C:Program FilesContosoContoso.exe and then changing the UI language?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-968343">
				<div id="div-comment-968343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968343">
			February 25, 2012 at 7:46 am</a>		</div>

		<p>@Neil: It doesn&#39;t. That scenario is already broken anyway, so don&#39;t think about it.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-968353">
				<div id="div-comment-968353" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Stefan Kanthak</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968353">
			February 25, 2012 at 11:13 am</a>		</div>

		<p>| This imaginary InvalidateIndirectStringCache wouldn&#39;t solve the problem, since it couldn&#39;t invalidate the caches of other users.</p>
<p>| And what if the other users&#39; profiles are not accessible because they are on a roaming profile server you don&#39;t have access to?</p>
<p>That&#39;s the task of the part of the installer that is run from</p>
<p>[HKEY_LOCAL_MACHINESoftwareMicrosoftActive SetupInstalled Components&#8230;]</p>
<p>&quot;StubPath&quot;=&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-968373">
				<div id="div-comment-968373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Paul</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968373">
			February 25, 2012 at 9:34 pm</a>		</div>

		<p>Are there any benefits to this feature that are worth all these problems? &nbsp;Why was it implemented in the first place when it was obvious it would be broken for so many scenarios?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-968413">
				<div id="div-comment-968413" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ender</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968413">
			February 27, 2012 at 12:36 am</a>		</div>

		<p>[Often enough that people ask this question because they updated the indirect string without also modifying the shortcut. -Raymond]</p>
<p>I really should have known this would be the answer&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cheong odd alt thread-odd thread-alt depth-1" id="comment-968393">
				<div id="div-comment-968393" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/cheong00' rel='external nofollow' class='url'>cheong00</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968393">
			February 26, 2012 at 7:13 pm</a>		</div>

		<p>Emmm&#8230; I think if there&#39;s a setting in the Windows installer service to force cache update, it should be okay.</p>
<p>Something like &quot;if the user&#39;s last logon time to this computer is later than (the last update time of software that requires cache refresh), refresh the user&#39;s cache after logon&quot;.</p>
<p>[And what if the other users&#39; profiles are not accessible because they are on a roaming profile server you don&#39;t have access to? (And in a corporate environment &quot;all other users&quot; can run in the tens of thousands.) -Raymond]</p>
<p>Somehow I think if roaming profile users don&#39;t get their cache update, their I.T. should understand, and most probably the users as well (known as common glitches&#8230; it&#39;s quite common for applications that not designed for roaming profile behave in some &quot;funny&quot; way, and the users have grown accustomed to that, AmIRight?). *Put troll cap on*</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-968433">
				<div id="div-comment-968433" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">asdbsd</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968433">
			February 27, 2012 at 4:08 am</a>		</div>

		<p>[There are so many things wrong with this I don&#39;t know where to begin. At least two security flaws, possibly three depending on how you count. -Raymond]</p>
<p>I&#39;d like to hear the explanation, if possible. The only flaws I can think of can be fixed with some more or less trivial workarounds.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-968403">
				<div id="div-comment-968403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">dirk gently</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968403">
			February 26, 2012 at 11:43 pm</a>		</div>

		<p>To be completely fair, Doctor Who *does* rule and Karen Gillan is pretty hot, so I&#39;m with the developer this time.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-maurits even thread-even depth-1" id="comment-968603">
				<div id="div-comment-968603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Maurits+%5BMSFT%5D' rel='external nofollow' class='url'>Maurits [MSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968603">
			February 27, 2012 at 3:14 pm</a>		</div>

		<p>&gt; What if the target DLL is written to while you are logged off? And wouldn&#39;t this require the shell to monitor all DLLs which appear in the cache?</p>
<p>So make that a requirement of the cache. &nbsp;&quot;The indirect string cache needs to be invalidated when the target .dll is written to, even if no user is logged on.&quot; &nbsp;This just implies that the shell is a bad place to keep the cache.</p>
<div class="post">[<i>This means that the cache must be system-wide, which is a problem because different users can be running different languages. (I guess you could monitor all satellite DLLs, but that quickly explodes into thousands of DLLs being monitored by the system.) Also, what if the file is modified while the operating system isn&#39;t even running? (E.g., you boot into another partition and then modify the file, or the file is on a removable drive and is modified while inserted into some other machine.) -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-maurits odd alt thread-odd thread-alt depth-1" id="comment-968613">
				<div id="div-comment-968613" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Maurits+%5BMSFT%5D' rel='external nofollow' class='url'>Maurits [MSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968613">
			February 27, 2012 at 3:32 pm</a>		</div>

		<p>Hmmm&#8230; let&#39;s recap.</p>
<p>Definition: a &quot;perfect&quot; caching system is one that creates a performance boost leaving no other evidence that it exists (no possibility of stale data being returned; no cache poisoning; no authorization bypasses, etc.)</p>
<p>This blog post is a special case of the truism &quot;some caching systems are imperfect.&quot;</p>
<p>In this case, it looks like rubbing out the &quot;OMG there&#39;s a cache here&quot; evidence would either require reaching out to the .dll (to do a timestamp or hash comparison, losing a lot of the performance gain of the existing implementation) or pushing the problem down to the file system level (in which case it would only work on the new file system.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-968663">
				<div id="div-comment-968663" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-968663">
			February 28, 2012 at 3:17 am</a>		</div>

		<p>.lnk-files are broken by design.</p>
<p>The fix is, as usual, to reinstall windows.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-maurits odd alt thread-odd thread-alt depth-1" id="comment-969243">
				<div id="div-comment-969243" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Maurits+%5BMSFT%5D' rel='external nofollow' class='url'>Maurits [MSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120224-00/?p=8233#comment-969243">
			March 1, 2012 at 6:14 pm</a>		</div>

		<p>&gt; which is a problem because different users can be running different languages</p>
<p>Why is that a problem? &nbsp;Because when different users log in you get cache collisions?</p>
<p>Overcomeable; include the language information in the cache key (or equivalently, have a cache for each language.)</p>
<div class="post">[<i>I&#39;m still surprised you haven&#39;t freaked out over Windows having to register a change notification on every single DLL that has evern been seen (and then at every boot, reverifying the cache in case the file was modified while offline). It seems that you&#39;re over-engineering the problem. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

