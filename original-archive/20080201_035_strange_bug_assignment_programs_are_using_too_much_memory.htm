<html>
<head>
<title>Strange bug assignment: Programs are using too much memory</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>Strange bug assignment: Programs are using too much memory</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>February 1, 2008 / year-entry #36</td></tr>
<tr><td><b>Tags:</b></td><td>other</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>60</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">My office is in the same hallway as the programmer and program manager responsible for the Processes tab in Task Manager. (Of course, they are responsible for a bunch of other stuff too; it's not like 100% of their days are dedicated to Task Manager!) I happened to be passing by just as this particular...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p> My office is in the same hallway as the programmer and program manager responsible for the Processes tab in Task Manager. (Of course, they are responsible for a bunch of other stuff too; it's not like 100% of their days are dedicated to Task Manager!) I happened to be passing by just as this particular bug popped up on their radar. It went something like this: </p>
<blockquote class="m">
<p> Problem: Task Manager reporting programs are using too much memory </p>
<p> Steps to reproduce:  </p>
<ul>
<li>Start up the system and run some programs. </li>
<li>Run Task Manager. </li>
<li>Go to the Process tab. </li>
<li>Look at the Memory Usage column. </li>
</ul>
<p> Result: The numbers are too big! </p>
<p> Expected result: Less memory usage. </p>
</blockquote>
<p> Apparently, it's Task Manager's fault that other programs are using lots of memory. Maybe we should just take the values and divide them by two, just to make things look better. </p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (60)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-596823">
				<div id="div-comment-596823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">dave</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-596823">
			February 1, 2008 at 10:06 am</a>		</div>

		<p>It&#8217;s a good thing I didn&#8217;t have coffee in my mouth when I read that last line.</p>
<p>When they fix the bug, can you let us know? &nbsp;I&#8217;m trying to figure out how to make a program a little bit more compact (currently it will try to use all the memory available and then some for the working data it allocates), and if the task manager guys can figure out how to do that, it will save me a lot of trouble.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-596833">
				<div id="div-comment-596833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Bob Oleenk</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-596833">
			February 1, 2008 at 10:12 am</a>		</div>

		<p>Raymond, you should just walk over there and share the solution to their bug with them right now. &nbsp;&quot;Task manager is showing correct memory usage. &nbsp;The programs which appear to show too much memory usage are indirectly loading shell extensions.&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-596873">
				<div id="div-comment-596873" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Evan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-596873">
			February 1, 2008 at 10:39 am</a>		</div>

		<p>What&#8217;s wrong with that? The duokilobyte is a perfectly reasonable unit of measurement!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-596913">
				<div id="div-comment-596913" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.apptranslator.com' rel='external nofollow' class='url'>Serge Wautier</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-596913">
			February 1, 2008 at 11:11 am</a>		</div>

		<p>I often thought there was indeed a bug with these figures in Task Manager. Glad to read it is actually a bug!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-596923">
				<div id="div-comment-596923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-596923">
			February 1, 2008 at 11:12 am</a>		</div>

		<p>I&#8217;m curious. How does such a bug get escalated to development?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-596933">
				<div id="div-comment-596933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">mcowen</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-596933">
			February 1, 2008 at 11:13 am</a>		</div>

		<p>The numbers are too big? How do you know that they are too big? Maybe the program you are using as a reference is wrong, and Task Manager is correct.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-596953">
				<div id="div-comment-596953" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://slashdot.org/' rel='external nofollow' class='url'>Low IQ</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-596953">
			February 1, 2008 at 11:23 am</a>		</div>

		<p>Solution: Install Linux.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-596973">
				<div id="div-comment-596973" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Gabe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-596973">
			February 1, 2008 at 11:30 am</a>		</div>

		<p>Maybe the tester who filed the bug thought the numbers were in hex instead of decimal.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-596993">
				<div id="div-comment-596993" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">aJanuary</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-596993">
			February 1, 2008 at 11:44 am</a>		</div>

		<p>&quot;Task Manager says 177,248 and I only have 2&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597023">
				<div id="div-comment-597023" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ajb</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597023">
			February 1, 2008 at 11:53 am</a>		</div>

		<p>My favorite &#8216;strange bug assignment&#8217; went something like this: &nbsp;</p>
<p>-open up (configuration file that our app uses) in notepad. &nbsp;</p>
<p>-see that it contains Foo. &nbsp;</p>
<p>-In our application, do action X.</p>
<p>-press F5 in notepad to refresh</p>
<p>-Note that a timestamp was added to the configuration file.</p>
<p>Bug: action X should not add a timestamp to the configuration file.</p>
<p>(Hint: F5 doesn&#8217;t mean &#8216;refresh&#8217; in notepad.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597033">
				<div id="div-comment-597033" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Koro</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597033">
			February 1, 2008 at 11:54 am</a>		</div>

		<p>In Windows Vista, the Task Manager has the nasty habit of reporting the &#8220;Physical memory use&#8221; in the Performance tab, instead of the &#8220;Page file use&#8221; (which is more accurate to know how programs allocate memory) like all previous Windows versions did. Since memory use is always lower than page file usage (and always lower than total installed memory), one gets to wonder, was this done in order to &#8220;cover&#8221; for Vista&#8217;s huge memory usage?</p>
<div class="post">[<i>It was done because the perfomance monitoring team felt it was a less misleading value to show to the user. Which would you rather have: A program that allocates 200MB of memory but actively uses only 64KB of it, or a program that allocates 100MB of memory and actively uses all of it? Oh wait, no need to answer. You&#8217;d rather have the second program. I&#8217;d rather have the first. I guess we can just agree to disagree. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597073">
				<div id="div-comment-597073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://nomagichere.blogspot.com' rel='external nofollow' class='url'>Marc Bernard</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597073">
			February 1, 2008 at 12:39 pm</a>		</div>

		<p>I had a bug report that one of our apps was taking 100% CPU. &nbsp;I said, &quot;hey, it&#8217;s not wasting any.&quot; &nbsp;Why only use half the available CPU?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597083">
				<div id="div-comment-597083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://d20.jonnydigital.com' rel='external nofollow' class='url'>Jonathan Drain's D&amp;D Blog</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597083">
			February 1, 2008 at 12:40 pm</a>		</div>

		<p>A friend in tech support once had to handle this report:</p>
<p>&quot;When I click the red X in Outlook, the program exits. Is this a known issue?&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597093">
				<div id="div-comment-597093" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.1060.org/blogxter/publish/5' rel='external nofollow' class='url'>Steve Loughran</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597093">
			February 1, 2008 at 12:42 pm</a>		</div>

		<p>Bad news for whoever said linux is better: try java on a 64 bit linux box:</p>
<p>VIRT &nbsp;RES &nbsp;SHR S %CPU %MEM &nbsp; &nbsp;TIME+ &nbsp;COMMAND &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>2430m 834m &nbsp;14m S &nbsp; &nbsp;0 13.9 &nbsp;19:31.36 java &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>&nbsp;762m 560m 544m S &nbsp; 15 &nbsp;9.4 &nbsp;95:17.04 vmware-vmx &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>&nbsp;856m 332m &nbsp;29m S &nbsp; &nbsp;4 &nbsp;5.6 206:00.52 firefox-bin &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>1696m 171m &nbsp;12m S &nbsp; &nbsp;0 &nbsp;2.9 &nbsp; 6:09.90 java &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>1563m 153m 9980 S &nbsp; &nbsp;0 &nbsp;2.6 &nbsp; 1:23.08 java &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>&nbsp;292m 147m &nbsp;21m S &nbsp; &nbsp;0 &nbsp;2.5 &nbsp; 0:19.62 thunderbird-bin &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>&nbsp;259m 143m &nbsp;38m S &nbsp; &nbsp;1 &nbsp;2.4 &nbsp;32:54.43 Xorg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>&nbsp;312m &nbsp;59m &nbsp;14m S &nbsp; &nbsp;0 &nbsp;1.0 &nbsp; 0:51.61 evince &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>&nbsp;382m &nbsp;52m &nbsp;27m S &nbsp; &nbsp;0 &nbsp;0.9 &nbsp; 3:57.80 vmware &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>&nbsp;492m &nbsp;44m &nbsp;23m S &nbsp; &nbsp;0 &nbsp;0.8 &nbsp; 0:11.98 nautilus</p>
<p>There are single programs consuming more memory than a copy of XP+outlook running under VMWare &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . Oh. and this is the JRockit JVM that uses NEAR pointers for its memory, so the JVM heap is smaller than the 64-bit FAR pointer world of Sun&#8217;s JVM. Developers (that&#8217;s us) &nbsp;have got lazy about memory consumption, and end users suffer.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-mike-dimmick even thread-even depth-1" id="comment-597113">
				<div id="div-comment-597113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Mike+Dimmick' rel='external nofollow' class='url'>Mike Dimmick</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597113">
			February 1, 2008 at 12:49 pm</a>		</div>

		<p>@Koro: rubbish. Previous versions of Windows Task Manager reported working set size, i.e. physical memory used by this process (including shared pages). I&#8217;m not at my Vista computer at present so I&#8217;m not sure of the change, I think it was to remove the shared pages so they&#8217;re not counted multiple times.</p>
<p>One solution to the bug submitter&#8217;s problem would be to remove half the RAM fitted in the system. Sure, the system would be swapping more, but the working sets would be smaller.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597133">
				<div id="div-comment-597133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Aaargh!</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597133">
			February 1, 2008 at 1:03 pm</a>		</div>

		<p>&quot;A program that allocates 200MB of memory but actively uses only 64KB of it, or a program that allocates 100MB of memory and actively uses all of it?&quot;</p>
<p>What happens if you have, say, 512MB ram installed and two applications open, one actively using 256MB and one actively using 384MB (thus causing the system to swap constantly). Does it report that 512MB of physical memory is in use (because there is only 512MB of physical memory) or does it report 640MB in use, because that&#8217;s the amount actively being used.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597163">
				<div id="div-comment-597163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jess Sightler</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597163">
			February 1, 2008 at 1:31 pm</a>		</div>

		<p>@Steve Loughran,</p>
<p>JRockit is not exactly the model app for not using much memory. &nbsp;It tends to be faster than Sun&#8217;s vm, but also more memory intensive, ime.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597173">
				<div id="div-comment-597173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Eff Five</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597173">
			February 1, 2008 at 1:54 pm</a>		</div>

		<p>Koro:</p>
<p>This article has and interesting opionon on this <a rel="nofollow" target="_new" href="http://blogs.msdn.com/tess/archive/2006/09/06/net-memory-usage-a-restaurant-analogy.aspx" rel="nofollow">http://blogs.msdn.com/tess/archive/2006/09/06/net-memory-usage-a-restaurant-analogy.aspx</a></p>
<p>Look for the heading &quot;A comment on performance counters and how not to use taskmanager&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597193">
				<div id="div-comment-597193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Andrew Feldstein</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597193">
			February 1, 2008 at 2:02 pm</a>		</div>

		<p>I can&#8217;t believe no one has referred to &quot;shooting the messenger&quot; yet!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597233">
				<div id="div-comment-597233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">David Brooks</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597233">
			February 1, 2008 at 3:09 pm</a>		</div>

		<p>If it&#8217;s the bug I&#8217;m looking at &#8211; it&#8217;s hard to be sure, but I think the reporter (a CTP user) is saying: &quot;look how much memory is used by Vista system processes, even before I run an app! In my opinion, Vista is a memory hog. By the way, I used Task Manager to show this.&quot;</p>
<p>But that&#8217;s using psychic powers to read the user&#8217;s mind.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597243">
				<div id="div-comment-597243" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Marc K</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597243">
			February 1, 2008 at 3:14 pm</a>		</div>

		<p>&#8220;Which would you rather have: A program that allocates 200MB of memory but actively uses only 64KB of it, or a program that allocates 100MB of memory and actively uses all of it?&#8221;</p>
<p>Regardless, I&#8217;d like to have both figures available (working set size and virtual memory allocation), which is why my task manager is &#8220;Process Explorer&#8221;.</p>
<div class=post>[<i>Task Manager has the unfortunate position of being run frequently by people who don&#8217;t know how to interpret the data it provides. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597253">
				<div id="div-comment-597253" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anonymous Coward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597253">
			February 1, 2008 at 3:16 pm</a>		</div>

		<p>Maybe that&#8217;s because Vista IS a memory hog? How come a clean XP install uses no more than 120-140MB of page file, whereas Vista uses 700?</p>
<p>By reverting to Classic Mode and stopping a bunch of unneeded services, it can be brought down to 300-400&#8230; but that&#8217;s STILL too much!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597373">
				<div id="div-comment-597373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://sitdown.org.uk/' rel='external nofollow' class='url'>Marc</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597373">
			February 1, 2008 at 4:42 pm</a>		</div>

		<p>What annoys me is when people moan about the RAM Vista uses. If you want empty RAM, take it out, and put it on your desk!</p>
<p>Vista puts lots of stuff into RAM so everything runs quick, context menus, application startup times, explorer thumbnails, all a lot run quicker. I&#8217;d rather that than having my RAM meter showing 70% free&#8230;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-xepol odd alt thread-odd thread-alt depth-1" id="comment-597383">
				<div id="div-comment-597383" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Xepol' rel='external nofollow' class='url'>Xepol</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597383">
			February 1, 2008 at 4:43 pm</a>		</div>

		<p>I don&#8217;t believe the comment is about Taskman, but rather the bizarre, out of control memory hogging that seems to go on now aways.</p>
<p>I remember when Win95 could run effectively on a 4mb machine. I fire up TaskMan now, and even explorer is sucking up an astonishing gigabyte of ram virtual and half a gig private, leading me to say &quot;wtf???&quot;</p>
<p>Heck, even uTorrent which prides itself on its small footprint has 16mb of private bytes and 128mb of virtual memory. &nbsp;Heck, I didn&#8217;t even HAVE 128mb of ram until my pentium II system&#8230;</p>
<p>Ultimately, we are all wondering what the heck is going on with ram consumption, as even the pithiest of apps seems to consume more ram than we could have dreamed of affording in the win95 days.</p>
<p>Since the OS requirements for ram have grown from a simple 4mb to an astonishing 1gb, we all wonder if this is the apps or something more fundamental in the OS itself.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597423">
				<div id="div-comment-597423" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Josh</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597423">
			February 1, 2008 at 5:24 pm</a>		</div>

		<p>Xepol, uTorrent prides itself on a low footprint for the executable itself, but if you leave it to its own devices on a high speed connection it will create a fairly large cache. &nbsp;Disable the cache and uTorrent&#8217;s memory usage will drop drastically. &nbsp;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597443">
				<div id="div-comment-597443" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Triangle</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597443">
			February 1, 2008 at 5:35 pm</a>		</div>

		<blockquote><p>
  An API should also be made available for programs to control the factor of their own program.
</p></blockquote>
<p>Then programmers would abuse it to make it look like they were consuming less memory than they really are.</p>
<blockquote><p>
  Vista puts lots of stuff into RAM so everything runs quick, context menus, application startup times, explorer thumbnails, all a lot run quicker. I&#8217;d rather that than having my RAM meter showing 70% free&#8230;.
</p></blockquote>
<p>Then how come instead of getting rid of that stuff when you run a memory intensive program, it begins paging ?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597453">
				<div id="div-comment-597453" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anonymous Coward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597453">
			February 1, 2008 at 5:37 pm</a>		</div>

		<p>&quot;Vista puts lots of stuff into RAM so everything runs quick, context menus, application startup times, explorer thumbnails, all a lot run quicker. I&#8217;d rather that than having my RAM meter showing 70% free&#8230;.&quot;</p>
<p>Problems are:</p>
<p>1- Vista is STILL slow despite what you mention (especially boot &amp; logon times &#8211; why does it have to &quot;configure updates&quot; for two minutes after installing updates?)</p>
<p>2- I&#8217;d rather have the RAM free for when I actually need it to run memory intensive apps (Virtual PC, Photoshop, games) than have Windows gob it all up &quot;to be quicker&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597473">
				<div id="div-comment-597473" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">nksingh</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597473">
			February 1, 2008 at 5:38 pm</a>		</div>

		<p>Pagefile usage/VM Size is not an entirely accurate measure of how much memory a program is using either. &nbsp;I&#8217;m no expert on taskmgr figures (I tend not to care how much memory my programs are using since I&#8217;m not obsessive about such things until I notice a slowdown), but I do know that you really need to have a sophisticated understanding of the way the Windows Memory Manager works to truly make useful observations about how the taskmgr figures correlate to system performance. &nbsp;</p>
<p>Some applications might show a huge &quot;commit size&quot; for memory, but not actually tax your system much at all. &nbsp;Mm does not even take up space in the pagefile for memory that your program allocates but never touches. &nbsp;It just charges a bit to the &quot;balance sheet&quot; of memory that it&#8217;s willing to hand out. Nothing is materialized until it&#8217;s touched. &nbsp;It&#8217;s entirely possible that the Vista heap is allocating a lot more memory from the virtual memory subsystem than the XP heap to reduce VA fragmentation in your program. Or something else of a similar nature could be happening. &nbsp;</p>
<p>A much better place to look for memory information relating to performance is the Reliability and Performance Monitor. &nbsp;I think the hard faults/sec figure gives you some insight into which programs are touching a lot of new pieces of memory frequently. &nbsp;This is the behavior which affects system performance.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597513">
				<div id="div-comment-597513" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark Sowul</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597513">
			February 1, 2008 at 6:27 pm</a>		</div>

		<p>&quot;2- I&#8217;d rather have the RAM free for when I actually need it to run memory intensive apps (Virtual PC, Photoshop, games) than have Windows gob it all up &#8216;to be quicker&#8217;&quot;</p>
<p>I&#8217;d rather have people who have no idea what they&#8217;re talking about stop doing so. &nbsp;C&#8217;est la vie.</p>
<p>Here, read these so next time you&#8217;ll sound at least slightly less clueless. &nbsp;<a rel="nofollow" target="_new" href="http://shsc.info/WindowsMemoryManagement" rel="nofollow">http://shsc.info/WindowsMemoryManagement</a></p>
<p><a rel="nofollow" target="_new" href="http://www.bitsum.com/winmemboost.asp" rel="nofollow">http://www.bitsum.com/winmemboost.asp</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597533">
				<div id="div-comment-597533" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://qstuff.blogspot.com' rel='external nofollow' class='url'>Justin Olbrantz (Quantam)</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597533">
			February 1, 2008 at 6:58 pm</a>		</div>

		<p>I once got a bug saying that my entirely-user-mode application running as limited user on one QA computer took down <a href="http://qstuff.blogspot.com/2007/01/i-win.html" target=_new rel=nofollow rel="nofollow">http://qstuff.blogspot.com/2007/01/i-win.html</a>&nbsp;an entire subnet <a href="http://qstuff.blogspot.com/2007/05/i-didnt-actually-win.html" target=_new rel=nofollow rel="nofollow">http://qstuff.blogspot.com/2007/05/i-didnt-actually-win.html</a> on the company network. I almost died laughing after reading that bug report.</p>
<p>Beat that, suckers!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597053">
				<div id="div-comment-597053" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">David Walker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597053">
			February 1, 2008 at 12:13 pm</a>		</div>

		<p>Koro: &nbsp;*Vista&#8217;s* huge memory usage? &nbsp;Although the system-related processes show up in the list, too, the stuff reported in Task Manager is mostly *application* program usage. &nbsp;</p>
<p>What does Vista have to do with that?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597553">
				<div id="div-comment-597553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Cheong</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597553">
			February 1, 2008 at 9:15 pm</a>		</div>

		<p>Steve Loughran: The nice thing about using VM (Here I mean both javaVM and vmware) to compare is that you can feel free to tell how much memory it should use. You can always tell it to eat up most of the memory in the system if you want.</p>
<p>That said, the JVM at there taking 2.4GB virtual memory&#8230; It could be Eclipse?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597563">
				<div id="div-comment-597563" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Pavel Lebedinsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597563">
			February 1, 2008 at 10:17 pm</a>		</div>

		<blockquote><p>
  I&#8217;d like to have both figures available (working set size and virtual memory allocation), which is why my task manager is &quot;Process Explorer&quot;.
</p></blockquote>
<p>Task manager already has counters for both of these (called Working Set and Commit Size on Vista):</p>
<p><a rel="nofollow" target="_new" href="http://msdn2.microsoft.com/en-us/library/aa965225.aspx" rel="nofollow">http://msdn2.microsoft.com/en-us/library/aa965225.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597273">
				<div id="div-comment-597273" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Wolf Logan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597273">
			February 1, 2008 at 3:20 pm</a>		</div>

		<p>A quick check of Vista&#8217;s Task Manager shows that the Process tab can display any combination of seven different memory figures:</p>
<p>* Working Set (Peak and Delta are also available)</p>
<p>* Private Working Set</p>
<p>* Commit Size</p>
<p>* Paged Pool</p>
<p>* Non-paged Pool</p>
<p>as well as USER ang GDI object counts, and total allocated handles.</p>
<p>If you need more information on a process&#8217; memory usage than this, you probably shouldn&#8217;t be looking in Task Manager.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597413">
				<div id="div-comment-597413" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">alex.r.</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597413">
			February 1, 2008 at 5:09 pm</a>		</div>

		<p>Of course they shouldn&#8217;t do that, it&#8217;s such an half-baked solution!</p>
<p>What they should do is add a UI option and let the *user* set the normalization factor (2, 5, 10, 17&#8230;), preferably per-process&#8230; </p>
<p>An API should also be made available for programs to control the factor of their own program.</p>
<p>Alternatively, the task manager could run as a kernel service that would gzip some pages of memory when they get to big. </p>
<p>That would work very well. </p>
<p>I see no problem whatsoever with any of the above.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597573">
				<div id="div-comment-597573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://greasemonkey.nonlogic.org' rel='external nofollow' class='url'>GreaseMonkey</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597573">
			February 2, 2008 at 2:59 am</a>		</div>

		<p>Having something like Alt+SysRq+F (kill most memory-hogging program under Linux) could be handy.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597583">
				<div id="div-comment-597583" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://aundh.blogspot.com' rel='external nofollow' class='url'>JamesW</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597583">
			February 2, 2008 at 6:44 am</a>		</div>

		<blockquote><p>
  Having something like Alt+SysRq+F (kill most memory-hogging program under Linux) could be handy.
</p></blockquote>
<p>That sounds a bit random. I&#8217;d like to know what I&#8217;m killing. No Windows to hand, but if I tried that this OS X machine right now, based on resident memory usage, it would kill the browser I&#8217;m typing this in. Next up for the chop would be PID 0. I think that would be bad.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597603">
				<div id="div-comment-597603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James Risto</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597603">
			February 2, 2008 at 9:37 am</a>		</div>

		<p>Being the &quot;go-to&quot; guy for deeper tech questions, people ask me about Vista memory usage; I explain the aggressive caching. Yet I know if task mangler and the sidebar widget showed memory usage without considering caching, that would offend others. I have no solution other than education.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597613">
				<div id="div-comment-597613" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Neil</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597613">
			February 2, 2008 at 9:57 am</a>		</div>

		<p>Another problem with the working set is that by the time you have a problem with the system the value isn&#8217;t useful as it&#8217;s a best effort rather than a realistic reflection of the process&#8217;s actual memory usage.</p>
<p>I disagree with running Windows 95 effectively on a 4mb machine. I seem to remember even Raymond admitting that it the basic installation would swap every minute to update the clock, but for me a usable installation required 8mb just for the OS &#8211; you couldn&#8217;t even run Solitaire without resorting to swap.</p>
<p>As for caches such as the one mentioned in conjunction with uTorrent, what we need is a class of memory &#8220;I don&#8217;t really need this but it would be nice to have around.&#8221; For example, Remote Desktop likes to cache bits of the screen, but I have to turn that feature off on my old laptop because it seems to cause it to swap. Instead it should use this, let&#8217;s call it &#8220;discardable&#8221;, memory and the OS would throw it away in preference to swapping. (I&#8217;m not saying that this was the reason that I found Windows 3.1 Standard mode better than 386 &#8220;Enhanced&#8221; mode but boy it felt faster.)</p>
<div class="post">[<i>The hard part of &#8220;discardable&#8221; memory isn&#8217;t the implementation, it&#8217;s the programming model. How do you tell a program, &#8220;Yeah that memory you tried to access? I discarded it.&#8221; Raise an exception? -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597653">
				<div id="div-comment-597653" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Triangle</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597653">
			February 2, 2008 at 10:49 pm</a>		</div>

		<p>[The hard part of &quot;discardable&quot; memory isn&#8217;t the implementation, it&#8217;s the programming model. How do you tell a program, &quot;Yeah that memory you tried to access? I discarded it.&quot; Raise an exception? -Raymond]</p>
<p>The operating system remembers how the memory &quot;got how it is&quot;, and then regenerates it. For example, if you have a framebuffer stored in system RAM, that could be considered discardable memory. When the program goes to access it, if it&#8217;s been discarded the window manager replays every drawing command that&#8217;s been executed on it and pretends it was never discarded in the first place.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597663">
				<div id="div-comment-597663" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Lascaille</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597663">
			February 3, 2008 at 2:04 am</a>		</div>

		<p>&quot;window manager replays every drawing command that&#8217;s been executed on it&quot;</p>
<p>Where&#8217;s that stored? Oh, in some additional memory that then has to be reserved&#8230;</p>
<p>If you wanted to implement this you&#8217;d have to implement it as part of the memory manager and provide an &#8216;allocate discardable memory&#8217; call but I don&#8217;t know if anyone would use it &#8211; probably the developers of utorrent (for example) would bury a tickbox &#8216;use discardable cache&#8217; somewhere in the conf and it&#8217;d be set off by default because it would make the performance suck.</p>
<p>Most programs that I know which have the tendency to use vast amounts of memory for caching (photoshop, azureus) have settings to let you decide how much cache you want them to allocate, which, to me, seems better.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597643">
				<div id="div-comment-597643" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nick</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597643">
			February 2, 2008 at 7:49 pm</a>		</div>

		<p>&quot;Having something like Alt+SysRq+F (kill most memory-hogging program under Linux) could be handy.&quot;</p>
<p>o.O</p>
<p>I&#8217;ve used Linux a fair bit but never heard of that. When in the WORLD would you even consider using that? &nbsp;Talk about crazy.</p>
<p>Let&#8217;s see&#8230; on my XP machine right now it appears that svchost.exe is using the most memory (some 50MB). &nbsp;Would killing that be a good idea? &nbsp;*Looks* ah, no. It&#8217;s hosting around 30 services some of which are somewhat important.</p>
<p>Crazy idea, though on second thought maybe not so bad. &nbsp;After all, most of the time it would just be a killswitch for Firefox. Must be what the &#8216;F&#8217; stands for.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597673">
				<div id="div-comment-597673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Stephen Jones</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597673">
			February 3, 2008 at 3:59 am</a>		</div>

		<p>When I got my first computer in 1996 the nice girl in the shop told me that the 8MB I provided it with might not be enough, and suggested I got another 8MB. Then in 1998 I got another with 32MB of RAM, and when I got my next paycheck upgraded to 64MB.</p>
<p>Then, as this was still the time processor speeds followed Moore&#8217;s Law, and did make a difference, I did a massive upgrade and got 128MB. A couple of years later I got another 256MB, and when a friend asked me why, I told him I might need the extra in the future, like in a couple of years time.</p>
<p>My present desktop has 2GB, just to be safe, and yet is only running the same programs I was running in 96. Admittedtly it&#8217;s faster, but how&#8217;s the commit history gone up to 765KB for email and two browsers?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597683">
				<div id="div-comment-597683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Triangle</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597683">
			February 3, 2008 at 4:10 am</a>		</div>

		<blockquote><p>
  Most programs that I know which have the tendency to use vast amounts of memory for caching (photoshop, azureus) have settings to let you decide how much cache you want them to allocate, which, to me, seems better.
</p></blockquote>
<p>But it isn&#8217;t better. If memory pressure gets high, then the OS swaps. Some of what might get swapped out is the cache. If it&#8217;s faster to regenerate the cached data than it is to access the disk, then it would improve system performance if the cache was deleted instead. Since applications don&#8217;t know about memory pressure, and the MMU doesn&#8217;t know where in memory the caches reside, there is no way to leverage that. Setting a fixed amount doesn&#8217;t work because it is inherently a dynamic property. If programs could allocate special discardable/cache memory, then the mmu could coordinate caching for best performance.</p>
<p>It looks like they almost implemented something similiar to this back in win16:</p>
<p><a rel="nofollow" target="_new" href="http://msdn2.microsoft.com/en-us/library/ms632618" rel="nofollow">http://msdn2.microsoft.com/en-us/library/ms632618</a>(VS.85).aspx</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597693">
				<div id="div-comment-597693" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Aaargh!</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597693">
			February 3, 2008 at 12:28 pm</a>		</div>

		<p>&quot;I&#8217;ve used Linux a fair bit but never heard of that. When in the WORLD would you even consider using that? &nbsp;Talk about crazy.&quot;</p>
<p>It&#8217;s one of the magic-sysrq keycombo&#8217;s and those are primarily for development/debugging purposes. It should usually be disabled on a production system.</p>
<p>There are also keycombo&#8217;s for forcing a disk sync, forcing an read-only remount of all filesystems. rebooting the system (this immediately reboots, so you need to sync and remount-ro first). And ofcourse, a keycombo that kills every application on the current VT. (thus guaranteeing you get a clean login prompt)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597703">
				<div id="div-comment-597703" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">mt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597703">
			February 3, 2008 at 2:27 pm</a>		</div>

		<blockquote><p>
  I remember when Win95 could run effectively on a 4mb machine
</p></blockquote>
<p>IIRC, when you installed Win95 on a 4MB system it installed a &quot;special&quot; set of DLL&#8217;s designed for running on that little RAM. &nbsp;Then, when you installed more RAM because your system was slow as heck you had to do a reinstall of 95 for it to use the extra memory (I fielded a lot of, &quot;I installed more RAM but my system is still slow,&quot; calls after 95&#8217;s launch).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597713">
				<div id="div-comment-597713" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">foxyshadis</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597713">
			February 3, 2008 at 3:08 pm</a>		</div>

		<blockquote><p>
  Then programmers would abuse it to make it look like they were consuming less memory than they really are.
</p></blockquote>
<p>Whoosh. Reread that post.</p>
<p>The best way imho to implement discardable memory is a new API, and let the application control the regeneration. Letting the OS do it is just one of those insanely hard problems for what will end up not working well enough anyway. Just give software some kind of setdiscardable() and when it&#8217;s ready to start using it again, unset its discardable bit and call the pertinent function if necessary.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597753">
				<div id="div-comment-597753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">anonymous</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597753">
			February 3, 2008 at 4:37 pm</a>		</div>

		<p>Commit charge and the useful shutdown menus seem to have disappeared too with Vista. Sheesh why DO MS remove features?</p>
<p>And speaking of Vista&#8217;s slowness (which is offtopic, sorry but), the servicing stack and network icon on the taskbar seem to be the slowest most bloated disk-eating (check %windir%WinSxS size) portions of the OS. Vista takes time to install updates, it takes time to shutdown and again at the next logon it shows &quot;Please wait while Windows configures updates&quot;. I contacted MS and they replied &quot;We&#8217;re aware that the servicing stack has some performance issues&quot;. I don&#8217;t buy that..isn&#8217;t this a production-ready OS? MS has made startup faster but slowed down logon/logoff. MS had made installation faster but made servicing (which is more frequent) slower.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597803">
				<div id="div-comment-597803" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">GrofLuigi</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597803">
			February 3, 2008 at 10:47 pm</a>		</div>

		<p>Quote Steve Loughran:</p>
<p>Bad news for whoever said linux is better: try java on a 64 bit linux box:</p>
<p>I&#8217;m sorry but there is logical flaw in that sentence. How is java&#8217;s slugishness fault of linux?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597763">
				<div id="div-comment-597763" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ulric</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597763">
			February 3, 2008 at 5:24 pm</a>		</div>

		<p>I&#8217;d really like to see a discussion of Vista&#8217;s memory handling.</p>
<p>I know that it&#8217;s now using more memory to make better use of the system. &nbsp;I&#8217;ve read that a while back on Coding Horror and other places.</p>
<p>But here&#8217;s the problem: I&#8217;m using Vista and it is *not* faster than XP, it feels a lot more sluggish, apps seem to take longer to load, etc. &nbsp;So&#8230; where is that performance I&#8217;m suposed to get? &nbsp;</p>
<p>For sure, the desktop compositing needs a lot of RAM, and that IS fast, so I&#8217;ll concede that. &nbsp;I&#8217;m not so sure about the enhanced disk caching, prefectching, or whatever else that&#8217;s supposed to make Windows more responsive.</p>
<p>Btw, to the guy saying above that context menus are faster.. com&#8217;on: &nbsp;context menu are not a performance problem. &nbsp;Also, Microsoft ads an something like a 400 ms artificial delay to any popup menu (which you can turn off in the registry MenuShowDelay) which affects everything on Windows.</p>
<div class=post>[<i><a href="http://beta.blogs.msdn.com/oldnewthing/archive/2008/06/19/8619303.aspx" rel="nofollow">That delay is there for a reason</a>. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597853">
				<div id="div-comment-597853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.farnz.org.uk/' rel='external nofollow' class='url'>Simon Farnsworth</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597853">
			February 4, 2008 at 8:19 am</a>		</div>

		<p>There are clean API designs for discardable memory; instead of thinking about flagging memory as discardable, and relying on exceptions or similar to let the application know that its cache has disappeared, you provide mechanisms for applications with caches to register an out-of-memory hook with the OS.</p>
<p>When the OS reaches a low on memory state where it&#8217;s starting to page, the applications are asked to free memory; &nbsp;the beauty of this design is that it doesn&#8217;t actually matter if no applications free up memory, as you just go into your paging routine, as you would have done without this API.</p>
<p>All this API ends up doing is notifying interested applications that there&#8217;s a global out-of-memory condition; applications with caches that are quicker to regenerate than replace (e.g. image data decompressed from a JPEG) can drop their caches, while garbage collected apps can trigger a GC run immediately, to help the OS cope.</p>
<p>Also, note that this does assume well-written applications. Badly written applications won&#8217;t register for the hook, while malicious applications will register and allocate memory whenever they&#8217;re hit.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597863">
				<div id="div-comment-597863" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Name required</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597863">
			February 4, 2008 at 9:31 am</a>		</div>

		<blockquote><p>
  Result: The numbers are too big!
</p></blockquote>
<p>So reduce the font size and set to &quot;Fixed&quot;, then.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597873">
				<div id="div-comment-597873" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Bryan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597873">
			February 4, 2008 at 9:48 am</a>		</div>

		<p>Ulric:</p>
<p>Your question is insanely vague. &nbsp;What about Vista is slower? &nbsp;If you&#8217;re using something designed to run on Windows 2000 or something that does all sorts of wonky stuff on startup that kills prefetch, it&#8217;s not suprising that it would be slower.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-597883">
				<div id="div-comment-597883" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">donutlord</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597883">
			February 4, 2008 at 10:26 am</a>		</div>

		<p>re: Dave &#8211; I did have coffee in my mouth.</p>
<p>This was funny. Thanks.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-597973">
				<div id="div-comment-597973" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Wil</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-597973">
			February 4, 2008 at 11:00 am</a>		</div>

		<p>I find it stupid that people complain about Vista not running well on systems with 512MB of ram (which is technically below minimum specs since these machines typically have shared memory with the video card).</p>
<p>If you buy a system that under speced in this day and age you are asking for trouble. Buy a system with yesterday&#8217;s specs run yesterday&#8217;s OS on it simple as that. If its not an option from your laptop provider, complain to them for releasing products that can&#8217;t run the software that comes with them.</p>
<p>A typical bottom of the range laptop or desktop that we give users at work has 2gig of ram as a minimum. And Vista runs perfectly on this setup.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-598243">
				<div id="div-comment-598243" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dave</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-598243">
			February 4, 2008 at 11:41 pm</a>		</div>

		<blockquote><p>
  What&#8217;s wrong with that? The duokilobyte is a perfectly reasonable unit of measurement!
</p></blockquote>
<p>I think you meant to say that it&#8217;s a perfectly cromulent unit of measurement.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-598293">
				<div id="div-comment-598293" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dr. Disaster</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-598293">
			February 5, 2008 at 4:18 am</a>		</div>

		<p>Maybe you can ask the programmer to squeeze in an extremely useful &quot;jump to file&quot; action in a process&#8217; context menu.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-598313">
				<div id="div-comment-598313" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Pavel Lebedinsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-598313">
			February 5, 2008 at 4:41 am</a>		</div>

		<blockquote><p>
  I know that it&#8217;s now using more memory to</p>
<p>  make better use of the system. &nbsp;I&#8217;ve read</p>
<p>  that a while back on Coding Horror and other</p>
<p>  places.
</p></blockquote>
<p>Do you mean this article?</p>
<p><a rel="nofollow" target="_new" href="http://www.codinghorror.com/blog/archives/000688.html" rel="nofollow">http://www.codinghorror.com/blog/archives/000688.html</a></p>
<p>It&#8217;s based on the false assumption that Free memory in Vista&#8217;s taskmgr is the same thing as Available memory in XP. In reality these are two completely different things &#8211; see the &quot;Memory Performance Information&quot; link I posted above. Vista with superfetch enabled is in fact more aggressive about prefetching things, but most of the observed difference is because the author is comparing apples and oranges, not because Vista has a &quot;radically different approach to memory management&quot;.</p>
<blockquote><p>
  Commit charge and the useful shutdown menus</p>
<p>  seem to have disappeared too with Vista.
</p></blockquote>
<p>Commit charge did not disappear. It was (unfortunately) renamed to &quot;page file&quot; usage.</p>
<blockquote><p>
  Some of what might get swapped out is the</p>
<p>  cache. If it&#8217;s faster to regenerate the</p>
<p>  cached data than it is to access the disk,</p>
<p>  then it would improve system performance if</p>
<p>  the cache was deleted instead
</p></blockquote>
<p>This is essentially what MEM_RESET does. It&#8217;s a bit complicated to use since you need to handle the possibility that the cached data you&#8217;re reading might asynchronously be replaced with zeros. So you need to VirtualLock it to prevent trimming while in use, or copy into a separate buffer and re-check the original, etc.</p>
<blockquote><p>
  provide mechanisms for applications with</p>
<p>  caches to register an out-of-memory hook</p>
<p>  with the OS
</p></blockquote>
<p>Windows provides CreateMemoryResourceNotification for this purpose.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-598923">
				<div id="div-comment-598923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">anonymous</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-598923">
			February 6, 2008 at 5:00 pm</a>		</div>

		<p>just get over it and install Ram Doubler.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-599343">
				<div id="div-comment-599343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Igor Levicki</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080201-00/?p=23613#comment-599343">
			February 7, 2008 at 7:30 pm</a>		</div>

		<p>Those who say Vista is faster either:</p>
<p>a) have 4GB of RAM</p>
<p>or:</p>
<p>b) are shameless liars</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

