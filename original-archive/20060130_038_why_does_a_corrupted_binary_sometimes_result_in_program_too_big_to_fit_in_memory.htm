<html>
<head>
<title>Why does a corrupted binary sometimes result in "Program too big to fit in memory"?</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>Why does a corrupted binary sometimes result in &quot;Program too big to fit in memory&quot;?</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>January 30, 2006 / year-entry #39</td></tr>
<tr><td><b>Tags:</b></td><td>history</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>44</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">If you take a program and corrupt the header, or just take a large-ish file that isn't a program at all and give it a ".exe" extension, then try to run it (Warning: Save your work first!), you will typically get the error "Program too big to fit in memory". Why such a confusing error...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>If you take a program and corrupt the header, or just take a large-ish file that isn't a program at all and give it a ".exe" extension, then try to run it (Warning: Save your work first!), you will typically get the error "Program too big to fit in memory". Why such a confusing error message? Why doesn't it say "Corrupted program"?</p>
<p> Because the program isn't actually corrupted. Sort of. </p>
<p> A Win32 executable file begins with a so-called "MZ" header, followed by a so-called "PE" header. If the "PE" header cannot be found, then the loader attempts to load the program as a Win16 executable file, which consists of an "MZ" header followed by an "NE" header. </p>
<p> If neither a "PE" nor an "NE" header can be found after the "MZ" header, then the loader attempts to load the program as an MS-DOS relocatable executable. If not even an "MZ" header can be found, then the loader attempt to load the program as an MS-DOS non-relocatable executable (aka "COM format" since this is the format of CP/M .COM files). </p>
<p> In pictures: </p>
<table border="1">
<tr>
<td rowspan="3">MZ</td>
<td>PE</td>
<td>Win32</td>
</tr>
<tr>
<td>NE</td>
<td>Win16</td>
</tr>
<tr>
<td>else</td>
<td>MS-DOS relocatable</td>
</tr>
<tr>
<td colspan="2">else</td>
<td>MS-DOS non-relocatable</td>
</tr>
</table>
<p> Observe that no matter what path you take through the chart, you will always end up at something. There is no exit path that says "Corrupted program". </p>
<p> But where does "Program too big to fit in memory" come from? </p>
<p> If the program header is corrupted, then various fields in the header such as those which specify the amount of memory required by the program will typically be nonsensical values. The loader sees an MS-DOS relocatable program that requires 800KB of conventional memory, and that's where "Out of memory" comes from. </p>
<p> An MS-DOS non-relocatable program contains no such information about memory requirements.  The rule for loading non-relocatable programs is simply to load the program into a single 64KB chunk of memory and set it on its way. Therefore, a program with no "MZ" header but which is larger than 64KB in size won't fit in the single 64KB chunk and consequently results in an "Out of memory" error. </p>
<p> And since people are certain to ask: </p>
<ul>
<li>"MZ" = the legendary Mark Zbikowski. </li>
<li>"NE" = "New Executable", back when Windows was "new". </li>
<li>"PE" = "Portable Executable", because one of Windows NT's     claims to fame was its portability to architectures     other than the x86. </li>
<li>"LE" = "Linear Executable", used by OS/2 and by Windows&nbsp;95     device drivers. </li>
</ul>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (44)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-341693">
				<div id="div-comment-341693" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Phylyp</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341693">
			January 30, 2006 at 11:49 am</a>		</div>

		<p>Will Vista or one of its successors have an RC honoring you?  :)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-341713">
				<div id="div-comment-341713" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nate</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341713">
			January 30, 2006 at 12:11 pm</a>		</div>

		<p>Well, shouldn&#8217;t the loader identify any such program that requires greater than 64K of memory as a corrupt program?  Unless I&#8217;m missing something, it isn&#8217;t like there isn&#8217;t a way to discover this situation before hand.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-341723">
				<div id="div-comment-341723" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mike Dunn</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341723">
			January 30, 2006 at 12:23 pm</a>		</div>

		<p>Trivia tidbit: &quot;ZM&quot; is also a valid header for the beginning of the file.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-341733">
				<div id="div-comment-341733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">8</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341733">
			January 30, 2006 at 12:51 pm</a>		</div>

		<p>How about only going that last route if the file ends with &#8216;.com&#8217;? Makes a lot of sense to me, whereas naming an old style 64k program anything other then *.com sounds silly. Who does that?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-341753">
				<div id="div-comment-341753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jeff Robertson</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341753">
			January 30, 2006 at 1:24 pm</a>		</div>

		<p>I assume the &quot;ZM&quot; has something to do with portability to systems with different endian-ness ?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-341763">
				<div id="div-comment-341763" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">8</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341763">
			January 30, 2006 at 1:38 pm</a>		</div>

		<p>Yeah, for people running dniWswod or something :D</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-341773">
				<div id="div-comment-341773" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">DavidE</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341773">
			January 30, 2006 at 1:42 pm</a>		</div>

		<p>Nate and 8, does this really need a solution? I mean, this seems to be a case where the user has to do something really dumb on purpose to make it happen, or it&#8217;s an indication that the user&#8217;s system is beginning to destroy itself.</p>
<p>Sadly, people still have a hard time learning the lesson of putting headers in file formats. How many of us have had to deal with the lack of version information in the first version of a file format?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-341783">
				<div id="div-comment-341783" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James MAstros</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341783">
			January 30, 2006 at 1:47 pm</a>		</div>

		<p>Is there a back-compat reason for allowing executables named .exe to load as DOS non-relocatables, or allowing .com files, .pif files, etc, to load PE executables?</p>
<p>This has, in the past, been a factor in the spread of email worms &#8212; people (and sometimes antivirus writers) don&#8217;t recognize all the combinations of extensions and executable code.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-341793">
				<div id="div-comment-341793" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://orcmid.com/blog/' rel='external nofollow' class='url'>orcmid</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341793">
			January 30, 2006 at 2:15 pm</a>		</div>

		<p>Raymond, your RSS feed is on fire, and this is the only way I have to contact you.</p>
<p>With your postings this morning, your feed is now downloading as a refresh of all posts back to &quot;From Doom to Gloom: &#8230; .&quot;  They all show the same timestamp in NewsGator Outlook 2.5 and they all have the same content: the URL of the top of the blog with no content whatsoever.</p>
<p>Fortunately I caught it before allowing these to replace the full-content ones I&#8217;ve filed for any of those.</p>
<p>Larry Osterman and Michael Kaplan&#8217;s blogs and a couple of other blogs.msdn.com blogs display the same phenomenon.  It only happens if there have been new posts today.  Michael says he&#8217;s reporting the problem.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-341803">
				<div id="div-comment-341803" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://baljemmett.livejournal.com/' rel='external nofollow' class='url'>Ben A L Jemmett</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341803">
			January 30, 2006 at 2:36 pm</a>		</div>

		<p>Jeff: as I recall, the &quot;ZM&quot; is used when the are multiple sections in the file.  I can&#8217;t remember if such a file consists of multiple-&quot;ZM&quot; sections followed by a final &quot;MZ&quot; section or vice-versa; I&#8217;d have to see if I still have my old reference books in the attic&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-oldnewthing bypostauthor even thread-even depth-1" id="comment-341813">
				<div id="div-comment-341813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341813">
			January 30, 2006 at 2:48 pm</a>		</div>

		<p>orcmid: The blog server administrators installed a new version of the server software. It reset a lot of stuff.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-341823">
				<div id="div-comment-341823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nate</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341823">
			January 30, 2006 at 3:03 pm</a>		</div>

		<p>DavidE: While this situation is hardly a pressing flaw in Windows, it is something that I have seen happen on occasion, in my case some (weird) malware.  It just seems so trivial to do very basic sanity checking to me.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-kjkhyperion even thread-even depth-1" id="comment-341833">
				<div id="div-comment-341833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">KJK::Hyperion</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341833">
			January 30, 2006 at 4:12 pm</a>		</div>

		<p>Hey, wonderful, the new version of the blog software is broken. I get the wrong sender and no link to the full article</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-341843">
				<div id="div-comment-341843" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Maks Verver</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341843">
			January 30, 2006 at 4:20 pm</a>		</div>

		<p>I would say that one of the characteristics of a &#8216;.COM file&#8217; is that it fits in a 64KB segment. If the binary is larger than that, it cannot possibly be a valid file of this type. Compare this with the relocatable binary: it has the constraint that it must start with an MZ header, otherwise it&#8217;s not a valid file. Why can non-relocatable binaries not have a similar constraint on file size?</p>
<p>The error message suggests there exist systems (presumably with more free memory) that can load the binary in question, while as a matter of fact it cannot, because the file will never fit in a 8086 64KB segment.</p>
<p>The diagram should probably have been:<br />
<br />MZ present: &#8230;<br />
<br />MZ absent:<br />
<br />    Filesize &lt;= 64KB: assume MS-DOS non-relocatable<br />
<br />    Otherwise:        Invalid file!<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-341853">
				<div id="div-comment-341853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341853">
			January 30, 2006 at 4:46 pm</a>		</div>

		<p>Isn&#8217;t this begging the question? &quot;Why can&#8217;t Windows tell me that the program is corrupted?&quot; &quot;Because Windows dorsn&#8217;t have code to do that.&quot; It doesn&#8217;t explain why it&#8217;s technically infeasible to add that exit path. (Not that I&#8217;m saying it isn&#8217;t technically infeasible&#8211;I don&#8217;t know anything about the structure (or possibly lack thereof) of COM executables&#8211;but this article doesn&#8217;t really explain.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-341863">
				<div id="div-comment-341863" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Stu</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341863">
			January 30, 2006 at 5:09 pm</a>		</div>

		<p>So what happens on Win64, where the old .com format isn&#8217;t supported?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-341873">
				<div id="div-comment-341873" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">CN</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341873">
			January 30, 2006 at 5:28 pm</a>		</div>

		<p>James: A COM file has no structure. None at all. The only way to tell that something is wrong is if it&#8217;s larger than 64 k.</p>
<p>BTW, for those who know, is it really 65536 bytes? Isn&#8217;t it more like 655280 or something? I have some vague memory of the COM file actually starting at CS:0100, with some kind of process control block (command line/DOS housekeeping/whatever) at CS:0000. That would also be why debug loads any file at 0100, unless it&#8217;s a recognizable EXE. What good is a debugger if it doesn&#8217;t give you the correct offsets? :-)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-341883">
				<div id="div-comment-341883" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">CN</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341883">
			January 30, 2006 at 5:29 pm</a>		</div>

		<p>Ooops, that should of course be 65 280, not 655 280. (0xFEFF)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-341913">
				<div id="div-comment-341913" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://baljemmett.livejournal.com/' rel='external nofollow' class='url'>Ben A L Jemmett</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341913">
			January 30, 2006 at 6:23 pm</a>		</div>

		<p>CN: you&#8217;re right, a COM file is indeed loaded starting as CS:0100 &#8212; the first 256 bytes are the Program Segment Prefix (PSP).  I guess that puts an upper limit on size at 63.75KB.</p>
<p>The PSP contains, amongst other things, bits and pieces for CP/M compatibility (at CS:0000 you&#8217;ll find CD 20 == INT 20h, which is the old &quot;terminate program&quot; call and was superseded by INT21h function 4Ch, with your errorlevel in AL; at CS:0005 is a JMP to the INT 21h handler (?) since CP/M programs used CALL 5 to access the OS).  There should be the skeletons of two FCBs in there as well (overlapped; if you only wanted to use one you didn&#8217;t need to copy the second one out of the way), plus the complete command line&#8230;  Been a long time since I needed to think about any of this, though!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-341923">
				<div id="div-comment-341923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Unrequired Name</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341923">
			January 30, 2006 at 7:41 pm</a>		</div>

		<p>Well why doesnt Window require a digital signature on the file to verify if it valid or not. Stupid Microsoft. Then you could have forced your DRM on us too.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-341933">
				<div id="div-comment-341933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Doug</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341933">
			January 30, 2006 at 8:37 pm</a>		</div>

		<p>James MAstros:<br />
<br />&quot;Is there a back-compat reason for allowing executables named .exe to load as DOS non-relocatables, or allowing .com files, .pif files, etc, to load PE executables?&quot;</p>
<p>I believe that the Windows 98 COMMAND.COM is actually an &quot;MS-DOS relocatable&quot; (i.e. DOS &quot;exe&quot;). I could be wrong, though&#8230; I don&#8217;t have a Win98 computer at the moment to check this.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-341943">
				<div id="div-comment-341943" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Stu</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341943">
			January 30, 2006 at 8:53 pm</a>		</div>

		<p>Doug: Just confirmed, in Windows 95 no less, that COMMAND.COM is an MZ executable. </p>
<p>However, there still doesn&#8217;t appear to be a reason that Windows doesn&#8217;t check the file size before assuming that it is a .com type executable.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-aadsso-1live-com000300008195987d even thread-even depth-1" id="comment-341953">
				<div id="div-comment-341953" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Spire' rel='external nofollow' class='url'>Spire</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341953">
			January 30, 2006 at 8:55 pm</a>		</div>

		<p>Doug: Yes, Windows 98&#8217;s COMMAND.COM is actually a MS-DOS relocatable (&quot;EXE&quot;) file.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-341983">
				<div id="div-comment-341983" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">8</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-341983">
			January 31, 2006 at 3:16 am</a>		</div>

		<p>Aha, so the BC is with old programs assuming it&#8217;s command.COM not command.EXE. That explains the com filesize &gt; 64kB feature, but not the exe-file-without-mz-or-zm-header-loaded-as-com one. What&#8217;s the point in that? Are there old programs who do that?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-342003">
				<div id="div-comment-342003" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John Elliott</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-342003">
			January 31, 2006 at 4:21 am</a>		</div>

		<p>I suppose the MZ header (and 8086 stub) are still present even in versions of Windows for other CPU architectures.<br />
<br />CN: &quot;What good is a debugger if it doesn&#8217;t give you the correct offsets?&quot; Well, according to the Interrupt List, MS-DOS DEBUG sets up the CALL 5 entry point incorrectly, so any DOS program that uses CALL 5 won&#8217;t run under DEBUG.<br />
<br />One other point: If a program starts MZ but is too short to have an EXE header, it&#8217;s treated as a COM file (at least by XP). Thus: 4D 5A B2 43 B4 02 CD 21 CD 20</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-342013">
				<div id="div-comment-342013" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">jtas</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-342013">
			January 31, 2006 at 5:24 am</a>		</div>

		<p>Just FYI. If you you rename a Win32 EXE program to .COM it still runs just fine.</p>
<p>I&#8217;ve seen programs that do this (devenv.com and devenv.exe) so that the .COM file is just a Console Win32 program that if it parses any non-command line parameters, runs the EXE, a GUI Win32 applcation. If there are both an ABC.COM and an ABC.EXE in the same directory, the command prompt will execute the .COM, I believe, for compatibility reasons. But, it may also have something to do with the PATHEXT environment variable.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-342023">
				<div id="div-comment-342023" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Martin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-342023">
			January 31, 2006 at 7:09 am</a>		</div>

		<p>Couldn&#8217;t the error message read &quot;Program too big to fit in memory or corrupt&quot;?</p>
<p>That would then prompt us to check both options instead of scratching our heads.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-342033">
				<div id="div-comment-342033" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">emmenjay</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-342033">
			January 31, 2006 at 7:32 am</a>		</div>

		<p>I have memories of Mr Z.  Back in the dark ages I worked on a program that walked the MSDOS heap.  From memory (pun not intended) each memory block header began with an &quot;M&quot; except the last block which began with a &quot;Z&quot;.  He was obviously a busy gentleman.  :-)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-342043">
				<div id="div-comment-342043" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blergh.wordpress.com/2006/01/31/dot-com/' rel='external nofollow' class='url'>Blergh &raquo; Dot Com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-342043">
			January 31, 2006 at 8:25 am</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://blergh.wordpress.com/2006/01/31/dot-com/" rel="nofollow">http://blergh.wordpress.com/2006/01/31/dot-com/</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-342053">
				<div id="div-comment-342053" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">vince</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-342053">
			January 31, 2006 at 9:56 am</a>		</div>

		<blockquote><p>
  (Warning: Save your work first!)</p>
<p>So it&#8217;s possible to crash Windows by just renaming a data file and executing it?
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-342063">
				<div id="div-comment-342063" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.cataraxia.com/' rel='external nofollow' class='url'>Kristoffer Henriksson</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-342063">
			January 31, 2006 at 10:12 am</a>		</div>

		<blockquote><p>
  So it&#8217;s possible to crash Windows by just renaming a data file and executing it?</p>
<p>Entirely possible depending on what user you are logged in as. Just as a thousand monkeys with typewriters and infinite time will eventually produce the complete works of shakespeare what is in the random file may be instructions to overwrite crucial files, terminate programs etc.
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-342133">
				<div id="div-comment-342133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">vince</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-342133">
			January 31, 2006 at 11:36 am</a>		</div>

		<blockquote><p>
  &gt; So it&#8217;s possible to crash Windows<br />
  <br />&gt; &gt;by just renaming a data file and<br />
  <br />&gt; &gt; executing it?</p>
<p>&gt; Entirely possible depending on what<br />
  <br />&gt; user you are logged in as. Just as a<br />
  <br />&gt; thousand monkeys with typewriters<br />
  <br />&gt; and infinite time will eventually<br />
  <br />&gt; produce the complete works of<br />
  <br />&gt; shakespeare what is in the random<br />
  <br />&gt; file may be instructions to<br />
  <br />&gt; overwrite crucial files, terminate<br />
  <br />&gt; programs etc.</p>
<p>Well yes, if the data file magically somehow calls a command that erases all your files, that would be bad.  But in that case &quot;Saving all your files first&quot; won&#8217;t help.</p>
<p>As you said, a better suggestion would be to run it as a temporary user, and still that shouldn&#8217;t crash the OS or harm anything<br />
  
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-342163">
				<div id="div-comment-342163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.electricminds.org' rel='external nofollow' class='url'>Erbo</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-342163">
			January 31, 2006 at 12:01 pm</a>		</div>

		<p>OS/2 2.0+ (after the MS-IBM split) used an .EXE file format similar to the &quot;LE&quot; format but not identical; it used the signature &quot;LX&quot; for its headers.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-342313">
				<div id="div-comment-342313" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Michiel</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-342313">
			February 1, 2006 at 7:56 am</a>		</div>

		<p>If you wondered why a .COM file bigger than 64K is still loaded: It&#8217;s because the extra bits (that aren&#8217;t loaded by the OS) can be loaded on-demand by the program itself. Simply open argv[0], seek to 64Kb and read from there. </p>
<p>The advantage is that an application could fit in a single file. Install=copy 1 file. Unistall=delete 1 file.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-342563">
				<div id="div-comment-342563" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://jasonhaley.com/blog/archive/2006/02/01/136175.aspx' rel='external nofollow' class='url'>Jason Haley</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-342563">
			February 1, 2006 at 7:33 pm</a>		</div>

		
		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-342953">
				<div id="div-comment-342953" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dmitri Chatokhine</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-342953">
			February 3, 2006 at 2:44 pm</a>		</div>

		<p>So the same mistake was made at least twice: calling Windows &quot;NT&quot; for &quot;New Technology&quot;, and also this &quot;New Executable&quot;. The Old New Thing indeed.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-343043">
				<div id="div-comment-343043" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Cheong</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-343043">
			February 3, 2006 at 11:25 pm</a>		</div>

		<p>[quote]<br />
<br />How about only going that last route if the file ends with &#8216;.com&#8217;? Makes a lot of sense to me, whereas naming an old style 64k program anything other then *.com sounds silly. Who does that?<br />
<br />[/quote]<br />
<br />&quot;.COM&quot; file extension means nothing to the loader. You can rename &quot;regedit.exe&quot; to &quot;regedit.com&quot; and see it&#8217;ll run. This is sometime useful to fool virus that&#8217;ll run each time you run an &quot;.EXE&quot; file.</p>
<p>btw, have anyone seen virus that name itself as thing such as &quot;www.microsoft.com&quot; in System32 directory to fool people that are lazy enough to just type the domain name without prefixing &quot;<a href="http://&#038;quot" rel="nofollow">http://&#038;quot</a>; to run it from the &quot;Run&#8230;&quot; menu?<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-343203">
				<div id="div-comment-343203" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Neil</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-343203">
			February 5, 2006 at 11:47 am</a>		</div>

		<p>I was always under the impression that a position independent executable (i.e. &quot;nonrelocatable&quot;) could be &gt; 64K but then it would have to do fancy segment arithmetic to access the rest of memory (it would load into a single memory block consuming available conventional memory, whereas a relocatable EXE only loads into necessary memory). I don&#8217;t have a suitable executable handy but I can persuade DEBUG to load a file of over 64K to result in the same memory &quot;layout&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-344243">
				<div id="div-comment-344243" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Hiei</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-344243">
			February 8, 2006 at 1:43 pm</a>		</div>

		<p>aha<br />
<br />I cannot understand what you said,<br />
<br />but I really want to leave a message on your blog.<br />
<br />heihei~</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-562493">
				<div id="div-comment-562493" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.kavinda.net/2007/10/24/ProgramTooBigToFitInMemory.aspx' rel='external nofollow' class='url'>Kavinda Munasinghe's Blog</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-562493">
			October 24, 2007 at 1:33 pm</a>		</div>

		
		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-562503">
				<div id="div-comment-562503" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.kavinda.net/2007/10/24/ProgramTooBigToFitInMemory.aspx' rel='external nofollow' class='url'>Kavinda Munasinghe's Blog - Program too big to fit in memory</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-562503">
			October 24, 2007 at 1:33 pm</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://www.kavinda.net/2007/10/24/ProgramTooBigToFitInMemory.aspx" rel="nofollow">http://www.kavinda.net/2007/10/24/ProgramTooBigToFitInMemory.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-595133">
				<div id="div-comment-595133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/oldnewthing/archive/2008/01/30/7315957.aspx' rel='external nofollow' class='url'>The Old New Thing : Even without a nitpicker's corner, I have to worry about nitpickers</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-595133">
			January 30, 2008 at 12:49 pm</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://blogs.msdn.com/oldnewthing/archive/2008/01/30/7315957.aspx" rel="nofollow">http://blogs.msdn.com/oldnewthing/archive/2008/01/30/7315957.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-673793">
				<div id="div-comment-673793" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.kavinda.net/2007/10/24/AllAboutTheProgramTooBigToFitInMemoryErrorAndHowToFixIt.aspx' rel='external nofollow' class='url'>All about the &quot;Program too big to fit in memory&quot; error and how to fix it.</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-673793">
			October 8, 2008 at 1:06 am</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://www.kavinda.net/2007/10/24/AllAboutTheProgramTooBigToFitInMemoryErrorAndHowToFixIt.aspx" rel="nofollow">http://www.kavinda.net/2007/10/24/AllAboutTheProgramTooBigToFitInMemoryErrorAndHowToFixIt.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-706353">
				<div id="div-comment-706353" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://wampir.mroczna-zaloga.org/archives/499-.exe-to-tylko-konwencja.html' rel='external nofollow' class='url'>Wampiryczny blog</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060130-00/?p=32483#comment-706353">
			February 5, 2009 at 3:29 am</a>		</div>

		<p>Dawno, dawno temu, jeszcze w czasach, gdy dominującym systemem był Windows 2000, prowadziłem szkolenie Hardening Windows 2000. W jego ramach pokazywałem kilka &quot;sztuczek&quot;, między innymi wykorzystanie Alternate Data Streams w NTFS.Jedną ze &quot;sztuczek&quot;,</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

