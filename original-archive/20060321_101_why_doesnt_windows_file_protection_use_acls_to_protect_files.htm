<html>
<head>
<title>Why doesn't Windows File Protection use ACLs to protect files?</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>Why doesn&#8217;t Windows File Protection use ACLs to protect files?</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>March 21, 2006 / year-entry #102</td></tr>
<tr><td><b>Tags:</b></td><td>other</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>57</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">Windows File Protection works by replacing files after they have been overwritten. Why didn't Windows just apply ACLs to deny write permission to the files? We tried that. It didn't work. Programs expect to be able to overwrite the files. A program's setup would run and it decided that it needed to "update" some system...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>Windows File Protection works by replacing files after they have been overwritten. Why didn't Windows just apply ACLs to deny write permission to the files?</p>
<p> We tried that. It didn't work. </p>
<p> Programs expect to be able to overwrite the files. A program's setup would run and it decided that it needed to "update" some system file and attempt to overwrite it. If the system tried to stop the file from being overwritten, the setup program would halt and report that it was unable to install the file. Even if the operating system detected that somebody was trying to overwrite a system file and instead gave them a handle to <code>NUL</code>, those programs would nevertheless notice that they had been hoodwinked because as a "verification" step, they would open the file they had just copied and compare it against the "master copy" on the installation CD. </p>
<p> The solution was to let the program think it had won, and then, when it wasn't looking, put the original back. </p>
<p> Now that Windows File Protection has been around for a few years, software installers have learned that it's not okay to overwrite system files (and trying to do it won't work anyway), so starting in Windows&nbsp;Vista, the Windows File Protection folks have started taking stronger steps to protect system files, and this includes using ACLs to make the files harder to replace. Presumably, they will have compatibility plans in place to accomodate programs whose setup really wants to overwrite a file. </p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (57)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-356843">
				<div id="div-comment-356843" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Valdas</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-356843">
			March 21, 2006 at 10:33 am</a>		</div>

		<p>So with Windows File Protection user is allowed to believe that the application will function OK (since it installed just fine), but then WFP will replace the file(s) back, thus potentially breaking it? How is this better than just disallowing to install the app in the first place?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-356853">
				<div id="div-comment-356853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Kristoffer</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-356853">
			March 21, 2006 at 10:41 am</a>		</div>

		<p>If the choice is between windows operating and an individual application operating the choice is clear.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-crathjen even thread-even depth-1" id="comment-356883">
				<div id="div-comment-356883" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">CRathjen</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-356883">
			March 21, 2006 at 10:50 am</a>		</div>

		<p>I&#8217;m guessing Valdas&#8217; point is that he&#8217;d rather have a 3rd option &#8211; block the App install. I don&#8217;t think that&#8217;s any better &#8211; instead of the app being potentially unstable (and Windows getting blamed), the app will simply fail to install in the first place (and Windows gets blamed).</p>
<p>There&#8217;s no &quot;right&quot; way to deal with such apps &#8211; the providers need to fix their installers so they don&#8217;t need to replace/modify/expect a certain version of system files (if such a need is even accurate in the first place, which I think Raymond is hinting is often not the case).</p>
<p>I think Valdas does have one point in his favor &#8211; if the app INSTALL breaks, at least you know exactly which app is attempting to mess things up for everyone else (And, with a little web search, why). With WFP, it may not be obvious which of multiple recently-installed apps was the culprit (since, with XP at least, I can do an awful lot of installs without having to reboot, which seems to be when I usually got WFP messages in the past).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-356893">
				<div id="div-comment-356893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">AC</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-356893">
			March 21, 2006 at 10:53 am</a>		</div>

		<p>Well the whole mess is really 100% MSFT&#8217;s own fault. For a long time, MSFT motivated the developers to do OS&#8217;s dirty work &#8212; &quot;if your program uses another version of coolDlg.DLL and not the one delivered with OS, no problem-o, go on and copy the newer one to System or System32 with your installation program&quot;. </p>
<p>Instead, the OS should have had an API call which would be the only way to modify the files in System32, and which would clearly declare that it can but it doesn&#8217;t have to really change something there.<br />
<br />One version of the installer that I deeply hate (the InstallShield monstrosity) even managed to overwrite some NT DLL with a 9x one completely lobotomizing NT.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-356903">
				<div id="div-comment-356903" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Kristoffer</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-356903">
			March 21, 2006 at 10:56 am</a>		</div>

		<p>Blocking an install is easier said than done.</p>
<p>Your two options are<br />
<br />1. Block it before it can run. This involves a great number of difficulties as the install may be a custom created install not relying on MSI and thus can&#8217;t be scanned in advance to determine whether the program about to be executed is both a setup program and wants to update a protected file.</p>
<p>2. Block it as it is running. This one is equally infeasible as it would imply that Windows be able to track Undo information for every program on the off chance that the program running is trying to install something and later on during the install process tries to install over a protected file.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-356913">
				<div id="div-comment-356913" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Tom Bowen</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-356913">
			March 21, 2006 at 11:04 am</a>		</div>

		<blockquote><p>
  I think Valdas does have one point in his favor &#8211; if the<br />
  <br />&gt; app INSTALL breaks, at least you know exactly which<br />
  <br />&gt; app is attempting to mess things up for everyone else<br />
  <br />&gt;(And, with a little web search, why). </p>
<p>The issues Raymond is talking about had to be decided long before there was anything like the web, much less a web search.
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-356933">
				<div id="div-comment-356933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://journal.pdsys.org/' rel='external nofollow' class='url'>Nicholas</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-356933">
			March 21, 2006 at 11:16 am</a>		</div>

		<p>&quot;Well the whole mess is really 100% MSFT&#8217;s own fault. For a long time, MSFT motivated the developers to do OS&#8217;s dirty work &#8212; &quot;if your program uses another version of coolDlg.DLL and not the one delivered with OS, no problem-o, go on and copy the newer one to System or System32 with your installation program&quot;.&quot;</p>
<p>Huh? The well-known way of pulling this off is to put &quot;your version&quot; of the DLL/whatever in the same directory as your application. That&#8217;s what most applications still do today. If your installer is copying a &quot;common&quot; or &quot;system&quot; file to the operating system&#8217;s directory, it better be darn careful about it. Why oh why don&#8217;t installers check their versions before copying? I don&#8217;t know how many times I&#8217;ll go to install drivers for something and get a &quot;the file you are attempting to override is newer than the one you are copying&quot; dialog&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-356943">
				<div id="div-comment-356943" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Moi</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-356943">
			March 21, 2006 at 11:21 am</a>		</div>

		<p>&quot;the providers need to fix their installers so they don&#8217;t need to replace/modify/expect a certain version of system files&quot;</p>
<p>If one could trust that some behaviour your software relied on by part X of the OS would not change, and that isn&#8217;t so. If you were involved in writing installer software for example you might find that your attempts to replace a file were no longer successful&#8230;</p>
<p>The idea that one can run old apps on newer operating systems is silly, IMO.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-356953">
				<div id="div-comment-356953" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Tim Smith</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-356953">
			March 21, 2006 at 11:27 am</a>		</div>

		<p>Moi:<br />
<br />&quot;The idea that one can run old apps on newer operating systems is silly, IMO.&quot;</p>
<p>So everytime you upgrade your OS, you will need to buy all new software and games? &nbsp;</p>
<p>That is even more silly.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-356973">
				<div id="div-comment-356973" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Lionell Griffith</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-356973">
			March 21, 2006 at 11:33 am</a>		</div>

		<p>In other words, if you have a festering wound covered with a dirty tattered bandage, you wouldn&#8217;t take it off, clean and disinfect the wound, and then put a clean bandaged on it. &nbsp;You would put still another bandage on top to hide the pus and blood that&#8217;s draining out. &nbsp;Then when the infected leg falls off, you would offer a service pack to fix it or, better, sell an upgrade.</p>
<p>The real fix is for ALL third parties to not install files in the system area. All drivers, dll&#8217;s, and configuration files should be installed in the applicationâ€™s directory. &nbsp;While this is quite possible and rather easy to do, the documentation provided by Microsoft suggests you do otherwise.</p>
<p>Is it any wonder that Windows takes a hit when problems crop up? &nbsp;Microsoft has invited the stupidities from the get go. &nbsp;It deserves any hit it gets from the problems they cause.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-356993">
				<div id="div-comment-356993" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John Elliott</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-356993">
			March 21, 2006 at 11:43 am</a>		</div>

		<p>How times change.</p>
<p>&quot;Important</p>
<p>An application&#8217;s installation program must install CTL3D.DLL in the Windows SYSTEM directory or, if running on a networked Windows installation, the Windows directory. CTL3D.DLL must not be installed in the application&#8217;s own directory or any other directory [&#8230;] CTL3DV2.DLL will not produce 3-D effects unless it is running from either windowssystem or the Windows directory. It is hoped this will encourage developers to correctly install CTL3DV2.DLL with their applications.&quot; &#8212; CTL3D documentation, by Wes Cherry and Kyle Marsh, August 1993.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-357023">
				<div id="div-comment-357023" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://silverstr.ufies.org/blog/archives/000932.html' rel='external nofollow' class='url'>Dana Epp's ramblings at the Sanctuary</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357023">
			March 21, 2006 at 11:57 am</a>		</div>

		<p>Over the years I have cringed at the thought that rogue elements could overwrite system binaries, bypassing Windows File Protection with use of tools like SysInternal&#8217;s handle.exe. I always wondered WHY they didn&#8217;t have tighter ACLs on the files, and</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-357033">
				<div id="div-comment-357033" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Phylyp</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357033">
			March 21, 2006 at 11:59 am</a>		</div>

		<p>I like the way WFP is implemented, with a &quot;true&quot; copy in the system32dllcache folder. </p>
<p>There have been times when I really wanted to make a replacement (usually putting XP&#8217;s notepad in Win 2000), where I&#8217;ve been able to circumvent WFP by putting the new notepad in the dllcache first, and then elsewhere. </p>
<p>The neat thing here is, this way, it protects my PC from rogue installers, yet allows me to mess with my PC when I want to.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-357083">
				<div id="div-comment-357083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Michael J.</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357083">
			March 21, 2006 at 12:12 pm</a>		</div>

		<p>If Windows had built-in installer right from the start&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-patriotb even thread-even depth-1" id="comment-357093">
				<div id="div-comment-357093" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">PatriotB</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357093">
			March 21, 2006 at 12:16 pm</a>		</div>

		<p>&quot;The real fix is for ALL third parties to not install files in the system area.&quot;</p>
<p>Anyone know why in the heck Flash gets installed in a &quot;macromed&quot; folder inside system32? &nbsp;What is wrong with Program Files?!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-357103">
				<div id="div-comment-357103" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Coderjoe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357103">
			March 21, 2006 at 12:18 pm</a>		</div>

		<p>Tom Bowen:</p>
<p>&gt; The issues Raymond is talking about had to be<br />
<br />&gt; decided long before there was anything like the<br />
<br />&gt; web, much less a web search.</p>
<p>The issue he is talking about is Windows File Protection, which didn&#8217;t exist until Windows XP. &quot;The Web&quot; was already going strong by this point.</p>
<p>&#8212;</p>
<p>Back in the 3.1 days (and possibly the 9x days), if you <em>tried</em> to keep your new version in your own directory, and the DLL was something that other programs running on the system were already using, you would not be able to load your new version, no matter how hard you tried. The system would only load a DLL once, and then share that instance of the DLL with any other programs that tried loading it later on. This is the whole reason programs were encouraged to write new system file versions into the system directories in the first place.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-357123">
				<div id="div-comment-357123" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.fleeb.com' rel='external nofollow' class='url'>Trey Van Riper</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357123">
			March 21, 2006 at 12:42 pm</a>		</div>

		<p>I do not quite see how Microsoft can be blamed for this issue, given the history behind it.</p>
<p>Basically, Microsoft has a difficult problem to, if not resolve, at least minimize. &nbsp;A very large number of software developers distribute things like msvcrt.dll (the C runtime DLL provided by Microsoft&#8217;s older compilers) with a version they know works for their system. &nbsp;They fail to examine the version of the old &amp; new DLL to ensure they aren&#8217;t downgrading the file (usually out of a combination of slothful setup practices, or ignorance of the problem). &nbsp;Microsoft winds up looking bad when some other program fails to run because the supporting DLL no longer provides the function required by a previously installed application.</p>
<p>What does one do?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-357133">
				<div id="div-comment-357133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Adam</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357133">
			March 21, 2006 at 12:42 pm</a>		</div>

		<p>AC: There were a number of times I wish MS had added an InstallSystemDll() call that took the path to a DLL and checked if it already existed.</p>
<p>If the dll did not already exist, copy it in place and set the share count to 1.</p>
<p>If it did exist, and a version check (using the version info inside the dll) shows the requested version is newer than the existing one, then overwrite the old one (including whatever magic is necessary to overwrite on reboot if the old one is in use) and increment the share count.</p>
<p>Finally, if it did exist, but the new version was older, just increment the share count on the existing dll <em>and return a success code</em>.</p>
<p>That would have alleviated so much of the dll hell associated with system dlls, we might not be in this mess now. (Applications would still install a private version to their application directory if they really did need a <em>specific</em> version, or if the lib authors were not competent enough to maintain ABI backwards-compatibility between minor/patch releases)<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-357143">
				<div id="div-comment-357143" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James Risto</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357143">
			March 21, 2006 at 12:42 pm</a>		</div>

		<p>For all the bad press WFP takes, I believe it to be a major step for system stability. I worry a lot less about crap installs on servers than I used to. Better than alternatives.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-357153">
				<div id="div-comment-357153" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Foo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357153">
			March 21, 2006 at 12:51 pm</a>		</div>

		<blockquote><p>
  Well the whole mess is really 100% MSFT&#8217;s own<br />
  <br />&gt;fault. For a long time, MSFT motivated the<br />
  <br />&gt;developers to do OS&#8217;s dirty work &#8212; &quot;if your<br />
  <br />&gt;program uses another version of coolDlg.DLL and<br />
  <br />&gt;not the one delivered with OS, no problem-o, go<br />
  <br />&gt;on and copy the newer one to System or<br />
  <br />&gt;System32 with your installation program&quot;.</p>
<p>You&#8217;d get the same thing on Unix if you had dumb installer and an app that uses shared libraries. In fact I&#8217;ve personally killed a Solaris system writing the wrong libcrt, for some (cr)application which needed a different version from the system default. </p>
<p>In fact on Windows there was a never a reason to even try this &#8211; the loader always checks the directory the exe file is in for DLL&#8217;s. If you really can&#8217;t write code to take advantage of the excellent forward &amp; backward binary compatibility that you get in Windows, you can always copy the versions of the libs you need to the same dir as the application. </p>
<p>On Linux you have pretty much no binary compatibility even between different versions of the same os and a zillion different variants of libs, so you end up distributing source code with no support, which is the preferred way, or statically linked binaries, which will lead to a load of flames from the zealots.<br />
  
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-oldnewthing bypostauthor even thread-even depth-1" id="comment-357163">
				<div id="div-comment-357163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357163">
			March 21, 2006 at 12:51 pm</a>		</div>

		<p>&quot;Windows File Protection, which didn&#8217;t exist until Windows XP.&quot; Windows File Protection first arrived in Windows 95. In 1995, the web was only just getting off the ground.</p>
<p>&quot;Instead, the OS should have had an API call&#8230;&quot; Oh you mean VerInstallFile?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-357223">
				<div id="div-comment-357223" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Adam</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357223">
			March 21, 2006 at 2:18 pm</a>		</div>

		<p>Except (AFAICT) VerInstallFile() doesn&#8217;t do the &quot;replace on reboot if destination file is in use&quot; magic, doesn&#8217;t increment the share count, and doesn&#8217;t return success if a newer file already exists.</p>
<p>If a dev can&#8217;t use this to replace dlls that are in use, and they need to roll that bit themselves, they can easily end up using the replace on reboot to overwrite newer versions. Oops.</p>
<p>If the function doesn&#8217;t return success on a newer file existing, and the caller doesn&#8217;t realise that one of the error codes is actually a success(!), what is the caller likely to do on error? Oh yeah, set up a replace on reboot, overwriting the newer version again. Oops.</p>
<p>(Why would anyone ever want to call VerInstallFile() with VIFF_FORCEINSTALL set to override the versioning of VerInstallFile()? Surely they&#8217;d just copy the file. I suppose part of the problem there is that VIFF_FORCEINSTALL isn&#8217;t granular enough and overrides too many things. I want to not care about different code pages as I&#8217;m installing an &quot;en-GB&quot; over an &quot;en-US&quot; file? Oops &#8211; just overwrote a newer version as well. Doh!)<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-357233">
				<div id="div-comment-357233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mike Swaim</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357233">
			March 21, 2006 at 2:19 pm</a>		</div>

		<p>&nbsp;IIRC versions of office around 1995 wrote more stuff in the Windows and System directories than in their program directories. Never did find out why.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-357263">
				<div id="div-comment-357263" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/mgrier' rel='external nofollow' class='url'>Michael Grier</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357263">
			March 21, 2006 at 2:38 pm</a>		</div>

		<p>The missing piece here is shared components. &nbsp;It&#8217;s always been a little &#8230; confusing &#8230; about the rules around redistributing components which ship with the operating system.</p>
<p>One of the keys of Windows&#8217; success was to provide ways for other people to make money. &nbsp;ISVs of the metaphorical/mythical shrink-wrap software are one set of people but also having a rich environment for ISVs to provide shared components is similarly important.</p>
<p>Sheridan used to provide a grid control when I first started working at MSFT so I use it as my canonical example.</p>
<p>COM registration (until XP with application and component manifests) is system-wide so you couldn&#8217;t really carry a COM component private to an application. &nbsp;So you have to put it somewhere and you need to establish protocol about how it gets updated.</p>
<p>This is a good example of a component which could be privatized to the application but who owns servicing the binary? &nbsp;The application? &nbsp;The component provider?</p>
<p>These are difficult questions. &nbsp;The pendulum was towards &quot;sharing is great! &nbsp;save memory!&quot;. &nbsp;Now, for applications, the pendulum is swinging the other way (privatization of everything) but imagine the Macromedia was privatized to each web site that used it. &nbsp;How could Macromedia ever produce a security patch for its engine &#8211; instead your system would be vulnerable to every privatized copy of the library.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-357293">
				<div id="div-comment-357293" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Cooney</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357293">
			March 21, 2006 at 3:04 pm</a>		</div>

		<p>Foo:<br />
<br />&gt; You&#8217;d get the same thing on Unix if you had dumb installer and an app that uses shared libraries. </p>
<p>No, Unix is better than that. </p>
<p>You can link against a major version of the lib. This is a link to the installed version. Multiple versions of the same lib can coexist.<br />
<br />If you absolutely need a specific version of a lib, you can stick it in /opt/app/lib or wherever and fix LD_LIBRARY_PATH to point at it first. If you&#8217;re confused about where an app gets its libs, &#8216;ldd app_name&#8217; will tell you.</p>
<p>Of course you can bugger a box by installing stuff over the existing libs, but there&#8217;s no reason to.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-357403">
				<div id="div-comment-357403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">A</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357403">
			March 21, 2006 at 7:22 pm</a>		</div>

		<p>&quot;Windows File Protection first arrived in Windows 95.&quot;</p>
<p>Unless Google and MSDN are incorrect, WFP first arrived in Windows 2000 and Me. Maybe you&#8217;re thinking of the System File Checker tool 98 had?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-oldnewthing bypostauthor even thread-even depth-1" id="comment-357423">
				<div id="div-comment-357423" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357423">
			March 21, 2006 at 7:57 pm</a>		</div>

		<p>In Windows 95, it didn&#8217;t have a name. It was just a dialog box called &quot;System File Warning&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-357433">
				<div id="div-comment-357433" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">x</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357433">
			March 21, 2006 at 8:18 pm</a>		</div>

		<p>WFP was not around in Windows 95. I worked on a product that replaced winsock.dll and it worked on 95 and NT 4.0. &nbsp;No warning dialog box.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-oldnewthing bypostauthor even thread-even depth-1" id="comment-357443">
				<div id="div-comment-357443" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357443">
			March 21, 2006 at 8:25 pm</a>		</div>

		<p>The system file warning dialog in Windows 95 didn&#8217;t monitor all DLLs, just the ones that were known to cause problems at the time.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-357183">
				<div id="div-comment-357183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Max Lybbert</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357183">
			March 21, 2006 at 1:29 pm</a>		</div>

		<p>I&#8217;m from Linux, but my understanding of how Windows works *today* is that attempts to change system libraries cause your app to use the library in question as part of a private assembly, but keeps all other apps using the system-supplied version.</p>
<p>I recognize this problem isn&#8217;t as easy to work out as it appears on first glance. &nbsp;I think Microsoft has done about the best it can now by giving the new app what it&#8217;s actually asking for (that a certain library be available to it) without mucking with the system. &nbsp;There are drawbacks with this approach (eg., wasted disk space or the fact that the &quot;upgraded&quot; library may have security issues that the system version doesn&#8217;t), but there would be drawbacks on any approach.</p>
<p>Now, yes, IMO it was a mistake to allow/encourage developers to muck with system libraries. &nbsp;But, then again, developers should be able to realize it&#8217;s no longer 1993.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-357463">
				<div id="div-comment-357463" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Coderjoe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357463">
			March 21, 2006 at 11:01 pm</a>		</div>

		<p>This &quot;system file warning&quot; dialog may have existed in Windows 95, but it sounds like a far cry from WFP, with the dllcache and all. I was wrong about it not being in 2K, and perhaps ME, but I still don&#8217;t think Windows 95&#8217;s &quot;system file warning&quot; counts as WFP.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-oldnewthing bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-357473">
				<div id="div-comment-357473" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357473">
			March 21, 2006 at 11:05 pm</a>		</div>

		<p>True, it wasn&#8217;t very full-featured, but the basic idea was there.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-357483">
				<div id="div-comment-357483" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">cyber_rigger</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357483">
			March 22, 2006 at 1:33 am</a>		</div>

		<p>I use Linux</p>
<p>Linux does what I tell it to do.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-357493">
				<div id="div-comment-357493" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Archangel</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357493">
			March 22, 2006 at 2:01 am</a>		</div>

		<p>And if Windows had a decent process for installing applications, this wouldn&#8217;t be a problem. Instead it allows third party applications to do anything they like to the system during install (Kazaa anyone?).</p>
<p>At least if the ACL route had been taken, the installers would have had to be fixed &#8211; and fixed they would have been, when the vendors realised they didn&#8217;t run on XP.</p>
<p>It&#8217;s possible to work around file protection (I&#8217;ve lost count of how many times I&#8217;ve done it to uxtheme.dll) but it&#8217;s not very nice having the OS slyly replace files behind my back.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-357503">
				<div id="div-comment-357503" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Moi</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357503">
			March 22, 2006 at 3:43 am</a>		</div>

		<p>&quot;So everytime you upgrade your OS, you will need to buy all new software and games?&quot;<br />
<br />No, you do not. You should first question why you need to &quot;upgrade your OS&quot;. The applications are what is important as they are what provide you with productivity &#8211; if you can achieve what you want with them, why should you want to change the OS?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-357513">
				<div id="div-comment-357513" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Aaargh!</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357513">
			March 22, 2006 at 4:03 am</a>		</div>

		<p>Why do apps need to install DLL&#8217;s in the system directory anyway ?<br />
<br />The idea of DLL&#8217;s was that they would be shared between applications, but the current state is that most applications that install system-wide DLL&#8217;s are the only apps that use them. The only reason I see for sharing DLL&#8217;s is saving disk space, maybe important in 1995 but nowadays it is no longer an issue.</p>
<p>Since Vista is Microsoft&#8217;s attempt to catch up to OS X 10.4 Tiger why not also use the idea of bundles, just package the whole application with all it&#8217;s libraries and everything else it needs (except it&#8217;s settings) into a single bundle. I switched from Linux to OS X about a year ago and the concept of bundles is one of the things that make OS X a joy to use.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-357533">
				<div id="div-comment-357533" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alexvn</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357533">
			March 22, 2006 at 5:22 am</a>		</div>

		<blockquote><p>
  You should first question why you need to &quot;upgrade your OS&quot;.<br />
  <br />&gt;The applications are what is important as<br />
  <br />&gt;they are what provide you with productivity &#8211;<br />
  <br />&gt;if you can achieve what you want with them,<br />
  <br />&gt;why should you want to change the OS? </p>
<p>Because I can get a better productivity with the new OS and applications thanks to some useful new features? Or because the old OS doesn&#8217;t work with new game I just bought? Or because the old OS doesn&#8217;t support new hardware I just plugged in my PC? Or because the old OS no longer supported by the manufacturer since it&#8217;s TOO old?
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-357543">
				<div id="div-comment-357543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Stu</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357543">
			March 22, 2006 at 7:40 am</a>		</div>

		<p>Windows could really do with a package manager. (No, msi does not count.)<br />
<br />It would also benefit from a repository system.<br />
<br />A package (deb, rpm, etc.) on linux is a compressed archive of the files to be installed, combined with a list of dependancies and optional configuration scripts.<br />
<br />When a package is installed, the package manager checks the dependencies and makes sure there are no file conflicts and then installs the files.<br />
<br />When combined with a repository system, it can download any missing dependancies. This goes a long way to reducing &#8216;dll hell&#8217;.</p>
<p>On Windows, there would be a Microsoft repository, including the latest versions of all MS redist components, although installers could include required packages for use ONLY when an internet connection is not available.<br />
<br />Third parties could also add repositories.</p>
<p>It could also be combined with automatic updates (as it already is on most linux distributions) so that getting new updates would be as simple as scanning the repositories for updated packages.<br />
<br />If third parties can also add repositories, then it would also add a much better solution for automatic updates for third party applications.</p>
<p>It is still possible to install programs outside the package manager on linux, as it would be on Windows. In fact, if WFP was also combined with the package manager, it would provide a mechanism for preventing overwrites, even of non-MS shared components.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-357673">
				<div id="div-comment-357673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.rotd.org/' rel='external nofollow' class='url'>Andreas Magnusson</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357673">
			March 22, 2006 at 12:21 pm</a>		</div>

		<blockquote><p>
  Linux does what I tell it to do.</p>
<p>Oh my Raymond, I thought minors were not allowed to read your blog (<a rel="nofollow" target="_new" href="http://blogs.msdn.com/oldnewthing/archive/2005/09/07/461914.aspx" rel="nofollow">http://blogs.msdn.com/oldnewthing/archive/2005/09/07/461914.aspx</a>).
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-357523">
				<div id="div-comment-357523" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Adam</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357523">
			March 22, 2006 at 4:28 am</a>		</div>

		<p>Aaargh: It&#8217;s not just saving disk space. The other main two reasons, both more important than saving HD space are saving memory, and security.</p>
<p>Saving memory comes from the fact that if there are two applications running on a system using the same dll, then the actual code and read-only data (e.g. bitmap resources) only need to be loaded into memory once, and each app shares the data. While memory is cheaper than it was in &#8217;95, it&#8217;s not as cheap as disk space, and the data we&#8217;re loading has got *big*. Icons instead of being 256-color 16&#215;16 and 32&#215;32 can now be (on some systems) 32-bit color 128 x 128 bitmaps, or vector graphics. And the types of resources used, such as animations, sounds, has increased as well.</p>
<p>The security comes from plugging holes. If someone finds a vulnerability in a shared library (say, zlib) then if all the applications that need that functionality use the shared version, you only need to upgrade one copy of the library to fix all the applications that use it. If each application has its own copy, or statically linked it, or even just used the source code directly (ahem, mozilla) then securing your system is an awful lot harder.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-358013">
				<div id="div-comment-358013" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jim</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-358013">
			March 22, 2006 at 3:43 pm</a>		</div>

		<p>I love when an interface lies to me.</p>
<p>Honestly, this post made me feel a lot better about WFP. &nbsp;I had no idea that it had any purpose other than to block me from doing what I wanted with my system. &nbsp;I&#8217;m sure you can imagine how annoyed I was when I finally figured out that Windows was invisibly correcting my &quot;mistakes,&quot; not bothering to tell me because users are too dumb to learn better.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-357573">
				<div id="div-comment-357573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Hayden</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-357573">
			March 22, 2006 at 10:58 am</a>		</div>

		<p>I have a copy of VB3.0. It comes whith a cut-down installer generator, which I didn&#8217;t use as it was very nearly impossible tom stop it writing *all* your DLLs to windows/system.<br />
<br />That was the conventional wisdom &quot;dlls go in windows/system&quot;.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-358183">
				<div id="div-comment-358183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Fat4ever</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-358183">
			March 22, 2006 at 7:03 pm</a>		</div>

		<p>Will this work on FAT32 partitions? How?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-358193">
				<div id="div-comment-358193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">System128</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-358193">
			March 22, 2006 at 7:09 pm</a>		</div>

		<p>If Vista breaks old apps by resisting those to write to system32, why not at the same time rename the system directory to system64 in win64?</p>
<p>Wasn&#8217;t the name (system32) preserved because old apps should be able to write to it?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-358203">
				<div id="div-comment-358203" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Reverend</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-358203">
			March 22, 2006 at 7:23 pm</a>		</div>

		<p>Do you 2 apps take this lawful compiled shared library with bugs &amp; patches till disk crash do you part?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-358273">
				<div id="div-comment-358273" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">System16</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-358273">
			March 22, 2006 at 8:48 pm</a>		</div>

		<blockquote><p>
  If Vista breaks old apps by resisting those<br />
  <br />&gt; to write to system32</p>
<p>That&#8217;s Vista.</p>
<p>&gt; Wasn&#8217;t the name (system32) preserved because<br />
  <br />&gt; old apps should be able to write to it?</p>
<p>That&#8217;s XP and 2003.</p>
<p>(Why does Vista x64 represerve the preserved system32 name? &nbsp;Oops.)
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-358413">
				<div id="div-comment-358413" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Peter Ibbotson</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-358413">
			March 23, 2006 at 7:26 am</a>		</div>

		<p>Hmm I notice this as I did a test install of an app I installed using Wise (version 7 IIRC) that the acl got in the way of Wise doing a version check. Tne problem is there isn&#8217;t an easy way around this for older programs.</p>
<p>Dunno if the Vista team have changed the rules so you can at least do a version check without getting an ACL violation.</p>
<p>Thankfully this isn&#8217;t my problem anymore for me as I&#8217;ve left the company concerned BUT the app was Windows XP Gold certified so we were very careful over version checking etc.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-358443">
				<div id="div-comment-358443" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">8</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-358443">
			March 23, 2006 at 8:42 am</a>		</div>

		<p>Andreas Magnusson, I use GNU/Linux and I&#8217;m 19. Not only do I get to read TONT, I can have as much Wine as I want ;)</p>
<p>BTW, system files ARE in fact protected by ACL&#8217;s. Just try (re)moving anything in system32. It only works when logged in as an administrator, which already pwns the box anyway.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-358733">
				<div id="div-comment-358733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Driver Guy</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-358733">
			March 23, 2006 at 2:27 pm</a>		</div>

		<p>As long as Microsoft covers up the independent software vendor (ISV) mistakes, they won&#8217;t bother to learn how to do things correctly. Simply because it makes business sense: why should the ISV waste time learning how to install their app correctly, if MS will cover up their mistake?</p>
<p>All the appcompat cruft makes for a better user experience but it just perpuates crappy software development. Many problems can be avoided by simply RTFM &#8211; the SDK docs, the API calls, etc. Many developers don&#8217;t bother.</p>
<p>MS really needs to stop covering for hardware and software bugs. Of course, it would be nice if their own applications didn&#8217;t try to overwrite kernel sreaming modules on Win2000 every time. :=)<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-358743">
				<div id="div-comment-358743" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Driver Guy</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-358743">
			March 23, 2006 at 2:36 pm</a>		</div>

		<p>BTW Raymond, your blog should be required reading for all Windows developers, cause it points out the mistakes others have made in the past. Other docs do not do that.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-358843">
				<div id="div-comment-358843" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-358843">
			March 23, 2006 at 10:46 pm</a>		</div>

		<p>Thursday, March 23, 2006 2:27 PM by Driver Guy<br />
<br />&gt; Many problems can be avoided by simply RTFM &#8211;<br />
<br />&gt; the SDK docs, the API calls, etc.</p>
<p>In that spirit, I used to correspond with a certain famous blogger who used to solicit bug reports so that subsequent RTFM would yield more accurate information.</p>
<p>In that spirit I occasionally still submit bug reports directly to MSDN. &nbsp;Sometimes they reply that content is acquired from MSDN and who knows if it will ever get fixed. &nbsp;Sometimes they don&#8217;t reply and who knows if it will ever get fixed. &nbsp;Sometimes they reply that they&#8217;re fixing it but it still doesn&#8217;t get fixed.</p>
<p>Well, yes, sometimes RTFM does avoid problems. &nbsp;I just wish that were true more often. &nbsp;Meanwhile I RTFM a lot.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-358903">
				<div id="div-comment-358903" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">dhiren</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-358903">
			March 24, 2006 at 10:17 am</a>		</div>

		<blockquote><p>
  If Vista breaks old apps by resisting those to<br />
  <br />&gt;write to system32, why not at the same time<br />
  <br />&gt;rename the system directory to system64 in<br />
  <br />&gt;win64?<br />
  <br />&gt;Wasn&#8217;t the name (system32) preserved because old<br />
  <br />&gt;apps should be able to write to it?</p>
<p>Because some apps may want to read from system32 even if they don&#8217;t want to install/update files there?
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-359163">
				<div id="div-comment-359163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">8</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-359163">
			March 25, 2006 at 5:42 pm</a>		</div>

		<p>They should use GetSystemDirectory.</p>
<p><a rel="nofollow" target="_new" href="http://blogs.msdn.com/oldnewthing/archive/2004/10/08/239767.aspx" rel="nofollow">http://blogs.msdn.com/oldnewthing/archive/2004/10/08/239767.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-359483">
				<div id="div-comment-359483" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">M</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-359483">
			March 27, 2006 at 11:10 am</a>		</div>

		<p>Linux doesn&#8217;t solve DLL Hell, it just replaces it with dependency hell instead. So the system won&#8217;t let you install conflicting libraries &#8211; great &#8211; now you can&#8217;t install (and therefore run) your application <em>at all</em>. Hardly a leap forward, all you did was swap one problem for another.</p>
<p>The approach Windows uses works absolutely fine, the problems with DLL Hell are due to its history and not any problem with the current design (in which programs can happily ship their own libraries privately).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-359673">
				<div id="div-comment-359673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Fred</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-359673">
			March 27, 2006 at 1:31 pm</a>		</div>

		<p>Does someone know of good articles on updating system files and keeping WPF happy, including COM servers (OCXs), and using the side-by-side sharing hack that MS introduced in 98SE?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-360603">
				<div id="div-comment-360603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">8</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-360603">
			March 28, 2006 at 4:22 pm</a>		</div>

		<p>M: If all else fails ($LD_PRELOAD, $LD_LIBRARY_PATH), then there&#8217;s still chroot. I haven&#8217;t seen Windows installing a small version of Windows in a directory to safely install software in, seperate from the real installation. But debootstrap and yast can do that.</p>
<p>But if you stick to the distro package repositories, dependencies will be satisfied unless there are conflicting files. However, it&#8217;s no problem for packages of the same library but different versions to coexist (for instance libxml1 and libxml2).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-365173">
				<div id="div-comment-365173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/oldnewthing/archive/2006/04/03/567318.aspx' rel='external nofollow' class='url'>The Old New Thing : Doing the best we can until time travel has been perfected</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060321-00/?p=31843#comment-365173">
			April 3, 2006 at 11:17 am</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://blogs.msdn.com/oldnewthing/archive/2006/04/03/567318.aspx" rel="nofollow">http://blogs.msdn.com/oldnewthing/archive/2006/04/03/567318.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

