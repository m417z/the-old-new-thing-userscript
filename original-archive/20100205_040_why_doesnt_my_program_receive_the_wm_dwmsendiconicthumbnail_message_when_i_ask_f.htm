<html>
<head>
<title>Why doesn't my program receive the WM_DWMSENDICONICTHUMBNAIL message when I ask for an iconic representation?</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>Why doesn&#8217;t my program receive the WM_DWMSENDICONICTHUMBNAIL message when I ask for an iconic representation?</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>February 5, 2010 / year-entry #41</td></tr>
<tr><td><b>Tags:</b></td><td>code</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>37</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">A customer was having trouble adding Windows 7 taskbar integration features to their application: I'm trying to use the new Windows 7 taskbar integration features, but am running into a problem. I've made certain that my program has the DWMWA_FORCE_ICONIC_REPRESENTATION and DWMWA_HAS_ICONIC_BUTMAP DWMWA_HAS_ICONIC_BITMAP [corrected 8am] attributes set, yet I never receive a WM_DWMSENDICONICTHUMBNAIL message in my window...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>
A customer was having trouble adding Windows&nbsp;7 taskbar
integration features to their application:
</p>
<blockquote CLASS=q><p>
I'm trying to use the new Windows&nbsp;7 taskbar integration features,
but am running into a problem.
I've made certain that my program has the
<code>DWMWA_FORCE_ICONIC_REPRESENTATION</code>
and
<strike><code>DWMWA_HAS_ICONIC_BUTMAP</code></strike>
<code>DWMWA_HAS_ICONIC_BITMAP</code> [corrected 8am]
attributes set,
yet I never receive a <code>WM_DWMSENDICONICTHUMBNAIL</code>
message in my window procedure.
</p>
</blockquote>
<p>
A member of the taskbar team invoked psychic powers:
</p>
<blockquote CLASS=m>
<p>
Is your program running elevated by any chance?
If so, then you need to add the
<code>WM_DWMSENDICONICTHUMBNAIL</code> message 
to your UIPI message filter:
</p>
<pre>
ChangeWindowMessageFilter(WM_DWMSENDICONICTHUMBNAIL, MSGFLT_ADD);
</pre>
</blockquote>
<p>
Psychic powers once again save the day.
</p>
<blockquote CLASS=q><p>
That was it. Thanks!
</p>
</blockquote>
<p>
Note that forcing someone to invoke psychic powers is a <i>bad thing</i>.
It means that you withheld crucial information that somebody had to
guess at.
Here are some crucial pieces of information people tend to forget to
mention:
</p>
<ul>
<li>"Oh, did I mention that my process is running elevated?"
<li>"Oh, did I mention that my process is a service?"
<li>"Oh, did I mention that my process is 32-bit, running on a 64-bit machine?"
<li>"Oh, did I mention that I initialized COM as MTA?"
<li>"Oh, did I mention that my process is impersonating another user?"
<li>"Oh, did I mention that I'm running a version of the operating
    system different from Windows&nbsp;7?" (or whatever the most
    current client operating system is)
</ul>
<p>
<b>Added</b>:
The reason those items above are crucial pieces of information is that
all of them (except the last one) are "game-changers":
If you do any of the things in the list,
a whole bunch of rules change.
It's like asking a question about traffic regulations and neglecting
to mention that the other vehicle
is a fire truck with its siren on.
(And presumably when you chose to invoke any of those game-changing
conditions, you were aware of the rules which applied to the new situation.
Those rules are documented with the game-changing condition,
not with the general description of a normally-functioning universe.
Imagine if every physics book had the sentence "This rule does not apply
to Superman" at the end of every paragraph.)</p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (37)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-808783">
				<div id="div-comment-808783" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808783">
			February 5, 2010 at 7:31 am</a>		</div>

		<p><a href="http://blogs.msdn.com/oldnewthing/archive/2009/12/04/9932270.aspx" rel="nofollow"></a> Jennifer Lopez has an iconic butmap.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-808803">
				<div id="div-comment-808803" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Km</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808803">
			February 5, 2010 at 7:43 am</a>		</div>

		<p>Problem is, that requires the asking one to KNOW that a piece of information is relevant. </p>
<p>I hope if you go to the doctor because you are coughing they are asking if you have tremors and fever and so on, before giving you a cure, and not simply saying &#8220;you should have mentioned&#8221;.</p>
<p>So no. It&#8217;s your job to be psychic when helping others.. of course this is correct if helping clients is your job.</p>
<div class=post>[<i>Basically, if there&#8217;s some way your program&#8217;s execution environment is different from &#8220;Running as normal user from the Start menu&#8221; then it&#8217;s relevant. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-808813">
				<div id="div-comment-808813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Vilx-</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808813">
			February 5, 2010 at 7:46 am</a>		</div>

		<p>Nitpickers. Gotta love them. :P</p>
<p>Though I have to say one thing &#8211; Windows has become SO complicated that it&#8217;s sometimes pretty difficult to figure out what the relevant information. For example, I have but a vague idea of what half of the list you gave is, let alone what implications it has. COM alone is such a hairy beast that it is no wonder people sometimes forget to tell something. Not because they wanted to withhold important information, or because they are lazy, but simply because they had no idea that some-seemingly-completely-unrelated-thing makes all the difference.</p>
<p>This is especially true with copy-paste code from the Internet. Of course, one should always study the code and try to understand it as much as possible &#8211; but sometimes trying to understand it brings one to such deep waters that it&#8217;s much more efficient to just copy the line, check that it works, and forget about it &#8211; instead of spending two weeks studying the internals of COM interop marshalling or something.</p>
<p>I&#8217;m not saying this is good. It&#8217;s a bad thing, no doubt about it. But it is understandable and forgivable.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-808823">
				<div id="div-comment-808823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">peterchen</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808823">
			February 5, 2010 at 8:22 am</a>		</div>

		<p>I agree that it&#8217;s hard to know what is relevant &#8211; but then, asking in a different way</p>
<p>&quot;Can you think of any reasons why I don&#8217;t receive message X&quot;?</p>
<p>at least seems more polite &#8211; and might help you think of some reasons for yourself.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-808833">
				<div id="div-comment-808833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Magnus</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808833">
			February 5, 2010 at 8:23 am</a>		</div>

		<p>You should not need psychic powers to fill in what&#8217;s missing from the documentation either.</p>
<p>In this case the documentation should say.</p>
<p>Oh, if your process is elavated you must also do this to let the message trough.</p>
<p>( At least it&#8217;s not documented on this page: <a href="http://msdn.microsoft.com/en-us/library/aa969530" rel=nofollow target=_new rel="nofollow">http://msdn.microsoft.com/en-us/library/aa969530</a>(VS.85).aspx )</p>
<div class=post>[<i>Except that the message filter isn&#8217;t specific to that message. It&#8217;s a general property of all messages. Should every window message have the Remark: &#8220;By default, UIPI blocks this message from being sent across processes of different integrity levels&#8221;? Should every class-defined message include the remark &#8220;Since class-defined messages are not marshalled, care must be taken when sending this message across processes&#8221;? Should it also mention other properties of messages, like &#8220;If this message is posted, then it is retrieved by the GetMessage or PeekMessage function. If it is sent, then the message is delivered directly to the window procedure and bypasses the message queue.&#8221;? (Or maybe there should just be a generic &#8220;Things you need to know about messages&#8221; page that every window message links to?) -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-808843">
				<div id="div-comment-808843" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Magnus</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808843">
			February 5, 2010 at 8:46 am</a>		</div>

		<p>If the user is supposed to know all the details that are relevant for every question then yes, this info should be on every page in the documentation to.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-808853">
				<div id="div-comment-808853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James Schend</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808853">
			February 5, 2010 at 8:48 am</a>		</div>

		<p>Vilx: that&#8217;s why I&#8217;d recommend starting new development in C#/.net. It&#8217;s just sooo much easier.</p>
<p>(I had the same kind of culture shock coming from the Mac Classic API&#8211; which is very small and simple&#8211; to the Win32 API&#8211; which is large and complicated. I never really felt comfortable with it, just because I wasn&#8217;t &quot;raised&quot; on it. But .net turns that all around.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-808873">
				<div id="div-comment-808873" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.henke37.cjb.net/' rel='external nofollow' class='url'>Henke37</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808873">
			February 5, 2010 at 10:05 am</a>		</div>

		<p>I am all for a page just about windows messages. With my psychic powers, I estimate that there is in fact one, but it does not cover every single listed generic issue.</p>
<p>The link on the other hand is overkill.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-808883">
				<div id="div-comment-808883" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">waleri</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808883">
			February 5, 2010 at 10:26 am</a>		</div>

		<p>I guess it would be helpful if documentation for WM_DWMSENDICONICTHUMBNAIL mentioned the fact, that message may be filtered.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-808893">
				<div id="div-comment-808893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Kyle S</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808893">
			February 5, 2010 at 11:01 am</a>		</div>

		<p>@waleri et al., I guess the documentation for WM_DWMSENDICONICTHUMBNAIL should also contain a copy of the C language reference, in case you encounter a syntax error when compiling code that sends that message.</p>
<p>I don&#8217;t understand this &quot;the documentation must contain everything&quot; mindset.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-808933">
				<div id="div-comment-808933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://adamrosenfield.com' rel='external nofollow' class='url'>Adam Rosenfield</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808933">
			February 5, 2010 at 12:28 pm</a>		</div>

		<p>@everhaveabadday:</p>
<p>When Windows unzips an archive, it creates all of the expanded files with the &quot;Read &amp; Execute&quot; security attribute set. &nbsp;Other programs may not.</p>
<p>I&#8217;ve run into a similar problem before fairly often &#8212; when I unzip an archive with Cygwin&#8217;s &#8216;unzip&#8217; executable, it does NOT create the expanded files as executable (they don&#8217;t have chmod +x as Cygwin sees it), so any .exes or .dlls in the archive will to load.</p>
<p>The workaround for this is either to unzip the archive outside of Cygwin, or use the CYGWIN environment variable to tell Cygwin &quot;Yes, I really want the files to be executable&quot;, e.g.</p>
<p>CYGWIN=nontsec unzip foo.zip</p>
<p>See also <a rel="nofollow" target="_new" href="http://www.cygwin.com/ml/cygwin/2003-02/msg02181.html" rel="nofollow">http://www.cygwin.com/ml/cygwin/2003-02/msg02181.html</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-808953">
				<div id="div-comment-808953" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">mikeb</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808953">
			February 5, 2010 at 1:16 pm</a>		</div>

		<blockquote><p>
  &gt; There may be plenty of idiot programmers out there, but let&#8217;s not forget that programming and debugging can be a complex endeavor, and sometimes even the best of us can have a bad day. &lt;&lt;
</p></blockquote>
<p>Hear, hear!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-808963">
				<div id="div-comment-808963" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anonymous Coward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808963">
			February 5, 2010 at 2:49 pm</a>		</div>

		<p>Actually, if someone is using Windows 7, he should probably mention it (except in obvious cases such as this, where we&#8217;re talking about a new feature) since almost everyone is still using Windows XP.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-808973">
				<div id="div-comment-808973" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Billy O'Neal</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808973">
			February 5, 2010 at 3:14 pm</a>		</div>

		<p>@Anonymous Coward:</p>
<p>The new taskbar APIs are a Windows 7 specific feature, so talking about them sort of implies that the user is running 7.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-808773">
				<div id="div-comment-808773" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">TKW</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808773">
			February 5, 2010 at 7:14 am</a>		</div>

		<p>DWMWA_HAS_ICONIC_B*I*TMAP</p>
<div class=post>[<i>Thanks, fixed (sort-of). -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-809003">
				<div id="div-comment-809003" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Zan Lynx</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-809003">
			February 5, 2010 at 4:36 pm</a>		</div>

		<p>I say the real problem here is running elevated at all.</p>
<p>I&#8217;ve got MMO clients that launch as elevated so they can download updates. A better way would be to add game users to some kind of permissions group.</p>
<p>There are ridiculous bits of software that think they need full Administrator privileges and from this question above, I see that the authors of such programs don&#8217;t even know what they&#8217;re doing!</p>
<p>From a Unix background, you don&#8217;t write setuid code unless you understand the dynamic loader, environment variables, and check every return code from every system function and handle it properly!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-808863">
				<div id="div-comment-808863" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">KenW</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808863">
			February 5, 2010 at 8:50 am</a>		</div>

		<p>@Km: Not quite right.</p>
<p>What Raymond is discussing is like a *doctor* going to his own personal physician and saying &quot;This hurts.&quot; As a professional in the same line of work, he should know that more information would be helpful, and provide it without having to be asked.</p>
<p>In the same way, the person asking the question of tech support is *supposed to be* a programmer (otherwise, why ask technical questions about programming), and as a fellow professional they should know that running elevated makes a difference on current versions of Windows. If they don&#8217;t, they should not be worrying about Win7 taskbar integration; they should be concentrating on recording what they&#8217;re doing as VBA macros in Office instead.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-809013">
				<div id="div-comment-809013" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.metamatt.com' rel='external nofollow' class='url'>Matt</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-809013">
			February 5, 2010 at 5:43 pm</a>		</div>

		<p>Sure, you should provide all the relevant information you can, when asking for help or reporting a problem.</p>
<p>But within reason &#8212; if you include tons of stuff that the recipient doesn&#8217;t think is relevant, you may fall victim to TLDR syndrome.</p>
<p>Meanwhile, while forcing people to use psychic powers is bad, I submit that if you design a piece of software or component that is fragile in a certain way such that (a) people often get confused about it and (b) they often ask you for help and (c) they often omit key details and (d) you can often psychically guess what&#8217;s wrong&#8230; um, maybe you share some of the blame too.</p>
<div class=post>[<i>The thing that most of the &#8220;psychic details&#8221; have in common is that they radically change the rules of Win32. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-809023">
				<div id="div-comment-809023" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">me</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-809023">
			February 5, 2010 at 6:00 pm</a>		</div>

		<p>I must be honest. &nbsp;I am pretty good at this sort of thing. &nbsp;I would have made the EXACT same mistake. &nbsp;The docs do not speak to it at all. &nbsp;This would have been a set my glasses down on my desk with a &#8216;how would I know it did that?&#8217;</p>
<p>The documentation is deficient here in some way.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-808903">
				<div id="div-comment-808903" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">everhaveabadday</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808903">
			February 5, 2010 at 11:09 am</a>		</div>

		<p>&gt;&gt; In the same way, the person asking the question of tech support is *supposed to be* a programmer (otherwise, why ask technical questions about programming), and as a fellow professional they should know that running elevated makes a difference on current versions of Windows. If they don&#8217;t, they should not be worrying about Win7 taskbar integration; they should be concentrating on recording what they&#8217;re doing as VBA macros in Office instead.</p>
<p>&#8212;&#8212;&#8212;&#8212;</p>
<p>That last part is a little harsh. &nbsp;Clearly in this case if the person had thought of elevation and UIPI he would&#8217;ve probably been able to fix the problem himself. &nbsp;Even the best of us sometimes don&#8217;t remember or realize all the relevant details to an issue, which is why Raymond helpfully provided that checklist at the end of his blog entry as a good starting point.</p>
<p>It&#8217;s especially clear in this case that the person was not familiar with the Win7 Taskbar integration APIs, so naturally his assumption was that he&#8217;s made some stupid mistake in his usage of those specific APIs/Windows messages. &nbsp;It&#8217;s understandable that he would be focusing on that instead of something more general like UIPI.</p>
<p>As a counterpoint, here&#8217;s a recent example I encountered where the more obvious information didn&#8217;t help. An end user was complaining that a certain part of a certain program is working on XP but not on Vista. &nbsp;To simplify the story:</p>
<p>1) The user (as well as I) already tried all the various compatibility settings as well as elevation, to no avail.</p>
<p>2) I then naturally started by trying to repro the problem on my Vista machine, but couldn&#8217;t.</p>
<p>3) I noticed the program uses a DLL residing in the program&#8217;s directory, so as a hunch, I asked the user to see if he has another copy of the DLL, perhaps a different version, residing in places like %windir%system32. &nbsp;Nope.</p>
<p>4) Later after some more talking, it turned out user was actually running this 32-bit program on Vista 64-bit. I found a machine with that installed and try reproing issue. &nbsp;Still no repro on my end. &nbsp;Baffled since the symptoms suggest a problem accessing files in a directory, which isn&#8217;t something that comes to mind as being affected by Wow64. (And no, we&#8217;re not talking about directories that gets redirected under Wow64 like system32.)</p>
<p>[Of course I also asked the user to redo step #3 with SysWow64. &nbsp;We ruled that out too.]</p>
<p>5) Eventually, as another hunch based on my inability to repro, I asked the user whether he unzipped the zip file containing all the program&#8217;s files using windows, or using some third-party unzipper.</p>
<p>Lo and behold, the user found that if he unzipped using windows instead of the third-party unzip program he was using, the problem went away.</p>
<p>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-</p>
<p>So we started with the kinds of things on Raymond&#8217;s checklist, but in this case, they all ended up being a detour to the actual problem. &nbsp;(And no, I still have no idea how exactly the third-party unzip program causes the problem, not that I need to know in this case since it&#8217;s not my program, and the end user is merely a user not the author of the program.)</p>
<p>&#8212;&#8212;&#8212;&#8212;-</p>
<p>There may be plenty of idiot programmers out there, but let&#8217;s not forget that programming and debugging can be a complex endeavor, and sometimes even the best of us can have a bad day.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-809033">
				<div id="div-comment-809033" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Gabe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-809033">
			February 5, 2010 at 8:33 pm</a>		</div>

		<p>Another reason that a 3rd-party unzip program might cause different results is that it might put all files into a single directory by default, while Windows&#8217;s unzipper always puts them in the directories specifed in the zip file.</p>
<p>I agree that the problem is knowing what information would be relevant, in particular because knowing that a piece of information is relevant would probably lead you to the answer in the first place.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-809043">
				<div id="div-comment-809043" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.nynaeve.net' rel='external nofollow' class='url'>Skywing</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-809043">
			February 5, 2010 at 10:17 pm</a>		</div>

		<p><a href="http://blogs.msdn.com/oldnewthing/archive/2009/12/04/9932270.aspx" rel="nofollow"></a> For code that is written to work against Win7 or later, I&#8217;d use ChangeWindowMessageFilterEx (<a href="http://msdn.microsoft.com/en-us/library/dd388202.aspx" rel=nofollow target=_new rel="nofollow">http://msdn.microsoft.com/en-us/library/dd388202.aspx</a> ) instead. &nbsp;ChangeWindowMessageFilterEx only opens the message &#8216;firewall&#8217; for the window you specify, instead of all windows, which is the behavior of ChangeWindowMessageFilter.</p>
<p>Using ChangeWindowMessageFilter without extreme care can be dangerous ( <a href="http://www.nynaeve.net/?p=151" rel=nofollow target=_new rel="nofollow">http://www.nynaeve.net/?p=151</a> ), especially for messages outside of the system-marshaled range (WM_USER+). &nbsp;In this case, the DWM message is within the system marshaled range, but it is still good practice to get into the habit of using ChangeWindowMessageFilterEx everywhere for new code.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-809053">
				<div id="div-comment-809053" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Teo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-809053">
			February 5, 2010 at 11:12 pm</a>		</div>

		<p>Raymond, can you please make an experiment? Ask your user&#8217;s question to an Office team member and measure how much time does it need to get the answer correctly.</p>
<p>Why do I have the gut feeling that at least 50% of MS programmers won&#8217;t have a clue what the problem is?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-yuhong-bao odd alt thread-odd thread-alt depth-1" id="comment-809063">
				<div id="div-comment-809063" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Yuhong+Bao' rel='external nofollow' class='url'>Yuhong Bao</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-809063">
			February 5, 2010 at 11:45 pm</a>		</div>

		<div class=post>[<i>deleted for violation of ground rules. Looking forward to the creation of yuhong3. -Raymond</i>]</div>
<div class=post>[<i>(that was sarcasm) -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-808993">
				<div id="div-comment-808993" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Matt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-808993">
			February 5, 2010 at 4:03 pm</a>		</div>

		<p>&gt; [Except that the message filter isn&#8217;t specific to that message. It&#8217;s a general property of all messages. Should every window message have the Remark: &#8220;By default, UIPI blocks this message from being sent across processes of different integrity levels&#8221;? Should every class-defined message include the remark &#8220;Since class-defined messages are not marshalled, care must be taken when sending this message across processes&#8221;? Should it also mention other properties of messages, like &#8220;If this message is posted, then it is retrieved by the GetMessage or PeekMessage function. If it is sent, then the message is delivered directly to the window procedure and bypasses the message queue.&#8221;? (Or maybe there should just be a generic &#8220;Things you need to know about messages&#8221; page that every window message links to?) -Raymond]</p>
<p>I think that this is exactly what should appear in MSDN. I&#8217;ve been doing win32 programming off-and-on for more than a decade and it&#8217;s such an immense platform that I have to look things like this up over and over. It would be *very* helpful for each message&#8217;s page in MSDN to have a number of notes with all of the special cases.</p>
<p>It&#8217;s not dumbing down the documentation &#8211; it&#8217;s just providing all of the information you need in one place for those of us that aren&#8217;t win32 programming day-in-day-out (or in my case, haven&#8217;t done any win32 development since just before the release of vista).</p>
<div class=post>[<i>Except that it&#8217;s not &#8220;all the information in one place&#8221;; it&#8217;s &#8220;all the information repeated in 2000 places.&#8221; The deal here is that there is an interaction between messages and elevation. It is documented in <a href="http://msdn.microsoft.com/bb756960.aspx" rel="nofollow">the docs on elevation</a> and is repeated <a href="http://msdn.microsoft.com/ms644950.aspx" rel="nofollow">in the docs for SendMessage</a>. If you want it repeated everywhere messages are mentioned, every page is going to have so much boilerplate people wouldn&#8217;t read it. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-809083">
				<div id="div-comment-809083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">dave</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-809083">
			February 6, 2010 at 9:06 am</a>		</div>

		<p>I would LOVE to have a list of &quot;Stupid things to check when you&#8217;re not getting a window message you expect to&quot; (or, more generally, &quot;Stupid things to check when X doesn&#8217;t seem to be working&quot;), even if it&#8217;s nothing more than one-sentence summaries (e.g. &quot;If the program is running with elevated privileges, messages may get filtered&quot;) with links to the documentation that addresses that problem.</p>
<p>Assuming that such a list existed, I don&#8217;t think a link to it in the &quot;See Also&quot; section of every message&#8217;s documentation would be excessive.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-809113">
				<div id="div-comment-809113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">yuhong2.71828</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-809113">
			February 6, 2010 at 10:51 pm</a>		</div>

		<p>I think it&#8217;s safe to say that a guy whose job it is to write UI code would never look at the docs for SendMessage (because he has been using it regularly for decades), nor the docs for elevation (because that&#8217;s somebody else&#8217;s job). However even after reading the docs it&#8217;s not clear that the problem is caused by running elevated. For one thing, one doesn&#8217;t think of the window manager as a process, per se, so why would one think of the DWM as a process? Even if one did know that it&#8217;s a process, it&#8217;s not mentioned anywhere that it&#8217;s a medium integrity process. Afterall, it&#8217;s a system service, so shouldn&#8217;t it be running a system integrity level? Another problem with the docs is that they tell you the problem of running at low integrity, so it&#8217;s not obvious that being elevated would cause problems.</p>
<p>Missing from the documentation is that DWM only has medium integrity level (and therefore it&#8217;s necessary to change the window filter) and that there is such a thing as a window filter that can be changed to allow in other messages. Furthermore, the ChangeWindowMessageFilter[Ex] docs only say that messages above WM_USER get blocked by default and some message below WM_USER are not blockable. Since WM_DWMSENDICONICTHUMBNAIL is below WM_USER, why would it be blocked?</p>
<p>I agree with other posters in believing that the docs for WM_DWMSENDICONICTHUMBNAIL should say &quot;The window that receives this message should either be running with low or medium integrity, or it should change its message filter with ChangeWindowMessageFilter[Ex].&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-809143">
				<div id="div-comment-809143" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.metamatt.com' rel='external nofollow' class='url'>Matt G</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-809143">
			February 7, 2010 at 10:01 am</a>		</div>

		<p>I just had another experience in psychic debugging that&#8217;s obvious after the fact but points at the difficulty of knowing what&#8217;s relevant up front.</p>
<p>I was trying to use Netflix Watch Instantly on my Win7-x64 laptop. It always failed with an error code (8156-4001) which, if you believe every story you can find on the net about people running into this problem and fixing it somehow, has either to do with corrupt Silverlight installs, corrupt SIlverlight local appdata stores, IE&#8217;s Trusted Sites settings, your network speed, or a few other things. I called Netflix support and they said it has either to do with audio driver compatibility with Silverlight or my Internet connection speed, but they couldn&#8217;t tell which. (Really?)</p>
<p>Eventually I talked to a support agent with psychic powers and he asked me if I installed any debugging software on that machine. Well yes, it has windbg, which probably isn&#8217;t relevant, but I also had set the kernel to boot in debug mode &#8212; months ago and had forgotten doing so. I used bcdedit to disable that, and now Netflix/Silverlight works fine.</p>
<p>In retrospect it&#8217;s kind of obvious (though still lame) that Netflix/Silverlight DRM would be afraid of debuggers. But normally, just enabling the debug support in the kernel doesn&#8217;t change app behavior, and for apps that specifically intentionally change their behavior because of it, you&#8217;d think they&#8217;d have the decency to complain about it specifically (not using an opaque error code that&#8217;s shared with 3 or more unrelated causes!).</p>
<p>So, I put to you: was this supposed to be obvious? Is activating the kernel debug mode another one of these game-changers?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-809153">
				<div id="div-comment-809153" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">bdcrazy</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-809153">
			February 7, 2010 at 11:22 am</a>		</div>

		<p>I&#8217;d say most users have never heard of kernel debug mode and most windows programmers I have asked didn&#8217;t know it existed either so they didn&#8217;t test in that mode.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-809173">
				<div id="div-comment-809173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">CGomez</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-809173">
			February 7, 2010 at 2:36 pm</a>		</div>

		<p>Having to resort to psychic debugging is always tough, but one issue I have is sometimes the customer may not even realize they withheld a crucial bit of information.</p>
<p>Certainly there are plenty of developers who just throw basic information at MSFT and expect them to start pinpointing the problem. &nbsp;However, there have been times that I have included everything I can think of that is relevant only to forget or not realize that there was a little tidbit that would have made it obvious.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-809213">
				<div id="div-comment-809213" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-809213">
			February 8, 2010 at 2:56 am</a>		</div>

		<p>This is a flaw in windows. How is anyone expected to develop software for this os when the conditions can vary this much when executing the software.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-809253">
				<div id="div-comment-809253" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://xkcd.com/221' rel='external nofollow' class='url'>Bulletmagnet</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-809253">
			February 8, 2010 at 6:46 am</a>		</div>

		<p>@640k</p>
<blockquote><p>
  How is anyone expected to develop software for this os when the conditions can vary this much when executing the software.
</p></blockquote>
<p>Step 1: RTFM</p>
<p>Step 2: ???</p>
<p>Step 3: Profit!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-809543">
				<div id="div-comment-809543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Peter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-809543">
			February 8, 2010 at 7:03 pm</a>		</div>

		<p>Hmmm&#8230;.I&#8217;m with all the people who say it&#8217;s a doc issue.</p>
<p>Let&#8217;s see: there are two general ways to send a message: SendMessage and PostMessage. &nbsp;I don&#8217;t know if there are hidden &quot;extra&quot; ways that Microsoft uses internally. &nbsp;Special Microsoft mechanism is reasonably common.</p>
<p>Beyond that, I assume that the message was sent via SendMessage or PostMessage. &nbsp;The UIPI documentation is actually in the hWnd parameter docs (which personally I often skip on the grounds that they generally have no content). &nbsp;I find out that what UIPI stands for, and that there&#8217;s an &quot;integrity level&quot; associated with a process.</p>
<p>But I don&#8217;t know that DWP is a process (the docs are unclear about that), and they don&#8217;t say what the DWP integrity level is normally set up.</p>
<p>Then I do a search and discover that integrity level is determined by the SID with the form S-1-16-xxxx. &nbsp;At this point my eyes glaze over, and I haven&#8217;t even gotten to where the introduction says that the Windows integrity model resembles the Biba model, but isn&#8217;t like the Clark-Wilson model.</p>
<p>Exactly what percent of developers will understand this? &nbsp;I happen to be a decent developer, and I happen to have done a pretty good job of updating an app to Vista level &#8212; and I&#8217;ve never heard of any of this.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-809833">
				<div id="div-comment-809833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Billy O'Neal</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-809833">
			February 9, 2010 at 10:20 am</a>		</div>

		<p>I think the point of the blog post has nothing to do about the specific case of ChangeWindowsMessageFilter &#8212; Asking the question is completely normal. The point is, if you are running under one of the kinds of conditions mentioned above, the rules change for you. These &quot;special things&quot; (such as the fact that your app is running elevated) are information you need to provide to those helping you fix a bug, so that the person helping you debug takes those changed rules into account.</p>
<p>You&#8217;re all reading too much into the specific question that was asked and completely missing the point of Raymond&#8217;s post.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-810123">
				<div id="div-comment-810123" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-810123">
			February 10, 2010 at 5:00 am</a>		</div>

		<p>&gt; &#8220;Oh, did I mention that&#8230;&#8221;</p>
<p>All those reasons explain why it&#8217;s hard to program Windows. It explains why programs are buggy, developers can&#8217;t usually remember all those &#8220;taxes&#8221;.</p>
<div class=post>[<i>These aren&#8217;t taxes though. Taxes are things you have to do even though you didn&#8217;t ask for them. But in this case, you <u>opted into</u> the situation. It&#8217;s more like getting a puppy without realizing that you&#8217;re going to have to take care of it even when it&#8217;s no longer cute. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-810543">
				<div id="div-comment-810543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Matt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-810543">
			February 10, 2010 at 7:01 pm</a>		</div>

		<p>[deleted for violation of ground rules. Looking forward to the creation of yuhong3. -Raymond]</p>
<p>[(that was sarcasm) -Raymond]</p>
<p>Raymond, I often wish I could give you stars back on your comments to comments.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-810903">
				<div id="div-comment-810903" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://balefrost.org/' rel='external nofollow' class='url'>Dan</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100205-00/?p=15043#comment-810903">
			February 11, 2010 at 5:26 pm</a>		</div>

		<p>Wouldn&#8217;t supplying enough information to avoid psychic debugging require that the asker of the question himself be psychic? And if he is psychic, would he even have to ask the question in the first place?</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

