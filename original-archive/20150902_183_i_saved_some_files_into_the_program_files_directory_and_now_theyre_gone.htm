<html>
<head>
<title>I saved some files into the Program Files directory, and now they're gone!</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>I saved some files into the Program Files directory, and now they&#8217;re gone!</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>September 2, 2015 / year-entry #184</td></tr>
<tr><td><b>Tags:</b></td><td>tipssupport</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>33</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">A customer reported that they saved some files in the Program Files directory, but when they went back to check, the files were gone! What happened? What most likely happened is UAC Virtualization. UAC Virtualization kicks in for applications which were designed for versions of Windows prior to Windows Vista. These applications often assume that...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>
A customer reported that they saved some files in the
Program Files directory,
but when they went back to check,
the files were gone!
What happened?</p>
<p>
What most likely happened is
<a href="http://technet.microsoft.com/en-us/magazine/2007.06.uac.aspx">
UAC Virtualization</a>.
</p>
<p>
UAC Virtualization kicks in for applications which were designed
for versions of Windows prior to Windows Vista.
These applications often assume that they are running with
administrative privileges, and when they
try to write to file or registry
locations that are normally
restricted to administrators,
they expect them to succeed.
So UAC Virtualization lets those writes succeed
by secretly
redirecting them to another location inside the user profile.
The reverse happens when the application later tries to read
the file or registry key:
If the file or key exists in the redirected location, it is
used instead of the one in the administrative location.
</p>
<p>
You can read
<a href="http://technet.microsoft.com/en-us/magazine/2007.06.uac.aspx">
the above-linked TechNet article for details</a>.
The short version is that you can find the files in the
<code>%LOCAL&shy;APP&shy;DATA%\<wbr>Virtual&shy;Store</wbr></code> directory
and the keys under the
<code>HKEY_<wbr>CURRENT_<wbr>USER\<wbr>Software\<wbr>Classes\<wbr>Virtual&shy;Store</wbr></wbr></wbr></wbr></wbr></code>
key.
</p>
<p>
<b>Bonus chatter</b>:
There used to be a button in Explorer called
<i>Compatibility Files</i> that appears if you are looking
at a directory that has a corresponding Virtual Store,
and clicking it takes you to that Virtual Store.
The button was removed in Windows&nbsp;8 based on telemetry
feedback that showed that very nearly nobody ever clicked on it
or even cared about it.
Furthermore, in the years since UAC was originally introduced,
the number of applications which require UAC Virtualization
has dropped significantly,
so the need to access items in the Virtual Store dropped correspondingly.
</p></p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (33)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-1206411">
				<div id="div-comment-1206411" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anon</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206411">
			September 2, 2015 at 7:43 am</a>		</div>

		<p>For:</p>
<p>&quot;&#8230;applications which were designed for versions of Windows prior to Windows Vista.&quot;</p>
<p>I read:</p>
<p> &quot;&#8230;applications which were not written properly, according to published Windows XP security guidelines, which repeatedly advised against storing user-modified data in system directories.&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1206401">
				<div id="div-comment-1206401" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Chris B</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206401">
			September 2, 2015 at 7:48 am</a>		</div>

		<p>@Anon &#8211; is an unenforced rule actually a rule?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1206391">
				<div id="div-comment-1206391" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Antonio &amp;#39;Grijan&amp;#39;</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206391">
			September 2, 2015 at 8:10 am</a>		</div>

		<p>@Chris B: It was enforced. Sort of. If you run a limited user account, you wouldn&#39;t be granted write permissions on system directories (Program Files, Windows) or registry keys (LOCAL_MACHINE, etc). Problem was nearly nobody used limited accounts, so almost no developers cared too support them.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1206381">
				<div id="div-comment-1206381" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Kevin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206381">
			September 2, 2015 at 8:19 am</a>		</div>

		<p>Based on the situation Raymond describes, I imagine the user manually navigated to C:Program Files through the Save As window. &nbsp;So a &quot;properly written Windows XP program&quot; would exhibit exactly this behavior (unless it&#39;s supposed to check the directory the user provides for sanity?).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1206371">
				<div id="div-comment-1206371" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206371">
			September 2, 2015 at 8:43 am</a>		</div>

		<p>Why did it have to be a policy switch to disable this incredibly bad idea? It should have been a switch to be set on each subdirectory of Program Files. The registry got it right.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1206351">
				<div id="div-comment-1206351" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Max</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206351">
			September 2, 2015 at 9:02 am</a>		</div>

		<p>@Chris B: That&#39;s the point of quite a few of Raymond&#39;s articles &#8211; even if a rule isn&#39;t enforced now, you still need to follow it, because a later version of Windows may begin to enforce it. There is often a sizable period between when a rule is made and when it is enforced, specifically to give developers plenty of time to adjust to the new rules so that they won&#39;t be caught off-guard and have their programs broken when enforcement begins. If a rule exists, it should be followed, because Windows development will proceed based on the assumption that everyone follows those rules, and anyone who doesn&#39;t follow them is liable to have their programs broken at any time.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1206341">
				<div id="div-comment-1206341" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dan Bugglin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206341">
			September 2, 2015 at 9:48 am</a>		</div>

		<p>@Kevin I believe UAC Virtualization will only happen for legacy applications&#8230; either they will have an app shim in place or will have Compatibility Mode applies for XP or earlier (that is my guess). For example if I do stuff in Program Files using an unelevated Command Prompt, UAC Virtualization will NOT kick in and I just get error messages.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1206331">
				<div id="div-comment-1206331" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Tomashu</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206331">
			September 2, 2015 at 10:02 am</a>		</div>

		<p>I was wondering why pasting %LOCALAPPDATA%/VirtualStore in explorer cause %LOCAL-­APP-­DATA%Virtual-­Store until I looked into source.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1206321">
				<div id="div-comment-1206321" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">JM</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206321">
			September 2, 2015 at 10:43 am</a>		</div>

		<p>Reading that article really hammers home just how many hoops the MS engineers had to jump through to transition from the &quot;software assumes everyone is running as an admin&quot; world to the &quot;let&#39;s actually start caring about security&quot; world. When people today complain about how Vista sucked, they probably don&#39;t appreciate that a certain level of suck was almost unavoidable to get to Windows 7 (disregarding for a moment how much exactly was unavoidable).</p>
<p>@Kevin, The MAZZter: the linked article explains exactly when virtualization happens: &quot;for the purposes of this virtualization, Windows Vista treats a process as legacy if it’s 32-bit (versus 64-bit), is not running with administrative rights, and does not have a manifest file indicating that it was written for Windows Vista&quot;. No shims are necessary, all 32 bit pre-Vista apps are assumed to require this redirection. So yes, if &quot;the customer&quot; was an end user who saved from an XP application while not elevated, this could happen, but I interpreted the story with &quot;the customer&quot; as an app developer who was saving files automatically. If an end user was the one affected, see &quot;unavoidable suckiness&quot; above.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1206311">
				<div id="div-comment-1206311" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jason</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206311">
			September 2, 2015 at 11:09 am</a>		</div>

		<p>&gt; I read:</p>
<p>&gt;</p>
<p>&gt; &quot;&#8230;applications which were not written properly, according to published Windows XP security guidelines, which repeatedly advised against storing user-modified data in system directories.&quot;</p>
<p>Besides user-modified data, programs would write to those locations to update components of themselves.</p>
<p>I&#39;m curious what Windows would do if the file in the real location became updated or replaced? Would it serve up the virtualized, old copy, or the newer real copy?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-andycadley2 even thread-even depth-1" id="comment-1206301">
				<div id="div-comment-1206301" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/AndyCadley' rel='external nofollow' class='url'>AndyCadley</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206301">
			September 2, 2015 at 12:18 pm</a>		</div>

		<p>@Jason:</p>
<p>UAC virtualization is disabled automatically for executables and dlls, so Windows will fail attempts to update them. For other types of file, such as config files, Windows will read the virtualized copy instead.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1206291">
				<div id="div-comment-1206291" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark Y</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206291">
			September 2, 2015 at 12:43 pm</a>		</div>

		<p>Does the button still exist in Win7? &nbsp;I just tried to go to such a directory and I see no button.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1206281">
				<div id="div-comment-1206281" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Sean</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206281">
			September 2, 2015 at 1:19 pm</a>		</div>

		<p>@Mark Y:</p>
<p>It&#39;s there, but only if there are files in the virtual store version of the directory.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1206271">
				<div id="div-comment-1206271" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">foo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206271">
			September 2, 2015 at 3:44 pm</a>		</div>

		<p>&gt; There used to be a button in Explorer called Compatibility Files</p>
<p>&lt;Mind blown&gt; I&#39;ve been using Win 7 for I don&#39;t know how long and never noticed that button (and yes it is in Win 7 as Sean says). Such a great feature I missed, since Win 10 will probably be happening for me in less than a month. For apps that used the virtual store (or ones I suspected of using it) I would always just navigate manually to the directory and see what was what. But in truth that was very rarely done. Still, me noticing the button up there would have been nice. But that area always held other buttons I scanned at once from right to left on some random folder (probably C root) and proceeded to not care about.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1206261">
				<div id="div-comment-1206261" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Cesar</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206261">
			September 2, 2015 at 6:55 pm</a>		</div>

		<p>@JM: &quot;for the purposes of this virtualization, Windows Vista treats a process as legacy if it’s 32-bit (versus 64-bit), is not running with administrative rights, and does not have a manifest file indicating that it was written for Windows Vista&quot;</p>
<p>&#8230;and is not called something like update.exe. At work, we had a problem because one executable had one of these &quot;magic&quot; names, which disabled that virtualization (no, it was not a setup-type program, it did something like connecting to the database and updating its data). The rest of the system had the virtualized view, that one executable didn&#39;t, and it broke things. I forgot the exact details, since it was a long time ago, but it was something like it trying to read files written by another executable &#8211; writes which got redirected to a hidden place, which update.exe couldn&#39;t see because the virtualization got disabled for it.</p>
<p>That executable was from before I arrived at that project; I fixed it by using a non-magic name for all executables, manifesting them to &quot;never elevate&quot; just to be sure, and by making things use the Application Data directory like they should have in the first place.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1206251">
				<div id="div-comment-1206251" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark Y</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206251">
			September 2, 2015 at 11:06 pm</a>		</div>

		<p>I can&#39;t find the button. &nbsp;Any pointers? &nbsp;What part of the screen? &nbsp;What color?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1206241">
				<div id="div-comment-1206241" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Neil</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206241">
			September 3, 2015 at 3:23 am</a>		</div>

		<p>Same here; if you start x86 WinDbg on x64 Windows 7 and use .symfix+ without specifying a download store, it will try to use C:Program Files (x86)Debugging Tools For Windows (x86)sym which promptly gets redirected to the virtual store, but there&#39;s no sign of a &quot;Compatibility Files&quot; button when you browse in Explorer.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1206231">
				<div id="div-comment-1206231" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dennis</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206231">
			September 3, 2015 at 3:31 am</a>		</div>

		<p>@Mark Y:</p>
<p>In the second &quot;menu bar&quot; besides &quot;Organize&quot;, &quot;New folder&quot; etc.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1206221">
				<div id="div-comment-1206221" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">metz2000</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206221">
			September 3, 2015 at 4:20 am</a>		</div>

		<p>@Kevin If the user navigates somewhere explicitly it&#39;s not a badly behaving program but &nbsp;badly behaving user.</p>
<p>However, if this is the default folder in Save as or Open dialogs then the program is bad. Many programs default to current directory and some even override the last used directory every time Save as or Open dialogs are used.</p>
<p>A good program would go with system default and wouldn&#39;t override last used folder. Or would default to My Document.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1206211">
				<div id="div-comment-1206211" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Macrosofter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206211">
			September 3, 2015 at 4:52 am</a>		</div>

		<p>&gt;There used to be a button in Explorer called Compatibility Files that appears if you are looking at a directory that has a corresponding Virtual Store, and clicking it takes you to that Virtual Store. The button was removed in Windows 8 based on telemetry feedback that showed that very nearly nobody ever clicked on it or even cared about it. </p>
<p>You imply that if people don&#39;t use the feature they don&#39;t need it. Alternate explanation can be that people don&#39;t know about it. The solution to this uncertainty would be to ask focus group to find files in virtual store and check percent of people who would use the dedicated button, then apply Bayes&#39; theorem to find percent of people who use the feature while they know about it. The solution to interface problem if it really exist can be an introduction of some indicator of existence of files in virtual store right in the address bar, combined with such button.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1206201">
				<div id="div-comment-1206201" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Deanna</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206201">
			September 3, 2015 at 4:52 am</a>		</div>

		<p>@Joshua regarding the policy switch. It is available per folder. Remove security on that folder, and access to that folder will no longer be virtualised.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1206141">
				<div id="div-comment-1206141" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Max</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206141">
			September 3, 2015 at 7:55 am</a>		</div>

		<p>@Macrosofter: It&#39;s more that if people don&#39;t use the feature, they aren&#39;t likely to miss it if it&#39;s removed. In addition, the feature&#39;s usefulness has declined significantly now that UAC has been in place for over 8 years. Dropping rarely-used features, regardless of why they&#39;re rarely-used, means dropping the significant support and maintenance cost associated with those features.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1206121">
				<div id="div-comment-1206121" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John Doe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206121">
			September 3, 2015 at 8:33 am</a>		</div>

		<p>@Anon, legacy here means 32-bit applications without a manifest, or without a valid supportedOS manifest element.</p>
<p>I agree the assumption is a bit too generalizing, there were lots of well behaved applications since Windows NT and Windows 2000, and quite a few ever since Windows 9x/ME gave place to Windows XP that did update themselves, all of which are considered legacy.</p>
<p>The thing is, probably the majority or the most used ones still stored things in the application&#39;s folder, usualy INI files and even documents (the open and save dialogs would be initialized with the application&#39;s folder instead of the user&#39;s documents folder or whatever was the most recently used one).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1206111">
				<div id="div-comment-1206111" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John Doe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206111">
			September 3, 2015 at 8:36 am</a>		</div>

		<p>@JM, this has been discussed before. &nbsp;It&#39;s not so much of a problem running as administrator if you&#39;re the single user of your machine.</p>
<p>In fact, if you get infected at user level, what really matters is still compromised and possibly lost: &quot;all your data are belong to us.&quot; &nbsp;The operating system itself, however, will be intact until some administrator logs on and gets inadvertently infected (e.g. a kernel font exploit or some Explorer preview exploit when viewing the folder that contains the malware), how good is that? </p>
<p>Much like a nuclear war would reap most of humanity off the face of the earth, but earth itself would probably even thank the disaster happened (those pesky parasitical humans!), even though other animals would be gone too, and lots of slowly decaying radiation would remain.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-wndsks even thread-even depth-1" id="comment-1206061">
				<div id="div-comment-1206061" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/skSdnW' rel='external nofollow' class='url'>skSdnW</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206061">
			September 3, 2015 at 1:46 pm</a>		</div>

		<p>@John Doe: The supportedOS element is not used on Vista, it probably checks for the requested execution level&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1206051">
				<div id="div-comment-1206051" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">JM</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206051">
			September 3, 2015 at 1:54 pm</a>		</div>

		<p>@John Doe: I couldn&#39;t disagree more.</p>
<p>If I hadn&#39;t been running as administrator, the PC I owned 10 years ago might still work &#8212; who knows? Sadly back then it was customary to run everything as administrator and restricted user accounts were something fancy you only used on servers, so the virus that flashed my BIOS into unusability had no trouble doing its work.</p>
<p>It&#39;s true that malware now focuses on screwing over your personal data more directly, ever since &quot;pwn the entire machine completely&quot; is no longer as simple as it was. (It&#39;s also true that the BIOS/UEFI in modern machines is no longer vulnerable in this way.) Does that mean defense in depth is not a valid concept? No, it doesn&#39;t.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1206041">
				<div id="div-comment-1206041" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">mikeb</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206041">
			September 3, 2015 at 4:32 pm</a>		</div>

		<p>I understand that there are various reasons (probably good and bad ones) for this behavior and how the Windows world got to the state where this was a problem, but as a user who encountered this scenario, it&#39;s very frustrating trying to find your files even if you have an inkling that they might have been &#39;virtualized&#39; to another location. This has only happened a handful of times tome, and I can&#39;t remember when the most recent was. But I do remember being quite irritated trying to find the damned things.</p>
<p>I don&#39;t recall ever seeing a &quot;Compatibility Files&quot; button. It may have showed up in Explorer (unless they removed it in Win7), but I probably just never noticed it because it would have never dawned on me what a &quot;compatibility file&quot; was. On the other hand, it&#39;s just as likely that I was using some other file manager than Explorer.</p>
<p>What I think would have been nice is if Explorer showed those virtualized files in a manner similar to how it shows files about to be written to a CD or files in different locations of the same &quot;Library&quot;. &nbsp;Then it would have been obvious that the file existed and was logically where it was supposed to be even if it was in a different actual location. But it sounds like there&#39;s little reason to make these UAC virtualized files easy to find since they don&#39;t seem to get created very much anymore.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cheong odd alt thread-odd thread-alt depth-1" id="comment-1206031">
				<div id="div-comment-1206031" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/cheong00' rel='external nofollow' class='url'>cheong00</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206031">
			September 3, 2015 at 6:32 pm</a>		</div>

		<p>Antonio &#39;Grijan&#39;: Agreed. And for those who actually required to care, they attempt to solve it in the wrong way.</p>
<p>I&#39;ve lose count on how many times I seen questions in MSDN forum asking how to run something as administrator without invoking UAC, and often what they&#39;re trying to do is something that do not require administrative access to complete if done correctly (say, write to correct directory, alter ACL of service to allow it be started by normal users, etc.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1206021">
				<div id="div-comment-1206021" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206021">
			September 3, 2015 at 8:19 pm</a>		</div>

		<p>@Deanna: Unfortunately we discovered in testing that works most of the time but not quite all of the time. It resisted bisection. Having learned that Windows checks for the virtualized file on open even if the folder has wide open permissions, I suspect that file locking was the issue, or perhaps something more insidious to track down.</p>
<p>(We have an application controlled temp directory with programmed wipes. It&#39;s under the installation directory because that&#39;s where this kind of thing went when the program was new and for three years the edict from management was turn off UAC since we discovered early on it worked just fine with UAC off but couldn&#39;t explain the behavior since it didn&#39;t track permissions 100% of the time.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-xpclientgmail-com odd alt thread-odd thread-alt depth-1" id="comment-1206001">
				<div id="div-comment-1206001" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/xpclient' rel='external nofollow' class='url'>xpclient</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1206001">
			September 4, 2015 at 5:33 am</a>		</div>

		<p>Another button &quot;View Remote Printers&quot; was removed in the move to the Ribbon. Was it removed due to telemetry again or forgotten?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1205921">
				<div id="div-comment-1205921" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John Doe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1205921">
			September 4, 2015 at 7:55 am</a>		</div>

		<p>@JM, we agree, then.</p>
<p>It&#39;s just that, to me, data is a priority. &nbsp;When you have to start somewhere, first deal with protecting confidential data and ensuring regular backups of crucial data. &nbsp;If that means you have to harden a server&#39;s security from top to bottom, so be it, but I&#39;d first start with data protection (e.g. PCI compliance, properly hashed passwords), access control, authentication, forced encrypted communications, logging, etc. and only them go down the rabbit&#39;s hole: firewall, IDS, throttling, antivirus, etc.</p>
<p>In terms of single-worker workstations, no matter how your machine is hardened, you should have a plan to protect your data: encrypted storage and/or scheduled backups.</p>
<p>I&#39;m not advocating anyone to run everything as administrator or to disable UAC, or to not have protection at every layer. &nbsp;It&#39;s just that most people get the wrong impression that they&#39;re protected relying solely on these lower-level measures. &nbsp;Yes, you&#39;re more protected, but never really, completely protected. &nbsp;Have your own measures on top of the low-level ones, one thing that is not easily restoreable is data. &nbsp;You may consider configurations and active directory as data too.</p>
<p>Hell, think about ̶s̶m̶u̶g̶ ̶a̶f̶i̶c̶i̶o̶n̶a̶d̶o Mac users who say it doesn&#39;t have viruses and it&#39;s totally safe. &nbsp;I say it&#39;s mostly due to the lack of popularity and interest. &nbsp;Several 0-day exploits for two popular browser plug-ins (say, one with the same name as a comic book hero, and one named after a coffee origin island) have kind of proven that it&#39;s not safer at all.</p>
<p>It happens to their own software too, but Apple&#39;s secrecy policy and/or shame on their bugs (yes, even ones not related to security) results in not being able to detect duplicate bugs or track existing ones.</p>
<p>Look at how recent these news are, it&#39;s not last year&#39;s news. &nbsp;ASLR, pseudo-UAC and a few other things don&#39;t protect you from any of this, just about the same kind of exploits targeting Windows. &nbsp;My dark side (do I have any other?) just keeps hoping OS X gets more popular so it gets more malware too.</p>
<p>But I digress. &nbsp;Just to show that relying on the library or OS or below alone is relying on quick-sand.</p>
<p>TL;DR: (I think this is hip, right? &nbsp;Oh, it&#39;s not hip to say something is hip, so I just de-hipped this)</p>
<p>Don&#39;t forget to protect your data.</p>
<p>Protect your data above all.</p>
<p>You never know in which layer the next hole will be, but wherever it&#39;ll be, data is always compromised.</p>
<p>Defense in depth? &nbsp;Yes.</p>
<p>Defense in depth solely at AD/API/AV/OS/network level and below? &nbsp;A delusion.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1205911">
				<div id="div-comment-1205911" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John Doe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1205911">
			September 4, 2015 at 8:03 am</a>		</div>

		<p>A few links, as my previous comment was deemed spam with them:</p>
<p>Regarding 0-day exploits: arstechnica.com/security/2015/07/two-new-flash-exploits-surface-from-hacking-team-combine-with-java-0-day/</p>
<p>Regarding bug report secrecy: stackoverflow.com/questions/144873/can-i-browse-other-peoples-apple-bug-reports</p>
<p>The promoted comments here are quite interesting: &nbsp;arstechnica.com/security/2015/08/0-day-bug-in-fully-patched-os-x-comes-under-active-exploit-to-hijack-macs/</p>
<p>Regarding pseudo-UAC: <a href="http://www.symantec.com/connect/blogs/mac-os-x-dialog-box-spoofing-believe-me-i-m-system-preferences" rel="nofollow">http://www.symantec.com/connect/blogs/mac-os-x-dialog-box-spoofing-believe-me-i-m-system-preferences</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1205831">
				<div id="div-comment-1205831" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">JM</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681#comment-1205831">
			September 4, 2015 at 11:02 am</a>		</div>

		<p>@John Doe: Kudos for going above and beyond the call on this one. Consider posting it on your own blog, or starting one if you don&#39;t have one yet. I think it could pay off.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

