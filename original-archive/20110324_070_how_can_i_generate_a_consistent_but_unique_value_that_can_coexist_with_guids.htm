<html>
<head>
<title>How can I generate a consistent but unique value that can coexist with GUIDs?</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>How can I generate a consistent but unique value that can coexist with GUIDs?</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>March 24, 2011 / year-entry #71</td></tr>
<tr><td><b>Tags:</b></td><td>other</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>18</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">A customer needed to generate a GUID for each instance of a hardware device they encounter: The serial number for each device is 20 bits long (four and a half bytes). We need to generate a GUID based on each device, subject to the constraints that when a device is reinserted, we generate the same...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>A customer needed to generate a GUID for each instance of a hardware device they encounter:</p>
<blockquote class="q"><p> The serial number for each device is 20 bits long (four and a half bytes). We need to generate a GUID based on each device, subject to the constraints that when a device is reinserted, we generate the same GUID for it, that no two devices generate the same GUID, and that the GUIDs we generate not collide with GUIDs generated by other means. One of our engineers suggested just running <code>uuidgen</code> and substituting the serial number for the final nine hex digits. Is this a viable technique? </p>
</blockquote>
<p> This is similar to the trap of thinking that <a href="http://blogs.msdn.com/oldnewthing/archive/2008/06/27/8659071.aspx"> half of a GUID is just as unique as the whole thing</a>. Remember that all the pieces of a GUID work together to establish uniqueness. If you just take parts of it, then the algorithm breaks down. </p>
<p> For this particular case, you're in luck. The classic Type&nbsp;1 GUID uses 60 bits to encode the timestamp and 48 bits to identify the location (computer). You can <a href="http://blogs.msdn.com/b/oldnewthing/archive/2004/02/11/71307.aspx"> take a network card, extract the MAC address, then smash the card with a hammer</a>. Now you have a unique location. Put your twenty bits of unique data as the timestamp, and you have a Type&nbsp;1 GUID that is guaranteed never to collide with another GUID. </p>
<p> If you have more than 60 bits of unique data, then this trick won't work. Fortunately, <a href="http://www.apps.ietf.org/rfc/rfc4122.html">RFC4122</a> explains how to create a so-called <i>name-based UUID</i>, which is a UUID that can be reliably regenerated from the same source data. <a href="http://www.apps.ietf.org/rfc/rfc4122.html#sec-4.3"> Section 4.3 explains how it's done</a>. The result is either a <a href="http://www.apps.ietf.org/rfc/rfc4122.html#sec-4.1.3"> type&nbsp;3 or type&nbsp;5 UUID</a>, depending on which variant of the algorithm you chose. </p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (18)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-903103">
				<div id="div-comment-903103" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Falcon</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903103">
			March 24, 2011 at 7:12 am</a>		</div>

		<p>&quot;You can take a network card, extract the MAC address, then smash the card with a hammer. Now you have a unique location.&quot;</p>
<p>To be on the safe side, buy a brand new card for this purpose &#8211; hopefully, it&#39;s MAC address has never been used to generate a GUID. Then, to get more value for your money, find a creative way to destroy the card and film it!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-903123">
				<div id="div-comment-903123" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Stephen Cleary</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903123">
			March 24, 2011 at 7:33 am</a>		</div>

		<p>Or just use a crypto-random MAC address with the broadcast bit set (no need to destroy hardware). I&#39;d recommend the name-based approach, though. Easier to clean up afterwards.</p>
<p><a rel="nofollow" target="_new" href="http://nitoprograms.blogspot.com/2010/11/few-words-on-guids.html" rel="nofollow">nitoprograms.blogspot.com/&#8230;/few-words-on-guids.html</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-joshuaganes even thread-even depth-1" id="comment-903133">
				<div id="div-comment-903133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Joshua+Ganes' rel='external nofollow' class='url'>Joshua Ganes</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903133">
			March 24, 2011 at 7:34 am</a>		</div>

		<p>The customer requirements don&#39;t give me enough information to confirm or deny whether an alternative approach would work. The fact that they are generating a GUID for a (supposedly) already unique serial number seems a bit strange to me. It is not clear what purpose this will serve.</p>
<p>I would suggest storing a mapping from serial number to a GUID in a database. When looking up a device, you can find its GUID very simply by querying the database. If no entry exists, simply generate a new one.</p>
<div class="post">[<i>That introduces race conditions and coherency issues. Oh, and component in question happens to be a kernel mode driver, so it&#39;s not like you can load up SQL Server. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-903143">
				<div id="div-comment-903143" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">laonianren</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903143">
			March 24, 2011 at 7:39 am</a>		</div>

		<p>&quot;20 bits long (four and a half bytes)&quot;</p>
<p>What is the C language octadecimal prefix?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-903163">
				<div id="div-comment-903163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Brian</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903163">
			March 24, 2011 at 8:03 am</a>		</div>

		<p>@Joshua: What if the hardware device is used on different machines, all of which must generate the same Guid but which are not always in communication with each other or a database?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-903173">
				<div id="div-comment-903173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Barbie</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903173">
			March 24, 2011 at 8:03 am</a>		</div>

		<p>Ah if only MACs were really unique&#8230; (e.g. &lt;<a rel="nofollow" target="_new" href="http://forum-en.msi.com/index.php?topic=134964.0&gt;" rel="nofollow">forum-en.msi.com/index.php</a>). It&#39;s pretty sad to see NIC providers mess that tenet up.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-joshuaganes even thread-even depth-1" id="comment-903183">
				<div id="div-comment-903183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Joshua+Ganes' rel='external nofollow' class='url'>Joshua Ganes</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903183">
			March 24, 2011 at 8:36 am</a>		</div>

		<p>@Brian: Precisely. That&#39;s why I can&#39;t confirm the alternative approach based on the current information. I always prefer the simple approach to the complicated one. The question still remains &#8212; why can&#39;t they just use the serial number as a unique identifier?</p>
<div class="post">[<i>The context here is a driver for a PnP device, and I&#39;m assuming that Windows wants PnP devices to be assigned a unique GUID. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-903193">
				<div id="div-comment-903193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">acq</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903193">
			March 24, 2011 at 8:37 am</a>		</div>

		<p>@Brian: the customer is in control of the process, he can write the software which gives guid based on the inserted hardware. &quot;Access to the database&quot; in a sense &quot;connect to SQL server&quot; is just not needed. The question was simply how they can produce always the same &quot;guid&quot; (128 bits) from the fixed 20 bits they have (map their 20 bits to the 128 bits that are then unique GUID).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-joshuaganes even thread-even depth-1" id="comment-903203">
				<div id="div-comment-903203" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Joshua+Ganes' rel='external nofollow' class='url'>Joshua Ganes</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903203">
			March 24, 2011 at 8:47 am</a>		</div>

		<p>Raymond, thanks for the additional context information. When you can, do it simple. When you can&#39;t, listen to Raymond Chen.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-903213">
				<div id="div-comment-903213" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">blah</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903213">
			March 24, 2011 at 9:41 am</a>		</div>

		<p>20 bits is 2.5 bytes.</p>
<div class="post">[<i>I&#39;m better at math than arithmetic. Didn&#39;t occur to me that I&#39;d have to check the customer&#39;s arithmetic too. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-maurits even thread-even depth-1" id="comment-903223">
				<div id="div-comment-903223" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Maurits+%5BMSFT%5D' rel='external nofollow' class='url'>Maurits [MSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903223">
			March 24, 2011 at 9:46 am</a>		</div>

		<p>Isn&#39;t everyone using Type 4 GUIDs nowadays? &nbsp;The replace-the-last-20-bits technique should work just fine for those.</p>
<div class="post">[<i>No, because that&#39;s not random any more. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-maurits odd alt thread-odd thread-alt depth-1" id="comment-903243">
				<div id="div-comment-903243" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Maurits+%5BMSFT%5D' rel='external nofollow' class='url'>Maurits [MSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903243">
			March 24, 2011 at 12:09 pm</a>		</div>

		<p>True, replacing the last 20 bits of a type 4 GUID does not preserve the type 4-ness of the GUID.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-903253">
				<div id="div-comment-903253" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903253">
			March 24, 2011 at 2:00 pm</a>		</div>

		<p>@Falcon after filming it, upload the video to youtube and take the unique video id and append it to your guid!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-903273">
				<div id="div-comment-903273" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mike Dunn</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903273">
			March 24, 2011 at 6:27 pm</a>		</div>

		<p>The &quot;smash a NIC with a hammer&quot; story is one of my favorite stories ever.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-903283">
				<div id="div-comment-903283" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">NL</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903283">
			March 24, 2011 at 9:59 pm</a>		</div>

		<p>Manufacturers re-use Mac addresses. &nbsp;It is therefore not precisely unique.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-903313">
				<div id="div-comment-903313" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dmitry Kolosov</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903313">
			March 25, 2011 at 4:03 am</a>		</div>

		<p>&quot;take a network card, extract the MAC address, then smash the card with a hammer&quot;</p>
<p>Is there a way to find out which one of my three network cards (two Ethernet adapters, one WiFi) I should destroy?</p>
<p>By the way, can&#39;t you fake a card&#39;s MAC address programmatically?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-903333">
				<div id="div-comment-903333" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">pkorona</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903333">
			March 25, 2011 at 4:18 am</a>		</div>

		<p>UUIDGEN will also produce a range of sequential GUIDs. You can use that to provide a base address for SN#0.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-903823">
				<div id="div-comment-903823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Stephen Cleary</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110324-00/?p=11143#comment-903823">
			March 28, 2011 at 7:56 am</a>		</div>

		<p>@pkorona:</p>
<p>Sorry, but that approach won&#39;t work. It is very wrong, in fact.</p>
<p>A quote from the link I posted above: &quot;Sequential GUIDs are not actually sequential. In normal circumstances, GUIDs being generated by the same computer will have gradually increasing Timestamp fields (with the other fields remaining constant). However, the Timestamp field is not in the least-significant bit positions of the GUID, so if the GUID is treated as a 128-bit number, it does not actually increment.&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

