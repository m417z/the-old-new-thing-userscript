<html>
<head>
<title>When people ask for security holes as features: World-writable files</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>When people ask for security holes as features: World-writable files</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>November 22, 2004 / year-entry #400</td></tr>
<tr><td><b>Tags:</b></td><td>history;when-people-ask-for-security-holes-as-features</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>39</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">If I had a nickel each time somebody asked for a feature that was a security hole... I'd have a lot of nickels. For example, "I want a file that all users can write to. My program will use it as a common database of goodies." This is a security hole. For a start, there's...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>If I had a nickel each time somebody asked for a feature that was a security hole...</p>
<p> I'd have a lot of nickels. </p>
<p> For example, "I want a file that all users can write to. My program will use it as a common database of goodies." </p>
<p> This is a security hole. For a start, there's an obvious denial of service attack by having a user open the file in exclusive mode and never letting go. There's also a data tampering attack, where the user opens the file and write zeros all over it or merely alter the data in subtle ways. Your music index suddenly lost all its Britney Spears songs. (Then again, maybe that's a good thing. Sneakier would be to edit the index so that when somebody tries to play a Britney Spears song, they get Madonna instead.) [Minor typo fixed. 10am] </p>
<p> A colleague from the security team pointed out another problem with this design:  Disk quotas.  Whoever created the file is charged for the disk space consumed by that file, even if most of the entries in the file belong to someone else. If you create the file in your Setup program, then it will most likely be owned by an administrator.  Administrators are exempt from quotas, which means that everybody can party their data into the file for free!  (Use alternate data streams so you can store your data there without affecting normal users of the file.) And if the file is on the system partition (which it probably is), then users can try to fill up all the available disk space and crash the system. </p>
<p> If you have a shared resource that you want to let people mess with, one way to do this is with a service.  Users do not access the resource directly but rather go through the service. The service decides what the user is allowed to do with the resource.  Maybe some users are permitted only to increment the "number of times played" counter, while others are allowed to edit the song titles. If a user is hogging the resource, the server might refuse connections for a while from that user. </p>
<p> A file doesn't give you this degree of control over what people can do with it. If you grant write permission to a user, then that user can write to <strong>any</strong> part of the file. The user can open the file in exclusive mode and prevent anybody else from accessing it. The user can put fake data in the file in an attempt to confuse the other users on the machine. </p>
<p> In other words, the user can make a change to the system that impacts how other users can use the system.  This sort of "impact other users" behavior is something that is reserved for administrators. An unprivileged user should be allowed only to mess up his own life; he shouldn't be allowed to mess up other users' lives. </p>
<p> Armed with this information, perhaps now you can answer <a href="http://groups.google.com/groups?selm=79f67ea0.0408100746.393fc613@posting.google.com"> this question posted to comp.os.ms-windows.programmer a few months ago</a>. </p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (39)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-228503">
				<div id="div-comment-228503" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://davidcrowell.com' rel='external nofollow' class='url'>David Crowell</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228503">
			November 22, 2004 at 7:42 am</a>		</div>

		<p>Sounds like an Access database on a file share to me  :)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-228513">
				<div id="div-comment-228513" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Svend</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228513">
			November 22, 2004 at 8:01 am</a>		</div>

		<p>People are lazy.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-228523">
				<div id="div-comment-228523" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mike Raiford</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228523">
			November 22, 2004 at 8:07 am</a>		</div>

		<p>&quot;Armed with this information, perhaps now you can answer this question posted to comp.os.ms-windows.programmer a few months ago.&quot; </p>
<p>Mhmmph. This is a dumb question. The poster really should have reexamined his horribly flawed design in the first place. Even without reading this article, I could see this is a dumb idea. </p>
<p>The common settings can be set by an administrative user, Whereas each individual user can customise those settings(saving their changes in HKCU) </p>
<p>This way, they change things to their preferences while not affecting every single other user.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-228533">
				<div id="div-comment-228533" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">SR</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228533">
			November 22, 2004 at 8:19 am</a>		</div>

		<p>The obvious answer to that question is to make all your users members of the Administrators (or Domain Admins) group ;-)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-228543">
				<div id="div-comment-228543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Cooke</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228543">
			November 22, 2004 at 9:06 am</a>		</div>

		<p>Like, DUH!</p>
<p>;)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-228563">
				<div id="div-comment-228563" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.codeproject.com/script/articles/list_articles.asp?userid=152' rel='external nofollow' class='url'>Mike Dunn</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228563">
			November 22, 2004 at 9:58 am</a>		</div>

		<p>OTOH, the developer isn&#8217;t thinking like a hacker and doesn&#8217;t intend to do harm, which is good.<br />
<br />OTOH, the developer isn&#8217;t thinking like a hacker and won&#8217;t write his code to be safe against hacking attempts, which is bad.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-228593">
				<div id="div-comment-228593" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">A</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228593">
			November 22, 2004 at 10:46 am</a>		</div>

		<p>Not only can one user corrupt a world-writable file at will, they can do it in a way that exploits a buffer overflow bug in the application, and use this as a way to gain control of other users&#8217; accounts.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-228603">
				<div id="div-comment-228603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Brent Dax</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228603">
			November 22, 2004 at 12:11 pm</a>		</div>

		<p>OTOH, there are environments where you don&#8217;t care about security.  My machine runs XP Home; I use one of three user accounts, depending on what I&#8217;m doing, so that I don&#8217;t get distracted by games while programming (for example).  I share my music across all three users by putting all of my music in Shared Documents and setting up a junction point (like a symbolic link on Unix, but works on NTFS) for each user.  My media player stores its database in a couple files in a subdirectory of My Music, so the index is shared too.  It&#8217;s a bit hackish, but it works.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-228553">
				<div id="div-comment-228553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://briandela.com/blog/archive/2004/11/22/152.aspx' rel='external nofollow' class='url'>Dela's Ramblings</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228553">
			November 22, 2004 at 12:13 pm</a>		</div>

		
		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-228613">
				<div id="div-comment-228613" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://jameskew.blogspot.com' rel='external nofollow' class='url'>James Kew</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228613">
			November 22, 2004 at 12:23 pm</a>		</div>

		<p>// My media player //</p>
<p>iTunes? I use the same junction-point hack to share its library between the 2 users on my machine.</p>
<p>I suspect though that even on a home machine with known users you still want to protect users from each other: who knows what nasty executables the wife/kids/friends/whoever have let in?<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-228623">
				<div id="div-comment-228623" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ac</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228623">
			November 22, 2004 at 1:22 pm</a>		</div>

		<p>Someone should have told Microsoft&#8230;</p>
<p>Most of the folders under &quot;Documents and SettingsAll Users&quot; are writable by all users (on my default installations of 2000 &amp; XP Professional). If we drill down to &quot;Documents and SettingsAll UsersApplication DataMicrosoft&quot; we find several programs with a &quot;common database of goodies&quot;.</p>
<p>&gt;&gt; Armed with this information, perhaps now you can answer this question posted to comp.os.ms-windows.programmer a few months ago. &lt;&lt;</p>
<p>If you&#8217;re sure of the security consequences, look up SetNamedSecurityInfo().</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-228643">
				<div id="div-comment-228643" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Cooke</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228643">
			November 22, 2004 at 2:57 pm</a>		</div>

		<p>ac,</p>
<p>On the (relatively uncustomized) Windows 2000 box I use at work, both the &quot;All Users&quot; directory and the specific directory you mentioned are writable only to members of the Administrators and Power Users groups. The group &quot;Everyone&quot; and the group &quot;Users&quot; have access to read, execute and list folder contents.</p>
<p>If you&#8217;ve got all of your users in the administrative and power users groups then you obviously don&#8217;t care much about security.</p>
<p>Brent,</p>
<p>Although Microsoft saw fit to hide the pretty security customization UI in Windows XP Home the command-line tool cacls (&quot;Change Access Lists&quot;, I think) is still available, so you can give all three of your users write access to that specific file or directory. I&#8217;ve had to use this utility several times to help those who were foolish enough to purchase this cripped version of Windows to run old budget games which expect to be able to write to directories under &quot;Program Files&quot;. (Fortunately, they aren&#8217;t foolish enough to perform everyday tasks as a user with Administrator privs.)<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-228653">
				<div id="div-comment-228653" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dustin Fraze</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228653">
			November 22, 2004 at 3:07 pm</a>		</div>

		<p>Correct me if I&#8217;m wrong, but won&#8217;t disabling Simple File Sharing in WinXP home allow the ACLs to reappear in the properties menu on the object, undermining the usage of cacls?</p>
<p>Why use an advanced, and widely unknown structure such as a junction point when just making the ACLs appear would do the job, and probably a lot better?<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-228663">
				<div id="div-comment-228663" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">A</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228663">
			November 22, 2004 at 3:11 pm</a>		</div>

		<p>It&#8217;s true that on Windows 2000 &quot;All Users&quot; is restricted to Administrators &amp; Power Users, but on Windows XP they relaxed the permissions so that Users can now write to &quot;Application Data&quot;.</p>
<p>I don&#8217;t like it either&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-228673">
				<div id="div-comment-228673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">B.Y.</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228673">
			November 22, 2004 at 3:38 pm</a>		</div>

		<p>Security is not everything, it&#8217;s simply not an issue for some applications.</p>
<p>I can see for many custom apps for small teams working on the same LAN, security/disk quotas are not issues people need worry about. Convenience and speed of development are far more important.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-228713">
				<div id="div-comment-228713" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anonymous Coward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228713">
			November 22, 2004 at 4:49 pm</a>		</div>

		<p>B.Y.: Hope you application breaks when Windows locks down more features in the future. Read &quot;Writing Secure Code&quot; dude, you&#8217;re obviously a newby!</p>
<p>Newsgroup poster: that&#8217;s why outsourcing is never really a good idea. :)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-228723">
				<div id="div-comment-228723" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Pavel Lebedinsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228723">
			November 22, 2004 at 5:19 pm</a>		</div>

		<blockquote><p>
  For a start, there&#8217;s an obvious denial of service attack by having a user open the file in exclusive mode and never letting go.</p>
<p>You can open a file in exclusive mode even if you only have read access. Short of rearchitecting file locking in Windows, there is nothing that can be done to prevent local DoS attacks like this one.
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-228733">
				<div id="div-comment-228733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228733">
			November 22, 2004 at 6:00 pm</a>		</div>

		<p>I think the environment where the user wanted this kind of almost wide-open access is similar to one where coworkers can look at each other&#8217;s desks and can even open each other&#8217;s desk drawers.  If they abuse the capability then they should expect to get fired.  Maybe this almost wide-open access is no worse than the presence of the computers already in that environment.</p>
<p>Of course it still would be dangerous to make it completely open.  You don&#8217;t want to let every infected machine on the internet come in and write your files.  This is why in Windows XP &quot;everyone&quot; doesn&#8217;t mean &quot;everyone&quot; any more, right?</p>
<p>If &quot;everyone&quot; access to a folder isn&#8217;t adequate for some reason, then the folder could be put on a FAT partition.  Or the share could be put on a Windows 98 machine but that would be an act of desperation.</p>
<p>Of course you wouldn&#8217;t want to trust other machines on your LAN in a hotel room or restaurant or train station the way you might in your office.  And even in your office you wouldn&#8217;t put that shared folder on a domain server or firewall server, you&#8217;d only put it on a file server.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-228743">
				<div id="div-comment-228743" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Rabbit</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228743">
			November 22, 2004 at 6:28 pm</a>		</div>

		<p>A:  What are you talking about?  Both my home and work Windows XP machines have %HOMEDRIVE%Documents and SettingsAll Users set for read-only access to non-power users.  This would appear to be the default.</p>
<p>Try it:<br />
<br />cacls &quot;%HOMEDRIVE%Documents and SettingsAll Users&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-228683">
				<div id="div-comment-228683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://briandela.com/blog/archive/0001/01/01/152.aspx' rel='external nofollow' class='url'>Dela's Ramblings</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228683">
			November 22, 2004 at 6:45 pm</a>		</div>

		
		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-228763">
				<div id="div-comment-228763" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Pavel Lebedinsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228763">
			November 22, 2004 at 8:30 pm</a>		</div>

		<p>A: the DACL you listed doesn&#8217;t allow a limited user to modify files created by somebody else (note that the write ACE for Users is Container Inherit only &#8211; it doesn&#8217;t apply to files).</p>
<p>The end result of this is that anybody can create files and folders under All UsersApplication Data but only file owners, admins and power users can modify them.</p>
<p>%systemroot%temp is another world-writable place, and it also has a DACL that serves similar purpose: allow all users to create temp files but don&#8217;t allow one user to read or modify files created by somebody else.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-228773">
				<div id="div-comment-228773" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Vorn</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228773">
			November 22, 2004 at 8:41 pm</a>		</div>

		<p>surprisingly, some well-respected internet applications depend on being world-writable: <a target="_new" href="http://www.wikipedia.org" rel="nofollow">http://www.wikipedia.org</a> , for instance.</p>
<p>Vorn</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-228783">
				<div id="div-comment-228783" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">A</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228783">
			November 22, 2004 at 9:01 pm</a>		</div>

		<p>&quot;The end result of this is that anybody can create files and folders&quot;</p>
<p>That&#8217;s correct, but therein lies the security hole&#8230;</p>
<p>Say a user has advance knowledge that a privileged process (e.g. an installer run by an administrator) is going to create and access a particular folder under All UsersApplication Data. That user could pre-create the folder using his account. He will then able to delete any files in the folder &#8212; including those owned by other users &#8212; and re-create them with malicious contents if he so desires.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-228793">
				<div id="div-comment-228793" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Pavel Lebedinsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228793">
			November 22, 2004 at 11:29 pm</a>		</div>

		<p>Yes but the same thing can happen when installing for example to the root of a drive. So All UsersApplication Data is not particularly special in this regard.</p>
<p>If you&#8217;re installing something outside of %programfiles% then I think it is the installer&#8217;s responsibility to check for things like this. For example it could fail if the directory exists and is owned by somebody other than BUILTINAdministrators or current user.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-228693">
				<div id="div-comment-228693" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Cooke</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228693">
			November 22, 2004 at 4:07 pm</a>		</div>

		<p>Dustin,</p>
<p>As far as I remember, disabling &quot;Simple File Sharing&quot; enables the security settings dialog for the *shares* but does not provide access to the filesystem-level permissions.</p>
<p>Since the filesystem permissions trump the share permissions, and the share permissions only apply when accessing the share anyway, that&#8217;s useful only for adding stronger rules, not for relaxing security.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-228703">
				<div id="div-comment-228703" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Cooke</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228703">
			November 22, 2004 at 4:14 pm</a>		</div>

		<p>Given that it&#8217;s always possible to relax security at the system level, usually by either giving users higher system priviledges or by adjusting permissions on particular directories and files, I don&#8217;t mind that Windows allows me to make this *not* work. If I was developing a quick tool in a hurry I could just allow all users to write to the file in question, assuming I didn&#8217;t care about security. I could also pick a subset of all users who could write to the file, so that only those users who are trusted can access it.</p>
<p>Additionally, the newsgroup poster that Raymond linked to could make use of the registry permissions in Windows NT to achieve his end while still retaining the ability to restrict access at the user level.</p>
<p>In all situations where you could argue that relaxed security would make life easier, that relaxed security is available so long as you have the rights to enable it, and it&#8217;s granular enough that you have more options than just &quot;All users can do x&quot;. If you don&#8217;t have the rights to enable it, then tough! :)<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-228753">
				<div id="div-comment-228753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">A</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228753">
			November 22, 2004 at 7:45 pm</a>		</div>

		<p>To clarify, &quot;Application Data&quot; and few other folders *under* All Users can be written to by Users, not All Users itself.</p>
<p>On a clean install of XP, cacls &quot;C:Documents and SettingsAll UsersApplication Data&quot; yields:</p>
<p>NT AUTHORITYSYSTEM:(OI)(CI)F<br />
<br />BUILTINAdministrators:(OI)(CI)F<br />
<br />CREATOR OWNER:(OI)(CI)(IO)F<br />
<br />BUILTINPower Users:(OI)(CI)C<br />
<br />BUILTINUsers:(OI)(CI)R<br />
<br />BUILTINUsers:(CI)(special access:)<br />
<br />                  FILE_WRITE_DATA<br />
<br />                  FILE_APPEND_DATA<br />
<br />                  FILE_WRITE_EA<br />
<br />                  FILE_WRITE_ATTRIBUTES</p>
<p>Curiously, the Microsoft subdirectory of Application Data has a different set of permissions defined on it that do NOT grant Users any write access. So the permissions we see here are only applicable to non-Microsoft programs.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-228813">
				<div id="div-comment-228813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">DrPizza</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228813">
			November 23, 2004 at 5:24 am</a>		</div>

		<p>Junction points are not like symlinks because they have TRULY SHITTY deletion semantics.</p>
<p>Delete a symlink, bye bye symlink.</p>
<p>Delete a junction point, bye bye data.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-228823">
				<div id="div-comment-228823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://en.wikipedia.org/wiki/User:Jamesday' rel='external nofollow' class='url'>James Day</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228823">
			November 23, 2004 at 5:41 am</a>		</div>

		<p>Wikipedia is almost world writable.</p>
<p>We have firewalled certain IP addresses and certain content across all projects (unruly crawlers mainly) and many more IPs are blocked on a per-project basis for content/ behavior reasons. We also block untrusted accounts from changing certain pages in certain ways. World writable is a handy tool but it does have its challenges, particularly with 250,000 changes per week, 20% of them from people with no account.</p>
<p>The last I&#8217;d heard, Ward Cunningham, known for creating the wiki concept,  was a Microsoft employee now.</p>
<p>I&#8217;m one of the root admins on the Wikimedia/ Wikipedia servers. Figures for 7 days preceding this post, English language encyclopedia only.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-228933">
				<div id="div-comment-228933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Cooke</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228933">
			November 23, 2004 at 7:57 am</a>		</div>

		<p>Wikipedia uses a mechanism much like the &quot;service&quot; approach that Raymond described. Random users aren&#8217;t allowed to go and party on the data files; instead, they must go through a defined protocol interface which decides what they are allowed to do.</p>
<p>Wikipedia won&#8217;t let me go in and corrupt the database, and as James Day said certain pages can&#8217;t be changed by certain people.</p>
<p>As for deleting junction points, I think the problem is that the application-level tools aren&#8217;t aware of the junction point in the filesystem underneath. When Windows Explorer deletes a directory, it doesn&#8217;t just make an unlink (or equivilent) call on that directory because it knows it can&#8217;t delete non-empty directores that way, so it automatically recurses inside and deletes the contents.</p>
<p>This problem doesn&#8217;t occur on UNIX because the applications know about symlinks, and the rm and rmdir commands just make one syscall to remove that one item, unless of course you specify &quot;rm -r&quot;, but then it can tell the difference between a directory symlink and a plain old directory.</p>
<p>I&#8217;m not sure if there are any calls that can be made on Windows to discover if a particular directory is a junction point, but if there are then Explorer should be extended to make such calls before deleting.</p>
<p>However, there are lots of other braindead apps which just blindly drill down through directory junctions; I have much of my second partition junctioned into places on my first partition (I&#8217;m a UNIX boi and I don&#8217;t much like having my data separated by an arbitrary distinction like what partition they are on. Sorry!) and there are plenty of apps which will just blindly recurse over the entire filesystem and then go ahead and do it again when they visit the other partition. Unfortunately, Windows comes with the heritage of having a really simple filesystem, so application programmers aren&#8217;t used to thinking about these kinds of issues. This isn&#8217;t really something that can be easily fixed, which is probably why there is no &quot;easy&quot; way to make a directory junction point.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-228983">
				<div id="div-comment-228983" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">A</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-228983">
			November 23, 2004 at 9:11 am</a>		</div>

		<blockquote><p>
  I&#8217;m not sure if there are any calls that can be made on Windows to discover if a particular directory is a junction point</p>
<p>All it takes is:</p>
<p>GetFileAttributes(DirectoryName) &amp; FILE_ATTRIBUTE_REPARSE_POINT
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-229123">
				<div id="div-comment-229123" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Stefan Kanthak</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-229123">
			November 23, 2004 at 6:21 pm</a>		</div>

		<p>Re: for the junctions and the ill beaving explorer: have a look at the shell extension &quot;NTFS Link&quot; on <a target="_new" href="http://www.elsdoerfer.net/" rel="nofollow">http://www.elsdoerfer.net/</a> which handles deletion and copying through a copyhook handler.</p>
<p>Re: for the world-writeable files Microsoft creates beneath %AllUsersProfile%: since NT RAS uses a world-writeable file RASPHONE.PBK to store connection data for dialup.<br />
<br />The phone numbers go there too, making it the ideal place for dialers to implant themselves!<br />
<br />I&#8217;d expect that about 10 years with NT should suffice to close this hole!<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-230533">
				<div id="div-comment-230533" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.scarydevil.com/~peter/' rel='external nofollow' class='url'>Peter da Silva</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-230533">
			November 26, 2004 at 12:55 pm</a>		</div>

		<p>Giving people a file to use as a dropbox is probably a bad idea. Giving them a directory, though, should be OK if the permissions on the directory are set so they can create new files but not deleet or modify other people&#8217;s files.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-232393">
				<div id="div-comment-232393" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">lobber</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-232393">
			December 5, 2004 at 1:36 pm</a>		</div>

		<p>&quot;Armed with this information, perhaps now you can answer this question posted to comp.os.ms-windows.programmer a few months ago.&quot;  perhaps not.  the question is specifically about a common area in the registry.  i don&#8217;t know what kind of quotas you can set on registry entries, but in any case i imagine that it&#8217;s a whole set of different problems than for the file system.</p>
<p>certainly the answer shouldn&#8217;t be &quot;why the hell do you want to share data between users?  what is wrong with you, don&#8217;t you know anything about security?&quot;</p>
<p>the real answer is: &quot;hi. here at microsoft we&#8217;ve managed to come up with the most labyrinthine morass of apis and specs ever.  we can&#8217;t possibly start from scratch and &quot;do it right&quot; the first time.  so when there is a question like yours, we choose the option that provides the most profit for the least amount of effort.  in your case our answer is: &#8216;these are not the features you are looking for.&#8217;  you are wrong for wanting them.  please buy one of our many microsoft press paperweights to determine what you should do instead. (and hope that you find the right book and that what you find works on most of the win32 variations that exist, which it probably doesn&#8217;t.)&quot;</p>
<p>no offense to Raymond who&#8217;s obviously doing his best, which is pretty damned good.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-232433">
				<div id="div-comment-232433" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-232433">
			December 5, 2004 at 2:47 pm</a>		</div>

		<p>You can do it, but world-writable files is not a secure way of doing it. I already described one secure solution in the article itself. Sometimes I wonder whether people actually read my articles before commenting on them&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-232733">
				<div id="div-comment-232733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">lobber</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-232733">
			December 6, 2004 at 12:33 pm</a>		</div>

		<p>Sorry for violating the 2-week limit Raymond, but I feel I have to respond!  I did (and do) read your articles before commenting.  I just don&#8217;t take very seriously the idea of running a custom-developed service (at an elevated privilege) just to share data between users of a single app.</p>
<p>Seems like overkill for the kind of app he seems to be thinking of.  Maybe he&#8217;d be better off with RegSetKeySecurity?<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-232743">
				<div id="div-comment-232743" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-232743">
			December 6, 2004 at 12:38 pm</a>		</div>

		<p>Is it overkill not to want your app to show up in bugtraq as a security hole? &quot;The XYZ program allows unprivileged users to corrupt the database and crash the administrator account.&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-233293">
				<div id="div-comment-233293" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">lobber</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-233293">
			December 7, 2004 at 9:50 pm</a>		</div>

		<p>It&#8217;s not overkill to do everything you can to avoid that bugtraq posting, no.  You&#8217;re right.  It just seems that a service is a &#8216;heavy-weight&#8217; solution and not a good one.  Getting a service running correctly (in a more privileged context, remember) is not necessarily the best solution.  Indeed I suggested that I wouldn&#8217;t even take it seriously &#8211; I should qualify that: I would look for another solution in 95% of the cases where the issue arose.  He wants to have a shared world-writable registry key.  Instead of a service and all the complications it would bring (and extra resources it would consume &#8211; inside *and* outside of the computer!) &#8230; er &#8230; </p>
<p>Anyways &#8211; I&#8217;m getting past myself.  I stupidly couched my point in &quot;Microsoft FrustrationTM&quot; on a Microsoft forum.  The point is that this is such a common requirement that there should be a clear common way to do it!  People who want to share application data securely between users on the same computer shouldn&#8217;t have to roll their own services!</p>
<p>That&#8217;s all.  Sorry for being rude.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-280403">
				<div id="div-comment-280403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/oldnewthing/archive/2005/06/07/426294.aspx' rel='external nofollow' class='url'>The Old New Thing</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041122-00/?p=37233#comment-280403">
			June 7, 2005 at 11:03 am</a>		</div>

		<p>Another thought experiment when thinking through a feature.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

