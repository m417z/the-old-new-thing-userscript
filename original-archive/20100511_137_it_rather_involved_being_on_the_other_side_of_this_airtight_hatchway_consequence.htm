<html>
<head>
<title>It rather involved being on the other side of this airtight hatchway: Consequences of enabling the kernel debugger</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>It rather involved being on the other side of this airtight hatchway: Consequences of enabling the kernel debugger</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>May 11, 2010 / year-entry #138</td></tr>
<tr><td><b>Tags:</b></td><td>other</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>20</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">In the category of dubious security vulnerability, I submit for consideration the following report: A machine with the kernel debugger enabled is vulnerable to a denial of service attack from an unprivileged user. The unprivileged user need only deference a null pointer. Once this occurs, the computer becomes completely unusable to all users. Um, yeah....</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>In the category of dubious security vulnerability, I submit for consideration the following report:</p>
<blockquote class="q"><p> A machine with the kernel debugger enabled is vulnerable to a denial of service attack from an unprivileged user. The unprivileged user need only deference a null pointer. Once this occurs, the computer becomes completely unusable to all users. </p>
</blockquote>
<p> Um, yeah. That's sort of the whole point of the kernel debugger, to halt system execution as soon as a problem has been detected. Enabling the kernel debugger requires administrative privileges, so it's not like unprivileged users can force a system halt on their own; they need the help of an administrator to turn on kernel debugging first. At that point, you've already made it to the other side of the airtight hatchway. If you have an accomplice who is already an administrator, then you may as well just cut to the chase and tell your accomplice to add you to the administrators group, too. Then you can do much more than simply halting the system. </p>
<p> <b>Clarification</b>: As Bob noted, and which I apparently didn't make clear enough from the title of the article, this message arrived as a security vulnerability report. It's not a security vulnerability if it requires assistance from an administrator to pull off. </p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (20)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-832743">
				<div id="div-comment-832743" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://about:blank' rel='external nofollow' class='url'>santosh</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832743">
			May 11, 2010 at 9:09 am</a>		</div>

		<p>start-&gt;shutdown ?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-832753">
				<div id="div-comment-832753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">David Walker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832753">
			May 11, 2010 at 9:18 am</a>		</div>

		<p>I have a better one: &nbsp;&quot;A machine that is plugged in to the wall for power is vulnerable to a Denial of Service attack from an unprivileged user. &nbsp;The unprivileged user need only unplug the power cord. &nbsp;Once this occurs, the computer becomes completely unusable to all users&quot;.</p>
<p>Take that!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-832763">
				<div id="div-comment-832763" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ads</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832763">
			May 11, 2010 at 9:19 am</a>		</div>

		<blockquote><p>
  &gt; start-&gt;shutdown
</p></blockquote>
<p>an unpriviledge use cannot do that on every system (it can be a locked option &#8211; for example it is not available on terminal servers for non-admin accounts).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-832783">
				<div id="div-comment-832783" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">mh</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832783">
			May 11, 2010 at 10:03 am</a>		</div>

		<p>How about: &quot;A machine that is plugged in to the wall, running on battery, or in some cases even switched off is vulnerable to a Denial of Service attack from an unprivileged user. &nbsp;The unprivileged user need only empty a bucket of water over it. &nbsp;Once this occurs, the computer becomes completely unusable to all users.&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-832803">
				<div id="div-comment-832803" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Someone You Know</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832803">
			May 11, 2010 at 10:29 am</a>		</div>

		<p>A machine that is plugged into the wall, running on battery, or in some cases even switched off is vulnerable to a Denial of Service attack from an unprivileged user. The unprivileged user need only detonate a thermonuclear device near the computer. Once this occurs, the computer and all users become completely unusable.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-832823">
				<div id="div-comment-832823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Michael Mol</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832823">
			May 11, 2010 at 10:37 am</a>		</div>

		<p>A machine that is plugged into the wall, running on battery, or in some cases even switched off is vulnerable to a Denial of Service attack from an unprivileged user. The unprivileged user need only summon el Diablo. Once this occurs, the computer and all users become completely unusable.</p>
<p>Well, the users become unusable. Not sure about the coputer.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-832833">
				<div id="div-comment-832833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jonathan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832833">
			May 11, 2010 at 10:44 am</a>		</div>

		<p>Your response is as if the report had said:</p>
<p>&quot;An unprivileged user can DOS a machine by enabling KD and &#8230;&quot;</p>
<p>Which is clearly incorrect. But the report correctly said:</p>
<p>&quot;A machine with KD enabled [by an administrator] is vulnerable to a DOS attack from an unprivileged user, which can&#8230;&quot;</p>
<p>Which is true (though not exactly a shocking revelation).</p>
<p>David Walker, mh, Someone You Know: That&#8217;s quite unrelated &#8211; obviously, a user with physical access to the machine can do a lot.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-832843">
				<div id="div-comment-832843" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John Melville</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832843">
			May 11, 2010 at 10:58 am</a>		</div>

		<p>I think the scary part is not the question but the motivation for the question. &nbsp;Clearly one of two options are present.</p>
<p>1) Someone has software that only works with a kernel debugger attached &#8212; software that they think is ready for prime time. &nbsp;Or</p>
<p>2) Somebody thinks that attaching a kernel debugger to a production machine is a good way to solve a problem.</p>
<p>Either case should make you very afraid.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-832853">
				<div id="div-comment-832853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Brendan Dowling</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832853">
			May 11, 2010 at 11:15 am</a>		</div>

		<p>This isn&#8217;t a question, it&#8217;s a notice. &nbsp;It says, &quot;Don&#8217;t leave the kernel debugger installed and enabled in a production system. &nbsp;It will cause security problems.&quot; &nbsp;</p>
<p>It seems analogous to the automobile debug module. &nbsp;You can operate your car with it plugged in, but you may get dust into the connectors and you might have trouble closing the hood. &nbsp;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-832863">
				<div id="div-comment-832863" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">a random passerby</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832863">
			May 11, 2010 at 11:28 am</a>		</div>

		<p>@Jonathan: The question was actually answered as if the report were as you read it. In the answer, it&#8217;s pointed out that the KD need be enabled by an Administrator. So the user can&#8217;t DOS the system on their own, they need an admin to enable the KD for them, and if the user can do that then it&#8217;s analogous to giving the user admin rights in this case.</p>
<p>Also: A machine that is plugged into the wall, running on battery, or in some cases even switched off while encased in an EM-resistant case and buried 2 miles beneath the surface of the Earth with no way to access it is vulnerable to a DOS attack. Once this occurs, the computer is obviously owned by a government agency, at which point it isn&#8217;t doing anything useful anyways.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-832883">
				<div id="div-comment-832883" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Daniel</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832883">
			May 11, 2010 at 12:09 pm</a>		</div>

		<p>@ads</p>
<p>That reminds me of the policies on my uni: we (students) weren&#8217;t allowed to shut down or restart a computer, but those options were available on the logon screen.</p>
<p>In other words, assuming turning computers off is a bad thing (since it&#8217;s disabled), you were strictly required to remain anonymous when doing such vandalism.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-832893">
				<div id="div-comment-832893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">kog999</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832893">
			May 11, 2010 at 12:43 pm</a>		</div>

		<p>@Daniel</p>
<p>we had a policy like that at my old company. the logic was that we wanted users to leave their pc&#8217;s on at night so updates could be installed etc. However no matter how many emails we sent out people would still shutdown their pc&#8217;s when they leave. so we disabled the shutdown button from the start menu. This would force people to either hold down the power button or unplug the pc to turn it off. most people would not be willing to do that so they would just log out or lock their computer instead (well more like just walk away and the computer would lock itself after 15 minutes) though one or two would still hold down the button. So this ended up pretty much accomplishing our goal.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-832903">
				<div id="div-comment-832903" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.henke37.cjb.net/' rel='external nofollow' class='url'>Henke37</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832903">
			May 11, 2010 at 2:51 pm</a>		</div>

		<p>You never heard of wake on lan? Just let them power the computer down, and power it back up remotely as needed. Users are none the wiser, you are saving power and you get the job done.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-832923">
				<div id="div-comment-832923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">microbe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832923">
			May 11, 2010 at 3:58 pm</a>		</div>

		<p>With kernel debugging enabled the system halts when a NULL pointer is dereferenced?</p>
<p>I can understand if it&#8217;s a NULL pointer derefenced in the kernel space. If it&#8217;s only in user space, why?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-832933">
				<div id="div-comment-832933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anonymous Coward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832933">
			May 11, 2010 at 4:52 pm</a>		</div>

		<blockquote><p>
  I can understand if it&#8217;s a NULL pointer derefenced in the kernel space. If it&#8217;s only in user space, why?
</p></blockquote>
<p>I think this provides the seed to why the question was asked / notice was given (depending on interpretation).</p>
<p>They have something going wrong in kernel mode or are afraid something might and want to catch relevant data if shit happens, but whatever it is is unexpected / happens too rarely / is too hard to reproduce on the test servers / &#8230; so they decided to enable kernel debugging on (part of) the production systems.</p>
<p>But then they discovered that any user can halt the system from user mode. Raymond didn&#8217;t deny this, so I&#8217;ll assume this is true, but I think it&#8217;s a very weird situation. Unless something goes wrong in kernel mode the system should certainly not be interrupted. (Note: if it <em>isn&#8217;t</em> true, then Raymond&#8217;s criticism doesn&#8217;t apply at all.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-832973">
				<div id="div-comment-832973" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Pavel Lebedinsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832973">
			May 11, 2010 at 10:12 pm</a>		</div>

		<blockquote><p>
  With kernel debugging enabled the system halts when a NULL pointer is dereferenced?
</p></blockquote>
<p>It doesn&#8217;t (in the default configuration). User mode debug breaks or single step exceptions will break into kd by default, but even that can be disabled by setting the /NOUMEX boot option.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-832943">
				<div id="div-comment-832943" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Bob</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-832943">
			May 11, 2010 at 5:25 pm</a>		</div>

		<p>&gt; Which is clearly incorrect. But the report correctly said: &quot;A machine with KD enabled [by an administrator] is vulnerable to a DOS attack from an unprivileged user, which can&#8230;&quot;</p>
<p>A machine with an incompetent administrator is going to have bigger problems than this one.</p>
<p>And only a real freak knows how to attach a *kernel debugger* and also forgets to detach it after doing whatever debugging was necessary.</p>
<p>In any case, according to Raymond this was a &quot;security vulnerability&quot; report, and not a &quot;bug report&quot; or a &quot;request for help&quot;, and he didn&#8217;t say that the reporter was slapped with a wet fish instead of being helped.</p>
<p>The correct response to an invalid security vulnerability report is to redirect the report to a more appropriate location, if possible with an explanation as to why &quot;this is a vulnerability that requires you to have administrator access in order to exploit it&quot; is not actually a vulnerability.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-833033">
				<div id="div-comment-833033" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">unekdoud</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-833033">
			May 12, 2010 at 7:01 am</a>		</div>

		<p>There&#8217;s way too many of these posts around. How about a new category for them?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-833203">
				<div id="div-comment-833203" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">T-bone</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-833203">
			May 12, 2010 at 10:48 pm</a>		</div>

		<p>OK, but who reported it? Michael Howard or the newbie?</p>
<p>I hope you get this for what it means, that I look forward to read your posts, but you probably don&#8217;t need to blog on every single minute variation of these clearly mistaken and obviously foolish vulnerability claims that come your way. We got the point already!</p>
<p>You know, dogs biting men ain&#8217;t news.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-833233">
				<div id="div-comment-833233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jules</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100511-00/?p=14073#comment-833233">
			May 13, 2010 at 2:28 am</a>		</div>

		<p>I think people discovering a bug are way too ready to call it a security hole. &nbsp;As an example, a few years back I was one of the maintainers of a free software assembler. &nbsp;Somebody discovered a buffer overflow in part of the code, so if you had a particular directive with more than (IIRC) 32K of data on the line, you could cause code embedded in the line to be executed. &nbsp;This was reported to us as a &quot;remotely exploitable security hole&quot;.</p>
<p>First of all, why is it even a security hole? &nbsp;Surely, if you&#8217;re assembling a source file, you are more likely than not planning on running the resulting code, so wouldn&#8217;t a more direct approach be to just include your malicious code in the source?</p>
<p>Secondly: why remotely exploitable? &nbsp;I asked the reporter, and his response was along the lines of &quot;well, the user might set up a service to automatically assemble files that are sent to them via email, for example somebody doing grading of programming assignments.&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

