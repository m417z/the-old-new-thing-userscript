<html>
<head>
<title>How about not granting debug privileges to users?</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>How about not granting debug privileges to users?</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>January 4, 2010 / year-entry #3</td></tr>
<tr><td><b>Tags:</b></td><td>other</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>33</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">Commenter Yuhong Bao suggests, "How about not granting debug privileges on the user? This will make bypassing the protection impossible." This is such a great idea that Windows has worked that way for years. Normal non-administrative users do not have debug privilege. They can only debug processes that they already have PROCESS_ALL_ACCESS to. In other...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>Commenter Yuhong Bao suggests, "<a href="http://blogs.msdn.com/oldnewthing/pages/407234.aspx#737720">How about not granting debug privileges on the user? This will make bypassing the protection impossible</a>."</p>
<p> This is such a great idea that Windows has worked that way for years. </p>
<p> Normal non-administrative users do not have debug privilege. <a href="http://msdn.microsoft.com/ms679295.aspx"> They can only debug processes that they already have <code>PROCESS_ALL_ACCESS</code> to</a>. In other words, non-administrative users can only pwn processes that they already pwn. No protection is being bypassed since you had full access in the first place. </p>
<p> The SeDebugPrivilege <a href="http://blogs.msdn.com/oldnewthing/archive/2008/03/14/8080140.aspx"> allows you to debug any process, even those to which you do not have full access</a>. This is clearly dangerous, which is why it's not granted to non-administrative users by default. </p>
<p> Yuhong Bao also suggests, "How about separating the dangerous activities from the non-dangerous activities, or better, only allowing approved programs to do the dangerous activities?" (Where dangerous activities are defined as things that modify the program behavior.) I'm assuming this is discussing limiting the capabilities of SeDebugPrivilege, since in the absence of SeDebugPrivilege, the scope of your abilities is limited to things you already had the ability to do anyway; debugging didn't add anything new. </p>
<p> But even if you limited SeDebugPrivilege to nondestructive actions, you can still lose the farm. This imaginary <i>SeLimitedDebugPrivilege</i> would still let you read a target process's memory, which means you can do things like steal passwords and snoop on the activities of other users. </p>
<p> The last suggestion is to "only allow approved programs to do the dangerous activities." Again, I'm assuming this is discussing limiting the capabilities of SeDebugPrivilege, because without SeDebugPrivilege there is no new danger. But even in that limited context, what is an "approved program"? Approved by whom? </p>
<p> Must the program be digitally signed by Microsoft? I suspect people who write debuggers which compete with, say, Microsoft Visual Studio, would be upset if they had to submit their debugger to Microsoft for approval. And what are the requirements for receiving this approval? Does the debugger have to pass some battery of tests like WHQL? There are already plenty of readers of this Web site who reject WHQL as useless. Would this "debugger certification" also be useless? </p>
<p> Or maybe approval consists of merely being digitally signed at all? There are plenty of readers of this Web site who object to the high cost of obtaining a digital certificate (<a href="http://www.verisign.com/code-signing/msft-partner-code-signing/index.html">US$399</a>; I don't think the <a href="http://www.verisign.com/code-signing/msft-organizational-certificates/index.html"> $99</a> discounted version works for code signing.) And there are also plenty of readers who <a href="http://blogs.msdn.com/oldnewthing/archive/2009/09/24/9898728.aspx#9899019"> consider code signing to be payola</a> and <a href="http://blogs.msdn.com/oldnewthing/archive/2009/09/24/9898728.aspx#9900016"> designed to maximize profit rather than effectiveness</a>. </p>
<p> Or do you mean that the program needs to be listed in some new registry key called something like <code>Approved Debuggers</code>? Then what's to stop a rogue program from just auto-approving itself by writing to the Approved Debuggers registry key on its own? </p>
<p> But then again, all this is a pointless discussion once you realize that SeDebugPrivilege is granted by default only to administrators. And since administrators already pwn the machine, there's no protection that SeDebugPrivilege bypasses: You already bypassed it when you became an administrator. </p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (33)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-799773">
				<div id="div-comment-799773" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Marquess</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-799773">
			January 4, 2010 at 7:12 am</a>		</div>

		<p>This looks familiar. Indeed: <a href="http://blogs.msdn.com/oldnewthing/archive/2006/05/10/594537.aspx" target=_new rel=nofollow rel="nofollow">http://blogs.msdn.com/oldnewthing/archive/2006/05/10/594537.aspx</a></p>
<div class=post>[<i>Unintentional but somehow fitting that a factually correct but otherwise unhelpful article was generated in response to a question from Yuhong Bao. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-799833">
				<div id="div-comment-799833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Yuhong Bao</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-799833">
			January 4, 2010 at 8:15 am</a>		</div>

		<p>&quot;Must the program be digitally signed by Microsoft? &#8230;&quot;</p>
<p>I agree that it would be going too far, and I did not intend to suggest this.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-799883">
				<div id="div-comment-799883" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.medcalcsoftware.com' rel='external nofollow' class='url'>Frank</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-799883">
			January 4, 2010 at 10:12 am</a>		</div>

		<p>You need the discounted ($99) certificate from Verisign to create your Winqual account.</p>
<p>For code signing, the best buy is a Comodo signing certificate purchased through Tucows. It is $75 for one year, $140 for 2 years and $195 for 3 years. Visit <a rel="nofollow" target="_new" href="https://author.tucows.com/index.php?action=auth&amp;redirect=certs.php" rel="nofollow">https://author.tucows.com/index.php?action=auth&#038;redirect=certs.php</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-799903">
				<div id="div-comment-799903" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Marquess</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-799903">
			January 4, 2010 at 10:39 am</a>		</div>

		<p>“[Unintentional but somehow fitting that a factually correct but otherwise unhelpful article was generated in response to a question from Yuhong Bao. -Raymond]”</p>
<p><a href="http://blogs.msdn.com/oldnewthing/archive/2009/12/04/9932270.aspx" rel="nofollow"></a>In this day and age, it can&#8217;t be bad to repeat important information. As any parent can probably attest. It&#8217;s also helpful to repeat information.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-799913">
				<div id="div-comment-799913" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://jpotter@lss.com.au' rel='external nofollow' class='url'>jon</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-799913">
			January 4, 2010 at 11:08 am</a>		</div>

		<p>Microsoft has a history now of granting its own signed software special privileges, so it&#8217;s not that great a leap of imagination to think that this could be done as well.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-799923">
				<div id="div-comment-799923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Marquess</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-799923">
			January 4, 2010 at 11:10 am</a>		</div>

		<p>@jon:</p>
<p>[citation needed]</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-799963">
				<div id="div-comment-799963" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://jpotter@lss.com.au' rel='external nofollow' class='url'>jon</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-799963">
			January 4, 2010 at 1:07 pm</a>		</div>

		<p>@Marquess: <a rel="nofollow" target="_new" href="http://technet.microsoft.com/en-us/magazine/2009.07.uac.aspx" rel="nofollow">http://technet.microsoft.com/en-us/magazine/2009.07.uac.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-799973">
				<div id="div-comment-799973" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://jpotter@lss.com.au' rel='external nofollow' class='url'>jon</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-799973">
			January 4, 2010 at 1:09 pm</a>		</div>

		<p>@Marquess: (from the above link)</p>
<p>&quot;it must be digitally signed by the Windows publisher, which is the certificate used to sign all code included with Windows&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-799983">
				<div id="div-comment-799983" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">KenW</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-799983">
			January 4, 2010 at 1:22 pm</a>		</div>

		<p>@jon: That article doesn&#8217;t say what you think it says. It says that &quot;applications&quot; (not MS applications, but applications in general) took advantage of by default having admin access, which MS started restricting in XP/Vista and above. This is explained in the opening 3 paragraphs of the page you linked.</p>
<p>Please read it again. It doesn&#8217;t support your post at all.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-800023">
				<div id="div-comment-800023" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.pretentiousname.com' rel='external nofollow' class='url'>Leo Davidson</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800023">
			January 4, 2010 at 1:36 pm</a>		</div>

		<p>@KenW: The article, specifically the part Jon quoted in his follow-up just before your post, does support Jon&#8217;s claims. Maybe you didn&#8217;t read it to the end?</p>
<p>(It also says what you say it says. Articles can say more than one thing! :))</p>
<p>As the article says, binaries signed by the Windows publisher (i.e. a subset of apps signed by Microsoft, and no-one else), and stored in particular directories, get special powers.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-800043">
				<div id="div-comment-800043" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Marquess</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800043">
			January 4, 2010 at 2:06 pm</a>		</div>

		<p>Binaries, signed by Microsoft, and stored in particular directories get special powers without user interaction (but only if this user is already running as admin). Every other application gets these powers with a UAC prompt. Sounds fair to me. Especially considering this sentence:</p>
<p>&quot;We understand the aggravation, and there might be a legitimate reason that those applications can&#8217;t run without administrative rights, but the risk is too high that developers will avoid fixing their code to work with standard user rights.&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-800063">
				<div id="div-comment-800063" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://windowssucks.wordpress.com/' rel='external nofollow' class='url'>WndSks</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800063">
			January 4, 2010 at 2:23 pm</a>		</div>

		<p>@Marquess: The problem is, the default UAC level in 7 allows the signed whitelisted MS apps to be used by any program to elevate without prompt (Check Leo Davidson&#8217;s site, no need to go over this again; in 7, UAC != security)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-800073">
				<div id="div-comment-800073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800073">
			January 4, 2010 at 2:35 pm</a>		</div>

		<p>On one hand jon is technically correct, but at the same time it was done to ease the pain of managing a system with UAC enabled. &nbsp;Just look at the small list of files given the special treatment (<a rel="nofollow" target="_new" href="http://www.withinwindows.com/2009/05/02/short-windows-7-release-candidate-auto-elevate-white-list/" rel="nofollow">http://www.withinwindows.com/2009/05/02/short-windows-7-release-candidate-auto-elevate-white-list/</a>) &#8211; all of them are management-related utilities. &nbsp;On the other hand, I definitely understand the pain other developers are going through in order to rework their applications to be UAC compliant. &nbsp;The bottom line is that providing a mechanism to auto-elevate 3rd party applications would ultimately result in people abusing it. &nbsp;In this case I think the exception is for the greater good.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-800113">
				<div id="div-comment-800113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://jpotter@lss.com.au' rel='external nofollow' class='url'>jon</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800113">
			January 4, 2010 at 6:21 pm</a>		</div>

		<p>@John: &quot;On the other hand, I definitely understand the pain other developers are going through in order to rework their applications to be UAC compliant.&quot;</p>
<p>In our own particular case, the pain comes from already having done the work (long ago) to be fully UAC compliant, and still being done over by the changes in Windows 7. We did the right thing, but because Microsoft can&#8217;t be bothered doing it themselves, they give themselves a free pass.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-800123">
				<div id="div-comment-800123" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Stefan Kanthak</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800123">
			January 4, 2010 at 6:40 pm</a>		</div>

		<p>There are indeed (and since LOOONG time) several settings which allow only &quot;administrator approved&quot; code to run:</p>
<ol>
<li>see MSKB 182569 and %windir%INFINETRES.ADM:
<p>&nbsp; [HKLMSoftwareMicrosoftWindowsCurrentVersionInternet SettingsZones*]</p>
<p>&nbsp; &quot;1200&quot;=dword:010000</p>
<p>&nbsp; &quot;2000&quot;=dword:010000</li>
<li>
<p>see MSKB 216384:</p>
<p>&nbsp; [HKLMSoftwareMicrosoftWindowsCurrentVersionPoliciesExplorer]</p>
<p>&nbsp; &quot;EnforceShellExtensionSecurity&quot;=dword:01</p>
</li>
<li>
<p>see MSKB 555235 &amp; 883256:</p>
<p>&nbsp; [HKLMSoftwareMicrosoftWindowsCurrentVersionPoliciesExt]</p>
<p>&nbsp; &quot;RestrictToList&quot;=dword:01</p>
<p>&nbsp; [HKLMSoftwareMicrosoftWindowsCurrentVersionPoliciesExtCLSID]</p>
<p>&nbsp; &quot;{GUIDGUID-GUID-GUID-GUID-GUIDGUIDGUID}&quot;=&quot;1&quot;</p>
</li>
<li>
<p>see MSKB 267930.</p>
</li>
</ol>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-800133">
				<div id="div-comment-800133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800133">
			January 4, 2010 at 8:05 pm</a>		</div>

		<p>jon: What changed with regard to UAC from Vista to 7? &nbsp;I haven&#8217;t kept up with Windows 7 yet.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-800153">
				<div id="div-comment-800153" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://jpotter@lss.com.au' rel='external nofollow' class='url'>jon</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800153">
			January 4, 2010 at 11:04 pm</a>		</div>

		<p>@John: Basically, because Microsoft got scared by the complaints of too many UAC prompts in Vista, Microsoft software no longer needs to show a UAC prompt to elevate under the default configuration.</p>
<p>Third party software doesn&#8217;t have this privilege and still must show a prompt to elevate. Therefore third party file software (e.g. file managers) are disadvantaged compared to the Microsoft software (e.g. Explorer).</p>
<p>There are several security implications as well which have been well covered; e.g. see <a rel="nofollow" target="_new" href="http://www.pretentiousname.com/misc/win7_uac_whitelist2.html" rel="nofollow">http://www.pretentiousname.com/misc/win7_uac_whitelist2.html</a> for lots of detail.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-800183">
				<div id="div-comment-800183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://jpotter@lss.com.au' rel='external nofollow' class='url'>jon</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800183">
			January 5, 2010 at 1:13 am</a>		</div>

		<p>@Marquess: You&#8217;re completely wrong, sorry. For example, Explorer runs quite happily without admin privileges. You&#8217;re doing it right now.</p>
<p>I agree that the UAC selector shouldn&#8217;t be at a lower setting &#8211; but unfortunately, that&#8217;s the default setting that Microsoft has imposed on people.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-800193">
				<div id="div-comment-800193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">A regular viewer</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800193">
			January 5, 2010 at 1:13 am</a>		</div>

		<p>I don&#8217;t see why Microsoft cannot understand a very simple request. All these blog posts and comments and more that 95% of all tech articles every written and will continue to be written, point out to that basic inability of Microsoft to comprehend a simple statement made by millions of developers and users for over 25 years. It is shameful and damning.</p>
<p>&quot;I goof up. You pay.&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-800203">
				<div id="div-comment-800203" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ender</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800203">
			January 5, 2010 at 4:27 am</a>		</div>

		<p>@Frank: do those Tucows/Comodo certificates allow driver (kernel mode) signing?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-800213">
				<div id="div-comment-800213" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800213">
			January 5, 2010 at 5:29 am</a>		</div>

		<p>How about &#8216;approved debuggers&#8217; being a list &nbsp;that can only be added to by Administrators via UAC?</p>
<div class=post>[<i>I covered this in the article. &#8220;Then what&#8217;s to stop a rogue program from just auto-approving itself by writing to the Approved Debuggers registry key on its own?&#8221; You run the Application&nbsp;X installer. The installer asks for elevation. You grant it. It adds itself as an &#8216;approved debugger&#8217; even though it&#8217;s really just a music player. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-800173">
				<div id="div-comment-800173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Marquess</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800173">
			January 5, 2010 at 1:07 am</a>		</div>

		<p>The whitelisted programs are all applications that *cannot be run without admin privileges*. Microsoft trusts these programs (as they should, having developed them). However, MS has no reason to trust other application, and as readers of this blog should know, if you give people an easy way out, they *will* abuse it.</p>
<p>Now, about the code injection: Don&#8217;t run Windows as admin and with the UAC selector at a lower setting. You&#8217;re just asking for trouble. Exploits that require admin privileges are *not* exploits.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-800363">
				<div id="div-comment-800363" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.medcalcsoftware.com' rel='external nofollow' class='url'>Frank</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800363">
			January 5, 2010 at 12:18 pm</a>		</div>

		<p>To ender: yes, the Tucows/Comodo certificates allow driver signing.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-800373">
				<div id="div-comment-800373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ricardo Costa</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800373">
			January 5, 2010 at 12:36 pm</a>		</div>

		<p>I believe the concern here is about keyloggers and code injection. What if the program could use an API to disable debugging on itself? Or, at least, protect regions of memory from being read/written by other user-level processes. Debuggers wouldn&#8217;t be able to fully debug the process but it would be more beneficial than harmful.</p>
<div class=post>[<i>All I have to do to defeat you is to launch you suspended, connect as a debugger, and then when you call the imaginary <code>PreventDebuggingThisProcess</code> function, trick you into thinking the call succeeded. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-800383">
				<div id="div-comment-800383" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Aram Hăvărneanu</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800383">
			January 5, 2010 at 12:53 pm</a>		</div>

		<p>To posts regarding UAC:</p>
<p>I think Mark Russinovich summarized it just right in his PDC talk. (Free to watch on the web). UAC has nothing to do with security. UAC has nothing to do in regard to regular users. UAC is only for developers that can use it to make sure the software they are developing can run without Admin priviledges. If their software does not trigger UAC prompts, then the software can be run by a regular user, which in turn will not see any suspicious prompts. UAC is a developer tool, not a security tool.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-800543">
				<div id="div-comment-800543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Cheong</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800543">
			January 5, 2010 at 5:33 pm</a>		</div>

		<p>[All I have to do to defeat you is to launch you suspended, connect as a debugger, and then when you call the imaginary PreventDebuggingThisProcess &nbsp;function, trick you into thinking the call succeeded. -Raymond]</p>
<p>Or rather, invent some compiler directive that after compilation, generates some kind of .securetext and .securedata section (kind of like .data section that disallows execution in NX context) that disallow debuggers to step in. (When you use VS to debug, of course the generated debug assembly should run in normal .text/.data sections only so you can debug these codes/data.)</p>
<div class=post>[<i>I guess you could do that, but it means that users don&#8217;t have full access to their own processes. This looks like a solution in search of a problem. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-mike-dimmick even thread-even depth-1" id="comment-800303">
				<div id="div-comment-800303" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Mike+Dimmick' rel='external nofollow' class='url'>Mike Dimmick</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800303">
			January 5, 2010 at 10:03 am</a>		</div>

		<p>On the discussion of the change between Vista and 7 UAC: Windows Vista already distinguished between various different forms of signed code for the presentation of UAC confirmation dialogs. Windows code (i.e. signed with the Windows publisher certificate) gets a different colour banner and slightly different wording, in elevation and over-the-shoulder prompts. The four levels are:</p>
<p>1. Windows executables (blue, IIRC &#8211; writing this on XP)</p>
<p>2. Other signed executables (grey)</p>
<p>3. Unsigned executables from unknown locations (yellow, task buttons rather than regular buttons)</p>
<p>4. Unsigned executables with mark of the Web (red with &#8216;X&#8217; shield icon, strongly discouraged from running)</p>
<p>Windows 7 allows you to select a threshold below which the prompts will not show. The default is to not show prompts for level 1, Windows-supplied applications, but you can turn it up to show prompts for those as well, or down, to not show prompts for all signed applications. This is different from Windows Vista&#8217;s all-or-nothing approach.</p>
<p>As a quick reminder for everyone, the prompts occur when you start a new process via ShellExecuteEx. (CreateProcess inherits the parent security state as it should not be interactive.) For regular EXEs, a prompt is generated if there is a manifest, and it specifies requireAdministrator or, if the user is an admin, highestAvailable. Or, if it has been marked as requiring administrator rights in the shim database or on the shortcut. If there is no manifest, it may still invoke a prompt if the executable matches certain heuristics intended to detect legacy setup programs.</p>
<p>Once an elevated application is running, the *way* it was elevated has no significance. They all get the same elevated token. Windows components don&#8217;t get any extra special privileges over other software, whether signed or unsigned.</p>
<p>Microsoft have been careful to distinguish updates to Windows &#8211; normally packaged as .msu files anyway, to appear in the Turn On/Off Windows Features dialog &#8211; from other Microsoft-supplied software. Even Windows Live Essentials is signed as Microsoft, not as Windows.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-800393">
				<div id="div-comment-800393" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Marquess</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800393">
			January 5, 2010 at 12:57 pm</a>		</div>

		<p>Ok, I finally got around to testing that injection tool. Pressed inject, got UAC prompt, was unimpressed.</p>
<p>Tested on Windows Server 2008 R2, limited user. *yawn*</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-800553">
				<div id="div-comment-800553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Me</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800553">
			January 5, 2010 at 5:34 pm</a>		</div>

		<p>@Marquess</p>
<p>&quot;Tested on Windows Server 2008 R2, _limited user_. *yawn*&quot;</p>
<p>You&#8217;re deliberately missing the point.</p>
<p>The Window 7 (and W2K8R2? who knows) default UAC model is broken because it can be silently bypassed. Bypassing UAC is not the same as privilege escalation.</p>
<p>&quot;The whitelisted programs are all applications that *cannot be run without admin privileges*.&quot;</p>
<p>Calc.exe? Notepad? Maybe it&#8217;s not so deliberate.</p>
<p>FWIW I think Aram (and Mark) got it right.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-800603">
				<div id="div-comment-800603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://markk-b.sitesled.com/' rel='external nofollow' class='url'>MarkKB</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800603">
			January 6, 2010 at 4:07 am</a>		</div>

		<p>&quot;The Window 7 (and W2K8R2? who knows) default UAC model is broken because it can be silently bypassed. Bypassing UAC is not the same as privilege escalation.&quot;</p>
<p>Not true with a limited user account. It would show a UAC prompt, just like Vista.</p>
<p>Obviously, the solution is to make the limited user account the default, and to educate the user as to what the admin account is for (administration). However, I&#8217;m not quite sure of an easy way to do this.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-800823">
				<div id="div-comment-800823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-800823">
			January 6, 2010 at 9:48 am</a>		</div>

		<p>Vista did it right. w7 is back to &quot;perceived security&quot; only with some lesser nagging than vista &#8211; worst of 2 worlds.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-801193">
				<div id="div-comment-801193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Random832</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-801193">
			January 7, 2010 at 6:22 am</a>		</div>

		<p>&#8220;Then what&#8217;s to stop a rogue program from just auto-approving itself by writing to the Approved Debuggers registry key on its own?&#8221;</p>
<p>I think the idea is that administrators take some responsibility for the programs they install. But, since you asked, what about an &#8220;Approved Registry Editors&#8221; key? [which to begin with only includes Regedit and maybe some hypothetical control panel for adding programs to approved lists [both of which will in the initial configuration only write to keys requiring it in interactive mode]]</p>
<div class=post>[<i>The underlying problem is still there. In order to install (almost) any program, you have to grant its installer &#8220;Approved Registry Editors&#8221; status so it can update the registry as part of its installation, at which point you implicitly gave it permission to add the program to the &#8220;Approved Registry Editors&#8221; key. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-801883">
				<div id="div-comment-801883" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Stefan Kanthak</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100104-00/?p=15423#comment-801883">
			January 9, 2010 at 1:24 pm</a>		</div>

		<p>[The underlying problem is still there. In order to install (almost) any program, you have to grant its installer &quot;Approved Registry Editors&quot; status so it can update the registry as part of its installation, at which point you implicitly gave it permission to add the program to the &quot;Approved Registry Editors&quot; key. -Raymond]</p>
<p>Cf. Ken Thompson famous article &quot;Reflections on Trusting Trust&quot; &lt;<a rel="nofollow" target="_new" href="http://cm.bell-labs.com/who/ken/trust.html&gt;" rel="nofollow"></a><a href="http://cm.bell-labs.com/who/ken/trust.html&#038;gt" rel="nofollow">http://cm.bell-labs.com/who/ken/trust.html&#038;gt</a>;</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

