<html>
<head>
<title>When people ask for security holes as features: Silent install of uncertified drivers</title>
<link rel="stylesheet" href="page.css">
</head><body>
<div class="titlediv"><h2>When people ask for security holes as features: Silent install of uncertified drivers</h2></div>
<div class="hdrdiv"><table class="hdrtable" cellspacing="0" cellpadding="0">
<tr><td><b>Date:</b></td><td>August 16, 2005 / year-entry #227</td></tr>
<tr><td><b>Tags:</b></td><td>history;when-people-ask-for-security-holes-as-features</td></tr>
<tr><td><b>Orig Link:</b></td><td>https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563</td></tr>

<tr><td><b>Comments:&nbsp;&nbsp;&nbsp;&nbsp;</b></td><td>79</td></tr>
<tr><td valign="top"><b>Summary:</b></td><td valign="top">Probably the single greatest source of bluescreen crashes in Windows XP is buggy device drivers. Since drivers run in kernel mode, there is no higher authority checking what they're doing. If some user-mode code runs amok and corrupts memory, it's just corrupting its own memory. The process eventually crashes, but the system stays up. On the...</td></tr>
</table></div>
<hr/>
<table class="contenttable" cellspacing="0" cellpadding="0"><tr><td><div class="contentdiv">
<!-- CONTENT START -->
<p>Probably the single greatest source of bluescreen crashes in Windows&nbsp;XP is buggy device drivers. Since drivers run in kernel mode, there is no higher authority checking what they're doing. If some user-mode code runs amok and corrupts memory, it's just corrupting its own memory. The process eventually crashes, but the system stays up. On the other hand, if a driver runs amok and corrupts memory, it's corrupting your system and eventually your machine dies.</p>
<p> In acknowledgement of the importance of having high-quality drivers, Windows&nbsp;XP warns you when an uncertified driver is being installed. Which leads to today's topic, a question from a device driver author. </p>
<blockquote class="m"><p> When I try to install any driver, I get a User Consent Dialog box which tells the user that this is an unsigned driver. Is it possible to author a driver installation package that by-passes this user consent dialog box? </p>
</blockquote>
<p> The whole purpose of that dialog is to prevent the situation you desire from happening! [typo fixed 5pm] If you don't want the warning dialog, submit your driver for certification. (For testing purposes, you can <a href="http://winqual.microsoft.com/help/use_help/testsignusersguide_help.aspx"> sign your drivers with the test root certificate</a> and install the test root certificate before running your setup program. Of course, installing the test root certificate also <a href="http://blogs.msdn.com/oldnewthing/archive/2003/08/12/54634.aspx"> causes the desktop to read "For test purposes only"</a> as a reminder that your machine is now allowing test-signed drivers to be installed.) </p>
<p> Driver writers, of course, find the certification process cumbersome and will do whatever they can to avoid it. Because, of course, if you submit your driver for certification, it might fail! This has led to <a href="http://blogs.msdn.com/oldnewthing/archive/2004/03/05/84469.aspx"> varying degrees of shenanigans to trick the WHQL team into certifying a driver different from the one you intend to use</a>. My favorite stunt was related to my by a colleague who was installing a video card driver whose setup program displayed a dialog that read, roughly, "After clicking OK, do not touch your keyboard or mouse while we prepare your system." After you click OK, the setup program proceeds to move the mouse programmatically all over the screen, opening the Display control panel, clicking on the Advanced button, clicking through various other configuration dialogs, a flurry of activity for what seems like a half a minute. When faced with a setup program that does this, your natural reaction is to scream, "Aaaiiiiigh!" </p>
<!-- CONTENT END -->
</div></td></tr></table>
<hr/>
<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (79)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-297013">
				<div id="div-comment-297013" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Diego</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297013">
			August 16, 2005 at 10:22 am</a>		</div>

		<p>Woah, I&#8217;ve just lost all my hope for the human kind</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297023">
				<div id="div-comment-297023" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://dotnetjunkies.com/WebLog/stefandemetz/' rel='external nofollow' class='url'>stefan demetz</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297023">
			August 16, 2005 at 10:23 am</a>		</div>

		<p>my thoughts were always that windows should run unsigned drivers in user mode &#8230;. like in NT 3.51<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297033">
				<div id="div-comment-297033" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ac</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297033">
			August 16, 2005 at 10:27 am</a>		</div>

		<p>Actually, if you define your own device class you will NOT get prompted by the unsigned driver install dialog. </p>
<p>Also, one of the problems of WHQL in my experience is that although you provide an INF file that may list 10 different devices, WHQL will still sign it even if you&#8217;ve only provided them with only one of those listed devices.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297043">
				<div id="div-comment-297043" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.jelovic.com' rel='external nofollow' class='url'>Dejan Jelovic</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297043">
			August 16, 2005 at 10:28 am</a>		</div>

		<p>Even worse, my new Dell laptop came with an usigned bluetooth driver whose setup automatically clicks on the Continue button of the dialogs while installing the driver.</p>
<p>BTW, the WHQL website is awfully hard to navigate, so I can see why small hardware manufacturers are put off.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297053">
				<div id="div-comment-297053" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dave</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297053">
			August 16, 2005 at 10:35 am</a>		</div>

		<p>I have seen these shenanigans as well about a year ago, with the driver for a USB memory key. It would install and auto-push the button on that warning dialog. XP SP2 added a new check for kernel memory pool corruption and guess what? This driver would blue-screen every time the memory key was plugged in. </p>
<p>To me, this kind of software fits into the &quot;grayware&quot; area along with spyware and adware. Attempts to circumvent a user notification like this are malicious, and the result is an unstable system.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297063">
				<div id="div-comment-297063" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jim Howard</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297063">
			August 16, 2005 at 10:52 am</a>		</div>

		<p>Were you hidding under the table at the meeting I was at just the other day?</p>
<p>I work on a wifi product that sometimes is bundled with wifi cards. When packaged like that our installer also installs the wifi card dirver.</p>
<p>Guess what.  The suits are all upset about the &quot;unsigned driver&quot; warning, and they are sure that a programmer more clever than me could make them go away.</p>
<p>Of course actually getting the drivers certified is too expensive.</p>
<p>Excuse me while I get back to work on my TPS report.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297073">
				<div id="div-comment-297073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jim</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297073">
			August 16, 2005 at 10:52 am</a>		</div>

		<p>Were you hidding under the table at the meeting I was at just the other day?</p>
<p>I work on a wifi product that sometimes is bundled with wifi cards. When packaged like that our installer also installs the wifi card dirver.</p>
<p>Guess what.  The suits are all upset about the &quot;unsigned driver&quot; warning, and they are sure that a programmer more clever than me could make them go away.</p>
<p>Of course actually getting the drivers certified is too expensive.</p>
<p>Excuse me while I get back to work on my TPS report.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297083">
				<div id="div-comment-297083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jack Mathews</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297083">
			August 16, 2005 at 10:53 am</a>		</div>

		<p>You talk about WHQL like it&#8217;s fair and impartial.</p>
<p>Unfortunately, I remember the crap they pulled with 3dfx.  Like, for instance, making them write a 2D driver for NT for the Voodoo 1 to WHQL it.  A driver they never had any intention of releasing.  Or the fact that they were demanding Glide source code (and the ability to do what they want with it) to allow them to distribute an OpenGL ICD, and were holding back WHQL certification to boot.  Glide, you may remember, was a direct competitor to D3D back then, and also Microsoft were in undisclosed cahoots with nVidia at the time.  I&#8217;m not saying this is what killed Glide or 3dfx or anything, I&#8217;m just saying it was underhanded.</p>
<p>And some readers may wonder why WHQL is so important?  It&#8217;s not only because of this box, it&#8217;s because OEMs get money back on Windows if they ship with WHQL only hardware.  So basically, hardware manufacturers are forced to make concessions on occasion to have nothing to do with the quality of their drivers.  Otherwise they&#8217;ll never be in a Dell machine.</p>
<p>That&#8217;s not to say that WHQL doesn&#8217;t have its value, as noted above.  But sometimes there&#8217;s a nefarious side to it as well that has nothing to do with security or bluescreens.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297093">
				<div id="div-comment-297093" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James Risto</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297093">
			August 16, 2005 at 11:06 am</a>		</div>

		<p>Bugs me when large vendors like IBM and SAN cards don&#8217;t get their drivers verified.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297103">
				<div id="div-comment-297103" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">tsrblke</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297103">
			August 16, 2005 at 11:09 am</a>		</div>

		<p>Jack,</p>
<p>Neither side of this game is impartial.  Just as you claim WHQL isn&#8217;t playing fair, I can tell you that sometimes (mostly) the OEM (and other hardware makers) are out to cut corners and make money.<br />
<br />I still remember one of Linksys&#8217;s Wireless B PCMCIA cards.  I went to install the driver, the instructions actually said something to the tune of &quot;Ignore this warning box, it doesn&#8217;t mean anything important.  Continue clicking OK on every screen until the driver finishes installing.&quot;  Hell I could have put a box in that said &quot;Click here to format your hard drive&quot; and I&#8217;m sure some end users would have clicked OK.  Cisco is a huge company, surely the WHQL payment isn&#8217;t much to them.<br />
<br />WHQL is there because it assures drivers are stable.  Why?  Because when the BSOD comes most end users don&#8217;t say &quot;Oh my unsigned driver has corrupted memory in Kernal mode.&quot; They say &quot;Stupid Windows, always crashing, Macs never crash.&quot;  WHQL helps make windows look good, because that&#8217;s all alot of end users see the computer as, &quot;Windows.&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297113">
				<div id="div-comment-297113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anonymous Coward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297113">
			August 16, 2005 at 11:20 am</a>		</div>

		<p>Heh, I&#8217;ve spent a lot of time attempting to explain why we couldn&#8217;t &quot;brand&quot; the dialogs that pop up in the browser before the user installs a signed control&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297123">
				<div id="div-comment-297123" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ToddM</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297123">
			August 16, 2005 at 11:29 am</a>		</div>

		<p>WHQL helps make windows look good, because that&#8217;s all alot of end users see the computer as, &quot;Windows.&quot;<br />
<br />&#8212;&#8212;&#8212;</p>
<p>Well, if that&#8217;s the case, then it sounds like Microsoft is the true beneficiary of WHQL.  So why should the hardware vendors have to foot the expensive bill?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297133">
				<div id="div-comment-297133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Justin Saying</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297133">
			August 16, 2005 at 11:33 am</a>		</div>

		<p>Problem with WHQL from my perspective is that it imposes requirements that aren&#8217;t related to system reliability. Sometimes these are impossible to meet, depending on the hardware.</p>
<p>Judging by the number of comments here, I&#8217;d say WHQL is more a thorn in the side of developers than it probably needs to be.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297143">
				<div id="div-comment-297143" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anonymous Coward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297143">
			August 16, 2005 at 11:46 am</a>		</div>

		<p>What really bugs me is when you get a blue screen and all crash analysis says is that it was &quot;caused by a device driver&quot;.  Since there are 30 or 40 on the machine that makes it really hard to work out who to blame.  I would instantly replace their hardware.</p>
<p>I would have assumed that memory allocations, PCI reservations, DMAs etc would be at least tagged with the driver class (eg video driver resources would be different than USB serial port drivers).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297153">
				<div id="div-comment-297153" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">binaryc</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297153">
			August 16, 2005 at 11:57 am</a>		</div>

		<p>The reason it only says, &quot;caused by a device driver&quot; is because all device drivers run in the same memory space, so my video card driver could be dancing all over your ethernet driver memory.</p>
<p>Making WHQL certification free would certainly encourage a lot more vendors to certify their drivers, but it would also causes a lot of vendors to just sumbit crap to the WHQL without testing it themselves first.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297163">
				<div id="div-comment-297163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.1060.org/blogxter/publish/5' rel='external nofollow' class='url'>Steve Loughran</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297163">
			August 16, 2005 at 12:04 pm</a>		</div>

		<p>WHQLs job is to stop support calls, to stop MS getting the blame for BSOD events. And they are mostly good at it. The fact that most stuff just plugs and plays is down to them&#8230;try getting the miscellaneous bits of a laptop to work on linux to see what their absence brings.</p>
<p>But systems still BSOD, and we, the end users, get to stare at the screen. And that happens even if the stuff gets certified, because there are so many system combinations out there, so many OS patches, so many machine states -and only one pointer error in a driver toasts your box. Furthermore, driver vendors get no respect. Nobody reviews a graphics card saying &quot;its a junk card but the driver folk have made it almost workable&quot;. No bad drivers get blame, good drivers get silence. Whereas a bit of instability in an app is par for the course, what with crash-recovery built into things like Word. </p>
<p>What WHQL could be done is making more of the posted crash failure statistics public. Why cant we see which display driver causes the most failures? Or which bluetooth dongles are the flakiest? Or whose DVD-RW software should we avoid? MS fault reporting must know these facts&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297173">
				<div id="div-comment-297173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Micah Chalmer</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297173">
			August 16, 2005 at 12:32 pm</a>		</div>

		<p>My guess is that if you have the capital to get your hardware manufactured and your device drivers working at all, the monetary cost of WHQL will not be the deterrent to getting your drivers certified.  Making your hardware available to vendors like Dell would surely make up for that.</p>
<p>What will be a deterrent is the kind of story Jack Matthews told.  Demanding unrestricted license to the source code?  Refusing to grant certification to a company because they make software that competes with Micorosft?  Those are real deterrents.  Sure, some of them just want to cut corners and release unstable garbage, but many of them are probably scared off by the prospect of submitting their code to a hostile and aggressive company who just might see them as a threat.  Better to just tell the users to ignore the warning in the instruction manual.</p>
<p>(tsrbike: the fact that some hardware manufacturers are cheapskates who want to get away with releasing crap has no bearing on how Microsoft treats the good ones.)</p>
<p>I do agree that people who make setup programs that programmatically move the mouse in an attempt to bypass the confirmation dialog should be hit on the head a few times&#8230;fortunately those seem to be relatively rare.</p>
<p>And oh yeah: for full disclosure&#8217;s sake, I should note that I personally have no idea if Jack&#8217;s story is true.  I just have no reason to disbelieve it, and Microsoft has demonstrated time and again its willingness to behave that way.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297183">
				<div id="div-comment-297183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.technet.com/efleis/archive/2005/08/16/409275.aspx' rel='external nofollow' class='url'>Eric Fleischman's WebLog</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297183">
			August 16, 2005 at 12:36 pm</a>		</div>

		<p>So much going on&#8230;..Had a week and a half of vacation which was nice. It was nice to get back to see&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-maurits even thread-even depth-1" id="comment-297203">
				<div id="div-comment-297203" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Maurits+%5BMSFT%5D' rel='external nofollow' class='url'>Maurits [MSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297203">
			August 16, 2005 at 12:40 pm</a>		</div>

		<p>How about if I get to certify my own drivers&#8230; then if a user accepts my signing certificate as trustworthy, they can install any of my drivers without further prompts.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297213">
				<div id="div-comment-297213" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ATZ Man</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297213">
			August 16, 2005 at 12:45 pm</a>		</div>

		<p>A barrier to entry is a barrier to entry. The signing requirement and the requirement that potential clients of error reporting obtain a cert from VeriSigh cost third party companies money and thereby cause them to stay out of markets they could have entered, and consequently LOWER the quality of components available to users by decreasing competition.</p>
<p>Microsoft would best level the playing field by displaying the signature box of a signed driver. Thus the user would be required to view a dialog box for ANY driver. Further, Microsoft should allow orgs that are peers of WHQL certify drivers and allow drivers to obtain certs from any such org or set of such orgs as they choose. Over time users would know which orgs were on the ball and which had agendas.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297223">
				<div id="div-comment-297223" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ulric</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297223">
			August 16, 2005 at 12:53 pm</a>		</div>

		<p>I remember the matrox millenium driver (I think) installation under Win95 clicking all the display properties buttons to install the driver, but at the time I was under the impression this was because updating the video driver was pretty complicated for normal people, having to go to the display properties, last tab, Have Driver, etc..</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297233">
				<div id="div-comment-297233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297233">
			August 16, 2005 at 1:04 pm</a>		</div>

		<p>At a company I used to work for they had found away around that dialog box.  They would silently launch the System Properties / Driver Signing Options dialog, send windows messages to select &quot;Ignore&quot; and then click ok, effectively turning off the dialog box (BTW, the code to re-enable the setting was commented out, so the installer made your machine less secure forever &#8212; great stuff coming from a security company).</p>
<p>When it came time for me to release my device driver they insisted that I use this &quot;Top Secret&quot; functionality to get rid of the unsigned driver dialog box.  I flatly refused.  It took a lot of fighting, but I pretty much said &quot;I will not do it, ever.&quot;<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297243">
				<div id="div-comment-297243" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">anonymous coward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297243">
			August 16, 2005 at 1:07 pm</a>		</div>

		<p>Yes, I realize that resources (memory, dma, irq etc) are shared amongst all device drivers.  However it should be possible to do a better job of pointing fingers.  For non-memory related issues, you can track which driver reserved the resource.  For memory related stuff, you can tag allocations with who made them.</p>
<p>In many cases just narrowing to the class of device would be more than enough for me.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297253">
				<div id="div-comment-297253" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jim Nakashima</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297253">
			August 16, 2005 at 1:13 pm</a>		</div>

		<p>I like the spirit of WHQL, the main thing I don&#8217;t like about it pertains to the barrier it causes.  If I am a small startup, the cost in terms of time and resources to WHQL my driver could be a barrier to me putting out my product.</p>
<p>Additionally, if you do have a new device class or something very different from what WHQL is expecting, there is an additional level of pain that you have to go through.</p>
<p>In other words, I feel that in certain cases, WHQL is a barrier to innovation. </p>
<p>Not to mention the whole idea of MSFT playing big brother regardless of the benefit is also an issue.  If it is really necessary, then an independent 3rd party should WHQL certify where Microsoft would have to undergo the exact same requirements and not be able to make exceptions for their own code.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297263">
				<div id="div-comment-297263" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">dakirw</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297263">
			August 16, 2005 at 1:14 pm</a>		</div>

		<p>I&#8217;m guessing that &quot;your&quot; was meant to be &quot;you&quot;:</p>
<p>The whole purpose of that dialog is to prevent the situation your desire from happening!</p>
<p>Otherwise, interesting article. Thanks for taking the time out to write up stuff every weekday.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297273">
				<div id="div-comment-297273" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">price</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297273">
			August 16, 2005 at 1:40 pm</a>		</div>

		<p>How much does the WHQL thing cost?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297283">
				<div id="div-comment-297283" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">tekumse</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297283">
			August 16, 2005 at 1:45 pm</a>		</div>

		<p>sorry Raymond but this qualifies as your lamest argument ever.  Considering the usual high quality I say this one is in a category of itself.</p>
<p>Disclaimer:  I am a user, never worked in a hardware vendor nor in software/driver related company.</p>
<p>Your argument can be summed thus: &quot;In order to make sure your computer is more stable Microsoft is making the hardware more expensive.&quot;  All this certification cost is passed back to the consumer of the hardware.</p>
<p>WHQL is a monopoly and the worst of it.  Arrogant, anti-competitive, expensive, buearacratic.</p>
<p>Remember AT&amp;T and proprietary phones?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297293">
				<div id="div-comment-297293" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dave</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297293">
			August 16, 2005 at 2:20 pm</a>		</div>

		<p>&quot;In order to make sure your computer is more stable Microsoft is making the hardware more expensive.&quot; </p>
<p>When a hardware vendor makes a crappy driver and foists it off on users, they are just shifting costs from themselves to their users. Instead of selling the product for $40, they sell it for $30 and let the user spin the Wheel of Misfortune. Maybe their users will be lucky and only have an occasional crash. Or maybe the users will lose thousands of dollars worth of valuable data. Thank goodness breaking the little seal on the driver CD absolves the vendor of any responsibilty for that.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297303">
				<div id="div-comment-297303" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">asdfasdf</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297303">
			August 16, 2005 at 2:26 pm</a>		</div>

		<p>But tekumse, certification isn&#8217;t required.  Anyone can install drivers that aren&#8217;t certified.  And anyone can write drivers that aren&#8217;t certified.  The point is that they&#8217;re going to get a warning letting them know that anything can happen.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297323">
				<div id="div-comment-297323" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Bryan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297323">
			August 16, 2005 at 2:56 pm</a>		</div>

		<p>Yep, anything can still happen, even with signed drivers.  It&#8217;s impossible to fully test any significant piece of software, including drivers.</p>
<p>(The complexity of the DDK interfaces doesn&#8217;t help with that either, but that&#8217;s a separate issue.)</p>
<p>WHQL signing is at best a statement saying &quot;Microsoft&#8217;s testing team couldn&#8217;t get this to fail&quot;.  Which is, fundamentally, not worth a whole lot.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297343">
				<div id="div-comment-297343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Cooke</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297343">
			August 16, 2005 at 3:21 pm</a>		</div>

		<p>Does Windows let users install certs from other driver certification organisations? It seems to me that I should be given the option to trust Joe Random Driver Certification Company if I want to. More likely, though, is that a system vendor will do its own testing on hardware for systems it ships and would thus be able to sign the drivers for the devices in the system themselves and install their certificates on systems that they sell.</p>
<p>I think it&#8217;s Microsoft being the centralized authority that makes most people balk at this certification business. For many people there are other orgnisations that they would trust just as much or moreso than Microsoft to certify drivers, and buying a system from a company implies trust in them I think. (after all, there&#8217;s nothing to stop them doing the driver installation before you get the system, so you&#8217;d never see the signing dialog unless you did a reinstall.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297383">
				<div id="div-comment-297383" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Carlos</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297383">
			August 16, 2005 at 4:13 pm</a>		</div>

		<p>Chris suggested that a price reduction to $1000 would make the WHQL program more popular.  In fact, it costs only $250:<br />
<br /><a rel="nofollow" target="_new" href="http://www.microsoft.com/whdc/whql/policies/testing.mspx" rel="nofollow">http://www.microsoft.com/whdc/whql/policies/testing.mspx</a></p>
<p>Which suggests that price isn&#8217;t the reason for unsigned drivers.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297393">
				<div id="div-comment-297393" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">AndyC</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297393">
			August 16, 2005 at 4:14 pm</a>		</div>

		<p>Ben: The problem with that is that a dodgy hardware vendor could just create an installer that installs their own certificate, then installs the now trusted signed driver, completely negating the signing process.</p>
<p>Installers that bypass these kind of checks by sending Windows messages really need to be stopped though. There should be some way of preventing automation of system dialogs like this. I appreciate that&#8217;s not easy though.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297403">
				<div id="div-comment-297403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anonymous Coward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297403">
			August 16, 2005 at 4:46 pm</a>		</div>

		<p>Take this situation:</p>
<p>Video driver has a random pointer and writes to memory owned by someone else.</p>
<p>Audio driver has a perfectly valid pointer that just got badly corrupted. It writes to that and BSODs. The error message says &#8216;Audio driver was running and it just crashed.&#8217;</p>
<p>Clearly this is not the fault of the audio driver but they&#8217;ll be getting the support calls. Or, more likely, several different drivers will be blamed on different systems and at different times.</p>
<p>Reporting information that is likely to be inaccurate is a bad idea.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297413">
				<div id="div-comment-297413" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Edward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297413">
			August 16, 2005 at 5:16 pm</a>		</div>

		<p>I thought you were only required to submit source code if you wanted your driver to be shipped &quot;in the box&quot; with Windows. If you just want to have people install it off a CD with some hardware or download it then you only need to submit the binary for testing. </p>
<p>Looking at Vista it seems the final version will refuse to install ANY drivers that are not signed. The beta only lets things through because there are not enough signed drivers around for all the available hardware. Perhaps that is only for Graphics drivers.</p>
<p>Also doesn&#8217;t Vista have a seperate secure desktop that is used for the InfoCard properties? By making the driver secutiry dialogs use that environment you would prevent any manipulation via window messages.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297423">
				<div id="div-comment-297423" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Cooke</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297423">
			August 16, 2005 at 5:18 pm</a>		</div>

		<p>Many of these bypassing tricks could be avoided by having the driver install confirm messages appear in a separate window station, similar to the trick used with screen savers and the Ctrl+Alt+Del dialog to stop running applications from messing with them. It would mean that the user would be unable to interact with the desktop while the dialog is displayed, but I think that&#8217;s a small price to pay, especially since driver installation is something that one (hopefully) does pretty infrequently.</p>
<p>The whole driver install process doesn&#8217;t need to be done like this, but the message whining about a driver not being signed certainly does, as would a theoretical dialog for installing new driver certificates, which should be full of lots of big red warnings telling users that it&#8217;s probably a bad idea.</p>
<p>I remember reading, though, that it&#8217;s not uncommon for driver installers to simply shove the relevant entries into the registry directly without going through the driver install APIs. There&#8217;s little that can be done about this except to place access controls on the relevant parts of the registry which the real driver installer can bypass. Perhaps recent versions of Windows do this already; I&#8217;ve not really ever checked. :)</p>
<p>It&#8217;s a shame that drivers are now often provided in installer packages. I much preferred it when drivers were installed through the Add Hardware interface based on a completely declarative install script, thus restricting what could happen at driver install.</p>
<p>I&#8217;ve thought for a while now, in fact, that all software installation under Windows should be based on declarative scripts (describing what needs to be done) run through a standardized installer rather than through executables. It would then allow the standardized installer to impose rules on software installation rather than simply having conventions, and force prompts where the installer wants to do something a little iffy such as writing to the Windows directory. Of course, it&#8217;s too late for all that now, and there&#8217;s not really any way to stop vendors shipping installer applications anyway since the system can&#8217;t distinguish between a setup program and an actual application.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297443">
				<div id="div-comment-297443" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://smartfrog.org/' rel='external nofollow' class='url'>Steve Loughran</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297443">
			August 16, 2005 at 5:31 pm</a>		</div>

		<p>Declarative deployment is the best way to deploy things. .MSI tried to do this but added a &quot;custom&quot; feature that got hacked into by every installer tool vendor, so the declarative stuff got completely ignored. </p>
<p>i actually work on distributed system deployment by day, and it is things that dont clean up that cause the most trouble. Drivers may cause bluescreens, but it is normally apps that get your system into such a complete mess that &quot;rebuild time&quot; is your only option. This is why vmware/vpc and xen are so cool. you can clone system images, install something for single use and then delete the disk image after use. nice. its a wonderful future, and it also blows away so much app activation protection that stuff is doomed too. why worry about WGA when entire vm images can be shared?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297483">
				<div id="div-comment-297483" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dazhel</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297483">
			August 16, 2005 at 7:01 pm</a>		</div>

		<p>&lt;i&gt;I remember reading, though, that it&#8217;s not uncommon for driver installers to simply shove the relevant entries into the registry directly without going through the driver install APIs. There&#8217;s little that can be done about this except to place access controls on the relevant parts of the registry which the real driver installer can bypass. Perhaps recent versions of Windows do this already; I&#8217;ve not really ever checked. :) &lt;/i&gt;</p>
<p>I believe you&#8217;re correct Ben, I have worked for a company that produced a driver that did exactly that. Digital signatures were the last thing on their mind because WHQL submission would have introduced an external dependency into the almighty schedule.</p>
<p>Right up to and including Windows Server 2003, the registry entries required you refer to were accessible only by administrative users, but not solely through the driver installation APIs . We never had the problem of a warning dialog being shown during installation.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297523">
				<div id="div-comment-297523" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">tekumse</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297523">
			August 16, 2005 at 7:33 pm</a>		</div>

		<p>So the majority of vendors hate enough WHQL program to create all kinds of crazy hacks and I&#8217;m sure some of those using it are not trilled about it and the problem is with them??? Now that&#8217;s arrogance.</p>
<p>What happened to Raymond who thought that if something doesn&#8217;t work the way most people expect it then it is broken?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297193">
				<div id="div-comment-297193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Stringfellow</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297193">
			August 16, 2005 at 12:36 pm</a>		</div>

		<p>I *love* Steve&#8217;s idea. Seeing crash statistics would help me make a more informed choice. There are pitfalls that would need to be worked out (e.g. a particular device might show a lot of crashes simply because it&#8217;s very popular and therefore in a lot of systems) but there is certainly some potential there.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297533">
				<div id="div-comment-297533" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Carlos</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297533">
			August 16, 2005 at 8:07 pm</a>		</div>

		<p>So how do you explain when WHQL drivers hang, lock up and generally destroy my machine? Yes, nVidia, ATI, Microsoft, and many other companies are to blame. WHQL is just Microsoft&#8217;s way of steering the market in its own whims. Guess what for Vista? You won&#8217;t be allowed to install non-WHQL drivers. You&#8217;ll be required to go through WGA just to install drivers. Your hardware will be buried under layers of DRM which decides how you get to use the hardware you paid for. You don&#8217;t own your PC, Microsoft does.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297543">
				<div id="div-comment-297543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://silverstr.ufies.org/blog/' rel='external nofollow' class='url'>Dana Epp</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297543">
			August 16, 2005 at 8:47 pm</a>		</div>

		<p>Raymond,</p>
<p>Interesting post. However, I think we need to be fair here and say part of the problem is the fact WHQL doesn&#8217;t HAVE a certification program for all driver types out there. I have a few kernelmode drivers that I wrote, some requiring consent dialogs (NDIS and TDI style network filters) and one that does not (an IFS filter). When I approached Microsoft for certification and went through the process, it was found that WHQL doesn&#8217;t currently have a category and cannot therefore issue a set of tests against the drivers. We can&#8217;t even go through the process of being tested, never mind getting the driver signed or get the WHQL badge.</p>
<p>If Microsoft wants to sign only drivers that have passed testing in the WHQL lab, I am for it. But they need to have the resources and the test plans to avail itself so developers that leverage the DDK can go end to end with the process. Currently, thats not possible&#8230; making it a suspect process for many driver developers out there. I run all our code through the IOStress and the HCT test kits (with and without Driver Verifier on), as well as use tools like prefast and static driver verifier as part of our build process. However, we can&#8217;t leverage the rest of WQHL&#8217;s offering because it doesn&#8217;t yet exist. And when Vista is released, it will start getting harder to handle this with customers. We take pride in our development and testing process&#8230; yet show up as unprofessional as we have unsigned drivers. Yet there is nothing we can do about it.</p>
<p>Give us an alternative to comply with the driver signing. I don&#8217;t mind going through the process&#8230; but you leave people to dumb hacks to make the installation process easy and professional to customers when you don&#8217;t give an option.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297553">
				<div id="div-comment-297553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">mikeb</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297553">
			August 16, 2005 at 9:03 pm</a>		</div>

		<p>Chris comments: &gt;&gt; How much does WHQL cost? As someone pointed out, if WHQL was free, hardware vendors would submit crappy code and let WHQL QA it. &lt;&lt;</p>
<p>Microsoft does not perform the actual testing of the driver.  The hardware vendor obtains the test suite (a free download, I believe), and runs the test on their own &#8211; fixing problems identified by the test suite. </p>
<p>Once the driver passes test suite, a log that is encrypted by the test suite is sent to WHQL &#8211; that is what is used by MS to verify the driver has passed the tests.</p>
<p>So the costs bourne by the hardware vendor are $250 per submission and the cost of the Verisign certificate.  I&#8217;m sure that for most vendors the main concern is actually performing the work and the schedule impact (note that any updates to the driver need to go throught the same process if they are going to be signed).<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297573">
				<div id="div-comment-297573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/carmencr' rel='external nofollow' class='url'>Carmen Crincoli</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297573">
			August 16, 2005 at 9:29 pm</a>		</div>

		<p>I wish I had a good way to describe the immense difficulty of coding quality device drivers that are, fast, useful, stable, interop-friendly, and cheap.  (After all, the companies want to make money as well.)</p>
<p>It&#8217;s just not as easy as anyone ever imagines.  People have wonderful ideas as to how to fix things, but actually implementing them would be painful, if not impossible.  I know that Raymond&#8217;s regular audience tends to be a more Win32 oriented community than a driver writing one, so I&#8217;ll say this:</p>
<p>Go out, get the DDK, and start writing drivers.  See how demanding it is, and how difficult quality is to control.  In user mode, a bug is a crash.  You stop, debug it, change things up, and keep going.  Even THIS process, in kernel mode, can be painful.</p>
<p>If writing Win32 code in C is running with scissors, writing a kernel mode device driver in C is riding around in a concert on a chipper/shredder.  You&#8217;re probably going to get hurt, and some people are gonna die.</p>
<p>Before you go and quote &quot;but other platforms!&quot; at me, remember that Windows has a far wider range of drivers written for it than any other platform, a good number of which are perfectly stable. This is the ENTIRE point of the WHQL program, to get those marginal drivers to a minimum level of quality.  NOT to ensure they are perfect.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297313">
				<div id="div-comment-297313" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">theller</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297313">
			August 16, 2005 at 2:43 pm</a>		</div>

		<p>I was getting blue screens from a buggy MICROSOFT driver (for a netgear cardbus adapter).  Installing the *unsigned* vendor provided driver made it work correctly.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297333">
				<div id="div-comment-297333" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.lawfulneutral.com' rel='external nofollow' class='url'>Chris</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297333">
			August 16, 2005 at 3:07 pm</a>		</div>

		<p>How much does WHQL cost? As someone pointed out, if WHQL was free, hardware vendors would submit crappy code and let WHQL QA it. Bad drivers make Microsoft look bad, so Microsoft should make WHQL very easy, but still provide a minor inconvenience *to PHBs*! Most programmers want to write good code. I bet most hardware vendors avoid WHQL because of cost-averse PHBs. If Microsoft charged (say) just $1000, then PHBs would reluctantly give in but insist that programmers write good code to avoid unnecessary resubmission to WHQL.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297583">
				<div id="div-comment-297583" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James Day</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297583">
			August 16, 2005 at 10:09 pm</a>		</div>

		<p>Carlos,</p>
<p>I hope you&#8217;re wrong about not being able to insall unsigned drivers in Vista. Sounds like a really consumer-unfriendly approach. I definitely don&#8217;t want to be in a world where only drivers Microsoft approves can be installed.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297373">
				<div id="div-comment-297373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dave</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297373">
			August 16, 2005 at 4:13 pm</a>		</div>

		<p>&quot;I was getting blue screens from a buggy MICROSOFT driver (for a netgear cardbus adapter). Installing the *unsigned* vendor provided driver made it work correctly. &quot;</p>
<p>About two years ago, for some of their wireless junk, Netgear put out incompatible versions of the hardware that had the SAME Plug and Play ID. So, if you let Windows auto-detect the hardware and install the driver based on the PnP ID it would sometimes install the wrong driver. One of the cardinal rules of PnP is NEVER give the same ID to two different pieces of hardware.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297603">
				<div id="div-comment-297603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jon Potter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297603">
			August 17, 2005 at 12:24 am</a>		</div>

		<p>Haven&#8217;t you noticed this is exactly the way the world (or Microsoft&#8217;s world) is going? It won&#8217;t be too much longer before ALL software has to be approved by Microsoft before it can be installed&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297433">
				<div id="div-comment-297433" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">User</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297433">
			August 16, 2005 at 5:26 pm</a>		</div>

		<p>many years have passed since introduction of bluetooth, and yet WHQL bluetooth certification does allow ONLY a limited number of profiles.</p>
<p>if you, as a manufacturer, try to provide all the bluetooth profiles (specific examples: bluetooth audio gateway, bluetooth network card (not dialup adapter)), you do not receive WHQL! which means that *ALL* the bluetooth device drivers used in *ALL* major laptops (ibm/lenovo,dell,etc) are unsigned!!!!! (and consequently are using various schemes to bypass the warning dialog message).</p>
<p>as another user said here, WHQL has become yet another monopolistic arrogant, anti-competitive, buearacratic tool. it has become useless for users. fortunately it is quite easy to circumvent.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297623">
				<div id="div-comment-297623" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.foxyshadis.com' rel='external nofollow' class='url'>foxyshadis</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297623">
			August 17, 2005 at 12:35 am</a>		</div>

		<p>I don&#8217;t think all the comments about WHQL being arrogant, monopolistic, etc, are fair. They exist to try being a measure of stability and repeatability, to all the random drivers out there. On the other hand, they&#8217;re out of date; before the internet, when drivers were only released once on in long increments, it would make sense, but now updates are released weekly or monthly in many cases, to correct minor bugs and occasionally add features, requiring a costly resubmission for each. And of course new product categories that aren&#8217;t really new anymore really do need to be dealt with.</p>
<p>Maybe if once a driver passed, updates that passed the suite could be signed for free.</p>
<p>On the other hand, I wish some companies would keep their printer drivers stable, since terminal services requires exactly the same driver on each end. (Or at least a print processor that can decode its print driver&#8217;s stream, which Brother changes every update.)</p>
<p>I doubt vista will ship requiring driver verification, the companies will revolt.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297643">
				<div id="div-comment-297643" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Phylyp</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297643">
			August 17, 2005 at 1:38 am</a>		</div>

		<p>I cannot comment on whether WHQL is a monopolistic practice, on whether WHQL testing is really thorough&#8230; </p>
<p>What I can say is: back when I used Win 95 OSR 2 I used to face various BSoDs that were apparently rooted in drivers and VxDs.  I now run Win XP SP2, and the only time I saw a blue screen was when I removed my wallpaper [really lame joke, I know :)]</p>
<p>One thing I ensured while setting up my current box was to use only signed drivers.  Maybe that helped, maybe its just XP SP2 that&#8217;s more stable&#8230; but what matters is that I&#8217;m happy.</p>
<p>The current WHQL may not be the ideal process, but I see good (IMHO) ideas being put out.  Hope someone on the WHQL team is going through this blog.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297653">
				<div id="div-comment-297653" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anon</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297653">
			August 17, 2005 at 3:49 am</a>		</div>

		<p>I am really beginning to wish that Windows would really lock down what installation apps (and apps in general) can do to a system.</p>
<p>I really wish that I simply didn&#8217;t have the rights to write to certain directories or read/write certain registry keys. Because when management comes and asks me if I can do something, I have to answer that technically I can. Even though I feel that the behaviour in question is dodgey as all hell.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297663">
				<div id="div-comment-297663" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://wind.codepixel.com' rel='external nofollow' class='url'>Antonio Vargas</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297663">
			August 17, 2005 at 4:35 am</a>		</div>

		<p>[1] Crap hardware, bcos it&#8217;s cheaper to buy parts.</p>
<p>[2] Crap code, bcos good coders ask for too much money.</p>
<p>[1] + [2] ==&gt; BSOD</p>
<p>News at 11!!!<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297673">
				<div id="div-comment-297673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James Moore</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297673">
			August 17, 2005 at 4:58 am</a>		</div>

		<p>Signed drivers I can see the point of.<br />
<br />However some MS security features are a pain in the ass for seemingly little benefit.</p>
<p>For example I do some development in C# for an application at my workplace. In the past executables from VB and C++ are run from a network share. Now the CLR fails to run CLR exes because the assembly needs to be specially signed or full access allowed to local intranet zone.</p>
<p>So now I would have to visit every PC and change the .net Configuration.</p>
<p></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297683">
				<div id="div-comment-297683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ElBiggus</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297683">
			August 17, 2005 at 7:47 am</a>		</div>

		<p>&quot;Reporting information that is likely to be inaccurate is a bad idea.&quot;</p>
<p>Try telling that to whoever wrote the Add/Remove Programs app&#8230;  :)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297633">
				<div id="div-comment-297633" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">zzz</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297633">
			August 17, 2005 at 1:26 am</a>		</div>

		<p>I&#8217;m just a dumb end-user so I&#8217;ll list my concerns:</p>
<p>* It seems that circumventing the safety mechanisms is too easy, security related dialogs should be made so that only already installer drivers (mouse) can access them. </p>
<p>* Automation of things should not be possible through hacky approaches.</p>
<p>* Maybe it will be in future processors possible to have each driver in their own space or such that it is easier to know what driver causes crash.</p>
<p>* Having a similar, perfected installer for all applications and drivers would be good. Companies can then do minor customizations to this by specifying audio,text,video or 3D graphics to be displayed during the install. Current installer companies can go to * since most of the install programs are mediocre and over-size and slow etc at best.</p>
<p>* Windows should have a mechanism to split files somehow &#8211; I imagine having single downloadable installer image. When executed the image (suppose it is 3 GB in size, a huge game), provided that it is run on the destination drive of the install, could just split itself to the files inside of it without any copying processes involved. So download a huge file to C: then run it and it will split into many files which are then moved to appropriate places. 1 second install! Patent pending soon!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297693">
				<div id="div-comment-297693" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.pelpem.com' rel='external nofollow' class='url'>John Goewert</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297693">
			August 17, 2005 at 8:50 am</a>		</div>

		<p>To anyone above who wrote &quot;I have all WHQL drivers installed and my machine still is buggy!&quot;</p>
<p>Please read exactly what Raymond has said.<br />
<br />Then, re-read it. Go ahead and give it a third time.</p>
<p>He said that systems can be unstable and BSOD because hardware manufacturers are using two code paths: one for the WHQL tests that work perfectly and get approved, then use triggers and flag th have it run a completely different path on the end user&#8217;s machines from the same binary that the WHQL tested.</p>
<p>And before you start MS bashing, think to yourself&#8230; and be honest&#8230; ever had a kernel panic because of a dodgy driver in Linux?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297713">
				<div id="div-comment-297713" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nate</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297713">
			August 17, 2005 at 10:38 am</a>		</div>

		<p>The uncertified driver warning is just an annoyance. Only an out-of-touch geek would think that it is a security feature.</p>
<p>Here is what normal people see. Hell, it&#8217;s what I see, since I don&#8217;t spend 10 minutes contemplating every damn dialog you throw at me:</p>
<p>  Blah blah blah blah<br />
<br />  Technobabble technobabble blah blah<br />
<br />  Blah blah blah blah<br />
<br />  Blah blah blah blah<br />
<br />  Blah blah blah blah</p>
<p>  [Some button]   [Some other button]</p>
<p>If I pause and concentrate, I can probably figure out the implications one way or the other.</p>
<p>There is no way my Dad can figure it out. He just wants his device to work, and so he will press the default button. If that doesn&#8217;t work, he will run the installer again and press the other button. What the hell did you think a normal, non-geek person would do?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297733">
				<div id="div-comment-297733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Eric Brown</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297733">
			August 17, 2005 at 12:03 pm</a>		</div>

		<p>Well, Nate, if Microsoft changed the dialog to say:</p>
<p>Warning!  Your hardware manufacturer hasn&#8217;t bothered to test this driver!</p>
<p>Do you feel lucky?</p>
<p>Yes     No</p>
<p>Quite a few people would be annoyed.  So they have to change the dialog.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297793">
				<div id="div-comment-297793" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Cooney</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297793">
			August 17, 2005 at 1:23 pm</a>		</div>

		<p>All I know is that, should Longhorn, I mean Vista refuse unsigned drivers outright, I won&#8217;t be buying it. Windows isn&#8217;t the only game in town.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297813">
				<div id="div-comment-297813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">bnt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297813">
			August 17, 2005 at 1:58 pm</a>		</div>

		<p>Oh, this is just awesome. Microsoft requires a certification program for drivers and it&#8217;s called  &quot;monopolistic, anti-competitive and arrogant.&quot; When Sun, IBM or some OSS foundation does the exact same thing, it&#8217;s called &quot;open, trust, competitive, standardization and quality.&quot; MS-bashers, get a clue, please.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297833">
				<div id="div-comment-297833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark G</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297833">
			August 17, 2005 at 4:07 pm</a>		</div>

		<p>Well, after reading most of the comments on this topic I figured I would voice up my opinion having to constantly deal with this issue. First, a little background. I work for a company that manufacutres automotive diagnostic equipment. </p>
<p>Our tool plugs in (via USB) to a Windows PC and interfaces with the car. The USB chip in our device is a standard, off-the-shelf component with a driver that has passed WHQL. We don&#8217;t even have the source code for this driver. Now, the certified driver we&#8217;ve seen cause BSOD&#8217;s and hung IRP&#8217;s. But only in very odd situations, so I can understand WHQL missing it.</p>
<p>However, for our product we take this driver, modifiy the VID &amp; PID in the INI file and then that dialog box comes up. Now, our customers are auto mechanics who get very, very scared by that dialog box. We&#8217;ve lost a few customers who returned the thing and couldn&#8217;t even install the driver. </p>
<p>Despite us manufacturing our own hardware we are just not able to pay for WHQL certification every time our vendor (FTDI) comes out with a new driver. I understand why the warning is there and would prefer that it be kept. But I wish that WHQL costs could be reduced. </p>
<p>-Mark</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297853">
				<div id="div-comment-297853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.foxyshadis.com' rel='external nofollow' class='url'>foxyshadis</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297853">
			August 17, 2005 at 4:35 pm</a>		</div>

		<p>zzz:<br />
<br />&lt;&lt;&lt;<br />
<br />* Windows should have a mechanism to split files somehow &#8211; I imagine having single downloadable installer image. When executed the image (suppose it is 3 GB in size, a huge game), provided that it is run on the destination drive of the install, could just split itself to the files inside of it without any copying processes involved. So download a huge file to C: then run it and it will split into many files which are then moved to appropriate places. 1 second install! Patent pending soon!<br />
<br />&gt;&gt;&gt;</p>
<p>This is exactly how installers have worked for many years, to a greater or lesser extent. I&#8217;m not sure what&#8217;s new here. The reason installations are slow even though all they are is splitting a zip (if that), it because disk reading and writing speed is a huge bottleneck.</p>
<p>Your other statement pretty much describes MSI and recent versions of InstallShield.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297883">
				<div id="div-comment-297883" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.lawfulneutral.com' rel='external nofollow' class='url'>Chris</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297883">
			August 17, 2005 at 8:00 pm</a>		</div>

		<p>solution: revisit the NT microkernel design. Move device drivers from kernel mode to user mode. Crappy device drivers crash themselves, not the entire OS. I&#8217;ve read that Longhorn/Vista is introducing support for user-mode device drivers.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297773">
				<div id="div-comment-297773" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nate</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297773">
			August 17, 2005 at 1:01 pm</a>		</div>

		<p>Scenario 1</p>
<p>&quot;How should we deal with bad device drivers?&quot;</p>
<p>&quot;I know! Let&#8217;s put up a dialog forcing the user to acknowledge that the device driver might be bad. Then it will be *their* fault if it fails!&quot;</p>
<p>&#8212;-</p>
<p>Scenario 2</p>
<p>&quot;How should we deal with bad device drivers?&quot;</p>
<p>&quot;I know! Let&#8217;s warn the user. Then, when they see the warning they can either drive back to the store to return the product, or call the manufacturer and ask them for a certified driver. Since most computer stores and all manufacturers are responsive to customer needs, they will *certainly* either refund their money and suggest a certified replacement, or quickly re-write their driver and certify it. And since all users are rational, they would never install the un-certified driver.&quot;</p>
<p>&quot;And these steps won&#8217;t be inconvenient at all compared to clicking the &#8216;Continue&#8217; button!&quot;<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297823">
				<div id="div-comment-297823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nate</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297823">
			August 17, 2005 at 2:51 pm</a>		</div>

		<p>I&#8217;m an MS-basher (well, I am in this thread, but not always), and I think that if having certified drivers is so all-fired important, then Windows should refuse to install them. Correspondingly, make the certification process free or low-cost.</p>
<p>Another alternative would be to refuse to install non-certified drivers for devices that Windows already supports. Then, discourage IHVs from writing drivers and focus on increasing Windows&#8217; built-in support for devices. The world doesn&#8217;t need another mouse driver, another printer port monitor, or for gobsake, an OEM driver for a USB memory stick!</p>
<p>Another alternative would be for Microsoft to build the PCs, using only hardware they approved of. Don&#8217;t support anything else. Or require PC makers to certify their designs, using only approved devices. *</p>
<p>Anything is better than dumping the problem on the user&#8217;s lap.</p>
<p>* This isn&#8217;t as far fetched as it seems. Microsoft is doing it already with the X-Box and, to a lesser degreee, with HPCs and HTPCs. Apple has done it forever.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297893">
				<div id="div-comment-297893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Gabe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297893">
			August 18, 2005 at 12:07 am</a>		</div>

		<p>You can&#8217;t just run arbitrary drivers in user mode because some need direct hardware access. Anything that can access hardware can crash your machine, so it almost doesn&#8217;t matter if its memory is protected because the whole rest of the machine is open for abuse. Why pay the massive price of separate address spaces (mapping, copying, TLB flushes, cache misses) if it isn&#8217;t even going to solve your problem?</p>
<p>On the other hand, many drivers don&#8217;t need to access hardware, and they may be able to run from user mode (see user mode WDF). There&#8217;s no reason my USB CF reader&#8217;s driver should be able to bring down my machine, but there is definitely a perf hit for making all those user&lt;-&gt;kernel transitions.</p>
<p>Based on the fact the posts calling WHQL a monopolistic manifestation of Big Brother and a seemingly equal number suggesting that it be more draconian, I would suggest that MS is doing a good job.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-297913">
				<div id="div-comment-297913" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Hayden</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297913">
			August 18, 2005 at 8:19 am</a>		</div>

		<p>Yes, user-space device drivers. Perhaps that should be &quot;re-introduce&quot; user-space drivers :-) I believe NT3.51 worked that way. NT4 went back to ring0 drivers because it made it a lousy games platform.</p>
<p>It&#8217;s true &#8211; a driver can crash your PC by doing bad stuff to DMA, PCI bus control, USB controller etc. But I bet most BSODs come from good old-fashioned memory treading (re-use freed block, buffer overflow. stack corruption), so user-space running would catch, what, 70% of buggy driver failures?</p>
<p>You could also perhaps reduce the severity of the warning for user-space drivers, so that the user would be less frightened, and the 1-man shops (who probably do USB stuff mostly anyway) can sell product without involving Microsoft.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297983">
				<div id="div-comment-297983" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Edward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297983">
			August 18, 2005 at 11:07 am</a>		</div>

		<p>It was only GDI and the Window Manager that were in usermode before NT4. The drivers that talk to the actual hardware have always been kernel mode. </p>
<p><a rel="nofollow" target="_new" href="http://www.microsoft.com/technet/archive/ntwrkstn/evaluate/featfunc/kernelwp.mspx" rel="nofollow">http://www.microsoft.com/technet/archive/ntwrkstn/evaluate/featfunc/kernelwp.mspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-n4cer even thread-even depth-1" id="comment-298193">
				<div id="div-comment-298193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Garry Trinder</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-298193">
			August 18, 2005 at 1:52 pm</a>		</div>

		<p>Many of the things people are asking for are available/coming in &quot;Longhorn&quot;.</p>
<p>A new device driver installation architecture, unified user mode and kernel mode device driver model, and WHQL certification for non-standard device classes. There&#8217;s also a future goal of kernel mode driver isolation (not sure how far along this work is &#8212; probably beyond &quot;Longhorn&quot;) so that even faults in kernel mode drivers are recoverable.</p>
<p>Device Installation Rules for Windows Longhorn<br />
<br /><a rel="nofollow" target="_new" href="http://www.microsoft.com/whdc/driver/install/InstallRules.mspx" rel="nofollow">http://www.microsoft.com/whdc/driver/install/InstallRules.mspx</a></p>
<p>Windows Driver Foundation<br />
<br /><a rel="nofollow" target="_new" href="http://www.microsoft.com/whdc/driver/wdf/default.mspx" rel="nofollow">http://www.microsoft.com/whdc/driver/wdf/default.mspx</a></p>
<p>Windows Vista Driver Development<br />
<br /><a rel="nofollow" target="_new" href="http://www.microsoft.com/whdc/driver/wdk/default.mspx" rel="nofollow">http://www.microsoft.com/whdc/driver/wdk/default.mspx</a></p>
<p>Windows Vista Logo Program<br />
<br /><a rel="nofollow" target="_new" href="http://www.microsoft.com/whdc/winlogo/LH_logo.mspx" rel="nofollow">http://www.microsoft.com/whdc/winlogo/LH_logo.mspx</a></p>
<p>The Driver Quality Signature Program (for devices that don&#8217;t fit established MS Logo programs)<br />
<br /><a rel="nofollow" target="_new" href="http://www.microsoft.com/whdc/winlogo/drvsign/dqs.mspx" rel="nofollow">http://www.microsoft.com/whdc/winlogo/drvsign/dqs.mspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-297903">
				<div id="div-comment-297903" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nick Lamb</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-297903">
			August 18, 2005 at 6:58 am</a>		</div>

		<p>Of course people aren&#8217;t actually asking for a security hole&#8230; the security hole already exists and Raymond more or less admits that.</p>
<p>As to the &quot;drivers crash.. bad&quot; part of this argument, Microsoft isn&#8217;t doing half of what they ought to do from an engineering point of view if that was the focus. WHQL provides a barrier to entry targetted at Microsoft&#8217;s worst fears ($250 doesn&#8217;t keep out IBM but it does keep out Joe Blow), another excuse to drive developers through the &quot;just buy one more certificate&quot; milking process, and as an added bonus a way to get first look at new things coming down the pipeline (remember Microsoft is also a hardware company &#8211; they&#8217;re asking people to send potentially valuable information to their direct competitor &#8211; uh, right)</p>
<p>If Microsoft wanted to improve reliability and device driver quality, and if they wanted the user to help drive this improvement to the right people, then they would&#8230;</p>
<p>* Let the vendor install a cert chain (buy IBM, get an IBM cert, all IBM drivers are authorised, let IBM take the heat when it breaks).</p>
<p>* Give away the middle layer. Windows device drivers do too much work, adding complexity where the system is at its most vulnerable. Microsoft has a software RAID solution that&#8217;s useable. But that solution isn&#8217;t included in every Windows (for market segmentation reasons, ie marketing overides engineering) so a zillion users have &quot;upgraded&quot; with a 3rd party driver. There are dozens of other examples where Microsoft has or could quickly develop 90% of the code in 3rd party drivers and could provide a service layer to those drivers eliminating the bulk of their code. Less code =&gt; Less bugs.</p>
<p>* Push drivers into userspace. There is no reason why a bug in the driver for my fancy USB mouse should kill Windows. If developers are finding it easier to make that fancy driver run with excess privileges, work with them to reverse the trend. If they&#8217;re doing it out of habit, find ways to break the habit. Most machines ought to have less than half a dozen hardware-specific (and thus provided by 3rd parties) kernel drivers but on Windows it&#8217;s commonly many times more.</p>
<p># Disk controller<br />
<br /># Sound<br />
<br /># Graphics<br />
<br /># Network<br />
<br /># Video in (e.g. webcam, DVB)</p>
<p>Gee, there do seem to be a LOT more 3rd party files than can be explained by that loaded into the NT kernel. WHQL isn&#8217;t fixing that, with or without an &quot;Install anyway&quot; dialog. If Raymond wants to address driver quality and improve Windows security in the bargain, here&#8217;s a suggested title</p>
<p>&quot;Why you shouldn&#8217;t write a (kernel) driver&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-298883">
				<div id="div-comment-298883" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jake</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-298883">
			August 19, 2005 at 2:31 pm</a>		</div>

		<p>On the issue of having Vista not allow the installation of drivers that have not been accepted by MS (assuming this is the case), I personally feel that this is too much power.  It allows one company to render the products of other companies literally useless.  These companies are sometimes competing with MS, or its partners.  Bad scenario.</p>
<p>That said, I think there is another large reason for the new (supposed) policy that has been overlooked in this discussion: DRM and the like.  Without this move, it is much harder to protect content.  The problem is that this, like most attempts to restrict what it is possible for a consumer to do with his own machine, adds no immediate benefit to the consumer, often serving only to annoy or inconvenience him/her. (The âbig pictureâ benefits are another discussion.)<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-299433">
				<div id="div-comment-299433" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-299433">
			August 21, 2005 at 4:42 am</a>		</div>

		<p>A few comments here, the first of which is tangential to the topic.</p>
<p>1.  It&#8217;s not only driver installers that automatically click buttons and hide their shenanigans from victims.  A CD/DVD writing program, which used to be my favourite in this genre, did the same thing.  During installation it invoked Windows Media Player in a hidden window and issued invisible instructions to Windows Media Player to persuade it to change the DVD region code in the drive&#8217;s firmware.  This is the thing that can only be changed 4 times and then the drive automatically disables it from being changed again.  We need logo certification for apps too, and have certification denied to apps that screw their customers.</p>
<p>2.  As mentioned before but it bears repeating, I was also tricked by a &quot;security&quot; app that played the same kind of game to install an unsigned driver without the user&#8217;s knowledge.  Maybe I know which company &quot;Joe&quot; used to work for.  One version of their unsigned driver caused a few blue screens.  Naturally I blamed Microsoft because I didn&#8217;t even know that driver was there.  After being gently reminded of how to check for what drivers are installed, I found it.</p>
<p>3.  Also mentioned before but bears repeating.  Despite the blue screens mentioned in item 2 above, I&#8217;ve still had about 50 times as many blue screens caused by signed drivers than caused by unsigned drivers.  And I&#8217;ve still had more blue screens caused by drivers that Microsoft designated themselves as the provider and publisher and self-signer, than drivers received from other vendors.</p>
<p>So, I have no opinion one way or the other about signed or unsigned drivers, but the trickery and secrecy played by some vendors is pretty offensive.  The user needs to be informed when drivers are being installed, signed or not.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-300213">
				<div id="div-comment-300213" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.ceamus.com' rel='external nofollow' class='url'>Clay Dowling</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-300213">
			August 23, 2005 at 10:00 am</a>		</div>

		<p>Somebody mentioned the joy of loading Linux on a laptop (especially an older, slightly dodgy laptop).  I have lots of different operating systems around my house, and I assure you that Linux, which lets everybody and his idiot brother write drivers, is a pretty hit and miss affair for laptop support.  Windows XP runs quite well even on some pretty obscure hardware.</p>
<p>The one operating system that has been completely without flaw or trouble is OpenBSD.  And what does this operating system have in common with Windows?  Driver authoring is very tightly controlled by a central group of developers.  They are in fact an wholly undemocratic lot and make the WHQL process look pretty benign.  Source must be provided or it won&#8217;t even be considered, and programming problems will get you the boot, even if they aren&#8217;t tripped over during runtime.</p>
<p>So keep in mind, if you don&#8217;t like Windows, there are alternatives.  Even alternatives that might cause the drivers you write for your software to be of much higher quality.  But if you like that option to keep your code proprietary, a little bit of driver signing is a pretty small price to pay.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-301573">
				<div id="div-comment-301573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/craigrow/archive/2005/08/27/457245.aspx' rel='external nofollow' class='url'>craigrow: blogging about developing, testing and getting a logo for your drivers using the Windows Driver Kit and the Driver Test Manager</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-301573">
			August 28, 2005 at 12:59 am</a>		</div>

		<p>This&amp;amp;nbsp;is the best story I&#8217;ve ever heard about somebody trying to get around the unsigned driver dialog&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-342443">
				<div id="div-comment-342443" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://proxy.11a.nu/2005/09/14/device-driver-signing-bypasses/' rel='external nofollow' class='url'>proxy.11a.nu : IT Security Research &amp; Development Journal &raquo; Blog Archive &raquo; Device driver signing bypasses</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-342443">
			February 1, 2006 at 1:57 pm</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://proxy.11a.nu/2005/09/14/device-driver-signing-bypasses/" rel="nofollow">http://proxy.11a.nu/2005/09/14/device-driver-signing-bypasses/</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-520683">
				<div id="div-comment-520683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.angelsonlinehome.com/?p=79' rel='external nofollow' class='url'>Angel&#8217;s Online &raquo; Blog Archive &raquo; 64 bit - Don&#8217;t waste my time</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-520683">
			June 29, 2007 at 3:07 pm</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://www.angelsonlinehome.com/?p=79" rel="nofollow">http://www.angelsonlinehome.com/?p=79</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-536433">
				<div id="div-comment-536433" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.angelsonlinehome.com/wp/?p=60' rel='external nofollow' class='url'>64 bit - Don&#8217;t waste my time &raquo; Angel&#8217;s Online</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050816-08/?p=34563#comment-536433">
			August 14, 2007 at 12:49 pm</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://www.angelsonlinehome.com/wp/?p=60" rel="nofollow">http://www.angelsonlinehome.com/wp/?p=60</a></p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>

</body>
</html>
<br/><div class="disclaimer">
*DISCLAIMER: I DO NOT OWN THIS CONTENT. If you are the owner and would like it removed, please
<a target="_blank" href="/contact.htm">contact me</a>.
The content herein is an archived reproduction of entries from
Raymond Chen's "Old New Thing" Blog (most recent link is <a target="_blank" href="https://devblogs.microsoft.com/oldnewthing/">here</a>).
It may have slight formatting modifications for consistency and to improve readability.
<br/><br/>
WHY DID I DUPLICATE THIS CONTENT HERE?
Let me first say this site has never had anything to sell and has never shown ads of any kind. I have nothing monetarily to gain by duplicating content here.
Because I had made my own local copy of this content throughout the years, for ease of using tools like grep, I decided to put it online after I discovered
some of the original content previously and publicly available, had disappeared approximately early to mid 2019.
At the same time, I present the content in an easily accessible theme-agnostic way.
<br/><br/>
The information provided by Raymond's blog is, for all practical purposes, more authoritative on Windows Development than Microsoft's
own MSDN documentation and should be considered supplemental reading to that documentation. The wealth of missing details
provided by this blog that Microsoft could not or did not document about Windows over the years is vital enough, many would agree an online "backup" of these details
is a necessary endeavor. Specifics include:<br/>
<ul>
    <li>
        A "redesign" after 2019 erased thousands of user's comments from previous years. As many have stated, the comments are nearly as important as the postings themselves.
        The archived copies of the postings contained here retain the original comments.
    </li>
    <li>
        The blog has changed domains many times and the urls have otherwise been under constant change since 2003.
        Even when proper redirection has been set up for those links, redirection only works for a limited period of time.
        For example, all of the internal blog links that were valid in early 2019, were broken by 2020 without proper redirection.
    </li>
    <li>
        The blog has been under constant re-design and re-theming since its inception.
        It is downright irritating to deal with a bogged-down site experience as the result of the latest visual themes designed for cell-phone browsers.
        As of this writing, it is cumbersome to navigate titles with only 10 entries per page.
        While it is nice that the official site has a search feature, searching using this index (with all titles on a single page) is much quicker (CTRL-F in most browsers).
    </li>
</ul>
</div><br/>
&lt;-- Back to <a href="index.htm">Old New Thing Archive Index</a>

