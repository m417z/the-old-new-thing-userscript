<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (25)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-1023733">
				<div id="div-comment-1023733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">McKay</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023733">
			December 3, 2012 at 7:02 am</a>		</div>

		<p>So, how should one find a function (for debugging purposes) that has been moved to a different library by another team? (programatically?)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-maurits odd alt thread-odd thread-alt depth-1" id="comment-1023743">
				<div id="div-comment-1023743" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Maurits+%5BMSFT%5D' rel='external nofollow' class='url'>Maurits [MSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023743">
			December 3, 2012 at 7:10 am</a>		</div>

		<p>Please tell me the fix wasn&#39;t to create an aaa.dll in system32 with aaa!FunctionX(a, b, c) { return 0; }</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1023753">
				<div id="div-comment-1023753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/ajgelado_4000_hotmail.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>ajgelado@hotmail.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023753">
			December 3, 2012 at 7:11 am</a>		</div>

		<p>@McKay: in short, you don&#39;t have/need to. If it&#39;s a public function, it will not move. If the other team really needs to move it, they will leave a stub in the original library so compatibility isn&#39;t broken, or at least post information about the move (if it were done before release). On the other hand, if it was moved without warning, chances are that it was an internal function, and you shouldn&#39;t be calling it in the first place.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1023763">
				<div id="div-comment-1023763" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mott555</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023763">
			December 3, 2012 at 7:13 am</a>		</div>

		<p>For fun, write a DLL with the method they were looking for and dump it in the System directory. Make it open the user&#39;s web browser to this blog post, and push the DLL out via Windows Updates. Then wait and see if there are still any users of this application out in the wild.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1023783">
				<div id="div-comment-1023783" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/bombsoft_4000_hotmail.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>bombsoft@hotmail.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023783">
			December 3, 2012 at 7:36 am</a>		</div>

		<p>Mott!!!</p>
<p>I thought you wanted TDWTF levels of oddness, not XKCD levels of cruelty!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1023803">
				<div id="div-comment-1023803" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/stephen.horn_4000_volition_2D00_inc.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>stephen.horn@volition-inc.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023803">
			December 3, 2012 at 8:17 am</a>		</div>

		<p>Seriously, how could xpclient rate this 1-star? I&#39;m in stitches, especially after mott&#39;s suggestion of making the function open a web browser to this page!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1023813">
				<div id="div-comment-1023813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dan Bugglin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023813">
			December 3, 2012 at 8:24 am</a>		</div>

		<p>@McKay For starters, if you write something like this to help you, there&#39;s no need to compile it into your main program. &nbsp;The function isn&#39;t going to change places every time you run your program so there is no need. &nbsp;Put code like this into a temporary project, run it, find your function, and then use the appropriate library name in your main program.</p>
<p>Assuming you did this because it&#39;s undocumented though, it&#39;s probably not the best idea.</p>
<p>Of course since this specific example is because you&#39;re coding it against a system in development, ideally you&#39;d have the phone number of a guy developing the system for questions since everything is changing all the time. &nbsp;In which case, you call him up and say &quot;Hey, where&#39;d FunctionX go? &nbsp;It&#39;s not being exported by user32 anymore&quot;. &nbsp;And then he&#39;d tell you or ask someone who would know.</p>
<p>The fun part is apparently it didn&#39;t even matter that this function call wasn&#39;t working since the program still functioned just fine. &nbsp;Did anyone even notice the call never succeeded?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1023823">
				<div id="div-comment-1023823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Evan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023823">
			December 3, 2012 at 8:49 am</a>		</div>

		<p>I read TheDailyWTF regularly, and this is a better entry than most!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1023833">
				<div id="div-comment-1023833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Koro</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023833">
			December 3, 2012 at 8:51 am</a>		</div>

		<p>This sounds like a huge security hole too, if some of the scanned directories are user-writable.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-brunopitrus odd alt thread-odd thread-alt depth-1" id="comment-1023843">
				<div id="div-comment-1023843" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/kinokijuf' rel='external nofollow' class='url'>kinokijuf</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023843">
			December 3, 2012 at 8:52 am</a>		</div>

		<p>@Lockwood:</p>
<p>XKCD level of cruelty would be opening a shock site.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1023853">
				<div id="div-comment-1023853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/bombsoft_4000_hotmail.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>bombsoft@hotmail.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023853">
			December 3, 2012 at 9:30 am</a>		</div>

		<p>Touch√©</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1023863">
				<div id="div-comment-1023863" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/johnstonj_4000_inn_2D00_soft.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>johnstonj@inn-soft.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023863">
			December 3, 2012 at 9:30 am</a>		</div>

		<p>How many blog entries have we read on here about bad, misbehaving programs doing things they shouldn&#39;t in DllMain? &nbsp;Now here is a program that specifically seeks them out!</p>
<p>Probably the program crashes horribly on any modern computer with a smattering of random 3rd-party apps, some of them surely being ill-behaved. &nbsp;Seems like it&#39;s on a suicide mission&#8230;</p>
<p>The &quot;better&quot; method would have been to analyze the image without running any code from it (similar to Dependency Walker; I&#39;m not sure what functions it uses but those would be the ones to use). &nbsp;Once the correct function is located, then and only then LoadLibrary/GetProcAddress.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alexcohn even thread-even depth-1" id="comment-1023893">
				<div id="div-comment-1023893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Alex+Cohn' rel='external nofollow' class='url'>Alex Cohn</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023893">
			December 3, 2012 at 9:56 am</a>		</div>

		<p>Since the function wasn&#39;t exported anymore, the next step would be to scan all relocation tables for the signature of this function. If it is not there, then somebody changed it&#39;s declaration to static. OK, this means that the scanner should look for it in all code segments.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1023913">
				<div id="div-comment-1023913" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">chentiangemalc</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023913">
			December 3, 2012 at 11:56 am</a>		</div>

		<p>another example of the great (not!) communication that is so common in the software dev/IT world over the world. let&#39;s not ask rest of the windows teams where this function might have gone, let&#39;s make a hacked up function to find it ourselves.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1023933">
				<div id="div-comment-1023933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/stephen.horn_4000_volition_2D00_inc.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>stephen.horn@volition-inc.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023933">
			December 3, 2012 at 12:32 pm</a>		</div>

		<p>@Malcolm: I don&#39;t see any problems with writing a function like this to scan through libs your own company wrote and return which libs contained the appropriate function, as an alternative to pestering someone. That would potentially make the communication unnecessary, or would at least obviate the first question of &quot;where is it&quot; so that the conversation can proceed to &quot;why was it moved&quot;, if needed.</p>
<p>The laughably obvious problem is that the code was checked in as part of some other application, wrecking the performance of the application on startup and introducing a gaping security hole in case said application was shipped to clients somewhere.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1023943">
				<div id="div-comment-1023943" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/jas71_4000_hotmail.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>jas71@hotmail.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023943">
			December 3, 2012 at 12:52 pm</a>		</div>

		<p>Clearly, they weren&#39;t trying hard enough. They should have found an old copy of user32.dll, made a note of the first 32 or so bytes of that function, then instead of relying on GetProcAddress, searched for that byte sequence then branched into whatever code matched.</p>
<p>(Health warning: idea proposed for entertainment purposes only. If you actually do this in real code, please stop programming and report to your nearest fast-food vendor for more suitable employment.)</p>
<p>Apart from anything else, unless they were expecting the function to move between DLLs again in future, why not run it once, say &quot;aha, it&#39;s moved from user32.dll to kernel32.dll &#8211; let&#39;s get it from there now&quot;? Raymond&#39;s interpretation of &quot;maybe it moved to another DLL so let&#39;s try them all&quot; is close, but doesn&#39;t quite capture the depths of insanity here: they either never tested the code at all and never noticed it never worked in the first place, or thought something like &quot;hm, it&#39;s gone from user32.dll, it hasn&#39;t shown up in any other DLL yet &#8230; maybe it just got lost, so it&#39;ll wash up ashore in some random DLL in a few weeks, so let&#39;s code on that basis&quot;. Pretty scary stuff.</p>
<p>I&#39;m reminded of some malware here: trying to obfuscate the file the payload actually attacks by enumerating all files and checking the hash against a specific value. (Researchers knowing &quot;this virus is trying to find SpecialAccountingPackage.exe, it&#39;s probably trying to steal account data, let&#39;s get a copy of that and see what it does&quot; will find it much easier than &quot;it&#39;s trying to attack a file with a SHA1 hash of eed73195584166e03b3077f08cc2a5e833f468e3 &#8230; we&#39;re stumped&quot; &#8211; though of course that particular one is easy to find.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1023963">
				<div id="div-comment-1023963" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Henning Makholm</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023963">
			December 3, 2012 at 1:52 pm</a>		</div>

		<p>@jas88: This one? <a rel="nofollow" target="_new" href="http://www.schneier.com/blog/archives/2012/08/help_cryptanaly.html" rel="nofollow">http://www.schneier.com/&#8230;/help_cryptanaly.html</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1023983">
				<div id="div-comment-1023983" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1023983">
			December 3, 2012 at 3:22 pm</a>		</div>

		<p>It&#39;s usually easier to write this kind of code that to communicate with people that has the social skills of a thermonuclear device.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1024003">
				<div id="div-comment-1024003" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Silly</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1024003">
			December 3, 2012 at 6:57 pm</a>		</div>

		<p>So the real wtf is they weren&#39;t placing the search algo in a &#39;RunOnce&#39; utility and caching the result by placing the dll name (or a null byte if not found) in some file loaded by the main program when launched by the user. Or perhaps running a thread that did the search/cache every hour or so in case the available dlls changed. Right?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1024013">
				<div id="div-comment-1024013" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">The Enumerator</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1024013">
			December 4, 2012 at 1:51 am</a>		</div>

		<p>&quot;Well, yeah, but still, what possesses you to try such a crazy technique, even if only for debugging?&quot;</p>
<p>A deadline. The answer is always a deadline.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1024023">
				<div id="div-comment-1024023" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">JM</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1024023">
			December 4, 2012 at 3:21 am</a>		</div>

		<p>@V-Shorn: doing this to &quot;helpfully&quot; unburden your colleagues by not asking them questions is bad for everyone. It&#39;s bad for you, because you&#39;re spending time on throwaway analysis that is probably (not necessarily, but probably) better spent on other stuff. It&#39;s bad for your colleagues when, seven months down the line, they have to play consultants because you slipped in a call to an internal function that now no longer exists, or worse, does something different &#8212; when they would have preferred to discuss better solutions from the outset. And finally it&#39;s bad for the company as a whole when integration slip-ups like these bog down the entire process.</p>
<p>Nobody likes the guy who&#39;s sending everyone mail every 10 minutes because he can&#39;t be arsed to open the documentation to anything, but if you&#39;re heading into an area where there is no documentation and you&#39;re making assumptions, it&#39;s generally not a bad idea to ask someone else to take a look. Even better if that other person is involved in the original development. If you don&#39;t want to interrupt someone&#39;s flow (good policy) save it up for a water cooler discussion (or as I like to call it, a coffee run ambush).</p>
<p>I know you were just offering it up as a possibility of seeing where it is as preparation for an actual discussion so as to not waste time, but even that, I&#39;d argue, is a sign of a problem. It encourages people to actually do this (write code to find stuff out) instead of investing either in better documentation or easier communication. It&#39;s only a small step from here to writing compatibility shims for the rest of your career. I&#39;m also very skeptical this actually saves time, unless you are an idiot savant who can hack code like this in 5 minutes but cannot ask a sensible question in 5 minutes (no obvious jokes about how you know people like this, please&#8230;)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1024283">
				<div id="div-comment-1024283" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">RSmith</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1024283">
			December 5, 2012 at 1:58 am</a>		</div>

		<p>Security hole? Guys, we&#39;re talking about Windows 95. I don&#39;t need to get a DLL cleverly inserted to execute arbitrary code when there is zero filesystem security&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1024473">
				<div id="div-comment-1024473" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Blog hater</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1024473">
			December 5, 2012 at 5:06 pm</a>		</div>

		<p>The blogsoftware keep raring messages. Please fix this bug, ASAP.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1024623">
				<div id="div-comment-1024623" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">David Walker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1024623">
			December 6, 2012 at 9:37 am</a>		</div>

		<p>@Blog Hater: &nbsp;Yep, there&#39;s nothing quite as bad as raring messages. &nbsp;I hate it when that happens. &nbsp;I don&#39;t want my messages to be rared.</p>
<p>And of course, it always helps to say &quot;Please fix this bug ASAP&quot;. &nbsp;That&#39;s what I&#39;ve been leaving out of my bug reports all along!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1024973">
				<div id="div-comment-1024973" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Christ van Willegen</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121203-00/?p=5933#comment-1024973">
			December 10, 2012 at 5:41 am</a>		</div>

		<p>@Henning Makholm: I mentioned this to a friend of mine (about the virus needing a specific data file on the client to be able to decode itself). He said: &quot;Well, if that file is spread via a command center, you&#39;ll never get at the decoded data <em>at all</em>&quot;. Insightful at the very least, and a good tip to virus-developers out there. Ah well, if he can think of it, someone else can think of it as well&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>