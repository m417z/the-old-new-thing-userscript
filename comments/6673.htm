<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (16)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment byuser comment-author-chris-j-leonard even thread-even depth-1" id="comment-1009543">
				<div id="div-comment-1009543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Veltas' rel='external nofollow' class='url'>Veltas</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120906-00/?p=6673#comment-1009543">
			September 6, 2012 at 7:17 am</a>		</div>

		<p>I read this attempting to be as open-minded as possible, because it sounds foolish to start with such a terrible assumption. &nbsp;It&#39;s like starting a logical analysis of military options after an ambush with the presumption that the apocalypse is occurring.</p>
<p>But, whenever there&#39;s a bug in my code I always find it tempting to believe that the provided resources are not functioning as defined, when in fact 99 times out of 100 they are and it&#39;s my fault.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1009573">
				<div id="div-comment-1009573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Adam Rosenfield</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120906-00/?p=6673#comment-1009573">
			September 6, 2012 at 7:38 am</a>		</div>

		<p>Even something like writing a single zero byte out-of-bounds, doing something like a printf, and then restoring that byte to what it was before can be a serious security vulnerability. &nbsp;See CVE-2001-0279 and the analysis in section 2 of this article: <a rel="nofollow" target="_new" href="http://www.phrack.org/archives/57/p57_0x08_Vudo%20malloc%20tricks_by_MaXX.txt" rel="nofollow">http://www.phrack.org/&#8230;/p57_0x08_Vudo%20malloc%20tricks_by_MaXX.txt</a> .</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1009583">
				<div id="div-comment-1009583" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">henke37</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120906-00/?p=6673#comment-1009583">
			September 6, 2012 at 7:43 am</a>		</div>

		<p>In fact, it is more common that people prove that a &quot;less harmful&quot; vulnerability can be used for code execution than the opposite.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1009593">
				<div id="div-comment-1009593" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Brian</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120906-00/?p=6673#comment-1009593">
			September 6, 2012 at 7:51 am</a>		</div>

		<p>When debugging, I always assume the problem is caused by cosmic radiation until I&#39;m proven otherwise.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1009613">
				<div id="div-comment-1009613" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">DaveR</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120906-00/?p=6673#comment-1009613">
			September 6, 2012 at 8:13 am</a>		</div>

		<p>I am always amazed at how many programmers don&#39;t understand the implications of &quot;undefined behaviour&quot;. &nbsp;They don&#39;t get that anything can happen. &nbsp;While it might appear to do the same thing each time, it doesn&#39;t mean that they can depend on that behaviour.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alegrigoriev odd alt thread-odd thread-alt depth-1" id="comment-1009623">
				<div id="div-comment-1009623" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/alegr1' rel='external nofollow' class='url'>alegr1</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120906-00/?p=6673#comment-1009623">
			September 6, 2012 at 8:17 am</a>		</div>

		<p>[Since heap corruption can in principle lead to anything, any bug that results in heap corruption automatically gets a default classification of Arbitrary Code Execution]</p>
<p>How do you classify stack overflows? IE8 and IE9 are giving me stack overflows in MSXML.DLL (runaway recursion).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1009633">
				<div id="div-comment-1009633" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Matt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120906-00/?p=6673#comment-1009633">
			September 6, 2012 at 8:19 am</a>		</div>

		<p>@Raymond:</p>
<p>&quot;And it is extremely rare that one can successfully prove that a heap overflow is not exploitable under any possible conditions&quot;</p>
<p>That&#39;s because under almost any conditions a heap-overflow actually IS an exploitable bug, that actually CAN be turned into installation of a rootkit. This isn&#39;t security experts being nampy-pamby and hedging their bets by saying &quot;it MIGHT cause code-execution&quot;. Chances are, if there&#39;s a heap overflow involved, someone at some point actually WILL turn it into an exploit to install rootkits on your unpatched systems.</p>
<p>Memory corruption of any sort, any time is always a critical bug that you must stop everything right now to fix. It is never acceptable to leave memory corruption bugs as &quot;acceptable risk&quot; or to say &quot;we&#39;ll fix that, right after we finish this feature&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1009643">
				<div id="div-comment-1009643" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Matt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120906-00/?p=6673#comment-1009643">
			September 6, 2012 at 8:20 am</a>		</div>

		<p>@alegr1: Stack buffer overwrites are &quot;Arbitrary Code Execution&quot;. Stack exhaustion bugs when compiled with all of the options in Visual Studio set to default and in Microsoft libraries since Win Vista are &quot;Denial of Service&quot;. Other stack overflows might be &quot;Arbitrary Code Execution&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1009653">
				<div id="div-comment-1009653" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120906-00/?p=6673#comment-1009653">
			September 6, 2012 at 8:26 am</a>		</div>

		<p>@alegrl: Stack overflow is just a crash thanks to guard page.</p>
<p>We had a stack buffer overflow we classified as not exploitable (just a crash) because there was no way to write past the NUL sentinal without being caught and the program falling on its sword immediately (in fact that&#39;s what was happening when we discovered it&#8211;one of our customers managed to hit the bug).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1009663">
				<div id="div-comment-1009663" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Henning Makholm</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120906-00/?p=6673#comment-1009663">
			September 6, 2012 at 8:28 am</a>		</div>

		<p>@Matt: Sure &#8212; as soon as we figure out where the memory corruption happens. If all we&#39;re seeing is unreproducible weird effects that we attribute to &quot;prior memory corruption by unknown causes&quot; by a process of elimination, then often there is not much more to do than shrug and hope for better clues to turn up later.</p>
<p>After all, it is awfully hard to rule out cosmic radiation, in the technical sense of &quot;anything that randomly alters a program&#39;s memory behind its back&quot; &#8212; such as an already-present malware infaction that (for its own murky reasons) attach to our process as a debugger, changes a random byte somewhere, and then scoots away. Or, for that matter, actual cosmic rays.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1009703">
				<div id="div-comment-1009703" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Matt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120906-00/?p=6673#comment-1009703">
			September 6, 2012 at 9:16 am</a>		</div>

		<p>@Joshua: It&#39;s only a DoS if you&#39;re smart and are working with all of the security options on a modern compiler like Visual Studio. Not all stack exhaustion vulnerabilities are unexploitable (<a href="http://www.exploit-db.com/wp-content/themes/exploit/docs/17784.pdf" target="_new" rel="nofollow">http://www.exploit-db.com/&#8230;/17784.pdf</a>). In Visual Studio it is the &quot;chkstk&quot; function that is turning what would be a RCE into a DoS.</p>
<p>@Henning: That is why you design your programs to fail fast when they go wrong. Cosmic radiation causing your bugs is vastly less likely than because your code is crappy.</p>
<div class="post">[<i>You&#39;re not allowed to jump any stack pages (guard page or otherwise) in Win32, so any compiler that didn&#39;t do the chkstk would have crashed even under normal operation. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1009743">
				<div id="div-comment-1009743" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">JDF</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120906-00/?p=6673#comment-1009743">
			September 6, 2012 at 11:41 am</a>		</div>

		<p>This puts me in mind of Tilton&#39;s Law: Solve the First Problem.</p>
<p>Story here: <a rel="nofollow" target="_new" href="http://smuglispweeny.blogspot.com/2008/03/tiltons-law-solve-first-problem.html" rel="nofollow">smuglispweeny.blogspot.com/&#8230;/tiltons-law-solve-first-problem.html</a></p>
<p>Favorite quote: &quot;This stuff is hard enough to get right when things are working nominally, but once they go wrong we no longer have a system that even should work.&quot;</p>
<p>I have referred support techs to this article over and over in the last few years, usually after hearing &quot;This failed, then that failed, and now X isn&#39;t working. I&#39;m trying to solve X by frobulating the sprocket&#8230;&quot; No, stop right there, I won&#39;t help you frobulate, you need to fix the first problem!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1009753">
				<div id="div-comment-1009753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alexey</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120906-00/?p=6673#comment-1009753">
			September 6, 2012 at 12:12 pm</a>		</div>

		<p>A post most appropriate in view of Mark Russinovich&#39;s new novel&#39;s recent release.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cheong odd alt thread-odd thread-alt depth-1" id="comment-1009783">
				<div id="div-comment-1009783" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/cheong00' rel='external nofollow' class='url'>cheong00</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120906-00/?p=6673#comment-1009783">
			September 6, 2012 at 7:28 pm</a>		</div>

		<p>I think &quot;cosmic radiation&quot; is a bit over&#8230; &quot;memory chip went bad&quot; is more plausible explanation.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1009793">
				<div id="div-comment-1009793" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Matt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120906-00/?p=6673#comment-1009793">
			September 7, 2012 at 2:05 am</a>		</div>

		<p>@Raymond</p>
<p>&gt;&gt;&gt; &quot;[You&#39;re not allowed to jump any stack pages (guard page or otherwise) in Win32, so any compiler that didn&#39;t do the chkstk would have crashed even under normal operation. -Raymond]&quot;</p>
<p>The key there being Win32. Stack exhaustion bugs on other platforms are not always safe, so an assertion that stack exhaustion bugs are always a DoS isn&#39;t true in the general case.</p>
<p><a href="http://cansecwest.com/core05/memory_vulns_delalleau.pdf:" target="_new" rel="nofollow">cansecwest.com/&#8230;/memory_vulns_delalleau.pdf:</a></p>
<p>Linux 2.4 (SAFE)</p>
<p>► Linux 2.6 (UNSAFE)</p>
<p>► FreeBSD 5.3 (MMAP UNSAFE)</p>
<p>► OpenBSD 3.6 (SAFE but&#8230;)</p>
<p>► Linux emulation on FreeBSD 5.3 (UNSAFE)</p>
<p>► Linux emulation on OpenBSD 3.6 (SAFE but&#8230;)</p>
<p>► Solaris 10 / x86 (SAFE)</p>
<p>► Solaris 9 / Sparc (SAFE)</p>
<p>► Windows XP SP1 (SAFE)</p>
<p>► Any OS with certain uncommon threading libraries (UNSAFE)</p>
<p>Even in Win32, if you&#39;re using a library that does stack-copying (e.g. some implementations of fork on Win32), they just allocate a lot of stack and don&#39;t bother with a stack-guard page. So even on Win32 these might be exploitable.</p>
<p>As a general rule &#8211; if it&#39;s a memory corruption, just fix it. Don&#39;t argue about whether it&#39;s exploitable. Just fix it.</p>
<div class="post">[<i>My point was that chkstk is not a &quot;security option&quot; in Visual Studio. There is no way to turn it off (it&#39;s not an &quot;option&quot;) because it is required for correct functioning. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1009943">
				<div id="div-comment-1009943" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Gabe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120906-00/?p=6673#comment-1009943">
			September 7, 2012 at 9:19 pm</a>		</div>

		<p>The worst thing about heap corruption is that it usually manifests itself as normal operation. I would suggest that it&#39;s actually quite rare for heap corruption to ever manifest as a bug.</p>
<p>In fact, maybe that&#39;s the second-worst thing about heap corruption. I guess the worst thing is when heap corruption is what *causes* normal functioning, as in fixing the heap corruption causes the program to stop functioning normally. For example, you might be writing something out of bounds of an array that causes the same memory block to get returned from malloc over and over again, masking the fact that you never free it.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>