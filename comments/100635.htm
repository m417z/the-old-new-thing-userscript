<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (6)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="/oldnewthing/20190104-00/?p=100635#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://blogs.msdn.microsoft.com/oldnewthing/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Foldnewthing%2F20190104-00%2F%3Fp%3D100635">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment byuser comment-author-koldude even thread-even depth-1 parent" id="comment-1375175">
				<div id="div-comment-1375175" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/kantos' rel='external nofollow' class='url'>kantos</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20190104-00/?p=100635#comment-1375175">
			January 4, 2019 at 7:04 am</a>		</div>

		<p>From a &#8220;I don&#8217;t trust the compiler&#8221; perspective, I think the <code>lifetime</code> examples are dangerous, the compiler should be free to optimize out any variables captured if they aren&#8217;t actually used in the body of the lambda. That said I&#8217;m not a very good language lawyer.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/oldnewthing/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Foldnewthing%2F20190104-00%2F%3Fp%3D100635">Log in to Reply</a></div>
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-damien_the_unbeliever odd alt depth-2" id="comment-1375185">
				<div id="div-comment-1375185" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Damien_The_Unbeliever' rel='external nofollow' class='url'>Damien_The_Unbeliever</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20190104-00/?p=100635#comment-1375185">
			January 4, 2019 at 7:17 am</a>		</div>

		<p>I don&#8217;t think it can because it&#8217;s probably constrained to call the destructor on lifetime at the end of the lambda scope. The whole RAII pattern is based on having useful destructors called at known points in time.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/oldnewthing/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Foldnewthing%2F20190104-00%2F%3Fp%3D100635">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-geelaw even depth-2" id="comment-1375195">
				<div id="div-comment-1375195" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Gee+Law' rel='external nofollow' class='url'>Gee Law</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20190104-00/?p=100635#comment-1375195">
			January 4, 2019 at 9:25 am</a>		</div>

		<p>It <em>is</em> used. “Used” means having a side effect. Here the side effect is the non-trivial constructor/destructor.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/oldnewthing/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Foldnewthing%2F20190104-00%2F%3Fp%3D100635">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-d-sturm odd alt depth-2" id="comment-1375225">
				<div id="div-comment-1375225" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/DanStur' rel='external nofollow' class='url'>DanStur</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20190104-00/?p=100635#comment-1375225">
			January 4, 2019 at 11:12 am</a>		</div>

		<p>This seems quite obviously an illegal optimisation even without checking any specific parts of the standard. If an optimisation makes a legal c++ program invalid we surely have a problem.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/oldnewthing/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Foldnewthing%2F20190104-00%2F%3Fp%3D100635">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-matteo even thread-odd thread-alt depth-1 parent" id="comment-1375265">
				<div id="div-comment-1375265" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Matteo+Italia' rel='external nofollow' class='url'>Matteo Italia</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20190104-00/?p=100635#comment-1375265">
			January 4, 2019 at 4:16 pm</a>		</div>

		<p>The <code>std::shared_ptr</code> example is probably wrong&#8230; AFAIK there is no such a thing as <code>std::shared_from_this</code>, maybe you meant (if you class inherits from <code>std::enable_shared_from_this</code>) <code>self = this-&gt;shared_from_this()</code> (possibly without the redundant <code>this-&gt;</code>).</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/oldnewthing/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Foldnewthing%2F20190104-00%2F%3Fp%3D100635">Log in to Reply</a></div>
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-oldnewthing bypostauthor odd alt depth-2" id="comment-1375285">
				<div id="div-comment-1375285" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20190104-00/?p=100635#comment-1375285">
			January 4, 2019 at 5:41 pm</a>		</div>

		<p>Thanks. Fixed.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/oldnewthing/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Foldnewthing%2F20190104-00%2F%3Fp%3D100635">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>
<!-- COMMENTS END -->
</div></td></tr></table>