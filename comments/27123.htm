<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (10)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-496683">
				<div id="div-comment-496683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://forbidden-planet.blogspot.com' rel='external nofollow' class='url'>richard</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070425-00/?p=27123#comment-496683">
			April 25, 2007 at 11:09 am</a>		</div>

		<p>Are you running OS/2?</p>
<p>My copy of ntsd says that the -z option is &quot;reserved for OS/2 debugging&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-496693">
				<div id="div-comment-496693" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Rhomboid</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070425-00/?p=27123#comment-496693">
			April 25, 2007 at 11:35 am</a>		</div>

		<p>Rather than doing the address calculation manually, couldn&#8217;t you run rebase on a copy of GHI.DLL so that it loads at the same place it did in the app?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-496703">
				<div id="div-comment-496703" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James Schend</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070425-00/?p=27123#comment-496703">
			April 25, 2007 at 12:04 pm</a>		</div>

		<p>Richard&#8230;</p>
<p>I checked the version of NTSD that ships with Windows XP SP2. -z is documented as:</p>
<p>-z &lt;CrashDmpFile&gt; specifies the name of a crash dump file to debug</p>
<p>-zp &lt;CrashPageFile&gt; specifies the name of a page.dmp file</p>
<p>Are you using the Windows 2000 version? If it was reserved for OS/2, they might have recycled it for XP.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-496723">
				<div id="div-comment-496723" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://forbidden-planet.blogspot.com' rel='external nofollow' class='url'>richard</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070425-00/?p=27123#comment-496723">
			April 25, 2007 at 12:13 pm</a>		</div>

		<p>Yes, I am using Windows 2000. I realized after I posted that I had omitted some vital information (such as the version of the OS and tools I was running).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-496733">
				<div id="div-comment-496733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070425-00/?p=27123#comment-496733">
			April 25, 2007 at 12:22 pm</a>		</div>

		<p>Often seen in C++ apps when you have a global COM smart pointer, so the destructor tries calling Release on the COM object after main has completed, and CoUninitialize has been called.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-496753">
				<div id="div-comment-496753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Pavel Lebedinsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070425-00/?p=27123#comment-496753">
			April 25, 2007 at 1:14 pm</a>		</div>

		<p>I think you can also make debugger believe that GHI.DLL is still loaded by doing this:</p>
<p>0:000&gt; ? 1e781000 &#8211; 1e1c0000</p>
<p>Evaluate expression: 6033408 = 005c1000</p>
<p>0:000&gt; .reload GHI.DLL=1e1c0000,005c1000</p>
<p>This is convenient when you need to translate multiple addresses (such as when there is a stack trace with several return addresses from the unloaded DLL on the stack).</p>
<p>(Richard/James &#8211; ntsd from system32 is very old and doesn&#8217;t have any extensions. You should download the latest version from <a rel="nofollow" target="_new" href="http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx" rel="nofollow">http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx</a>).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-496913">
				<div id="div-comment-496913" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">JS</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070425-00/?p=27123#comment-496913">
			April 26, 2007 at 9:30 am</a>		</div>

		<p>Use:</p>
<p>.reload /unl ghi.dll</p>
<p>It does all the dirty work for you.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-497033">
				<div id="div-comment-497033" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Kujo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070425-00/?p=27123#comment-497033">
			April 26, 2007 at 12:04 pm</a>		</div>

		<p>In this crash, my first thought is usually that the &#8220;this&#8221; pointer was bad, so the vtable in ecx isn&#8217;t a valid one (using a dangling pointer?) &nbsp;I probably would have barked up that tree before considering an unloaded dll.</p>
<p>I&#8217;ve noticed that good windbg debugging involves a lot of pattern recognition (being able to spot a float or a string, for example.) Unlike me, it sounds like unloaded dll was your first guess, and with high confidence no less! The heuristic you listed was &#8220;its address is consistent with once having been in valid code.&#8221; &nbsp;How did you discern that instantly? &nbsp;</p>
<p>I can see that 0x1e1cfdf8 is well-aligned, but that&#8217;s hardly telling on its own. &nbsp;0x10000000 is a very common dll base address, but 0x1e1cfdf8 doesn&#8217;t feel close enough to that (and indeed, the lucky dll was based at 0x1e1c0000.) Is it just that I don&#8217;t work with COM very often, so dlls aren&#8217;t my first guess?</p>
<div class=post>[<i>True, if I had thought harder, 0x1Exxxxxx does seem a bit too high, but sometimes you get the right answer for the wrong reason. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-eric-brown even thread-even depth-1" id="comment-497053">
				<div id="div-comment-497053" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Eric+C+Brown' rel='external nofollow' class='url'>Eric C Brown</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070425-00/?p=27123#comment-497053">
			April 26, 2007 at 12:14 pm</a>		</div>

		<p>In recent versions of windbg, the register display will often say &lt;unloaded ghi.dll&gt;+blah. &nbsp;Not always, but often.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-497123">
				<div id="div-comment-497123" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Kujo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070425-00/?p=27123#comment-497123">
			April 26, 2007 at 12:52 pm</a>		</div>

		<p>Thanks for the tip on -z, it&#8217;s definitely nicer than using dumpbin or something. &nbsp;</p>
<p>Inspired by Eric&#8217;s comment, I see there&#8217;s a brand new version of the debugging tools released today! Thanks :)</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>