<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (11)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-349243">
				<div id="div-comment-349243" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">8</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060223-14/?p=32173#comment-349243">
			February 23, 2006 at 11:01 am</a>		</div>

		<p>&quot;a 32-bit version of the tool helper library sort of got bolted onto the side of Win32&quot;</p>
<p>Aha! So THATS how Windows 95 was made&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-mithuns odd alt thread-odd thread-alt depth-1" id="comment-349343">
				<div id="div-comment-349343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Mithun+Shanbhag' rel='external nofollow' class='url'>Mithun Shanbhag</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060223-14/?p=32173#comment-349343">
			February 23, 2006 at 2:52 pm</a>		</div>

		<p>Are there any other libs that allow you to enumerate running threads? The PSAPI and WtsApi32 libs allow you to only enumerate processes but not threads&#8230;&#8230;..</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-349423">
				<div id="div-comment-349423" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Carlos</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060223-14/?p=32173#comment-349423">
			February 23, 2006 at 6:40 pm</a>		</div>

		<p>@mithuns</p>
<p>HKEY_PERFORMANCE_DATA can give you a list of processes and threads, and it&#8217;s been around since NT 3.1 where it was the only supported method of doing this.</p>
<p>Unfortunately: it&#8217;s a chore to use; third-party performance providers can leak memory into your process, bombard it with messages, and break performance data altogether; the performance text registry key is some kind of hack backed by files in system32 which used to break regularly (I haven&#8217;t tried it recently); and it&#8217;s not supported on Win 9x.</p>
<p>If you don&#8217;t need the performance data it&#8217;s probably not worth the pain.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-349293">
				<div id="div-comment-349293" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mike</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060223-14/?p=32173#comment-349293">
			February 23, 2006 at 1:04 pm</a>		</div>

		<p>This again reminds me that the most required functionality of Win32, is also the most hary.</p>
<p>I first read about threads in an article about OS/2 back in&#8230; man, the dark ages. :-) I then got to know NT, and noticed it lacked even the basic stuff &#8211; the stuff even the Amiga OS had (my background when it comes to preemptive multitasking systems). One of the missing things were &quot;I provide memory, you provide a snapshot of the system state I request&quot;. That is AFAIK the only reliable way in a dynamic system, without this anyway happening behind the scenes (which it doesn&#8217;t do in NT).</p>
<p>Add then all the different ways you need to do this &#8211; all the gazillion ways from NT 3.51 to NT4, to Win95, to 98, to NT5 to&#8230; and every &quot;new&quot; &quot;innovation&quot; (or whatever they&#8217;re called) deprecates the previous way of doing it. Man, that&#8217;s a cesspool. I now see there&#8217;s no wonder I just gave up.</p>
<p>This however brings me to what I consider a much, much worse problem with NT &#8211; a problem likely not anticipated and impossible to retrofit: Named threads. BeOS got this right; every thread also has a &quot;name&quot;, a string provided when the thread was created. Why is this a problem in NT? Have you ever tried to debug a DirectX-using application, and having been forced to visit every bl**dy thread just to see what threads are &quot;DInput&quot;, &quot;DSound&quot; and so on? Add the suggestion of having a basically &quot;dead&quot; thread just waiting for an object&#8230;</p>
<p>Add to the mess that how threads actually work isn&#8217;t 100% documented (as that would require 100% documentation of APC&#8217;s &#8211; for a user-mode API).</p>
<p>I know, I expanded beyond the subject. Sue me.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-349473">
				<div id="div-comment-349473" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Simon</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060223-14/?p=32173#comment-349473">
			February 23, 2006 at 10:39 pm</a>		</div>

		<p>Mike, see the following, I think it will make you happy:</p>
<p><a rel="nofollow" target="_new" href="http://windowssdk.msdn.microsoft.com/library/en-us/dv_vsdebug/html/c85d0968-9f22-4d69-87f4-acca2ae777b8.asp" rel="nofollow">http://windowssdk.msdn.microsoft.com/library/en-us/dv_vsdebug/html/c85d0968-9f22-4d69-87f4-acca2ae777b8.asp</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-349483">
				<div id="div-comment-349483" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">M Hotchin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060223-14/?p=32173#comment-349483">
			February 23, 2006 at 10:45 pm</a>		</div>

		<p>For threads that you control, you can name them in the debugger by looking at this article:<br />
<br /><a rel="nofollow" target="_new" href="http://www.highprogrammer.com/alan/windev/visualstudio.html" rel="nofollow">http://www.highprogrammer.com/alan/windev/visualstudio.html</a><br />
<br />or here:<br />
<br /><a rel="nofollow" target="_new" href="http://msdn2.microsoft.com/en-us/library/xcb2z8hs.aspx" rel="nofollow">http://msdn2.microsoft.com/en-us/library/xcb2z8hs.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-junfeng even thread-even depth-1" id="comment-349513">
				<div id="div-comment-349513" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Junfeng+Zhang' rel='external nofollow' class='url'>Junfeng Zhang</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060223-14/?p=32173#comment-349513">
			February 24, 2006 at 12:58 am</a>		</div>

		<p>Raymond,</p>
<p>You should add a disclaimer, that tool helper library is not safe to use in product system. They read other processes&#8217; memory without synchronization. As a result it may corrupt other processes&#8217; memory.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-349533">
				<div id="div-comment-349533" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Purplet</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060223-14/?p=32173#comment-349533">
			February 24, 2006 at 4:22 am</a>		</div>

		<blockquote><p>
  &gt; They read other processes&#8217; memory without synchronization.</p>
<p>How can this corrupt other processes&#8217; memory ?</p>
<p>I can see how it can potentially read corrupted/invalid data, but not how it can corrupt other processes memory [other than faulting, but I hope the OS will check for these..]
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-349543">
				<div id="div-comment-349543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">KJK::Hyperion</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060223-14/?p=32173#comment-349543">
			February 24, 2006 at 4:30 am</a>		</div>

		<p>junfeng, that&#8217;s not true. The processes and threads list is returned atomically by the kernel, and the module and heap walkers are based on RtlQueryProcessDebugInformation, which creates a paired remote thread in the process to examine and returns a coherent, read-only snapshot. PSAPI is the unsafe one</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-349553">
				<div id="div-comment-349553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">KJK::Hyperion</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060223-14/?p=32173#comment-349553">
			February 24, 2006 at 5:28 am</a>		</div>

		<p>Oh, Raymond, you may want to use RTL_CONTAINS_FIELD instead of FIELD_OFFSET + sizeof</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-junfeng even thread-even depth-1" id="comment-349823">
				<div id="div-comment-349823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Junfeng+Zhang' rel='external nofollow' class='url'>Junfeng Zhang</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060223-14/?p=32173#comment-349823">
			February 24, 2006 at 3:52 pm</a>		</div>

		<p>I stand correct. </p>
<p>Going kernel does not mean it is safe. Unless you freeze the process in question, reading the process information while the process is running is unsafe action. </p>
<p>Creating remote thread is even more dangerous. </p>
<p>Now I did not say that you should not use those APIs. The chance of causing problem is rare and the usefulness of the information is apparent. But you do need a disclaimer just in case.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>