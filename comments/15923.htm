<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (28)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-788873">
				<div id="div-comment-788873" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">someone else</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-788873">
			November 25, 2009 at 8:21 am</a>		</div>

		<p>Aw come on, Raymond. You should know that most readers come here for the analysis!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-788893">
				<div id="div-comment-788893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alexandre</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-788893">
			November 25, 2009 at 8:42 am</a>		</div>

		<p>@someone else: I don&#8217;t know. Quite a large number of people seem to come here just for the nitpicking and vista-bashing.</p>
<p>Back to the topic at hand, it makes sense. Once a process is launched and has used its own command line, it and a lot else has little use for the original command line. I was surprised it&#8217;s even kept somewhere.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-788933">
				<div id="div-comment-788933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Boris</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-788933">
			November 25, 2009 at 9:42 am</a>		</div>

		<p>Well, no, it would be useful for programs like Process Explorer (already mentioned) to give the user a better idea of what&#8217;s running on their system than &quot;Host Process for Windows Services&quot;, either to determine whether it&#8217;s malicious or to track down what&#8217;s taking up so much RAM/disk space. I could even think of cases where taking action automatically on such information is useful. Think antiviruses removing known threats based on command line arguments.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-788943">
				<div id="div-comment-788943" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">JohnJS</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-788943">
			November 25, 2009 at 10:04 am</a>		</div>

		<p>@Alexandre: Well, you come for the analysis but you stay for the vista-bashing :-).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-788953">
				<div id="div-comment-788953" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Frymaster</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-788953">
			November 25, 2009 at 10:31 am</a>		</div>

		<p>&quot;&#8230;.Process Explorer (already mentioned) to give the user a better idea of what&#8217;s running on their system than &quot;Host Process for Windows Services&quot;,&quot;</p>
<p>not only does process explorer tell you that, you can also use &quot;tasklist /svc&quot; from the command line</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-788963">
				<div id="div-comment-788963" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-788963">
			November 25, 2009 at 10:31 am</a>		</div>

		<p>From a contractual perspective, it&#8217;s kept around because it&#8217;s a parameter to main(), and by C convention main doesn&#8217;t return, putting its parameters out of scope. However, you can of course do whatever you want, including terminating the thread that main is in.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-788973">
				<div id="div-comment-788973" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dave</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-788973">
			November 25, 2009 at 10:46 am</a>		</div>

		<blockquote><p>
  You should know that most readers come here for the analysis!
</p></blockquote>
<p>I come for the analysis, but I stay for the insults!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-788993">
				<div id="div-comment-788993" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.differentpla.net/' rel='external nofollow' class='url'>Roger Lipscombe</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-788993">
			November 25, 2009 at 10:57 am</a>		</div>

		<p>On a related note, if I remember correctly, some of djb&#8217;s daemontools (used with qmail on Unix) deliberately overwrite their command lines, so that they can report status and errors to someone using &#8216;top&#8217; or &#8216;ps&#8217;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-789003">
				<div id="div-comment-789003" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.roseharp.com' rel='external nofollow' class='url'>Timothy Byrd</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789003">
			November 25, 2009 at 11:17 am</a>		</div>

		<p>Don&#8217;t even need to bother with Process Explorer &#8211; on Vista, the Task Manager can show the (possibly over-written) command line.</p>
<p>And what will the poor Vista-bashers do now that Windows 7 is out?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-789043">
				<div id="div-comment-789043" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">porter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789043">
			November 25, 2009 at 12:00 pm</a>		</div>

		<blockquote><p>
  &gt; and by C convention main doesn&#8217;t return
</p></blockquote>
<p>Yes it does, when the program finishes! Hence why it returns an int which the stub which called main then passes to exit().</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-789083">
				<div id="div-comment-789083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789083">
			November 25, 2009 at 1:21 pm</a>		</div>

		<p>I suppose this qualifies as an &quot;application trying to fool you&quot;, but a specific use case is for applications that accepts passwords via command-line arguments.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-789093">
				<div id="div-comment-789093" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Boris</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789093">
			November 25, 2009 at 1:28 pm</a>		</div>

		<p>@Timothy, here? I&#8217;m running Windows 7 and don&#8217;t see the command line.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-789103">
				<div id="div-comment-789103" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Boris</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789103">
			November 25, 2009 at 1:30 pm</a>		</div>

		<p>Sorry, by &quot;here&quot; I meant &quot;where&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-789113">
				<div id="div-comment-789113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">porter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789113">
			November 25, 2009 at 1:31 pm</a>		</div>

		<p>Similarly, can you see the environment variables for a process?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-789123">
				<div id="div-comment-789123" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">manyirons</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789123">
			November 25, 2009 at 1:36 pm</a>		</div>

		<p>@Alexandre: You should have used a capitol &#8216;V&#8217; in &quot;Vista&quot;, not that it deserves it.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-789133">
				<div id="div-comment-789133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">manyirons</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789133">
			November 25, 2009 at 1:39 pm</a>		</div>

		<p>Pre-emptive nit-pick: &nbsp;I know I spelled capital incorrectly.</p>
<p>Raymond, being this precise is hard. &nbsp;You do a great job!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-789153">
				<div id="div-comment-789153" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Keeron Modi</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789153">
			November 25, 2009 at 2:09 pm</a>		</div>

		<p>Vista / Win7 Task manager:</p>
<ul>
<li>
<p>&quot;View&quot; menu</p>
</li>
<li>
<p>&quot;Select Columns&quot;</p>
</li>
<li>
<p>Scroll down to &quot;Command line&quot;</p>
</li>
</ul>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-dean-harding odd alt thread-odd thread-alt depth-1" id="comment-789163">
				<div id="div-comment-789163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Dean+Harding' rel='external nofollow' class='url'>Dean Harding</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789163">
			November 25, 2009 at 2:09 pm</a>		</div>

		<p>@Boris: You can add a column for command-line in the &quot;Processes&quot; list.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-789173">
				<div id="div-comment-789173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">IanB</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789173">
			November 25, 2009 at 2:24 pm</a>		</div>

		<blockquote><p>
  Don&#8217;t even need to bother with Process Explorer &#8211; on Vista, the Task Manager can show the (possibly over-written) command line.
</p></blockquote>
<p>Argh, why didn&#8217;t I know that! Thanks.</p>
<p>Random aside: Windows 7 (Pro x64) now allows you again to drag and drop directories from Explorer to the command prompt to save typing the full path. This useful feature was removed from Vista.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-788833">
				<div id="div-comment-788833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://adamrosenfield.com' rel='external nofollow' class='url'>Adam Rosenfield</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-788833">
			November 25, 2009 at 7:20 am</a>		</div>

		<p>Yep, just tested the following dummy program:</p>
<p>#include &lt;windows.h&gt;</p>
<p>int main(int argc, char **argv)</p>
<p>{</p>
<p> &nbsp;wchar_t *x = GetCommandLineW();</p>
<p> &nbsp;while(*x) *x++ = L&#8217;x&#8217;;</p>
<p> &nbsp;Sleep(10000000);</p>
<p> &nbsp;return 0;</p>
<p>}</p>
<p>When I opened it up with Process Explorer, it reported the command line as &quot;xxxxxxxxxx&quot; instead of what it actually was.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-789183">
				<div id="div-comment-789183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jon</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789183">
			November 25, 2009 at 4:47 pm</a>		</div>

		<p>&quot;not keeping track of information you don&#8217;t need&quot; is wrong. You do need it, for diagnostics.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-789223">
				<div id="div-comment-789223" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://lambert.geek.nz/' rel='external nofollow' class='url'>Miral</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789223">
			November 25, 2009 at 7:03 pm</a>		</div>

		<p>While deliberately overwriting the command line for purposes of reporting status (as mentioned above) could be useful &#8212; how do you know how much room you have?</p>
<p>I guess you can be reasonably safe in assuming that if someone gave you 20 characters in actual parameters then the buffer is at least that big, but I don&#8217;t think there are any particular guarantees anywhere, especially when a program is being run with no parameters.</p>
<p>So it might end up just being another way to buffer-overrun yourself&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-789233">
				<div id="div-comment-789233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://lambert.geek.nz/' rel='external nofollow' class='url'>Miral</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789233">
			November 25, 2009 at 7:10 pm</a>		</div>

		<p>Also: is there a Win32 way of getting the (possibly overwritten) command line of a process, or is it only available through WMI? &nbsp;(I don&#8217;t regard WMI as part of Win32.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-yuhong-bao odd alt thread-odd thread-alt depth-1" id="comment-789253">
				<div id="div-comment-789253" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Yuhong+Bao' rel='external nofollow' class='url'>Yuhong Bao</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789253">
			November 25, 2009 at 8:35 pm</a>		</div>

		<p>&quot;Windows 7 (Pro x64) now allows you again to drag and drop directories from Explorer to the command prompt to save typing the full path. This useful feature was removed from Vista.&quot;</p>
<p>As mentioned by Raymond before, that was a side effect of the introduction of UIPI to Vista. Restoring this feature to Windows 7 required moving console windows into a separate conhost.exe.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-789263">
				<div id="div-comment-789263" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">porter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789263">
			November 26, 2009 at 12:46 am</a>		</div>

		<blockquote><p>
  &gt; Also: is there a Win32 way of getting the (possibly overwritten) command line of a process,
</p></blockquote>
<p>You mean like inject a DLL using CreateRemoteThread into another process? And that DLL then calls GetCommandLineW and sends you the result back?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-789283">
				<div id="div-comment-789283" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Neil</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789283">
			November 26, 2009 at 2:56 am</a>		</div>

		<p>And don&#8217;t forget that the command line doesn&#8217;t necessarily include the correct, or indeed any, executable. (WinDbg 6.6.0007.5 gets this wrong.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-789473">
				<div id="div-comment-789473" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://lambert.geek.nz/' rel='external nofollow' class='url'>Miral</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789473">
			November 26, 2009 at 3:19 pm</a>		</div>

		<blockquote><p>
  &gt; You mean like inject a DLL using CreateRemoteThread into another process? And that DLL then calls GetCommandLineW and sends you the result back?
</p></blockquote>
<p>That&#8217;s the only way I could think of, yes. &nbsp;I was wondering if there were anything more elegant.</p>
<p>Although then I noticed that Raymond &lt;a href=&quot;<a rel="nofollow" target="_new" href="http://blogs.msdn.com/oldnewthing/archive/2009/02/23/9440784.aspx&quot;&gt;had" rel="nofollow">http://blogs.msdn.com/oldnewthing/archive/2009/02/23/9440784.aspx&quot;&gt;had</a> covered this before&lt;/a&gt;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-789573">
				<div id="div-comment-789573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">anonymous</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20091125-00/?p=15923#comment-789573">
			November 27, 2009 at 12:36 am</a>		</div>

		<p>@Miral</p>
<p>I do not know if you consider this more elegant</p>
<p>but i guess ReadProcessMemory instead of injecting a thread has less risk of destroying something.</p>
<p>It still has the sampe problems with reading commandline from privileged processes and is surely equally unsupported&#8230;</p>
<p><a rel="nofollow" target="_new" href="http://www.codeproject.com/KB/threads/GetNtProcessInfo.aspx" rel="nofollow">http://www.codeproject.com/KB/threads/GetNtProcessInfo.aspx</a></p>
<p><a rel="nofollow" target="_new" href="http://wj32.wordpress.com/2009/01/24/howto-get-the-command-line-of-processes/" rel="nofollow">http://wj32.wordpress.com/2009/01/24/howto-get-the-command-line-of-processes/</a></p>
<p>AFAIK this is the way most tools implement reading commandline&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>