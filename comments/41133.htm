<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (17)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-121233">
				<div id="div-comment-121233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Doug</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-121233">
			January 9, 2004 at 9:23 am</a>		</div>

		<p>I would smack any fool around that tried to depend on how the assembly works.  Just BEGGING for trouble.</p>
<p>The good thing is, there are now very, very few programmers who understand assembly to this level, and they are all old enough to know better.  Or one would hope.</p>
<p>Grin.</p>
<p>Now, passing a non-static member function in for a callback, I&#8217;ve seen fools try that.  But it never makes it out of programmer testing, because nothing works&#8230;..<br />
<br />(Duh, why am I getting a visit from the Doctor?)</p>
<p>Course, passing objects in WM_ type stuff can cause other problems with deleted objects.  Those can get amusing to prevent.<br />
<br />What if there is already a message in the queue with that object reference as an LPARAM when you clean things up in the destructor?  Can you say trap on shutdown?<br />
<br />You really need to have some form of validation for the &quot;this&quot; pointer.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-121253">
				<div id="div-comment-121253" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.microsoft.com/' rel='external nofollow' class='url'>Willaim H. Gates</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-121253">
			January 9, 2004 at 11:35 am</a>		</div>

		<p>Hello Raymon,</p>
<p>You shouldn&#8217;t disregard our precious software in public.</p>
<p>Bill.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-121283">
				<div id="div-comment-121283" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Steve Sheppard</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-121283">
			January 9, 2004 at 12:38 pm</a>		</div>

		<p>Stupid and illiterate too! </p>
<p>Bill, </p>
<p>You seem to have a real problem with names, both RaymonDs and your own -&gt; Willaim != William.</p>
<p>Thanks for playing,</p>
<p>Steve</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-121303">
				<div id="div-comment-121303" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">asdf</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-121303">
			January 9, 2004 at 3:53 pm</a>		</div>

		<p>Woah, wtf? A new BOOLEAN type? What happened to BOOL?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-121313">
				<div id="div-comment-121313" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.rotd.org' rel='external nofollow' class='url'>Andreas Magnusson</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-121313">
			January 9, 2004 at 3:55 pm</a>		</div>

		<p>Most of the callbacks seems to allow user-data, but not the Service-API, which is too bad because when you put several services in one exe, it would be nice to have a class for each.<br />
<br />Do you know why the Service-API lacks this (no pun intended), is there a good reason or was it just &quot;missed&quot;?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-121323">
				<div id="div-comment-121323" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-121323">
			January 9, 2004 at 4:01 pm</a>		</div>

		<p>BOOLEAN, like UNICODE_STRING, dates back to the days when Windows NT was called &quot;OS/2 3.0 NT&quot;.</p>
<p>Andreas: I don&#8217;t know what the deal is with the service APIs. You can always fake it be instancing your callbacks. There are some other callbacks which frustratingly fail to pass reference data, like AbortProc, all the Windows hooks&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-121343">
				<div id="div-comment-121343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mike</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-121343">
			January 9, 2004 at 6:16 pm</a>		</div>

		<p>Andreas: Service callbacks take user-data.  Put your this pointer in the lpContext.</p>
<p>DWORD WINAPI HandlerEx(<br />
<br />  DWORD dwControl,<br />
<br />  DWORD dwEventType,<br />
<br />  LPVOID lpEventData,<br />
<br />  LPVOID lpContext<br />
<br />);<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-121393">
				<div id="div-comment-121393" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Florian</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-121393">
			January 10, 2004 at 3:36 am</a>		</div>

		<p>What if SomeClass was derived from SomeParentClass and ThreadProc was a virtual member function? Would the compiler still do the stack optimization?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-121403">
				<div id="div-comment-121403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-121403">
			January 10, 2004 at 7:53 am</a>		</div>

		<p>Try it and see! (and see if you can explain the codegen)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-121413">
				<div id="div-comment-121413" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.whirlingdervishes.com' rel='external nofollow' class='url'>Henk Devos</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-121413">
			January 10, 2004 at 8:16 am</a>		</div>

		<p>I&#8217;m wondering what&#8217;s happened to this in Win64.<br />
<br />Have all user data parameters been widened to 64 bit?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-121423">
				<div id="div-comment-121423" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-121423">
			January 10, 2004 at 8:24 am</a>		</div>

		<p>I mentioned this briefly in my old blog</p>
<p><a target="_new" href="http://blogs.gotdotnet.com/raymondc/permalink.aspx/d29da767-5c07-48ec-9b9c-5f514b7d1f6b" rel="nofollow">http://blogs.gotdotnet.com/raymondc/permalink.aspx/d29da767-5c07-48ec-9b9c-5f514b7d1f6b</a></p>
<p>There&#8217;s more information on Win64 data types on MSDN, like here for example.</p>
<p><a target="_new" href="http://msdn.microsoft.com/library/en-us/dnnetserv/html/ws03-64-bitwindevover.asp" rel="nofollow">http://msdn.microsoft.com/library/en-us/dnnetserv/html/ws03-64-bitwindevover.asp</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-135453">
				<div id="div-comment-135453" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ebbe Kristensen</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-135453">
			January 12, 2004 at 2:56 am</a>		</div>

		<p>   return ((SomeClass*)lpParameter)-&gt;ThreadProc();</p>
<p>really should be:</p>
<p>   return reinterpret_cast&lt;SomeClass*&gt;(lpParameter)-&gt;ThreadProc();</p>
<p>Using new-style casts makes the code safer. Also it is easier to find casts in the source using a simple search.</p>
<p>See also B. Stroustrup, The C++ Programming Language 3rd edition, pg 819. No, C-style casts are not deprecated &#8211; yet&#8230;<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-135853">
				<div id="div-comment-135853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://baby.homeip.net/patrick/archives/000142.php' rel='external nofollow' class='url'>Simply Patrick</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-135853">
			January 13, 2004 at 1:19 pm</a>		</div>

		<p>??????,??????????? ?????????? calling convention: The history of calling conventions, part 1 The history of calling conventions, part 2 The history of calling conventions, part 3 The history of calling conventions, part 4: ia64 Why do member functions need to be&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-137303">
				<div id="div-comment-137303" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://alexpojoga@yahoo.com' rel='external nofollow' class='url'>Alex</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-137303">
			January 19, 2004 at 6:00 pm</a>		</div>

		<p>Isn&#8217;t this passed in ebx?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-137313">
				<div id="div-comment-137313" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-137313">
			January 19, 2004 at 6:06 pm</a>		</div>

		<p>Try it and see. My remarks applied to the Microsoft Visual C++ compiler &#8211; other compilers will probably do things differently.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-196213">
				<div id="div-comment-196213" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/archive/2004/07/19/187415.aspx' rel='external nofollow' class='url'>The Old New Thing</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-196213">
			July 19, 2004 at 10:02 am</a>		</div>

		<p>Thereby ensuring that you match the calling convention.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-202173">
				<div id="div-comment-202173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040109-00/?p=41133#comment-202173">
			August 10, 2004 at 9:38 am</a>		</div>

		<p>Commenting closes after two weeks.</p>
<p><a target="_new" href="http://weblogs.asp.net/oldnewthing/archive/2004/02/21/77681.aspx" rel="nofollow">http://weblogs.asp.net/oldnewthing/archive/2004/02/21/77681.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>