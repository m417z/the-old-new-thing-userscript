<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (19)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-609033">
				<div id="div-comment-609033" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Tim Smith</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609033">
			March 11, 2008 at 10:05 am</a>		</div>

		<p>To the best of my knowledge, conversions between CF_UNICODE and CF_TEXT (both directions) are handled automatically by the OS.</p>
<p>The OS can &quot;lie&quot; and insert new FORMATETC structures that are supplied to the consumer.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-609063">
				<div id="div-comment-609063" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Matt Green</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609063">
			March 11, 2008 at 12:26 pm</a>		</div>

		<p>Hahaha, your Igor comment today is awesome!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-609073">
				<div id="div-comment-609073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Andrew</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609073">
			March 11, 2008 at 12:41 pm</a>		</div>

		<p>Nitpick:</p>
<p>If CTinyDataObject::QueryInterface fails then the value of the ppv param should be left unchanged.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-mike-dimmick odd alt thread-odd thread-alt depth-1" id="comment-609083">
				<div id="div-comment-609083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Mike+Dimmick' rel='external nofollow' class='url'>Mike Dimmick</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609083">
			March 11, 2008 at 12:46 pm</a>		</div>

		<p>@Andrew: I&#8217;m sure Raymond&#8217;s told us in previous posts that many callers of QueryInterface don&#8217;t check the return value and base their worked/not-worked decision on the returned pointer. Safer to set it to NULL and crash callers who are trying to call through a bad pointer straight away.</p>
<p>Which one of us has been responsible for maintaining the shell and working round bugs in shell extensions?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-609093">
				<div id="div-comment-609093" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James Risto</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609093">
			March 11, 2008 at 12:56 pm</a>		</div>

		<p>I find that the pre-emptive stuff totally deflates the waiting for any off-topic comments and I can concentrate better on the post!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-609143">
				<div id="div-comment-609143" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Triangle</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609143">
			March 11, 2008 at 1:56 pm</a>		</div>

		<p>&quot;Safer to set it to NULL and crash callers who are trying to call through a bad pointer straight away.&quot;</p>
<p>Are you sure you really want that?</p>
<p>&quot;I just installed this program and now whenever I turn on the computer there is some kind of error and then everything else on my screen dissapears&quot;</p>
<p>&quot;I find that the pre-emptive stuff totally deflates the waiting for any off-topic comments and I can concentrate better on the post!&quot;</p>
<p>You realize that by stating that you&#8217;ve made an offtopic comment, right? :P</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-609213">
				<div id="div-comment-609213" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Tihiy</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609213">
			March 11, 2008 at 4:08 pm</a>		</div>

		<p>Well, drag and drop is broken in Windows Vista for those &quot;security features&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-609293">
				<div id="div-comment-609293" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Yuhong Bao</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609293">
			March 11, 2008 at 7:32 pm</a>		</div>

		<p>&quot;Well, drag and drop is broken in Windows Vista for those &quot;security features&quot;.&quot;</p>
<p>Well, this actually did happen in one case, you can&#8217;t drag and drop to a command prompt window or any other window owned by an elevated process in Vista because of UIPI.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-609103">
				<div id="div-comment-609103" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.pretentiousname.com' rel='external nofollow' class='url'>Leo Davidson</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609103">
			March 11, 2008 at 1:04 pm</a>		</div>

		<p>@Mike: Some of them don&#8217;t check the return value *or* the pointer, which is fun when you&#8217;re writing your own ActiveX container!</p>
<p>A certain document-viewing ActiveX control does a QueryService (QS is like QI but may return a different object) for IBindHost, then calls through *ppv regardless of NULL pointers and HRESULTs. Yay for assuming the current version of Internet Explorer is the only ActiveX container in the world and that even IE itself won&#8217;t drop any interfaces one day&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-ryanbemrose odd alt thread-odd thread-alt depth-1" id="comment-609133">
				<div id="div-comment-609133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Ryan+Bemrose' rel='external nofollow' class='url'>Ryan Bemrose</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609133">
			March 11, 2008 at 1:32 pm</a>		</div>

		<p>@Andrew: </p>
<p><a rel="nofollow" target="_new" href="http://msdn2.microsoft.com/en-us/library/ms682521" rel="nofollow">http://msdn2.microsoft.com/en-us/library/ms682521</a>(vs.85).aspx</p>
<p>ppvObject</p>
<p> &nbsp; &nbsp;[out] Address of pointer variable that receives the interface pointer requested in riid. Upon successful return, *ppvObject contains the requested interface pointer to the object. If the object does not support the interface specified in iid, *ppvObject is set to NULL.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-609173">
				<div id="div-comment-609173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">BryanK</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609173">
			March 11, 2008 at 2:59 pm</a>		</div>

		<p>Triangle: What else are you supposed to do? &nbsp;You&#8217;ll either hand them NULL, or some other random pointer that they&#8217;re going to call through (i.e. whatever was being pointed to by the pointer that they gave you). &nbsp;Better that you hand back NULL (and crash them right away) than let them call off into never-never land through some random pointer that you gave back to them (and let the program either continue &quot;forever&quot; (well, until a stack overflow), or crash a long way from the problem).</p>
<p>If you don&#8217;t support the interface they&#8217;re asking for, it&#8217;s not like you can hand them your IUnknown or something crazy like that. &nbsp;You have to either give them NULL, or not change the value.</p>
<p>(And if the documentation says to give them NULL, then you better give them NULL as well; otherwise people that *do* follow the documentation can get screwed up by your QI implementation.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-maurits odd alt thread-odd thread-alt depth-1" id="comment-609343">
				<div id="div-comment-609343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Maurits+%5BMSFT%5D' rel='external nofollow' class='url'>Maurits [MSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609343">
			March 12, 2008 at 2:12 am</a>		</div>

		<p>A more subtle nitpick attempt is whether QueryInterface should check ppv for NULL and return E_POINTER.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-609413">
				<div id="div-comment-609413" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dave</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609413">
			March 12, 2008 at 9:37 am</a>		</div>

		<p>Maurits, any developer dumb enough to pass a NULL into QI is also not going to check its return value. The most likely time for this to happen is during development, and the debugger&#8217;s stack trace should make it clear to the developer what they did wrong. The crash accelerates the debugging process.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-609433">
				<div id="div-comment-609433" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://adarsha.mv.googlepages.com' rel='external nofollow' class='url'>mvadu</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609433">
			March 12, 2008 at 10:44 am</a>		</div>

		<p>@Dave</p>
<p>The crash accelerates the debugging process.</p>
<p>Nicely said.. I like that as a tester. If I could see a crash/Runtime error in the beginning it self my life is easier as I can stop my testing then and there and return the code to dev team.. haha</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-609443">
				<div id="div-comment-609443" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://adarsha.mv.googlepages.com' rel='external nofollow' class='url'>mvadu</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609443">
			March 12, 2008 at 10:44 am</a>		</div>

		<p>@Dave</p>
<p>The crash accelerates the debugging process.</p>
<p>Nicely said.. I like that as a tester. If I could see a crash/Runtime error in the beginning it self my life is easier as I can stop my testing then and there and return the code to dev team.. haha</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-609763">
				<div id="div-comment-609763" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">hege</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609763">
			March 13, 2008 at 8:09 am</a>		</div>

		<p>Raymond, grow up, you&#8217;re childish.</p>
<p>(I don&#8217;t care about removing my comment, it&#8217;s just a message for you)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-609773">
				<div id="div-comment-609773" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://greenreaper.co.uk/' rel='external nofollow' class='url'>GreenReaper</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609773">
			March 13, 2008 at 9:59 am</a>		</div>

		<p>Tihiy, Yuhong Bao: If you&#8217;re the program, it can be done, at least for WM_DROPFILES. Just bear in mind that you may need to allow through message types that don&#8217;t officially exist.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-609943">
				<div id="div-comment-609943" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">kokomo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-609943">
			March 13, 2008 at 2:07 pm</a>		</div>

		<p>&quot;Windows Vista should be dragged and dropped to the trash can.&quot;</p>
<p>Greatest preemptive comment of all time. I think it&#8217;s better than &quot;*Here&#8217;s your stupid asterisk.&quot;</p>
<p>Thank you Raymond.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-610283">
				<div id="div-comment-610283" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">.dan.g.</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080311-00/?p=23153#comment-610283">
			March 16, 2008 at 7:36 pm</a>		</div>

		<p>Shouldn&#8217;t QueryGetData() be strictly implemented as:</p>
<p>return GetDataIndex(pfe) == DATA_TEXT ? S_OK : S_FALSE;</p>
<p>because DATA_NUM is not handled in GetData()?</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>