<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (13)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-1207901">
				<div id="div-comment-1207901" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150821-00/?p=91761#comment-1207901">
			August 21, 2015 at 7:06 am</a>		</div>

		<p>Been here.There used to be a comment &quot;Do not optimize. Compiler bugs lurk.&quot; Until we understood what was going on. Incidentally, in debug compiles the variable would always live long enough because debug builds keep variables alive until they leave scope.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1207891">
				<div id="div-comment-1207891" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Some guy</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150821-00/?p=91761#comment-1207891">
			August 21, 2015 at 7:23 am</a>		</div>

		<p>Not knowing any C# myself, I wonder:</p>
<p>is there any magic in &quot;GC.KeepAlive&quot; or is it basically just a NOP which could be replaced with anything else, as long as it references the local &quot;proc&quot; variable?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1207881">
				<div id="div-comment-1207881" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150821-00/?p=91761#comment-1207881">
			August 21, 2015 at 7:28 am</a>		</div>

		<p>It&#39;s a function call the JIT can&#39;t inline.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1207861">
				<div id="div-comment-1207861" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Raphael</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150821-00/?p=91761#comment-1207861">
			August 21, 2015 at 9:48 am</a>		</div>

		<p>Yep, it&#39;s just a NOP in a method marked as Do-Not-Inline: <a rel="nofollow" target="_new" href="http://referencesource.microsoft.com/#mscorlib/system/gc.cs,279">referencesource.microsoft.com</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1207821">
				<div id="div-comment-1207821" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">poizan42</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150821-00/?p=91761#comment-1207821">
			August 23, 2015 at 1:17 pm</a>		</div>

		<p>Uhm so unless it&#39;s special-cased in the jitter, GC.KeepAlive actually has a small performance overhead (at least a call+return)?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1207811">
				<div id="div-comment-1207811" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">12BitSlab</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150821-00/?p=91761#comment-1207811">
			August 23, 2015 at 2:08 pm</a>		</div>

		<p>Raymond, thanks for the managed code week. Again, I learned from your posts. </p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1207671">
				<div id="div-comment-1207671" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">voo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150821-00/?p=91761#comment-1207671">
			August 24, 2015 at 9:14 am</a>		</div>

		<p>@poizan42 It also inhibits useful optimisations since the JIT cannot make any assumptions about global state of the program after the function is executed.</p>
<p>But all in all that&#39;s still pretty negligible on a larger scale.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1207401">
				<div id="div-comment-1207401" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">DWalker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150821-00/?p=91761#comment-1207401">
			August 25, 2015 at 7:31 am</a>		</div>

		<p>I like how your colleague actually responds to you, and gives you thanks, and mentions that he forgot an important point. &nbsp;He doesn&#39;t blame you for what happened. &nbsp;That&#39;s nice!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1207261">
				<div id="div-comment-1207261" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anonymous Cow Herd</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150821-00/?p=91761#comment-1207261">
			August 25, 2015 at 5:08 pm</a>		</div>

		<p>&quot;a private static&quot;? Not &quot;a private static *field*&quot;?</p>
<p>Reminds me of the newbies asking in IRC &quot;Hey, I declared main as a void, but someone tells me it should be an int instead?&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1207241">
				<div id="div-comment-1207241" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anonymous Cow Herd</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150821-00/?p=91761#comment-1207241">
			August 25, 2015 at 5:24 pm</a>		</div>

		<p>@Raphael: I like how they censored the word &quot;races&quot;, referring to race conditions.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1207201">
				<div id="div-comment-1207201" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Medinoc</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150821-00/?p=91761#comment-1207201">
			August 26, 2015 at 12:06 am</a>		</div>

		<p>Weirdly, the documentation for KeepAlive mentions a problem that&#39;s not supposed to happen because according to Dispose&#39;s documentation, you&#39;re not supposed to dispose managed resources when GC&#39;d, only when explicitly disposed.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1207181">
				<div id="div-comment-1207181" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"> Medinoc</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150821-00/?p=91761#comment-1207181">
			August 26, 2015 at 4:06 am</a>		</div>

		<p>ETA: How foolish I am. Of course that situation can easily happen as soon as the stream is an unmanaged one.</p>
<p>Fortunately, explicit disposal should prevent it (since it references the object).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1206911">
				<div id="div-comment-1206911" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150821-00/?p=91761#comment-1206911">
			August 27, 2015 at 8:38 am</a>		</div>

		<p>@Anonymous Cow Herd: You mean like this?</p>
<p><a rel="nofollow" target="_new" href="http://stackoverflow.com/questions/32212468/wndproc-weird-behaviour-on-windows-8-1-only-works-if-dummy-printf-is-called/32212944#32212944">stackoverflow.com/&#8230;/32212944</a></p>
<p>(different function, same consequence)</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>