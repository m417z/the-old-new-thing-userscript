<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (20)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-668353">
				<div id="div-comment-668353" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Pierre B.</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668353">
			September 18, 2008 at 10:29 am</a>		</div>

		<p>Is there an equivalent way to tell if the current wallpaper is a funny wallpaper?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-668363">
				<div id="div-comment-668363" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668363">
			September 18, 2008 at 10:41 am</a>		</div>

		<p>Pierre: No, but it doesn&#8217;t matter since none of the links actually take you to wallpaper of any kind.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-668373">
				<div id="div-comment-668373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Adam</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668373">
			September 18, 2008 at 10:49 am</a>		</div>

		<p>I&#8217;m guessing that the customer&#8217;s real problem is that they&#8217;re doing something like trying to prevent a file from being moved to (or from) the recycle bin.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-668383">
				<div id="div-comment-668383" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Name required</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668383">
			September 18, 2008 at 10:56 am</a>		</div>

		<p>They were probably trying to move the *funnywallpapers.cn domain into the recylce bin.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-668393">
				<div id="div-comment-668393" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dave</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668393">
			September 18, 2008 at 11:27 am</a>		</div>

		<p>How can I tell that a directory is really a recycle bin? Duh. The only files in it will be deleted files.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-668403">
				<div id="div-comment-668403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Erzengel</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668403">
			September 18, 2008 at 11:49 am</a>		</div>

		<p>Guys, if you respond to the pingbacks to random pages, Raymond won&#8217;t be able to delete it without deleting your comments (or leaving your comments dangling making future readers wonder why TF you&#8217;re talking about wallpapers).</p>
<p>Anyway, I&#8217;m wondering if they&#8217;re trying to &quot;undo&quot; or something. I&#8217;ve wanted to programatically undo a move to the Recycle Bin, but Google is not your friend in this case.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-668433">
				<div id="div-comment-668433" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668433">
			September 18, 2008 at 12:16 pm</a>		</div>

		<p>This story, especially coupled with Erzengel&#8217;s comments, is starting to scare me.</p>
<p>I&#8217;m envisioning one of &quot;those&quot; companies, you know the kind, that change file associations without permission, use direct registry edits to bypass driver validation warnings, or have uninstallers that leave items on your hard drive. This company wants a scheduled task or service that checks your recycling bin for the &quot;leftovers&quot; their uninstaller doesn&#8217;t delete, and if it finds them, restores them “for you”.</p>
<p>Maybe it&#8217;s just a failure of imagination on my part, but I&#8217;m having a hard time coming up with a good reason for programmatically undoing a move to the recycling bin.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-668463">
				<div id="div-comment-668463" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668463">
			September 18, 2008 at 12:39 pm</a>		</div>

		<p>My guess is the customer wants to send files to the recycle bin.</p>
<p>uTorrent, Visual Studio, etc do this when they &quot;delete&quot; files on request by the user.</p>
<p>I know there&#8217;s gotta be two ways to do this, but only because I&#8217;ve seen software do them:</p>
<p>You can invoke the Windows &quot;Are you sure you want to recycle/delete this file?&quot; dialog. &nbsp;This gives you the added bonus of having shift depressed automatically skipping the recycle bin. &nbsp;Keyboard shortcut consistency ftw.</p>
<p>You can move files to the recycle bin without a prompt. &nbsp;I imagine you simply get the PIDL of the (desktop) recycle bin and call whatever shell folder API function to move files there. &nbsp;(I dunno much about shell object programming :( )</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-668473">
				<div id="div-comment-668473" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668473">
			September 18, 2008 at 12:48 pm</a>		</div>

		<p>If you want to send stuff to the recycle bin you would just use SHFileOperation(). &nbsp;I suspect the customer wants to do something far more sinister; my guess is it involves some kind of hook to prevent something from being moved to the recycle bin.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-668483">
				<div id="div-comment-668483" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">peted</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668483">
			September 18, 2008 at 12:49 pm</a>		</div>

		<p>&quot;This is another example of a customer having a problem, solving half of it, and asking for help with the other half, unaware that they are approaching the problem from the wrong direction.&quot;</p>
<p>In fact, one of the things I try to convey to every person who ever asks me a question about how to do something is that programming should almost always be <em>easy</em>. If you find yourself trying to do something, and are discovering that the platform (be it the OS, a framework, the language, etc.) seems to be getting in your way, that&#8217;s almost always a sure sign that you&#8217;re &quot;approaching the problem from the wrong direction&quot;.</p>
<p>There are exceptions, to be sure. But they are few and far between, much more rare than most people believe. A programmer&#8217;s first thought upon running into this kind of difficulty should be &quot;maybe there&#8217;s a different, better way to accomplish my goal&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-668503">
				<div id="div-comment-668503" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Gabe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668503">
			September 18, 2008 at 1:25 pm</a>		</div>

		<p>It&#8217;s not too hard to imagine some sort of desktop search app that wants to crawl the HD, but doesn&#8217;t want to index files in the Recycle Bin.</p>
<p>I&#8217;m sure there are other good reasons to want to do this. For example, if you wanted to calculate how much free space was available on a disk, you might want to add in the space used by &quot;deleted&quot; files.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-668513">
				<div id="div-comment-668513" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668513">
			September 18, 2008 at 1:32 pm</a>		</div>

		<p>Thank you, Gabe.</p>
<p>You are absolutely correct- I was approaching the problem from the wrong direction. There are plenty of reasons why you wouldn&#8217;t want to perform an action on the recycling bin. I was only considering operations that would happen if the folder was the recycling bin.</p>
<p>I&#8217;ll be able to sleep tonight now, thanks to you. Or maybe this afternoon, if my user requirements or product specifications don&#8217;t show up in my e-mail soon&#8230;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-668553">
				<div id="div-comment-668553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">DrkMatter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668553">
			September 18, 2008 at 5:39 pm</a>		</div>

		<p>&quot;Maybe it&#8217;s just a failure of imagination on my part, but I&#8217;m having a hard time coming up with a good reason for programmatically undoing a move to the recycling bin.&quot;</p>
<p>The key word here is &quot;undo&quot;. For example, imagine working in a software that gives you a view of certain files as part of a project. When you hit the delete key, it sends one of those files in the recycle bin. If, after that, you select &quot;Undo&quot; from the menu, the file is restored.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-668583">
				<div id="div-comment-668583" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joe Butler</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668583">
			September 18, 2008 at 9:39 pm</a>		</div>

		<p>There are lots of recycle bins, and they still don&#8217;t know which one is the current user&#8217;s bin?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-668593">
				<div id="div-comment-668593" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jules</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668593">
			September 19, 2008 at 3:21 am</a>		</div>

		<p>Joe Butler: Indeed. &nbsp;And there&#8217;d be no guarantee they&#8217;d even find the right recycle bin directory without doing a traversal of the entire directory structure of the machine (I presume that if you&#8217;ve mounted a volume in an empty ntfs directory it still gets its own recycle bin as a subdirectory of that directory&#8230; never tried, but that&#8217;d be the only way that makes sense), let alone any obvious way of identifying which was the right one.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-668603">
				<div id="div-comment-668603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Name required</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668603">
			September 19, 2008 at 4:18 am</a>		</div>

		<blockquote><p>
  Raymond won&#8217;t be able to delete it
</p></blockquote>
<p>If you&#8217;d pointed this out before I would have sold the spammers my services ;)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-668623">
				<div id="div-comment-668623" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668623">
			September 19, 2008 at 7:57 am</a>		</div>

		<p>DrkMatter,</p>
<p>You&#8217;ve just described a very different scenerio- IE, I want to find the recycling bin, so that I can perform a function on it.</p>
<p>While I guess you could enumerate the entire directory structure and check each directory indvidually to see if it is the recycling bin, that doesn&#8217;t strike me as the optimal solution. Of course, we already know that whatever the customer was doing, it&#8217;s not the Optimal solution, otherwise we wouldn&#8217;t be making fun of&#8230; I mean, learning from this customer.</p>
<p>In that scenerio, I think you&#8217;d probably be better off looking up the location of the Recycling bin, and then using that. It&#8217;s been a long time, but I think SHGetFolderLocation(CSIDL_BITBUCKET) used to work for this. Note that this may have been deprecated- It&#8217;s been a long time since I&#8217;ve done anything in this area. I&#8217;m fairly sure there is a new way to do this under Vista, although knowing Microsoft the old way probably still works, it just might get you made fun of, perhaps on this blog.</p>
<p>As you can tell, I haven&#8217;t done a lot of work with recycling bins under Vista, or in a long time. As such, any information above may not be correct, and should not be used in a production enviroment. :-)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-668883">
				<div id="div-comment-668883" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Erzengel</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-668883">
			September 20, 2008 at 12:14 am</a>		</div>

		<p>DrkMatter is correct, I want to be able to let the user select &quot;delete&quot; on a file, which sends it to the recycle bin (already done that).</p>
<p>However, right now that particular step is removed from the Undo history (It says &quot;You cannot undo this&quot; when you select delete because, like I said, Google is not your friend in this case).</p>
<p>So Mark, you jumped to the wrong conclusion, and I take exception to your associating me with malware companies. Your &quot;failure of imagination&quot; was more like a &quot;failure of reading comprehension&quot;.</p>
<p>See, when I googled for &quot;undoing move to recycle bin&quot; (this was some time ago) I got suggestions that included one much like what the customer&#8217;s stated request: iterate the directory structure, find the recycle bin, find the file you recycled, and move it. (And, of course, the classic &quot;Search for the string &quot;Recycle&quot; and open that folder&quot;)</p>
<p>That is why I wondered if that was the case here. Obviously from the next article we know it wasn&#8217;t.</p>
<p>Mostly I don&#8217;t work with Windows API, I work with the PS3. Windows API is useful only when I&#8217;m making tools for creating the assets, so it&#8217;s entirely likely there&#8217;s ways that I just can&#8217;t figure out, and I perhaps don&#8217;t know the magic incantation to get Google to tell me. These days I use it even less, only when the .NET API lets me down (like moving to recycle bin and back again)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-669003">
				<div id="div-comment-669003" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-669003">
			September 22, 2008 at 8:56 am</a>		</div>

		<p>Diplomacy isn&#8217;t my forte. I was actually referring to several legitimate vendors, if you search this blog, you&#8217;ll find the references. It was clear that Mr. Chen would prefer these names be omitted. Perhaps I should have said &quot;undoing a move to the recycling bin in this manner, as this method reminds me of similiar hacks used by some companies to change file associations&#8230;&quot;.</p>
<p>I can&#8217;t speak about several years ago, but today- <a rel="nofollow" target="_new" href="http://www.google.com/search?hl=en&amp;q=Programmatically+undoing+a+move+to+recycling+bin&amp;aq=f&amp;oq=" rel="nofollow">http://www.google.com/search?hl=en&#038;q=Programmatically+undoing+a+move+to+recycling+bin&#038;aq=f&#038;oq=</a></p>
<p>First result is this article. Third is a MSDN article from 2001.</p>
<p>If I may, how did you put the file into the recycling bin? At what point, if any, did you think &quot;Searching the HDD and testing each directory individually can&#8217;t be the right way- After all, I knew where the recycling bin was when I put the file there, so the data has to be stored somewhere&quot;? Was this code ever released commercially, or was this a personal project? Did QA kick up a red flag the first time they tried it on a Network drive, or even on a machine with 2 HDD&#8217;s? Or even 1 large HDD?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-669113">
				<div id="div-comment-669113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Erzengel</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080918-00/?p=20843#comment-669113">
			September 22, 2008 at 2:13 pm</a>		</div>

		<p>Umm, ShFileOperation, with FO_DELETE and FOF_ALLOWUNDO. I don&#8217;t actually do any moving here, I specifically say to the OS &quot;Hey, delete this file. But allow it to undoable.&quot; The OS is the one actually moving the file about, my program has no clue where the recycle bin is.</p>
<p>And yes, I noticed that today there seems to be articles that show what should be done. Any new tools will include that in the history, and I&#8217;ll revise any that are still in use. Maybe.</p>
<p>Like I said, I work on the PS3. Anything with my name in it has only appeared commercially on the PS3. The I use the Windows SDK in the tools made to create assets. As the people using such tools are colleages and can be told &quot;If you want the file back, it&#8217;s in the recycle bin. Sorry, the program can&#8217;t undo it itself.&quot;, it&#8217;s not that big of an issue.</p>
<p>As I said, I use the OS&#8217;s delete function to &quot;move to the recycle bin&quot;. Network drives, multiple hard drives, etc, all function correctly. It&#8217;s trying to undo it that is difficult because there is no &quot;Hey, you know that undoable delete I just told you to do? Yeah, can you tell me where the file is so I can undo it?&quot; Instead there&#8217;s a rather more convoluted method including the use of a virtual folder and iterating it for the file I just deleted, at the time I deleted it, and hopefully it will be there. Will that work on network drives and multiple hard drives? I don&#8217;t know, I haven&#8217;t actually tested it yet. I do know that my deleting the file does work, though.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>