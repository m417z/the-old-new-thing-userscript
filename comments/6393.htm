<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (13)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-1014673">
				<div id="div-comment-1014673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Andrew</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121005-00/?p=6393#comment-1014673">
			October 5, 2012 at 9:34 am</a>		</div>

		<p>&quot;If you want to use the default algorithm, you can call Lookup­Icon­Id­From­Directory or Lookup­Icon­Id­From­Directory­Ex. But if you want to use the default algorithm, then just use Load­Image already!&quot;</p>
<p>This seems to be erroneous. Both methods use the default algorithm?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1014683">
				<div id="div-comment-1014683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">SimonRev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121005-00/?p=6393#comment-1014683">
			October 5, 2012 at 9:37 am</a>		</div>

		<p>The Ex version lets you specify a desired size. &nbsp;But both use the default algorithm for color depth selection.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1014703">
				<div id="div-comment-1014703" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/johnstonj_4000_inn_2D00_soft.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>johnstonj@inn-soft.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121005-00/?p=6393#comment-1014703">
			October 5, 2012 at 10:29 am</a>		</div>

		<p>@Andrew: he&#39;s saying don&#39;t waste time if you want the default behavior of the current color depth &#8211; just use LoadImage. &nbsp;But if you need to do something different, then carry on&#8230;</p>
<p>In other words, if your custom algorithm == default algorithm, just use LoadImage.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1014723">
				<div id="div-comment-1014723" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121005-00/?p=6393#comment-1014723">
			October 5, 2012 at 7:13 pm</a>		</div>

		<p>Load&shy;Icon should have loaded all icons, and DrawIcon/DrawIconEx should have decided which resolution to use. The current architectural choices makes me cringe!</p>
<div class="post">[<i>&quot;Why does my 16&#215;16 icon take up a quarter megabyte of memory?&quot; -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1014753">
				<div id="div-comment-1014753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Klimax</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121005-00/?p=6393#comment-1014753">
			October 6, 2012 at 3:24 am</a>		</div>

		<p>Just a reminder that LoadIcon and co are from time, where RAM saving had high prioirty.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1014763">
				<div id="div-comment-1014763" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Clipboarder Gadget</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121005-00/?p=6393#comment-1014763">
			October 6, 2012 at 4:03 am</a>		</div>

		<p>Sadly it seems that the LoadIcon algorithm is broken since Vista. On a 150% scale DPI setting it loads always the lower resolution and never the higher. Because of that almost all application icons look blurry on the taskbar if you disable &quot;Always combine&quot; for the taskbar. Only some MS applications dont seem to do that, but only because they provide icons in all kinds of sizes.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1014733">
				<div id="div-comment-1014733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121005-00/?p=6393#comment-1014733">
			October 6, 2012 at 1:16 am</a>		</div>

		<p>If a 0.25mb ico file is compiled into the binary, there&#39;s of course no surprise that it will use 0.25 of ram when loading it.</p>
<div class="post">[<i>It&#39;s a surprise if you aren&#39;t the one who compiled the binary. LoadImage(&quot;Notepad.exe&quot;, 16, 16) suddenly requires 25x more memory than it used to. A folder in small icon mode would not be able to show more than 4000 files in a directory before running out of memory *just for the icons*. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-andycadley2 odd alt thread-odd thread-alt depth-1" id="comment-1014743">
				<div id="div-comment-1014743" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/AndyCadley' rel='external nofollow' class='url'>AndyCadley</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121005-00/?p=6393#comment-1014743">
			October 6, 2012 at 2:15 am</a>		</div>

		<p>@640K: If you always load *all* versions of an icon, there&#39;s of course no surprise that it uses lots more ram than if you only load what was actually needed.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1014783">
				<div id="div-comment-1014783" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121005-00/?p=6393#comment-1014783">
			October 7, 2012 at 5:33 pm</a>		</div>

		<p>[It&#39;s a surprise if you aren&#39;t the one who compiled the binary. LoadImage(&quot;Notepad.exe&quot;, 16, 16)&#8230;]</p>
<p>Load&shy;Icon isn&#39;t LoadImage. If you don&#39;t specify a size (i.e. Load&shy;Icon), then it&#39;s a surprise that the whole icon, including all it&#39;s resolutions, isn&#39;t loaded.</p>
<div class="post">[<i>Load&shy;Icon loads the icon at standard size (typically 32&#215;32). I can&#39;t wait for Alex to say &quot;designed without adult supervision.&quot; -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1014803">
				<div id="div-comment-1014803" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Giulia Q</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121005-00/?p=6393#comment-1014803">
			October 8, 2012 at 1:28 am</a>		</div>

		<p>Shouldn&#39;t pointers to resource data be decorated with const and __unaligned?</p>
<div class="post">[<i>Resource data is <a href="http://blogs.msdn.com/b/oldnewthing/archive/2011/06/09/10172702.aspx" rel="nofollow">4-byte aligned</a>, so you don&#39;t need to say __unaligned unless you have data that requires stricter alignment. You can say const if you want. That wasn&#39;t really the point of the article. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1014813">
				<div id="div-comment-1014813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/bombsoft_4000_hotmail.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>bombsoft@hotmail.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121005-00/?p=6393#comment-1014813">
			October 8, 2012 at 6:30 am</a>		</div>

		<p><a rel="nofollow" target="_new" href="http://blogs.msdn.com/b/oldnewthing/archive/2010/05/05/10007461.aspx" rel="nofollow">blogs.msdn.com/&#8230;/10007461.aspx</a></p>
<p>Loadicon also sounds like a Transformer.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1014833">
				<div id="div-comment-1014833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/johnstonj_4000_inn_2D00_soft.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>johnstonj@inn-soft.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121005-00/?p=6393#comment-1014833">
			October 8, 2012 at 7:10 am</a>		</div>

		<p>@Clipboarder Gadget: &nbsp;Maybe the offending apps/icons are not DPI-aware? &nbsp;If the app hasn&#39;t declared itself DPI-aware in the manifest, Windows Vista/7 will emulate 96 DPI which might explain your behavior.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1014923">
				<div id="div-comment-1014923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Clipboarder Gadget</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121005-00/?p=6393#comment-1014923">
			October 8, 2012 at 9:59 am</a>		</div>

		<p>No the programs are DPI-aware.</p>
<p>Even if you take a simple program from Petzolds samples with an icon and make it DPI-aware, Windows will take the 16-sized icon and scale it up even though there is a 32-sized icon.</p>
<p>You can prevent this by calling LoadIconWithScaleDown or ExtractIconEx instead of LoadIcon but most programs don&#39;t seem to do that.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>