<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (16)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-215003">
				<div id="div-comment-215003" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">bg</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041005-00/?p=37653#comment-215003">
			October 5, 2004 at 7:17 am</a>		</div>

		<p>a even easier way is to use #import</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-215023">
				<div id="div-comment-215023" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.differentpla.net/' rel='external nofollow' class='url'>Roger Lipscombe</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041005-00/?p=37653#comment-215023">
			October 5, 2004 at 8:02 am</a>		</div>

		<p>&#8230;or you could use attributed C++, which will generate the TLB and the header file (suitable for C and C++).<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-215053">
				<div id="div-comment-215053" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.codeproject.com/script/articles/list_articles.asp?userid=152' rel='external nofollow' class='url'>Mike Dunn</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041005-00/?p=37653#comment-215053">
			October 5, 2004 at 8:33 am</a>		</div>

		<p>Note that the ATL wizard in VC 6 has a bug, it generates header files with STDMETHOD when it should be STDMETHODIMP. This isn&#8217;t a problem in practice because the difference is that STDMETHOD includes &quot;virtual&quot;, which is harmless to repeat in the impl class.</p>
<p>Attributed C++ is about the worst thing I&#8217;ve ever encountered in my life. I have <em>never</em> gotten an attrib C++ ATL project to work in VC 7.1. Well, the wizard-generated code compiles, but as soon as I try to add my own stuff to the class, things break; and since the logic is hidden in attributes, there&#8217;s no way to debug it. (Things like: the class&#8217;s RGS file isn&#8217;t processed at registration time.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-215063">
				<div id="div-comment-215063" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Centaur</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041005-00/?p=37653#comment-215063">
			October 5, 2004 at 8:33 am</a>		</div>

		<p>However, this assumes that one wants a header that compiles both in C++ and C. Of course thatâ€™s a sensible thing to want. However, none of that macroing will give a declaration valid for other languages such as Object Pascal. Meanwhile, going the IDL way will likely yield a type library which is easily imported by other systems.</p>
<p>Borland Delphi and C++ Builder have a somewhat perverse way of defining interfaces; namely, you first make a type library by the use of a visual (and a pretty brittle at that) editor, and then the IDE generates or updates you the headers and the implementation. Also, you have the option of exporting the IDL for the type library.</p>
<p>Also, while generating the headers and the implementation, BCB insists on turning all interface pointer parameters into smart pointers that, among other things, automatically AddRef and Release. An unsuspecting victim is then forced to mentally step through different modes of a method call ([in], [out] and [in, out]) to understand why the object is suddenly gone after handing it to a method.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-215073">
				<div id="div-comment-215073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.accidentalscientist.com' rel='external nofollow' class='url'>Simon Cooke [exMSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041005-00/?p=37653#comment-215073">
			October 5, 2004 at 9:51 am</a>		</div>

		<p>Mike Dunn: I think that the problem with Attributed C++ isn&#8217;t that it doesn&#8217;t work, but rather that the documentation is nearly nonexistant.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-215083">
				<div id="div-comment-215083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Michael</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041005-00/?p=37653#comment-215083">
			October 5, 2004 at 11:27 am</a>		</div>

		<p>&gt; I think that the problem with Attributed C++<br />
<br />&gt; isn&#8217;t that it doesn&#8217;t work,</p>
<p>Actually, I&#8217;ve heard a lot of information that some parts of the generated code has memory leaks in some dispatch/invoke type stuff, and various other problems which of course are pretty hard to fix when they are automatically generated.</p>
<p>These are mentioned frequently on the microsoft.public.vc.atl newsgroup, such as this post for example:</p>
<p><a target="_new" href="http://groups.google.com/groups?q=attributed+bug+%22Alexander+Nickolov%22&amp;hl=en&amp;lr=&amp;ie=UTF-8&amp;group=microsoft.public.vc.atl&amp;safe=off&amp;selm=%23RNWlozzDHA.556%40TK2MSFTNGP11.phx.gbl&amp;rnum=3" rel="nofollow">http://groups.google.com/groups?q=attributed+bug+%22Alexander+Nickolov%22&#038;hl=en&#038;lr=&#038;ie=UTF-8&#038;group=microsoft.public.vc.atl&#038;safe=off&#038;selm=%23RNWlozzDHA.556%40TK2MSFTNGP11.phx.gbl&#038;rnum=3</a></p>
<p>It seems like attributes were sort of a short-lived and unsuccessful experiment by the  Visual Studio team. They haven&#8217;t even stood by them enough to fix these problems that are mentioned on the newsgroup.</p>
<p>Of course, to &quot;help you out&quot;, attributed is turned on by default when you create a new ATL project&#8230;<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-215093">
				<div id="div-comment-215093" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Chris Conti</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041005-00/?p=37653#comment-215093">
			October 5, 2004 at 1:05 pm</a>		</div>

		<p>Centaur:  I&#8217;ve always wished that MIDL had on option to not generate the C compatible code (i.e. generate C++  only)  OK-this is a minor point, and what does it hurt to generate both &#8230;</p>
<p>Isn&#8217;t it humorous that the visual studio team picked the same &#8216;perverse&#8217; backwards method for generating wsdl code?</p>
<p>I&#8217;ve also been disappointed that microsoft has never provided an idl-&gt;.NET tool (relying instead on the lossy #import style tlbimp)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-215103">
				<div id="div-comment-215103" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Rob Kennedy</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041005-00/?p=37653#comment-215103">
			October 5, 2004 at 1:24 pm</a>		</div>

		<p>Raymond, could you please make sure that a copy of today&#8217;s post is sent to the people in charge of the Platform SDK&#8217;s TextServ.h? That file is a perfect example of why people declaring interfaces in C or C++ should use the COM macros. The ITextServices and ITextHost interfaces in that unit are declared using &quot;unmacroed&quot; C++, and that makes them totally incompatible with anything else, especially languages that don&#8217;t understand Microsoft&#8217;s default thiscall calling convention.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-215113">
				<div id="div-comment-215113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041005-00/?p=37653#comment-215113">
			October 5, 2004 at 1:29 pm</a>		</div>

		<p>I agree that textserv.h is broken but it&#8217;s too late now. If you changed it to use the COM macros then you&#8217;d be changing the calling convention and existing clients would start crashing.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-215033">
				<div id="div-comment-215033" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041005-00/?p=37653#comment-215033">
			October 5, 2004 at 8:07 am</a>		</div>

		<p>But how many compilers support #import and attributed C++? Remember, the point of these macros is to admit a *compiler-independent* way of expressing COM interfaces. It&#8217;s great that there are shortcuts you can use that work only on certain compilers, but that&#8217;s not the issue here.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-215123">
				<div id="div-comment-215123" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://br.thespoke.net/MyBlog/fabiog/MyBlog.aspx' rel='external nofollow' class='url'>Fabio Galuppo</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041005-00/?p=37653#comment-215123">
			October 5, 2004 at 4:08 pm</a>		</div>

		<p>This comment is not about the macros&#8230;</p>
<p>Your posts are cool!</p>
<p>Raymond, do you plan compile these technical information (posts from COM, Win32, Win64) in a book? A lot of real Microsoft developers will be grateful!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-215233">
				<div id="div-comment-215233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anon</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041005-00/?p=37653#comment-215233">
			October 6, 2004 at 2:40 pm</a>		</div>

		<p>Raymond&gt; But how many compilers support #import and attributed C++?</p>
<p>&#8230;or __uuidof?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-215243">
				<div id="div-comment-215243" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041005-00/?p=37653#comment-215243">
			October 6, 2004 at 2:53 pm</a>		</div>

		<p>It&#8217;s one thing to make a compiler-specific feature available. It&#8217;s another to require it.</p>
<p>If your compiler doesn&#8217;t support __uuidof then including the header file gets you the interfaces but you don&#8217;t get any __uuidof magic &#8211; but at least the interfaces work and you can use them.  Whereas if your compiler doesn&#8217;t support #import and the header file uses it, then you&#8217;re stuck.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-215373">
				<div id="div-comment-215373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/oldnewthing/archive/2004/10/07/239318.aspx' rel='external nofollow' class='url'>The Old New Thing</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041005-00/?p=37653#comment-215373">
			October 7, 2004 at 1:51 pm</a>		</div>

		
		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-216253">
				<div id="div-comment-216253" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041005-00/?p=37653#comment-216253">
			October 12, 2004 at 7:14 pm</a>		</div>

		<p>Why are IDL and ODL almost but not quite compatible?  What are the criteria for choosing one or the other?  What is the method for switching from one to the other if the programmer&#8217;s actions in VC++ happened to generate the less appropriate choice?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-216273">
				<div id="div-comment-216273" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041005-00/?p=37653#comment-216273">
			October 12, 2004 at 8:58 pm</a>		</div>

		<p>Beats me, I&#8217;ve never heard of ODL.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>