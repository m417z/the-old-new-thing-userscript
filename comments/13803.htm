<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (23)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-837343">
				<div id="div-comment-837343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">steven</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837343">
			June 4, 2010 at 7:24 am</a>		</div>

		<p>With the alternative functions, it would also affect other windows of the same window class, even if they&#39;re in a different state? MSDN also states &quot;it is possible to change the background color for a class by using SetClassLong, but this change does not immediately repaint all windows belonging to the class.&quot;, as an example of undesireable behaviour, so something similar may apply in this case, resulting in the close button appearing enabled/disabled until the NC area is redrawn?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-837353">
				<div id="div-comment-837353" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Shaka</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837353">
			June 4, 2010 at 7:33 am</a>		</div>

		<p>Those function will enable/disable the close button for all the windows created from that window class from now, not the close button of the &quot;hwnd&quot; window.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-837363">
				<div id="div-comment-837363" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nick</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837363">
			June 4, 2010 at 7:36 am</a>		</div>

		<p>The problem is that the wrong code doesn&#39;t disable the menu item on the system menu.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-837373">
				<div id="div-comment-837373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nick</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837373">
			June 4, 2010 at 7:39 am</a>		</div>

		<p>I should add, likewise, it doesn&#39;t work if the window class was registered initially with CS_NOCLOSE</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-837383">
				<div id="div-comment-837383" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Crescens2k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837383">
			June 4, 2010 at 8:03 am</a>		</div>

		<p>In my time as a developer I have had a few situations where the people asking me to write the software wanted to diable the close button for whatever reason. In all cases I managed to get them to rethink the idea by doing simple things by changing the workflow, putting extra thought into what is being done or saving temporary operation data.</p>
<p>A lot of developers seem to forget about the end user just to make things easier for themselves. But in this situation it can end up a lot worse, because if the user feels really trapped when the window won&#39;t close then they can just end the process and that will definitely get the operation to end up in a very bad situation.</p>
<p>I have a list of actions which would make me not use an application if a program does. Trying to stop the application from closing is actually on that list. So if this application, with the close disabling, came out onto the market then I wouldn&#39;t be using it.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-837393">
				<div id="div-comment-837393" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alexandre Grigoriev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837393">
			June 4, 2010 at 8:27 am</a>		</div>

		<p>Fortunately, these tricks don&#39;t disable WM_CLOSE (or it&#39;s SC_CLOSE?) sent by Task Manager on Application-&gt;End Task button click. And the ultimate kill by TerminateProcess (Task Manager-&gt;End Process).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-837403">
				<div id="div-comment-837403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">sukru</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837403">
			June 4, 2010 at 8:40 am</a>		</div>

		<p>Doesn&#39;t MSI installer (which is a component of Windows) disable close button on the last step of uninstall operations? I believe this and similar cases are really legitimate uses of the functionality.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-837413">
				<div id="div-comment-837413" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dan Bugglin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837413">
			June 4, 2010 at 8:53 am</a>		</div>

		<p>@Alexandre I think an application can block WM_CLOSE, but if the developer wasn&#39;t expecting it (since there&#39;s no close button) they may forget to handle it, and the DefWndProc closes the window.</p>
<p>@sukru I assume because closing is considered equivalent to cancel and that is done to underscore that you can&#39;t cancel at that point. &nbsp;Still weird though.</p>
<p>I don&#39;t know much about window classes but my best guess is Shaka&#39;s&#8230; the flag is only checked on window creation.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-837443">
				<div id="div-comment-837443" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Rick C</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837443">
			June 4, 2010 at 11:20 am</a>		</div>

		<p>Interestingly, under 64-bit Win7, it does NOT seem to affect other windows of the same class, whether already open or not.</p>
<p>What Raymond was probably referring to, however, is that it disables the close button, but NOT the Close item on the system menu.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-837453">
				<div id="div-comment-837453" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Christian</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837453">
			June 4, 2010 at 2:07 pm</a>		</div>

		<p>There is one very illegimitate reason for disabling the close button and the remedy is &quot;net stop wuauserv&quot;. I heart deleting it&#39;s registry keys even allows installing additional updates without rebooting first ;-)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-837463">
				<div id="div-comment-837463" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jens</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837463">
			June 4, 2010 at 2:44 pm</a>		</div>

		<p>Yo close button, I&#39;m real happy for you and imma let you finish, but OK is the greatest button of all time&#8230; of all time.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-837473">
				<div id="div-comment-837473" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anonymous Coward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837473">
			June 4, 2010 at 4:02 pm</a>		</div>

		<blockquote><p>
  Christian
</p></blockquote>
<p>Or you can just drag the you-want-to-reboot window to the bottom right and reboot when it suits you.</p>
<p>As to why it wants to reboot, Raymond discussed that before: ‘Windows can but won&#39;t’ <a rel="nofollow" target="_new" href="http://technet.microsoft.com/en-us/magazine/2008.11.windowsconfidential.aspx" rel="nofollow">technet.microsoft.com/&#8230;/2008.11.windowsconfidential.aspx</a></p>
<p>On the other hand, there was an article on Slashdot some time ago about one of those old systems (think twenty years ago or something), that could achieve close to 100% uptime and get security right. I thought I bookmarked it since it was interesting from a historical perspective, but I can&#39;t find it any more.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-837433">
				<div id="div-comment-837433" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Rick C</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837433">
			June 4, 2010 at 9:38 am</a>		</div>

		<p>I&#39;d have to check but I&#39;d think that the actual answer is slightly different from Shaka&#39;s: &nbsp;I suspect that SetClassLong would affect *all* windows of that class, even those already existing, and not just new ones. &nbsp;I don&#39;t care enough to write code to test this, but my reasoning is that the change is supposed to happen right then, so it would make sense for it to affect all windows, and this sentence from MSDN &quot;Calling SetClassLong with the GCL_WNDPROC index creates a subclass of the window class that affects all windows subsequently created with the class&quot; implies that by specifically calling out GCL_WNDPROC &quot;affects all windows *subsequently* created&quot; which implies that other values don&#39;t.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-837493">
				<div id="div-comment-837493" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837493">
			June 4, 2010 at 6:46 pm</a>		</div>

		<p>I had to disable the close button and WM_CLOSE once thanks to a third party component (not to name names here). My response to the newly created usability problem was to create a big button on the window labeled &quot;Cancel&quot;.</p>
<p>As for the 100% uptime and getting security right, that is achieved on some Linux systems by patching the running kernel with binary patches.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-837503">
				<div id="div-comment-837503" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nick</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837503">
			June 4, 2010 at 9:02 pm</a>		</div>

		<p>&quot;I heart deleting it&#39;s registry keys even allows installing additional updates without rebooting first ;-)&quot;</p>
<p>Wow, and people wonder why the &quot;required yearly re-installation of Windows&quot; myth perpetuates. &nbsp;My Windows is unstable, even when I fix the registry manually!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-837543">
				<div id="div-comment-837543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alex Cohn</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837543">
			June 5, 2010 at 1:49 pm</a>		</div>

		<p>I wonder if the EnableMenuItem method will work for minimize and maximize, too. After all, these buttons also have siblings in the Alt-space menu.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-837553">
				<div id="div-comment-837553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Neil</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837553">
			June 5, 2010 at 4:54 pm</a>		</div>

		<p>I ran into this very problem a few hours ago, when I wanted to try VC2010++Express, and its setup insisted it needed to reboot; the Close button was disabled, as was the &quot;Restart Later&quot; button. I of course followed the path predicted by Crescens2K&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-837563">
				<div id="div-comment-837563" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Marquess</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837563">
			June 6, 2010 at 2:29 am</a>		</div>

		<p>VS2010 installs .NET Framework 4.0. I&#39;d say that warrants an unconditional reboot.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-837573">
				<div id="div-comment-837573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alexander Grigoriev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837573">
			June 6, 2010 at 9:42 am</a>		</div>

		<p>@Marquess</p>
<p>Why would installation of a new component warrant an unconditional reboot?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-837583">
				<div id="div-comment-837583" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Marquess</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837583">
			June 6, 2010 at 10:27 am</a>		</div>

		<p>Because it&#39;s a rather tightly integrated component.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-837843">
				<div id="div-comment-837843" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James Schend</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837843">
			June 7, 2010 at 9:43 am</a>		</div>

		<blockquote><p>
  On the other hand, there was an article on Slashdot some time ago about one of those old systems (think twenty years ago or something), that could achieve close to 100% uptime and get security right.
</p></blockquote>
<p>BeOS was close, if you&#39;re flexible in your definition of &quot;uptime.&quot; You could, for example, kill, patch, and restart the networking subsystem without rebooting the kernel or anything else on the system. (Or any other subsystem on the machine.)</p>
<p>But then again, if you have to kill networking, you&#39;re probably not going to count that as &quot;uptime&quot; except as a technicality.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-837713">
				<div id="div-comment-837713" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blog.steamsprocket.org.uk' rel='external nofollow' class='url'>Aneurin Price</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837713">
			June 7, 2010 at 7:55 am</a>		</div>

		<p>&gt;I&#39;d say that warrants an unconditional reboot.</p>
<p>Nothing short of the wrath of Zeus warrants an unconditional reboot.</p>
<p>Even updating the OS doesn&#39;t force a reboot. If your application tries a stunt like that, it had better be *the cure for cancer* or if I ever meet you I will hit you in the face with a brick.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-837933">
				<div id="div-comment-837933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Worf</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100604-00/?p=13803#comment-837933">
			June 7, 2010 at 10:30 pm</a>		</div>

		<p>There are mainframe systems that pretty much have the uptime crown. So much so that a reboot is a Very Serious Deal and can take hours or days, even. Literally 5 9&#39;s uptime.</p>
<p>Hell, the OS won&#39;t stop even if hardware fails &#8211; the OS merely keeps on trucking avoiding the failed CPU, RAM, disk or other component. And naturally, all hardware is hot swappable.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>