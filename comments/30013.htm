<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (60)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-412113">
				<div id="div-comment-412113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.brick-labs.com/' rel='external nofollow' class='url'>Eric D. Burdo</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412113">
			August 22, 2006 at 10:53 am</a>		</div>

		<p>Hmmm&#8230; Endless Loop anyone?</p>
<p><a rel="nofollow" target="_new" href="http://en.wikipedia.org/wiki/Circular_definition" rel="nofollow">http://en.wikipedia.org/wiki/Circular_definition</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412133">
				<div id="div-comment-412133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">apok</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412133">
			August 22, 2006 at 11:24 am</a>		</div>

		<p>Now i see the problem with my question, but how do i implement my program then?</p>
<p>;-)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412153">
				<div id="div-comment-412153" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Adrian</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412153">
			August 22, 2006 at 11:35 am</a>		</div>

		<p>This kind of thinking is an example of why the singleton pattern should be considered an ANTIpattern.</p>
<p>It&#8217;s almost always incorrect to assume that there will be only one instance of anything. &nbsp;And even if it&#8217;s right today, it may be wrong tomorrow. &nbsp;We have to stop believing in singletons.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412163">
				<div id="div-comment-412163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Adam</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412163">
			August 22, 2006 at 11:45 am</a>		</div>

		<p>Apok : That question reminds me of a story I once heard about a mythical group of [sub-culture]s who, having had a physicist explain to them how vast space is, how far away other stars and planets are, how unlikely we are to be able to travel at anything approaching the speed of light, and how far advanced cryogenics isn&#8217;t, then asked him &quot;Well, how are we going to travel to distant worlds before we die then?&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412173">
				<div id="div-comment-412173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Stu</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412173">
			August 22, 2006 at 11:49 am</a>		</div>

		<p>VNC can run as a service, but can only control the desktop of the first user logged on (at the console).</p>
<p>In fact, that is usually the best solution, as the vast majority of desktops only ever have one user logged on. Shared home computers and terminal servers are the exception.</p>
<p>MCE extenders also should not affect that solution.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412193">
				<div id="div-comment-412193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Brent Rockwood</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412193">
			August 22, 2006 at 12:24 pm</a>		</div>

		<p>For what it&#8217;s worth, in my organization it&#8217;s far more likely that any given session is a remote desktop session than a physical console session.</p>
<p>As developers of network software, there&#8217;s no way we can keep our entire labs at our desks. &nbsp;My desk contains a laptop and an LCD, but my lab consists of a stack of Virtual Server hosts downstairs in an air conditioned room. &nbsp;That keeps the office cooler (air conditioning costs a fortune), quieter, and uses less power. &nbsp;I believe this will be the rule rather than the exception, at least in corporate settings.</p>
<p>Hey, even at home my server sits in a closet, headless. :)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412213">
				<div id="div-comment-412213" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">still unenlightened</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412213">
			August 22, 2006 at 12:38 pm</a>		</div>

		<p>So what is the correct way to think about this? I presume there is some way to get a reference to the session that my program was created in(excepting services, of course).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412233">
				<div id="div-comment-412233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mihai</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412233">
			August 22, 2006 at 12:56 pm</a>		</div>

		<p>&lt;&lt;So what is the correct way to think about this?&gt;&gt;</p>
<p>Some ways:<br />
<br /> &#8211; Wait for the user to initiate the dialog. Have a client application talking to the service (this is also safer)<br />
<br /> &#8211; You might need to react to an action that is user caused (ie opening an infected file), then try to interact with the user opening the file (if you can determine who that is :-)<br />
<br /> &#8211; Tell to everybody (for something global, like low batery, or running on UPS)<br />
<br /> &#8211; THINK! Throw 10 scenarios at any solution you can find. Ask &quot;what if.&quot; Find someone in your team who is good at playing &quot;devil&#8217;s advocate.&quot; For instance I can see problems with all my sugestions above :-)<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412263">
				<div id="div-comment-412263" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Cooke</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412263">
			August 22, 2006 at 1:36 pm</a>		</div>

		<p>If your application is launched by a user, it will automatically appear in the correct session with no extra effort from you. In fact, you are usually prevented from interacting with any other window stations. (I can&#8217;t really remember how window stations relate to sessions, but I believe that each session can have more than one window station.)</p>
<p>The &quot;Scheduled Tasks&quot; feature in Windows tends to be a bit funny with how it selects a desktop to recieve its UI. When I log into one of our servers at work using Terminal Services every ten minutes a console window appears representing a scheduled task configured to run as me and then vanishes a few seconds later after stealing my keyboard focus. If I have two sessions open at once, it seems to be pretty random which one recieves the UI.</p>
<p>Strangely enough, when I tried to make this task run as a user that doesn&#8217;t log in (it&#8217;s a reserved account that we use for non-human agents on the network) the task didn&#8217;t run at all, even though it was configured to run when the user is not logged in. I never did figure out why.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412273">
				<div id="div-comment-412273" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">The Currently Logged-In User</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412273">
			August 22, 2006 at 1:38 pm</a>		</div>

		<p>Raymond, you&#8217;re a smart guy, but sometimes I&#8217;m surprised that you haven&#8217;t been beaten up by a co-worker going postal at your way of answering questions&#8230; </p>
<p>So, what is the recommended practice when your application, which runs as a service, (or any other situation when it could find itself with multiple or no user desktops/sessions/logins/whatever) needs operator input to proceed? </p>
<p>You guys at Microsoft must have encountered this problem a million times and solved it about an equal number of times. What does the SOP tell you to do? </p>
<p>(Please display the answer on the blog.)</p>
<div CLASS=post>[<i>The question is still under-specific. <u>Which</u> operator do you want to show the message to? Once you know which user you want, then we can start helping you contact that user. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412283">
				<div id="div-comment-412283" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">rsclient</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412283">
			August 22, 2006 at 2:02 pm</a>		</div>

		<p>&#8220;Classic&#8221; computers &#8212; vaxes and such &#8212; had a similar problem. &nbsp;There were all sorts of system services, and some of them need occasional attention. &nbsp;However, there really isn&#8217;t a single notable user send messages to. </p>
<p>The solution (because it&#8217;s a problem that actually needs a solution) was to have an &#8220;operators console&#8221; &#8212; one particular terminal that all such messages would go to. </p>
<p>What&#8217;s the Microsoft solution? &nbsp;Suppose I&#8217;m writing a small service controlling a bit of hardware, and my program really, really needs to tell SOMEONE that something bad is happening &#8212; that the humidity in the server room is too high, or that the lights are on, or whatever. &nbsp;<strong>Where is that message supposed to go</strong>? </p>
<p>Remember that I want to do it the &#8220;standard&#8221; way: the way that Microsoft recommends and uses itself in datacenters. &nbsp; </p>
<div CLASS=post>[<i>It seems you don&#8217;t know who youw ant to tell, as long as you tell <u>somebody</u>. Sure, you can notify a randomly-selected user, but is that a person who can actually do something about it? Imagine you&#8217;re a student on a lab computer and you get this notification that Tape Drive 2 has encountered a Critical Read Error. You&#8217;re going to say, &#8220;Why the hell am I getting this message? I&#8217;m not the tape operator.&#8221; -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412303">
				<div id="div-comment-412303" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">The Currently Logged-In User</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412303">
			August 22, 2006 at 2:23 pm</a>		</div>

		<p>&quot;The question is still under-specific.&quot;</p>
<p>Aaaaaghhh!!!! YOU DID IT AGAIN!</p>
<p>I didn&#8217;t specify which operator, because that is part of what I don&#8217;t know. All I know is that the app needs operator input. So how do I go about getting that input?</p>
<p>Assume that no code has been written at all &#8211; we&#8217;re still trying to design the application. The only thing we know for sure is that it will run as a service, and that it will find itself in the problematic situation of having zero or more than one desktops/sessions/etc.</p>
<p>What is the Microsoft way of solving this problem?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412323">
				<div id="div-comment-412323" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">The Currently Logged-In User</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412323">
			August 22, 2006 at 2:29 pm</a>		</div>

		<p>Got it from the KB:</p>
<p><a rel="nofollow" target="_new" href="http://support.microsoft.com/kb/327618/" rel="nofollow">http://support.microsoft.com/kb/327618/</a></p>
<p>&quot;We recommend that the service writer use a client/server technology such as remote procedure call (RPC), sockets, named pipes or COM to interact with the logged-on user from a service. Additionally, we recommend that you use the MessageBox function together with the MB_SERVICE_NOTIFICATION flag to display simple status messages.&quot;</p>
<p>So instead of having one client console for each service, is there something similar to SNMP for Windows services?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412333">
				<div id="div-comment-412333" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Edward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412333">
			August 22, 2006 at 2:32 pm</a>		</div>

		<p>If a service needs operator input, you may be willing to take input from anyone. &nbsp;In that case you should put a display on all the available desktops.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412343">
				<div id="div-comment-412343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Rick C</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412343">
			August 22, 2006 at 2:32 pm</a>		</div>

		<p>No, he didn&#8217;t. &nbsp;You still aren&#8217;t clear enough on the concept&#8211;or else you&#8217;re trolling. &nbsp;You need to identify something about the person you want to talk to. &nbsp;If Administrator and Jane Secretary are both logged in to a machine&#8211;which one do you want to talk to? &nbsp;Read Matt&#8217;s comment for a bunch of more-specific scenarios. &nbsp;You&#8217;re still acting like the guy in the hypothetical of Raymond&#8217;s original post. &nbsp;You haven&#8217;t defined who &quot;the user I want to talk to&quot; is yet, so there are a number of answers. &nbsp;Here&#8217;s a quick one&#8211;enumerate the list of logged-on users, and pick one at random (or the first one). &nbsp;I hope he hasn&#8217;t locked his terminal. &nbsp;I hope it wasn&#8217;t Jane Secretary, who knows just enough about computers to run a couple applications, and uses cheat-sheets to remind her how to start them.</p>
<p>Get the point yet?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412353">
				<div id="div-comment-412353" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.1060.org/blogxter/publish/5' rel='external nofollow' class='url'>Steve Loughran</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412353">
			August 22, 2006 at 2:34 pm</a>		</div>

		<p>multi-desktop support is something all winXP apps should have, because its so common and easy to test for. XP Pro is a bit limited because it locks out the current user when the 2nd comes in remotely, but the Server releases handle both side by side, though Server 2003 has a bit more isolation between instances, which actually makes sharing stuff harder.</p>
<p>Raymond even omitted the fact that when the screen saver kicks in, it brings up the logon desktop, so there is a 2nd desktop, even on a single user box.</p>
<p>-Services should be written assuming that there is no end user to notify. do you think that just because the OS can bring up dialogs telling you that your laptop wont suspend because a driver refused the request, the user<br />
<br />wants to see it?</p>
<p>When a service brings up a dialog on a desktop, it creates a privilege escalation back door. Anyone app on the same desktop can send messages to it, maybe, if they try hard, get their DLL to load and execute under it. Nobody wants that.</p>
<p>If your service wants to talk to the client, it should have an app that runs on the client and which talks over some secure channel e.g. named pipe, with a restricted set of messages. The service can notify clients this way; the clients request things of the server. Both ends should assume that messages may be sent by malicious apps, and check them before casting them to structs.</p>
<p>Where you do have fun with multiple desktops is that NT kernel objects get relinked to. Run Winobj as a remote user -you&#8217;ll see. Different users have different named objects.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412373">
				<div id="div-comment-412373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">The Currently Logged-In User</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412373">
			August 22, 2006 at 2:56 pm</a>		</div>

		<p>Rick, Matt,</p>
<p>I&#8217;m not trolling. The answer to my question was in the KB: &quot;We recommend that the service writer use a client/server technology such as remote procedure call (RPC), sockets, named pipes or COM to interact with the logged-on user from a service.&quot;</p>
<p>So, the question of &quot;how do I pop up a UI&quot;, as well as the question of &quot;on which desktop&quot; is meaningless &#8211; you&#8217;re not supposed to pop up anything at all. You&#8217;re supposed to write a client app that connects to the service. That app can then pop up anything it wants.</p>
<p>This is why I think Raymond&#8217;s approach is wrong. Why lead the person asking the question round and round, wasting everyone&#8217;s time, instead of just saying:</p>
<p>&quot;Since you can have multiple desktops, or no desktop, or terminal services, and all that, the standard way is to write a small client-side app that your users can run.&quot;</p>
<p>There. Whoever asked can now go on and be productive.</p>
<p>If they, after being told that, want to be extra-smart and implement the heuristics the Matt lists &#8211; great. But they now know what the SOP is as well as why it is SOP, and can fall back on it.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412383">
				<div id="div-comment-412383" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Matt Lee</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412383">
			August 22, 2006 at 2:56 pm</a>		</div>

		<p>I had a problem related to this at home the other day. &nbsp;My wife and I were both logged on to our user accounts. &nbsp;I was working on a document in Excel and wanted to print it double sided on our HP printer. &nbsp;She knew how to do that so I let her. &nbsp;It printed the first page, but would not print the second page.</p>
<p>We tried deleting the print job, but it was hung up and successive jobs wouldn&#8217;t print. &nbsp;I finally shut everything down and when I went to her user session, there was a HP print wizard providing instructions for turning over the paper to print double sided and waiting for the &quot;Continue&quot; button to be clicked. &nbsp;When I clicked it, the 2nd page of the document printed.</p>
<p>Kind of irritating. &nbsp;It&#8217;s a new printer so it certainly could have been tested on XP with multiple users.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412393">
				<div id="div-comment-412393" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Richard</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412393">
			August 22, 2006 at 3:54 pm</a>		</div>

		<p>I think people might be more clear on what they want if there were a few examples on users they might want to contact and how to do that &#8211; at worst they&#8217;ll know a bit more about what they don&#8217;t want.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412403">
				<div id="div-comment-412403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">David R</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412403">
			August 22, 2006 at 4:06 pm</a>		</div>

		<p>Other questions in this vein from network-land: &nbsp;What is the IP address of this computer? &nbsp;What is its Ethernet address?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412413">
				<div id="div-comment-412413" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Cooney</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412413">
			August 22, 2006 at 4:49 pm</a>		</div>

		<p>It sounds like the service writer wants to pop up an icon that will be seen &#8211; there are two different solutions that should work ok:</p>
<p>1. Iterate through all sessions and pop up the icon on those that are connected.</p>
<p>2. Pop the icon on <em>every</em> session.</p>
<p>After a timeout, kill all icons that haven&#8217;t been looked at.</p>
<p>This sounds like a really bad idea, and I&#8217;d love it if I could disable that sort of behavior (along with the tools that write focus stealing apps) &#8211; this leads to Raymonds underlying question: what exactly are you trying to do?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412423">
				<div id="div-comment-412423" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">The Currently Logged-In User</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412423">
			August 22, 2006 at 4:59 pm</a>		</div>

		<p>&quot;Other questions in this vein from network-land&quot;</p>
<p>And in the land of multiple monitors or headless servers:</p>
<p>&quot;What is the screen resolution?&quot;</p>
<p>I remember having to do some very annoying things when running Java on Linux without an X server, because the Java Runtime tried to find out the bit depth and resolution of the display when starting up, and there was no way to keep it from doing this.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412443">
				<div id="div-comment-412443" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Hutchings</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412443">
			August 22, 2006 at 6:02 pm</a>		</div>

		<p>Ben Cooke wrote: &quot;Strangely enough, when I tried to make this task run as a user that doesn&#8217;t log in (it&#8217;s a reserved account that we use for non-human agents on the network) the task didn&#8217;t run at all, even though it was configured to run when the user is not logged in. I never did figure out why.&quot;</p>
<p>The user that runs a scheduled task needs to have permission to read and write the Scheduled Tasks directory. &nbsp;No kidding.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-mike-dimmick odd alt thread-odd thread-alt depth-1" id="comment-412453">
				<div id="div-comment-412453" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Mike+Dimmick' rel='external nofollow' class='url'>Mike Dimmick</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412453">
			August 22, 2006 at 6:40 pm</a>		</div>

		<p>Mr. Currently Logged In User: What if no user is logged in?</p>
<p>You should consider logging an event to an appropriate Windows Event Log, then continue as best you can. Rely on some other management tool processing that log to alert the administrator or appropriate delegated operator. This allows administrators to aggregate monitoring of multiple servers.</p>
<p>There are many tools that can do this, including (I think) Microsoft Operations Manager.</p>
<p>(This is very much do-as-I-say, not do-as-I-do. I&#8217;ve inherited responsibility for an application server product originally written by my boss. Right now it is generally configured as an interactive service, with all that entails &#8211; the damn thing pops a notification icon on &#8216;the&#8217; taskbar, which means session 0, the interactive console session. This will no longer work as of Windows Vista. Unfortunately I have no long-term development budget, either time or money, so development is currently on hold &#8211; I tend to get requests to make specific functionality changes which do get budgeted, but no budget for generally improving the software. Sucks.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412473">
				<div id="div-comment-412473" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">The Currently Logged-In User</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412473">
			August 22, 2006 at 7:53 pm</a>		</div>

		<p>Mike,</p>
<p>true.</p>
<p>Your solution seems even better as it allows for multiple servers.</p>
<p>The downside of Microsoft Operations Manager is that you have to buy it, so I would not code to that API if I were writing something that was supposed to run on someone&#8217;s home PC.</p>
<p>Perhaps putting an SNMP angent into the service is the best way to do it, combined with logging to the system event log? (Like <a rel="nofollow" target="_new" href="http://snmpboy.msft.net/" rel="nofollow">http://snmpboy.msft.net/</a> )</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412253">
				<div id="div-comment-412253" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">lf</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412253">
			August 22, 2006 at 1:02 pm</a>		</div>

		<p>Most annoying case I have seen of this: Canon printer software that insists on having its ever-present control panel on &quot;the&quot; desktop. If two users log in, *both* control panels crash.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412293">
				<div id="div-comment-412293" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Matt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412293">
			August 22, 2006 at 2:20 pm</a>		</div>

		<p>The problem has, in essence, become domain specific &#8211; you have to tell Raymond who you want to contact. He can tell you (if he&#8217;s feeling particularly nice) how you get said desktop.</p>
<p>It would be interesting to know how to*:</p>
<p>+ Iterate though all sessions with Admin access (if you have an issue you wish to display to anyone who is logged on you may well want to do this to admins/power users etc. first.<br />
<br />E.G my UPS is acting up).</p>
<p>+ If I am a service running as a user, get the desktop(s)** for that user</p>
<p>+ How to find out which user &#8216;owns&#8217;/ &#8216;is responsible for&#8217; an attached device. If two users are logged in and net uses to a remote file system can I tell which one did it easily..</p>
<p>+ Identify which users interacted with the desktop (perhaps by mouse/keyboard for arguments sake) last/first</p>
<p>+ Which user was the first to logon to the machine. </p>
<p>+ If a user logged in is set to auto login (and thus for my purposes will be considered the most useful user to talk to)</p>
<p>+ Which sessions have a screen saver active</p>
<p>+ Which sessions are remote, (specifically terminal services &#8211; if you can tell it&#8217;s being interacted with by VNC et al so much the better :)</p>
<p>+ Which sessions are disabled due to removed USB authentication keys and the like (If I have to talk to active directory to do this that&#8217;s a pain)</p>
<p>Just some thoughts. If you want people to be clever in how they code for desktop interaction in the world or multiple users these questions should all be reasonably answerable right?</p>
<p>* I assume this is all on MSDN &#8211; therefore don&#8217;t actually bother answering<br />
<br />** Can the same user ever have two sessions (active or otherwise) to a computer. From different domains?<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412313">
				<div id="div-comment-412313" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Matt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412313">
			August 22, 2006 at 2:27 pm</a>		</div>

		<p>Oh yeah &#8211; rsclient.<br />
<br />The answer to your specific<br />
<br />&quot;Suppose I&#8217;m writing a small service controlling a bit of hardware, and my program really, really needs to tell SOMEONE that something bad is happening &#8212; that the humidity in the server room is too high, or that the lights are on, or whatever. &nbsp;<br />
<br />__Where is that message supposed to go__?&quot;</p>
<p>The answer is that such a response should not rely on a user being logged into the said box. The message should go to some other system which will inform the sysadmin/interested parties as needed.<br />
<br />This should hopefully be configurable and redundant.<br />
<br />An example of the most basic thing you can do is send an email. I know commercial systems which email/page/text/call(!)/have pretty GUI/make noises. All major server suppliers tend to provide their own proprietary solutions.</p>
<p>This system could then, if desired, use something like windows messenger service* to inform all connected users of the issue.</p>
<p>In the degenerate case (like a SOHO situation) the service that does this monitoring is running on the machine itself.<br />
<br />The idea is that your app should talk to some other system which lets the admin take whatever steps they see fit by supplying a timely, informative programmatic indication of the sate.</p>
<p>If you do this via an open standard so much the better.</p>
<p>* Yeah, I know &#8211; I assuming you&#8217;re behind a firewall so are happy to have this on :)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412363">
				<div id="div-comment-412363" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Matt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412363">
			August 22, 2006 at 2:37 pm</a>		</div>

		<p>The Currently Logged-In User </p>
<p>aaaaand breath. </p>
<p>Then describe, *for your app* who, out of all the possible users, should get this notification. </p>
<p>If you cannot decide, with your domain specific knowledge* who to contact then Raymond could just say &#8216;Pick a random session&#8217;. Based on your spec (it doesn&#8217;t matter) this is a valid and reasonable answer (well deterministic would be good for debugging). </p>
<p>Remember that all good thought experiments require a good start point. In your case an application that has a more descriptive name than &#8220;App&#8221; :) </p>
<p>* If you have no specific knowledge invent an app in your head, think of an error case then think who you would want to contact if you had all the info in the world about each session.</p>
<div CLASS=post>[<i>Precisely. You have to bring domain-specific knowledge. If it&#8217;s a probably with a database, then you should contact the database administrator. If it&#8217;s a problem with a tape drive, then contact the tape operator. Deliver the message to somebody who (1) cares and (2) has the power to fix it. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412493">
				<div id="div-comment-412493" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Brandon Bloom</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412493">
			August 22, 2006 at 10:34 pm</a>		</div>

		<p>If you have an application running as a service, it should NEVER present a UI!</p>
<p>Send an email to the admin, log an event, but never ever bug anyone using the machine!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412503">
				<div id="div-comment-412503" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">TK</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412503">
			August 22, 2006 at 11:14 pm</a>		</div>

		<p>&quot;Can the same user ever have two sessions (active or otherwise) to a computer.&quot;</p>
<p>Yes. In fact, this is sometimes necessary. I&#8217;ve seen cases where a terminal services session becomes unusable. It&#8217;s possible to establish another session though by connecting again with another instance of the client (and then use the terminal services manager on the server to kill the other connection).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412543">
				<div id="div-comment-412543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">.</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412543">
			August 23, 2006 at 4:35 am</a>		</div>

		<blockquote><p>
  &gt; Send an email to the admin, log an event, but never ever bug anyone using the machine!</p>
<p>Antivirus ?<br />
  <br />Personal firewall ?<br />
  <br />Remote control confirmation ?</p>
<p>&gt;&gt; Kind of irritating. &nbsp;It&#8217;s a new printer so it certainly could have been tested on XP with multiple users. </p>
<p>It certainly could have been tested and it could have costed more to make. </p>
<p>&#8212;</p>
<p>That said, the questions didn&#8217;t imply that the programmer wanted to display a dialog on that desktop. Maybe he wanted to emulate the VNC approach of doing its best to find the desktop running on the &quot;real&quot; console which has many advantages over remote desktop. Maybe it&#8217;s a service which wants to take a screenshot of what&#8217;s running (for whatever purpose, don&#8217;t ask! ;)).
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412553">
				<div id="div-comment-412553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mal</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412553">
			August 23, 2006 at 5:11 am</a>		</div>

		<p>This reminds me of my main peeve with iTunes on XP, about a year ago I had 2 housemates with iPods and we all had a login on my XP box. &nbsp;Suppose user1 left iTunes running and then locked his session, if user2 came along and wanted to update his tunes then he&#8217;d login, run iTunes and plug his iPod in &#8211; the iPod would then (rather inconveniently) connect to the user1&#8217;s instance of iTunes which you couldn&#8217;t see or interact with and prevent you connecting to to the instance you could see until you found user1 and got him to log out. Arrgh.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412573">
				<div id="div-comment-412573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Andy C</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412573">
			August 23, 2006 at 7:04 am</a>		</div>

		<p>This problem only arises if you try to solve two issues at once:</p>
<p>1. My service has encountered an event that someone may need to be notified of.</p>
<p>2. I want to be notified when specific events occur.</p>
<p>If a service needs to notify somebody of an event it should either write to the event log and/or generate a WMI event notification. It then becomes the responsibilty of whomever is listening to decide whether it is appropriate for them to respond and if so to take any measures necessary.</p>
<p>Doing it this way means you don&#8217;t need to worry about whether someone is logged in, whether 100 people are logged in or whether somebody is monitoring the situation remotely because all of the can be handled as appropriate.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412593">
				<div id="div-comment-412593" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">KJK::Hyperion</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412593">
			August 23, 2006 at 7:31 am</a>		</div>

		<p>The Currently Logged-In User: it&#8217;s that you aren&#8217;t supposed to have any user interface in a service. That&#8217;s it. It&#8217;s common sense, it has been a recommendation since forever, the Shatter proof-of-concept made a strong case for it, and it&#8217;s now (Windows Vista and later) a requirement</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412613">
				<div id="div-comment-412613" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">dave</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412613">
			August 23, 2006 at 8:35 am</a>		</div>

		<p>&quot;From a service, how do I do X with the currently logged-on user?&quot;</p>
<p>Where X is presumably &quot;expose the system to a shatter attack&quot;.</p>
<p>I appreciate the original sentiment &#8211; I have spend years railing against Windows programmers who have this strange notion that there must be an arse in the seat before a computer can work &#8211; but allowing privileged code to put a UI on an unprivileged desktop has been demonstrated to be a Very Bad Idea in itself.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412653">
				<div id="div-comment-412653" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">The Currently Logged-In User</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412653">
			August 23, 2006 at 10:12 am</a>		</div>

		<p>KJK::Hyperion,</p>
<p>it is common sense if you think about it, but what is lacking is a document that spells out what the proper way is.</p>
<p>I know about the vulnerabilities of emulating user actions via SendMessage, and I know about a lot of other vulnerabilities.</p>
<p>What I want Microsoft to do is stand up and say: &quot;We have analyzed vulnerabilities and found that the following way is the right way to allow a user to interact with services.&quot;</p>
<p>For example, when you SSH to a host, you don&#8217;t have to care about what a proper key exchange algorithm should consist of, even if it is common sense how it should work, if you are a cryptographer. All the cryptographic knowledge has been distilled into SSH and the manual that tells you how to use it. You don&#8217;t have to rely on remembering exploits.</p>
<p>This is why, when you have to implement crypto, should use a public algorithm and not try to be smart and roll your own. (And you should preferably use an entire public protocol to get the authentication and all the surrounding bits right as well.)</p>
<p>In the same way, I want for someone to distill all the common sense that is floating around into a document that spells out how services should be written so they can be managed locally or remotely via SNMP, Msft Operations Manager or whatever remote management facilities Microsoft decide to support, so someone writing a services doesn&#8217;t have to chase around and gather up all that common sense.</p>
<p>I know of no such document besides the one I found in the Microsoft KB. If you do, please share it with us.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412523">
				<div id="div-comment-412523" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Cooke</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412523">
			August 23, 2006 at 3:29 am</a>		</div>

		<p>To me, the obvious answer seems to be to have a setting in your app for who to contact in response to this event. That way the administrator can configure it. Of course, this leads to the question of what to do if there is *no-one* logged in, which is quite common on a server.</p>
<p>One thing that would be useful is a general &quot;event dispatch&quot; system, where services can just say &quot;Tell someone about this&#8230;&quot; and the system can figure out (based on the configuration of the event system) who to tell and how to tell them. Then allow plugins for the event sinks, so that I can (for example) write a plugin to send me a message through my company&#8217;s Jabber server, or send me an SMS message.</p>
<p>But maybe Windows already has this? It has the system-wide event log, so is there some way to hook into that and get notified when an event fitting a given criteria goes into the log?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412673">
				<div id="div-comment-412673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Andy C</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412673">
			August 23, 2006 at 10:46 am</a>		</div>

		<p>The Currently Logged In User: You&#8217;re basic assumption is wrong. There is no one &quot;best&quot; way of doing it, it depends entirely upon what the service is doing. For some (I&#8217;d contend most) WMI is the right way to do it. Others would be better suited to just logging information to an Event log. RPC, Email, SMS or a myriad of other technologies might be a better fit for other cases. </p>
<p>The only one sure-fire wrong answer is displaying a GUI directly from a privileged account.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412723">
				<div id="div-comment-412723" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">KJK::Hyperion</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412723">
			August 23, 2006 at 11:30 am</a>		</div>

		<p>There is no &quot;proper&quot; way&#8230; the only proper way is, keep the GUI out of the server. God knows there&#8217;s no scarcity of IPC mechanisms on Windows</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412733">
				<div id="div-comment-412733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">David Walker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412733">
			August 23, 2006 at 11:49 am</a>		</div>

		<p>This article and its comments are about the most interesting thread I have seen here, raising many interesting questions!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412803">
				<div id="div-comment-412803" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.1060.org/blogxter/publish/5' rel='external nofollow' class='url'>Steve Loughran</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412803">
			August 23, 2006 at 1:09 pm</a>		</div>

		<p>I now want to counteract the current &#8216;send all messages to the log&#8217; thread with a real anecote of why this isnt enough.</p>
<p>Back in 1997, my twin CPU P6/150 box (!) suddenly stopped updating the icons on the desktop. </p>
<p>So I restarted. Only the box didnt come back up. No OS.</p>
<p>So I pulled out my DAT tape backup from the previous month (lucky me) and did a system recover on it. </p>
<p>After a few hours, I had the system functional enough to see the event log. Which had a warning that drive C: and drive D: filesystem were corrupt. </p>
<p>I think I&#8217;d hit some race condition in the early NT4 NTFS code or the disk driver, but both filesystems got toasted. And what did the OS do? Nothing but leave a message in the log, on the now-toast FS.</p>
<p>This is the kind of event were every user needs to see a big warning in big letters &quot;the filesystem is toast, save up your working docs to a network share, then power off the machine without trying to do a clean shutdown. Take it to support and let them deal with it&quot;</p>
<p>I&#8217;ve had HDD failures on linux too; they dont do much more than log either. What is the point in SMART logging if all it does is add stuff to /var/log/errors?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412813">
				<div id="div-comment-412813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">TCLIU</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412813">
			August 23, 2006 at 2:31 pm</a>		</div>

		<p>Andy C: While many ways are right, they are not without tradeoffs, and I think it is outright stupid of Microsoft to not have a single documented standard solution for this. As it is now, developers are forced to figure out for themselves what the &#8220;right&#8221; solution is, but they are not even told what the tradeoffs are! </p>
<p>Example: Microsoft has a product called Microsoft Operations Manager that is used to manage datacenters. If you choose a method that can&#8217;t be integrated with MOM, well, then your service is much less attractive for organizations using MOM. </p>
<p>Did you know that? I sure didn&#8217;t. Before you call me a n00b (which I am) &#8211; whoever wrote the article I quoted from MSKB didn&#8217;t know that either, because MOM isn&#8217;t even mentioned! </p>
<p>If I had been forced to decide on a service-management solution I would have picked something incompatible with MOM, thereby making my service much harder to manage. </p>
<p>I&#8217;m not asking for something difficult. Microsoft can just stand up and say &#8220;Use SNMP. Download SDK <em>here</em>.&#8221; </p>
<p>The question of whether notifications etc. should result in dialog boxes popping up, emails being sent, or whatever is not for the event producer to decide. For home users I&#8217;d like Microsoft to include with Windows a little applet that perhaps lives in the system tray where I can select things such as: </p>
<p>+ Any hard drive events of type &#8220;ERROR&#8221; should result in a dialog box popping up on every session, or on the login screen, or whatever. </p>
<p>If you had two users on a machine, you could have personalized settings for each user. The secretary doesn&#8217;t have to see stuff they don&#8217;t understand anyway, and the power user can see everything. </p>
<p>For datacenters, the MOM could use SNMP to monitor the service and send emails, start sirens or whatever. </p>
<p>In short &#8211; all the problems of finding the right method, adding more methods disappear. Services use one api to generate events. Another program handles the &#8220;get the event to someone that cares&#8221; part. And it scales from home user to datacenter! </p>
<p>Again, notifying operators is a very common action. I&#8217;m amazed Microsoft hasn&#8217;t declared some method to be the standard. </p>
<div CLASS=post>[<i>There is no &#8220;one size fits all&#8221; solution. It has to be dealt with on a case-by-case basis. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412823">
				<div id="div-comment-412823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">TCLIU</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412823">
			August 23, 2006 at 2:41 pm</a>		</div>

		<p>Steve Loughran wrote: &quot;I&#8217;ve had HDD failures on linux too; they dont do much more than log either. What is the point in SMART logging if all it does is add stuff to /var/log/errors?&quot;</p>
<p>None really.</p>
<p>I&#8217;ve found this for KDE: MetaMonitor <a rel="nofollow" target="_new" href="http://www.kde-apps.org/content/show.php?content=30603" rel="nofollow">http://www.kde-apps.org/content/show.php?content=30603</a></p>
<p>That would allow you to have a popup on your desktop when your HD is about to go.</p>
<p>If you run KDE, that is.</p>
<p>I&#8217;m sure there are similar programs for Gnome.</p>
<p>(As an aside &#8211; while we are arguing over how impossible it is to pop up UIs, well, these guys just solved the problem. Privilege escalation is impossible since the notifier runs as the current user.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412853">
				<div id="div-comment-412853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Consul Desktop</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412853">
			August 23, 2006 at 4:02 pm</a>		</div>

		<p>Windows can only handle 1 physical console desktop. Don&#8217;t pretend it can handle several.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412873">
				<div id="div-comment-412873" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">David Walker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412873">
			August 23, 2006 at 4:36 pm</a>		</div>

		<p>Whoa there, Consul Desktop. &nbsp;That&#8217;s not true with Windows Media Center Edition, as has already been pointed out in the comments to this article.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412883">
				<div id="div-comment-412883" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Phil Wilson</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412883">
			August 23, 2006 at 5:20 pm</a>		</div>

		<p>I haven&#8217;t noticed anyone point out that there could in fact be NOBODY logged on to the system. A service is running at reboot whether there are any logged-on users or not, so not only do you have to deal with choosing between logged-on users, you also have to deal with zero users.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412923">
				<div id="div-comment-412923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412923">
			August 23, 2006 at 8:50 pm</a>		</div>

		<p>To Steve Loughran:</p>
<p>In case anyone doesn&#8217;t believe you, you&#8217;ll be glad to know that you can show them the same problem with more recent systems, up to and including build 5472 (and, as you mentioned, Linux).</p>
<p>Though recently I had one pleasantly surprising experience. &nbsp;Windows 2003 detected some bad blocks on a USB hard disk and, same as always, it recorded an event without telling me. &nbsp;But when I noticed the event, I ran CHKDSK with the option to check for bad blocks. &nbsp;CHKDSK told me the names of the affected files! &nbsp;It only gave me the shortnames, and every other user tool in Windows 2003 only gives me the longnames, so I had to do a bit of hunting to find the files, but it was still a big help. &nbsp;Windows 2003 did better than Linux this time.</p>
<p>The next surprise was that CHKDSK actually recovered the contents of the files. &nbsp;I was amazed. &nbsp;I thought I would have to copy new copies back in from another external backup, but decided to try the &quot;FC&quot; command first and it reported no differences. &nbsp;CHKDSK found bad blocks, recovered the contents, and at the end it said it found no problems with the file system. &nbsp;It actually told the truth. &nbsp;But I wouldn&#8217;t expect this to be repeatable. &nbsp;Ordinarily with bad blocks you&#8217;re going to have to recover the file from a different backup.</p>
<p>I still think the person sitting at the console should be informed together with the writing of an event log. &nbsp;For example &quot;Windows Explorer isn&#8217;t going to respond for a while because we&#8217;re trying to read a defective CD, so during this time don&#8217;t try to close your non-responding Windows Explorer.&quot; &nbsp;And maybe even &quot;Here&#8217;s a cancel button if you want to stop trying to read your defective CD&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-412843">
				<div id="div-comment-412843" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">TCLIU</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-412843">
			August 23, 2006 at 3:41 pm</a>		</div>

		<p>&#8220;There is no &#8220;one size fits all&#8221; solution. It has to be dealt with on a case-by-case basis. -Raymond&#8221; </p>
<p>Raymond, you are very good at saying what *can&#8217;t* be done. </p>
<p>But you are not good at saying what *can* be done and how one should choose between the alternatives. </p>
<p>I think the latter is much more interesting than the former.</p>
<div CLASS=post>[<i>I already gave two examples in previous comments for specific scenarios. The short version is: Decide who (1) wants to know, and (2) can do something about it. Be specific, don&#8217;t just say, &#8220;The person using the computer.&#8221; Once you know who you want to notify, you can then set about trying to contact them. The purpose of this article was to get people past that first step. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-413003">
				<div id="div-comment-413003" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">cg</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-413003">
			August 24, 2006 at 9:08 am</a>		</div>

		<p>What&#8217;s the best way for <em>your</em> situation &nbsp;(your client, your organization, yourself even) to be notified?</p>
<p>Also, are some messages from your service critical errors? &nbsp;Does <em>someone</em> need to be notified NOW (by email, pager, carrier pigeon, everything!!)? &nbsp;Are some messages important, and should be relayed by email, but not mission critical and can &quot;wait until Monday&quot;?</p>
<p>If you&#8217;re a software vendor, get to know your customers. &nbsp;What method(s) do they use to monitor their servers (and services)? &nbsp;Maybe they like SNMP. &nbsp;Maybe they detect errors in the Event Log. &nbsp;Maybe they like emails and pages set out to important admins. &nbsp;Provide methods for your software to hook into these reporting mechanisms. &nbsp;But most importantly, report <em>out</em>, don&#8217;t accept inputs back in this case (the danger of the privileged dialog on an unprivileged desktop was mentioned earlier).</p>
<p>The idea here is that, whatever&#8217;s gone wrong, you provide methods to tell those who need to know, how they want to know. &nbsp;Then, they can deal with it, perhaps by logging into the desktop with their privileged session and using your desktop admin tools.</p>
<p>I&#8217;ll give you an example. &nbsp;My organization likes (for some reason) paging system operators when a server &quot;goes down&quot;. &nbsp;They have a strange definition for servers &quot;going down&quot;, but the point is, server admins have their cell phones ringing with text messages all day long. &nbsp;I didn&#8217;t say it was effective, but it was what the organization wanted. &nbsp;Whether the organization is you, your employer, or your client, ask yourself how they want to be notified.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-413143">
				<div id="div-comment-413143" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jess Sightler</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-413143">
			August 24, 2006 at 11:11 am</a>		</div>

		<p>+1 to a document describing the various approaches and solutions to this kind of problem.</p>
<p>I&#8217;d bet the two most commonly appropriate solutions are:</p>
<p>1. Send an email (or SMS, or something)<br />
<br />2. Have the user run a client app (possibly on login) which monitors the service for events</p>
<p>The other approaches are:<br />
<br />1. Have the service allow GUI interaction and display junk on the screen &#8212; Bad idea, and no longer supported by Vista</p>
<p>2. Log it and forget &#8211; Hope it wasn&#8217;t important, because probably noone will notice :)<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-413193">
				<div id="div-comment-413193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">AndyB</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-413193">
			August 24, 2006 at 11:22 am</a>		</div>

		<p>As someone mentioned SMART monitoring of HDDs under Linux, and suggested a KDE app &#8211; what about my linux server whose only idea of a GUI is a coloured SSH session (when I run one, that is). In my case, smart errors are logged and a monitoring app sends me an email if it sees any. Same goes for brute-force hacking attempts on the server. </p>
<p>Whatever the answer to the problem is, I&#8217;m certain it requires the admin user to run an app to receive send-and-forget messages from the server, that message can be broadcast to many destinations, and is logged somewhere on the server. Whether the destination is email, a MSN message, SMS, or a UDP packet doesn&#8217;t matter.</p>
<p>The point is, you can&#8217;t have any interaction with the server because you may not be able to get to it (network down errors go &#8230; where? you must send so they can be received when the network is back up, at least the admin knows what happened in case, say, some services need restarting), and you can&#8217;t have direct interaction because no-one is likely to be in the server room (this also includes beeping from the BIOS, but that will be noticed after a while).</p>
<p>I suppose the only true way to deal with it is MessageBox, eventually someone will come and look at why the server is unresponsive :)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-413513">
				<div id="div-comment-413513" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.1060.org/blogxter/publish/5' rel='external nofollow' class='url'>Steve Loughran</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-413513">
			August 24, 2006 at 5:56 pm</a>		</div>

		<p>I&#8217;m glad the corrupt FS story has opened up this discussion more, as the underlying problem is &quot;how do I notify somebody competent in a timely manner&quot;.</p>
<p>In theory, windows has the event log, which is remotely accessible, and integrates with other management tools. In practise, most consumer-grade users dont know WTF it is, so it only ever gets opened when someone competent comes round or connects in to scope it out. </p>
<p>On the subject of linux HDD failures, the only time it hit me I was at a conference in a different country. From the laptop I&#8217;d noticed my email wasnt filtering, so its SSH in to the desktop, kill -9&#8217;d thunderbird and went to ~/bin to restart it, only to discover there was no ~/bin; the whole of /home had been unmounted after too many failures. not good.</p>
<p>I think I&#8217;d like every OS to SMS me on an HDD failure, and for that not to be a premium rate feature that I have to pay for enterprise management tools for. </p>
<p>At the same time, I dont want to get paged whenever some app feels like telling me that the default printer back over the VPN has run out of paper. a ::SendSMStoOperator() API call is not something the drivers should have. ::NotifyOperator(CRITICAL,FACILITY_FILESYTEM,&#8230;) would be better.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-413523">
				<div id="div-comment-413523" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Steve Loughran</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-413523">
			August 24, 2006 at 6:00 pm</a>		</div>

		<p>The Currently Logged-In User said &quot;I remember having to do some very annoying things when running Java on Linux without an X server, because the Java Runtime tried to find out the bit depth and resolution of the display when starting up, and there was no way to keep it from doing this.&quot;</p>
<p>Java doesnt work properly without X11 installed on unix because the advanced image API somehow needs it to do image processing. You have to install that headless X11 server that renders to memory only for things to work.</p>
<p>other unix apps need it too -the oracle command line installer for one. We suspect it is creating the GUI and filling in the forms and hitting the buttons itself.</p>
<p>Dont even get me started on apps that expect a keyboard&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-413563">
				<div id="div-comment-413563" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-413563">
			August 24, 2006 at 8:24 pm</a>		</div>

		<p>Speaking of who says there&#8217;s only one, think of all the Windows apps (not just Java) that get The screen resolution, Windows apps and drivers that get The keyboard state, Windows apps and drivers and firewalls that use The IP address, a few Windows apps and drivers and firewalls which somewhat understand multiple NICs but still use The IP address of each NIC, etc. &nbsp;Someone please remind me of why The workgroup or The domain works OK.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-414253">
				<div id="div-comment-414253" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Gabe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-414253">
			August 28, 2006 at 2:33 pm</a>		</div>

		<p>My guess as to why Oracle&#8217;s installer requires an X server is that it uses Java. If Java won&#8217;t start up without an X server, Oracle&#8217;s installer wouldn&#8217;t be able to start up either.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-414493">
				<div id="div-comment-414493" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Luci S</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-414493">
			August 28, 2006 at 11:20 pm</a>		</div>

		<p>My two cents about the new (beta indeed) MSN Screensaver. 1. it launches browser windows, 2. it crashes if it runs simultaneously under two accounts. Maybe a MSN team member reads this.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-414993">
				<div id="div-comment-414993" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-414993">
			August 29, 2006 at 10:32 pm</a>		</div>

		<p>One more &quot;only one&quot;: &nbsp;Historically most Usenet news readers assumed there was only one news server that the user would want to connect to. &nbsp;Outlook Express nicely avoids that assumption most of the time. &nbsp;Microsoft deserves at least 95% of a congratulation for this.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-415053">
				<div id="div-comment-415053" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-415053">
			August 30, 2006 at 1:47 am</a>		</div>

		<p>Oops, sorry for not having only one in a row here. &nbsp;I just came across a very relevant answer in MSDN:</p>
<p><a rel="nofollow" target="_new" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/window_stations.asp" rel="nofollow">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/window_stations.asp</a><br />
<br />&gt; The interactive window station, Winsta0, is<br />
<br />&gt; the only window station that can display a<br />
<br />&gt; user interface or receive user input. It is<br />
<br />&gt; assigned to the logon session of the<br />
<br />&gt; interactive user, and contains the keyboard,<br />
<br />&gt; mouse, and display device. All other window<br />
<br />&gt; stations are noninteractive, which means they<br />
<br />&gt; cannot display a user interface or receive<br />
<br />&gt; user input.<br />
<br />&gt;<br />
<br />&gt; When a user logs on to a Terminal Services-<br />
<br />&gt; enabled computer, a session is started for<br />
<br />&gt; the user. Each session is associated with<br />
<br />&gt; its own interactive window station. For more<br />
<br />&gt; information, see Terminal Services Sessions.</p>
<p><a rel="nofollow" target="_new" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/termserv/termserv/terminal_services_sessions.asp" rel="nofollow">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/termserv/termserv/terminal_services_sessions.asp</a><br />
<br />&gt; The console session on the Terminal Server is<br />
<br />&gt; assigned the session ID 0.<br />
<br />&gt;<br />
<br />&gt; Each Terminal Services session is associated<br />
<br />&gt; with an interactive window station. The only<br />
<br />&gt; supported window station name for an<br />
<br />&gt; interactive window station is &#8220;WinSta0&#8221;;<br />
<br />&gt; therefore each session is associated with its<br />
<br />&gt; own &#8220;WinSta0&#8221; window station.<br />
<br />[&#8230;]<br />
<br />&gt; However, because the Terminal Services<br />
<br />&gt; console session is never deleted, the window<br />
<br />&gt; stations associated with the console session<br />
<br />&gt; are not deleted.</p>
<p>If I understand correctly, in Vista the Terminal Services console session will no longer be session ID 0. &nbsp;It will be session ID something else.</p>
<p>Nonetheless the Terminal Services console session will be just one console session, right? &nbsp;That session will contain just one Winsta0. &nbsp;That session might also contain other window stations but they won&#8217;t be Winsta0. &nbsp;Other sessions will contain Winsta0 stations but they won&#8217;t be in the console session. &nbsp;There will only be one Winsta0 in the console session.</p>
<p>There can be several desktops in the Winsta0 window station in the console session, but only one of those desktops will be retrieved by the OpenInputDesktop function.</p>
<p>Result: &nbsp;the unique user logged into the console session.</p>
<div CLASS=post>[<i>I wouldn&#8217;t be surprised if Windows Vista changes the rules. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-416343">
				<div id="div-comment-416343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Neil</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060822-00/?p=30013#comment-416343">
			September 4, 2006 at 6:24 am</a>		</div>

		<p>Now I have to go away and figure out how my scheduled task should interact with me (currently if I get the settings right I just have to read the error message in the console window&#8230;)</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>