<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (29)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-571253">
				<div id="div-comment-571253" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Cody</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571253">
			November 27, 2007 at 10:51 am</a>		</div>

		<p>I once put my swap file on a compressed logical drive in Win 3.1. &nbsp;The computer didn&#8217;t like booting after that.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-571313">
				<div id="div-comment-571313" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nawak</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571313">
			November 27, 2007 at 11:52 am</a>		</div>

		<p>Interesting, I thought it was because they were in use&#8230; (A lot more than 3 files on my disk aren&#8217;t compressed, so it seems at least to play a role)</p>
<p>Does the same happen if the drive is marked as &#8216;compressed drive&#8217; before the install occurs? I remember that you can install windows on a disk without reformatting it.</p>
<p>I&#8217;m quite sure the same happens because else the system would be fragile as you described, but then I wonder what flag is passed to CreateFile when creating those files on the disk&#8230; FILE_ATTRIBUTE_SYSTEM?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-571413">
				<div id="div-comment-571413" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">anonymous</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571413">
			November 27, 2007 at 1:33 pm</a>		</div>

		<p>I wished such safety checks would apply to EFS as well. I had the %TEMP% folder of the administrator EFS-encrypted, and this ended up into some system files being encrypted when installing a regular update.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-571443">
				<div id="div-comment-571443" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Gabe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571443">
			November 27, 2007 at 1:59 pm</a>		</div>

		<p>I would expect that compressing the HIBERFIL wouldn&#8217;t cause any problems because the data in there should already be compressed. In fact, it probably uses the NTFS compression routines.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-571523">
				<div id="div-comment-571523" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.MichaelTeper.com' rel='external nofollow' class='url'>Michael Teper</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571523">
			November 27, 2007 at 3:08 pm</a>		</div>

		<p>Compressing key system files is probably the kind of problem that would never reach support or be easy for support to identify even if it did, but is one of those things contributing to the poor image associated with Windows.</p>
<p>Would it be a bad idea to protect key system files from encryption similar to the way key windows files are now protected from being overwritten and offer the user a meaningful message when s/he tries to force it?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-571533">
				<div id="div-comment-571533" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dan McCarty</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571533">
			November 27, 2007 at 3:13 pm</a>		</div>

		<p>&#8220;These files are exempted on all drives&#8221;</p>
<p>Does that mean the compression scheme won&#8217;t compress anything called</p>
<p>&nbsp; ntldr</p>
<p>&nbsp; ntdetect.com</p>
<p>&nbsp; hiberfil.sys</p>
<p>&nbsp; pagefile.sys</p>
<p>No matter where they are in the system and whether or not they&#8217;re the official version of the file?</p>
<div class=post>[<i>When you compress a drive, some files are exempted, but you can force it, and then it&#8217;s your problem. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-571553">
				<div id="div-comment-571553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Chris</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571553">
			November 27, 2007 at 3:46 pm</a>		</div>

		<p>I&#8217;d imagine (but don&#8217;t know for sure) that the automatic exemptions would only exempt files named ntldr, ntdetect.com, hiberfil.sys, and pagefile.sys only in the root directory of a drive (as those are the only places those files legitimately exist).</p>
<p>I once had to work on a computer where someone had done just the subject of this article. The laptop booted up saying simply &quot;NTLDR is compressed.&quot;</p>
<p>I suppose not enough of the filesystem driver is loaded to fix such a simple error.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-571613">
				<div id="div-comment-571613" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">foxyshadis</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571613">
			November 27, 2007 at 5:41 pm</a>		</div>

		<p>That&#8217;s interesting, no exemption for ntfs.sys? I always thought that was one you couldn&#8217;t compress, for the obvious reason, but I suppose I&#8217;ll try it with BartPE handy one of these days.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-571623">
				<div id="div-comment-571623" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Kemp</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571623">
			November 27, 2007 at 5:42 pm</a>		</div>

		<p>&quot;Compressing key system files is probably the kind of problem that would never reach support or be easy for support to identify even if it did, but is one of those things contributing to the poor image associated with Windows.</p>
<p>Would it be a bad idea to protect key system files from encryption similar to the way key windows files are now protected from being overwritten and offer the user a meaningful message when s/he tries to force it?&quot;</p>
<p>I imagine the reasoning is thus:</p>
<p>1) Average Joe will select to compress the drive and the critical files will be safe (he shouldn&#8217;t even see them unless he has screwed with his settings)</p>
<p>2) Anyone else should know what they&#8217;re doing before they mess with hidden system files with cryptic names</p>
<p>Basically, once you&#8217;re at the level where you know how to view and force compression on those files you really should also be at the level where you&#8217;re able to stop and think for a second. Considering why they&#8217;re marked hidden and system is a clue not to mess with them.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-571643">
				<div id="div-comment-571643" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571643">
			November 27, 2007 at 5:54 pm</a>		</div>

		<p>Cody: Except Windows 3.1 wasn&#8217;t really an operating system (it ran on top of DOS) and so the swap file wasn&#8217;t required for system boot? &nbsp;I think you mean to say when Windows started up.</p>
<p>Nawak: From the blog entry it seems to be based on names and not on any attribute flags.</p>
<p>anonymous: I wouldn&#8217;t try to encrypt Temp&#8230; I would just delete every file in it. &nbsp;If a program needed a file in it, it shouldn&#8217;t have put it in Temp! &nbsp;I&#8217;d find a better program if I could. &nbsp;At the very least the safest you can do is to just delete files in Temp with a Last Modified stamp before the last boot up.</p>
<p>Gabe: HIBERFIL.SYS is the dump of windows memory to disk&#8230; I would guess it can&#8217;t be compressed.</p>
<p>Although it seems like it would be easy, you have to remember that the CODE which is DUMPING memory to disk WILL ALSO BE DUMPED&#8230; if you dumped and then shutdown, when you started up whatever code was un-dumping would be overwritten, probably causing a BSoD. &nbsp;Next, even if that wasn&#8217;t a problem, if we resumed where we left off&#8230; well when we left off we were dumping memory to disk followed by a shutdown! &nbsp;Oops. &nbsp;So it&#8217;s not so simple.</p>
<p>But here&#8217;s what I would do to work around this (keep in mind all of this is guesswork, and I know nothing about the actual process): 1) Have a specific fixed virtual memory area allocated for the memory dump and the memory restore (whichever one is happening at the moment). &nbsp;Don&#8217;t allow the use of this block for ANYTHING else. &nbsp;Ever. &nbsp;2) Keep this area as small as possible so minimize the impact it will have on possible memory usage and so forth. &nbsp;3) I&#8217;d guess we&#8217;d also have to make it self-reliant (ie built in mini-filesystem support, no NTFS compression routines) to ensure we don&#8217;t make any calls OUTSIDE the block. 4) Don&#8217;t dump or restore this area. &nbsp;(Anyone know if I&#8217;m close?)</p>
<p>Chris: A bootloader has a limited size. &nbsp;If it needs more, you offload part of it to a hard drive partition and write a filesystem driver into the bootloader&#8230; but again&#8230; limited size, so you don&#8217;t want to put in stuff like compression support.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-571673">
				<div id="div-comment-571673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark Steward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571673">
			November 27, 2007 at 7:35 pm</a>		</div>

		<p>Dan: hiberfil.sys is indeed compressed, I believe in blocks of 64K at a time. &nbsp;Whether the dumping code is written to disk is irrelevant, as it&#8217;s NTLDR that reads it back in (and presumably then passes control back to the scheduler).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-571713">
				<div id="div-comment-571713" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">-</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571713">
			November 27, 2007 at 9:07 pm</a>		</div>

		<p>I might be wrong, but I don&#8217;t think PAGEFILE.SYS is just a file &quot;for which write requests must succeed&quot;. I think it gets special treatment, as in the extent list is always stored in memory, and it doesn&#8217;t use the normal FS facilities, rather operating at a lower level. Things like the free space bitmap might not be in RAM, and I think a great deal of the NTFS (and FASTFAT for that matter) code can be swapped out too, including compression/decompression.</p>
<p>In any case, no matter how hard you try, you won&#8217;t be able to use a compressed pagefile. You can&#8217;t compress it while it&#8217;s in use, and even if you compress it from other installation, Windows will clear the compressed flag and reallocate it on mount.</p>
<p>So that one isn&#8217;t a risk. The boot ones are, though.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-571733">
				<div id="div-comment-571733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">bd_</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571733">
			November 27, 2007 at 10:22 pm</a>		</div>

		<p>Dan, it&#8217;s theoretically possible to compress a hibernation file if you have sufficient ram &#8211; essentially, you&#8217;ll suspend the normal kernel and drop to a tiny copy kernel, copy all kernel memory into free space, then return to the real kernel to save user pages and the kernel memory image. On boot you&#8217;ll do much the same thing in reverse. You generally won&#8217;t have a problem with resuming into the suspend code, since you can just overwrite the state of the currently running thread to resume in the &#8216;get system running again after resume&#8217; code.</p>
<p>One complication is that since you&#8217;re going to be modifying filesystem metadata you have to be very very careful not to get confused when the system starts up again and various structures on-disk haven&#8217;t changed from what they were before you took the kernel image.</p>
<p>A much simpler approach &#8211; and probably what windows does &#8211; is to do essentially the same thing, but preallocate the hibernation file before imaging the kernel, then just push the data out to raw disk blocks. This way filesystem metadata remains unchanged and you don&#8217;t have to worry about things getting out of sync. Although it&#8217;s not strictly necessary to keep the hibernation file allocated all the time, it&#8217;s useful, as that way you can ensure hibernation will succeed, modulo available swap.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-571773">
				<div id="div-comment-571773" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anon</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571773">
			November 28, 2007 at 12:18 am</a>		</div>

		<p>NTLDR must have been an interesting piece of code to write. As far I can tell, there is a real mode stub that works like a Bios extender and a protected mode section that contains enough code to do read only access to NTFS and FAT. It can can use the Bios for disk access via the bios extender or you can even use a SCSI miniport driver. And registry access too. All in 209K.</p>
<p>It&#8217;s a shame that this stuff isn&#8217;t publically documented really.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-571793">
				<div id="div-comment-571793" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.informatik.uni-rostock.de/~jr252/' rel='external nofollow' class='url'>Johannes R&#246;ssel</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571793">
			November 28, 2007 at 1:47 am</a>		</div>

		<p>Hmm, I actually did compress my ntldr a long time ago &#8230; took me a while to figure out that in the recovery console compression is just an attribute to set or unset with attrib &#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-patriotb odd alt thread-odd thread-alt depth-1" id="comment-571803">
				<div id="div-comment-571803" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">PatriotB</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571803">
			November 28, 2007 at 3:39 am</a>		</div>

		<p>@Anon &#8212; Actually, it&#8217;s a good thing NTLDR and company weren&#8217;t publicly documented&#8230; it would probably have resulted in tying the hands of the boot team when it comes to trying to enhance/improve it in the future. &nbsp;You&#8217;ll note that Vista doesn&#8217;t use NTLDR at all, but uses a brand new boot loader.</p>
<p>@Gabe and others regarding hiberfil.sys &#8212; I would hope it isn&#8217;t compressed; hibernate and resume times are slow enough as it is, and adding compression to the mix would make it even slower. &nbsp;And hard drive space is cheap anyways.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-571823">
				<div id="div-comment-571823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">arun.philip</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571823">
			November 28, 2007 at 4:29 am</a>		</div>

		<p>@PatriotB:</p>
<p>I would hazard a guess that hibernate/resume are more constrained by spindle speed rather than CPU.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-571853">
				<div id="div-comment-571853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nawak</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571853">
			November 28, 2007 at 7:31 am</a>		</div>

		<p>@Dan:</p>
<p>&quot;Nawak: From the blog entry it seems to be based on names and not on any attribute flags.&quot;</p>
<p>Well, from the blog entry it seems that the compression of existing files, and the protection of the critical files, is done by the shell and not the filesystem (else how would you override the protection).</p>
<p>Then the drive is marked &quot;compress all new files&quot;, an attribute that has to be enforced by the filesystem, not the shell, since the shell is not &quot;between&quot; a program and the filesystem when the program creates &quot;new files&quot;.</p>
<p>So my question was, do these safeguards work (and how) when the drive is already marked as &quot;compressed&quot; before a windows installation, since then the new files that are created &nbsp;(and that should be compressed) are the &#8216;protected&#8217; files in question.</p>
<p>Maybe the windows setup refuses to install on a compressed partition, that would be the most simple solution, even if then it could let some users unable to reinstall without formatting and losing data. (It would force them to backup first, something that could be problematic when the system doesn&#8217;t boot correctly)</p>
<p>I don&#8217;t want to bother anyone with this question though, it was out of curiosity. If the answer is known, then I would be glad to hear it, else it doesn&#8217;t matter, I may try sometimes in the future when I have to install a new PC.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-571873">
				<div id="div-comment-571873" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Neil</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571873">
			November 28, 2007 at 7:48 am</a>		</div>

		<p>Nitpicker&#8217;s corner: Cody is referring to a permanent swap file. Temporary swap files can easily be created on compressed or remote media. (Particularly useful for diskless workstations.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-571943">
				<div id="div-comment-571943" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Borlock</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-571943">
			November 28, 2007 at 10:25 am</a>		</div>

		<p>Dan,</p>
<p>I&#8217;m pretty sure &#8216;anonymous&#8217; (with regard to the encrypted %temp% directory issue), referred to the installation of a program which, during installation, temporarily extracts some files into temp and then copies it to system32.</p>
<p>Lots of installs do this, and it&#8217;s perfectly valid.</p>
<p>The issue with that though is that since %temp% is encrypted, the file that was extracted in there retains its encryption when it subsequently gets copied somewhere else, causing the file inside system32 to be encrypted as well.</p>
<p>This doesn&#8217;t mean the app is trying to run itself from temp.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-572043">
				<div id="div-comment-572043" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">brian</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-572043">
			November 28, 2007 at 3:45 pm</a>		</div>

		<p>LOL compress your pagefile&#8230;. i stopped reading comments after that. &nbsp;Thats funny. Awesome post.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-572053">
				<div id="div-comment-572053" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://adarsha.mv.googlepages.com' rel='external nofollow' class='url'>mv adu</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-572053">
			November 28, 2007 at 3:47 pm</a>		</div>

		<p>I don&#8217;t think hibernate file is compressed. Otherwise it should take less space than the installed RAM, but Windows takes eactly same out of Harddisk space as that of installed RAM. So its just a raw dump and read back again.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-572063">
				<div id="div-comment-572063" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://adarsha.mv.googlepages.com' rel='external nofollow' class='url'>mv adu</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-572063">
			November 28, 2007 at 3:47 pm</a>		</div>

		<p>I don&#8217;t think hibernate file is compressed. Otherwise it should take less space than the installed RAM, but Windows takes exactly same out of Hard disk space as that of installed RAM. So its just a raw dump and read back again.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-572073">
				<div id="div-comment-572073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ERock</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-572073">
			November 28, 2007 at 3:50 pm</a>		</div>

		<p>I would LOVE a way to specify exceptions manually for other files. Like, Steam games run DOG slow if the content files are compressed but if they reach a certain age the &quot;Compress Old Files&quot; option in Disk Cleanup will compress them.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-572143">
				<div id="div-comment-572143" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://greasemonkey.nonlogic.org' rel='external nofollow' class='url'>GreaseMonkey</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-572143">
			November 28, 2007 at 5:22 pm</a>		</div>

		<p>Compressing your swap file shouldn&#8217;t really matter speedwise if you&#8217;ve got a fast CPU and a slow hard disk.</p>
<p>But yeah, I don&#8217;t think I&#8217;ll be compressing NTLDR any time soon.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-572203">
				<div id="div-comment-572203" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">DriverDude</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-572203">
			November 28, 2007 at 7:09 pm</a>		</div>

		<p>Encrypting %TEMP% ensures that unencrypted temp data is never written to disk. You might be editing an encrypted Word file; the file will remain encrypted before and afterwards but MS Word might write some fragment of the doc into an unencrypted temp file.</p>
<p>I once encrypted my Temp Internet Files folder, until I realized everything IE downloads is encrypted (even when I don&#8217;t want them to be), because IE downloads them into its Temp folder and then moves it to the final destination.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-572193">
				<div id="div-comment-572193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">DriverDude</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-572193">
			November 28, 2007 at 7:00 pm</a>		</div>

		<p>&quot;I don&#8217;t think hibernate file is compressed. Otherwise it should take less space than the installed RAM, but Windows takes exactly same out of Hard disk space as that of installed RAM.&quot;</p>
<p>Compression does not *gaurantee* that data will take less space. Pre-allocating as much space as RAM gaurantees all the RAM can be dumped in as few fragments as possible when it comes time to hibernate.</p>
<p>Windows 2000 dumps all RAM whereas XP excludes the cache, and I think Vista excludes anything that can be read from elsewhere (i.e., code segments can be re-read from the .exe) Vista also has readyboost to help reload code.</p>
<p>I also suspect that NTLDR uses real-mode BIOS calls to read the hibernate file, which might explain why resume is &quot;slow&quot; relative to native Win32 disk performance. Vista might have improved this with its new boot loaders.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-572343">
				<div id="div-comment-572343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Cody</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-572343">
			November 29, 2007 at 10:16 am</a>		</div>

		<p>For those that care, I was 10. &nbsp;I may have forgotten some details since then.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-572503">
				<div id="div-comment-572503" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://news.softpedia.com/news/What-Not-to-Compress-in-Windows-72311.shtml' rel='external nofollow' class='url'>   Give some thoughts before your apply &#8220;Compress to drive &#8221; in Windows &raquo; D' Technology Weblog: Technology, Blogging, Tips, Tricks, Computer, Hardware, Software, Tutorials, Internet, Web, Gadgets, Fashion, LifeStyle, Entertainment, News </a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20071127-00/?p=24373#comment-572503">
			November 29, 2007 at 3:39 pm</a>		</div>

		<p>PingBack from <a href="http://news.softpedia.com/news/What-Not-to-Compress-in-Windows-72311.shtml">http://news.softpedia.com/news/What-Not-to-Compress-in-Windows-72311.shtml</a></p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>