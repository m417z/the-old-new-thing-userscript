<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (10)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-610793">
				<div id="div-comment-610793" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">irql</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080318-00/?p=23083#comment-610793">
			March 18, 2008 at 10:37 am</a>		</div>

		<p>Nice article, thanks. Can anyone post a screenshot showing this in action? I&#8217;ve tried it myself but I couldn&#8217;t get it to compile with mingw and the Platform SDK doesn&#8217;t come with a compiler.</p>
<p>BTW if anyone wants to know why getting this right is so important, I recommend reading this article: <a rel="nofollow" target="_new" href="http://blogs.msdn.com/oldnewthing/archive/2007/05/07/2453927.aspx" rel="nofollow">http://blogs.msdn.com/oldnewthing/archive/2007/05/07/2453927.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-610813">
				<div id="div-comment-610813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Yuhong Bao</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080318-00/?p=23083#comment-610813">
			March 18, 2008 at 11:00 am</a>		</div>

		<p>irql: The Windows SDK does come with a compiler.</p>
<p>You may want to revisit this blog article, where CF_HDROP was misused for this:</p>
<p><a rel="nofollow" target="_new" href="http://blogs.msdn.com/oldnewthing/archive/2007/09/18/4966024.aspx" rel="nofollow">http://blogs.msdn.com/oldnewthing/archive/2007/09/18/4966024.aspx</a></p>
<p>Back then, you said that &quot;There will be a remedial course in the use of the FileGroupDescriptor sometime next year.&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-610833">
				<div id="div-comment-610833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">irql</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080318-00/?p=23083#comment-610833">
			March 18, 2008 at 11:11 am</a>		</div>

		<p>@Yahong Bao: No matter how many times I try, CL.EXE is not included and none of the examples can be built. Yes, latest version too, yes, older versions as well.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-610853">
				<div id="div-comment-610853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">RIck C</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080318-00/?p=23083#comment-610853">
			March 18, 2008 at 11:28 am</a>		</div>

		<p>irql: &nbsp;you need the windows SDK for the windows headers and libraries. &nbsp;Get yourself the Express Edition of Visual C++ for the compiler. &nbsp;There&#8217;s a few hoops you have to jump through to get both the Windows and standard C++ headers available, but they&#8217;re documented.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-madq42 even thread-even depth-1" id="comment-610863">
				<div id="div-comment-610863" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/MadQ1' rel='external nofollow' class='url'>MadQ1</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080318-00/?p=23083#comment-610863">
			March 18, 2008 at 12:57 pm</a>		</div>

		<p>I usually find myself in a quandry when I have to implement IDataObject. If I have to allocate something for an STGMEDIUM, I usually start to worry that the caller may not call ReleaseStgMedium, leaking things left and right. By the time I remember that I&#8217;ve already satisfied my part of the contract, I&#8217;m usually halfway through writing all kinds of complicated safeguard code. *sigh* &#8211; so much for impulse control.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-610883">
				<div id="div-comment-610883" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">scorpion007</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080318-00/?p=23083#comment-610883">
			March 18, 2008 at 10:48 pm</a>		</div>

		<p>irql, the platform SDK (and now the Windows SDK) has come with all the compilers for quite some time now. If you cannot figure out how to use them, don&#8217;t claim that they aren&#8217;t freely available.</p>
<p>You can get them even *without* visual studio express.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-611143">
				<div id="div-comment-611143" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Yuhong Bao</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080318-00/?p=23083#comment-611143">
			March 20, 2008 at 7:51 pm</a>		</div>

		<p>Why not directly use GlobalAlloc and GlobalLock, instead of using CreateHGlobalFromBlob? Saves a memory copy and takes less stack space.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-611153">
				<div id="div-comment-611153" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Yuhong Bao</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080318-00/?p=23083#comment-611153">
			March 20, 2008 at 8:09 pm</a>		</div>

		<p>Eg, instead of this:</p>
<p>&nbsp;case DATA_FILEGROUPDESCRIPTOR:</p>
<p>&nbsp;{</p>
<p>&nbsp; &nbsp;FILEGROUPDESCRIPTOR fgd;</p>
<p>&nbsp; &nbsp;ZeroMemory(&amp;fgd, sizeof(fgd));</p>
<p>&nbsp; &nbsp;fgd.cItems = 1;</p>
<p>&nbsp; &nbsp;StringCchCopy(fgd.fgd[0].cFileName,</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ARRAYSIZE(fgd.fgd[0].cFileName),</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TEXT(&quot;Dummy&quot;));</p>
<p>&nbsp; &nbsp;pmed-&gt;tymed = TYMED_HGLOBAL;</p>
<p>&nbsp; &nbsp;return CreateHGlobalFromBlob(&amp;fgd, sizeof(fgd),</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;GMEM_MOVEABLE, &amp;pmed-&gt;hGlobal);</p>
<p>&nbsp;}</p>
<p>how about something like this:</p>
<p>&nbsp;case DATA_FILEGROUPDESCRIPTOR:</p>
<p>&nbsp;{</p>
<p>&nbsp; HGLOBAL hfgd = GlobalAlloc(GMEM_MOVEABLE | GMEM_ZEROINIT, sizeof(FILEGROUPDESCRIPTOR));</p>
<pre><code>pmed-&amp;gt;hGlobal = 0;
</code></pre>
<p>&nbsp; if (!hfgd) return E_OUTOFMEMORY;</p>
<pre><code>LPFILEGROUPDESCRIPTOR pfgd = GlobalLock(hfgd);

if (!pfgd) {

    GlobalFree(hfgd);

    return E_OUTOFMEMORY;

}

pfgd-&amp;gt;cItems = 1;

StringCchCopy(pfgd-&amp;gt;fgd[0].cFileName,

    ARRAYSIZE(pfgd-&amp;gt;fgd[0].cFileName),

    TEXT(&amp;quot;Dummy&amp;quot;));

pmed-&amp;gt;tymed = TYMED_HGLOBAL;

pmed-&amp;gt;hGlobal = hfgd;

GlobalUnlock(hfgd);

return NO_ERROR;
</code></pre>
<p>&nbsp;}</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-611163">
				<div id="div-comment-611163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Yuhong Bao</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080318-00/?p=23083#comment-611163">
			March 20, 2008 at 8:44 pm</a>		</div>

		<p>On the matter of this, can you allocate the memory as GMEM_FIXED? This removes the need to call GlobalLock or GlobalUnlock.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-614263">
				<div id="div-comment-614263" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/oldnewthing/archive/2008/03/31/8344798.aspx' rel='external nofollow' class='url'>The Old New Thing</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080318-00/?p=23083#comment-614263">
			March 31, 2008 at 12:12 pm</a>		</div>

		<p>If you want multiple files, then drag multiple objects.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>