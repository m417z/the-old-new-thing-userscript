<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (65)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-494013">
				<div id="div-comment-494013" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James Risto</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494013">
			April 17, 2007 at 10:48 am</a>		</div>

		<p>Because I am lazy to do the research, does anyone know why this causes Notepad to think its Unicode?</p>
<p><a href="http://www.hoax-slayer.com/bush-hid-the-facts-notepad.html" target=_new rel=nofollow rel="nofollow">http://www.hoax-slayer.com/bush-hid-the-facts-notepad.html</a></p>
<div class=post>[<i>I thought I just spent two days discussing this. It&#8217;s guessing, and in this case, it guesses wrong. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494023">
				<div id="div-comment-494023" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">littleguru</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494023">
			April 17, 2007 at 10:50 am</a>		</div>

		<p>This might sound foolish, but why does the textbox not allow to select the encoding in the context menu?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494053">
				<div id="div-comment-494053" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Staffan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494053">
			April 17, 2007 at 11:20 am</a>		</div>

		<p>My favorite notepad &quot;bug&quot; is that it (unlike write.exe) won&#8217;t recognize unix-style line endings&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494073">
				<div id="div-comment-494073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Rob H</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494073">
			April 17, 2007 at 11:22 am</a>		</div>

		<p>James Risto: The bytes happen to look a lot like UTF-16, presumably all enough from the same region of Unicode or close enough to fool the heuristic.</p>
<p>Key features include, but are not limited to, the even number of characters and the fact that all of the spaces fall on odd characters.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494083">
				<div id="div-comment-494083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Puckdropper</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494083">
			April 17, 2007 at 11:25 am</a>		</div>

		<p>James, do the research and click on the first link: &nbsp;&quot;the Notepad file encoding problem&quot;</p>
<p>If you&#8217;re really curious, this will at least get you thinking.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494093">
				<div id="div-comment-494093" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">strik</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494093">
			April 17, 2007 at 11:25 am</a>		</div>

		<p>&#8230; and, not to forget, the &quot;guessing&quot; of Notepad which always guesses the file uses CR/LF, even if it does not.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494113">
				<div id="div-comment-494113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Adam</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494113">
			April 17, 2007 at 11:37 am</a>		</div>

		<p>James&gt;</p>
<p><a rel="nofollow" target="_new" href="http://blogs.msdn.com/michkap/archive/2006/06/14/631016.aspx" rel="nofollow">http://blogs.msdn.com/michkap/archive/2006/06/14/631016.aspx</a></p>
<p><a rel="nofollow" target="_new" href="http://blogs.msdn.com/michkap/archive/2006/07/11/662342.aspx" rel="nofollow">http://blogs.msdn.com/michkap/archive/2006/07/11/662342.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494133">
				<div id="div-comment-494133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nick</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494133">
			April 17, 2007 at 11:57 am</a>		</div>

		<p>One reason people are hesitant to save UTF-8 files with a BOM is that it breaks server-side includes (and partial pages included via PHP) in Internet Explorer (even 7).</p>
<p>Of course, of all the major browsers, only IE chokes on the stray BOMs in the middle of the page (because they were at the beginning of the files that were server-side-included and ended up in the middle of the page).</p>
<p>I predict that Microsoft will fix this some time between 2045 and the heat death of the universe.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494153">
				<div id="div-comment-494153" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">S</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494153">
			April 17, 2007 at 12:09 pm</a>		</div>

		<p>If unsure &#8211; just ask the user and do _NOT_ try to use psychic powers.</p>
<div class="post">[<i>Since you are almost never 100% sure, this boils down to &#8220;Always ask the user.&#8221; I bet you&#8217;d hate that. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494163">
				<div id="div-comment-494163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">pcooper</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494163">
			April 17, 2007 at 12:15 pm</a>		</div>

		<p>The problem with asking the user is that usually the user doesn&#8217;t know the first thing about character encoding systems.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494173">
				<div id="div-comment-494173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Adam</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494173">
			April 17, 2007 at 12:17 pm</a>		</div>

		<p>Nick &gt; Interesting &#8211; how does it &quot;break&quot; such things? A stray BOM in the page should just be interpreted as a ZWNJ. If it were in the middle of a long word that happened to fall near the end of a line, you&#8217;d get an unexpected word break, but I don&#8217;t see how that could be thought of as being particularly &quot;broken&quot;. Moreover, I don&#8217;t see how you&#8217;d end up with two parts of a word in different files.</p>
<p>Or does it output the &quot;no glyph&quot; box symbol for ZWNJs?</p>
<p>Can you expand on this?</p>
<p>But, the general problem is one of the main reasons why BOMs are discouraged. It breaks the semantics of being able to concatenate two text files together simply by appending one stream of bytes to another. You now have an extra character in the resultant stream that was not &quot;in&quot; the original files.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494183">
				<div id="div-comment-494183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">BryanK</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494183">
			April 17, 2007 at 12:41 pm</a>		</div>

		<p>pcooper &#8212; True, but depending on the dialog, they might not have to know anything about character encodings to answer it, either.</p>
<p>If it&#8217;s possible to narrow the (large) number of possible encodings down to a smaller number (say two to five), it may be possible to design a dialog that would allow the user to choose an encoding from this smaller list. &nbsp;Show them a preview of the text as it would display under the currently-selected encoding; then they can just switch between encodings until they find one that makes the text look right.</p>
<p>I don&#8217;t think it&#8217;d be a good idea to require the user to go through this dialog whenever Notepad isn&#8217;t sure (because as Raymond says, it almost never is sure). &nbsp;It&#8217;s probably a bad idea to require this dialog to come up at any point, in fact. &nbsp;But it should be possible to have it as a right-click option or a menu item somewhere; that way when a file is guessed wrong, at least the user can override the wrong choice.</p>
<p>(And to make it even more usable, it may be good to give the dialog an option for &#8220;save this choice with this file&#8221; if the chosen encoding will allow it &#8212; when the user chooses that, you&#8217;d add a BOM, or something, so there&#8217;s no ambiguity when reloading the file. &nbsp;Or you&#8217;d add an alternate data stream to the file that acts as an encoding hint (which, since it isn&#8217;t a BOM, won&#8217;t affect concatenating files &#8212; though I haven&#8217;t thought much about that, so it may have other problems). &nbsp;But if the user doesn&#8217;t have to keep bringing up this dialog every time they look at the file, that&#8217;d be good.)</p>
<p>Of course maybe this is all too much complexity for a simple program like Notepad, too.</p>
<div class="post">[<i>You already have the option to specify the encoding manually: Ctrl+O. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494193">
				<div id="div-comment-494193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mihai</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494193">
			April 17, 2007 at 12:41 pm</a>		</div>

		<p>I guess one of the traits of a nitpicker is that it does not not realize he is a nitpicker. For him, the point is valid and important.</p>
<p>So, even risking to be classified as nitpicker, I will make two (unrelated) points:</p>
<ol>
<li>Not sure what &quot;8-bit ANSI&quot; is.</li>
</ol>
<p>In the Windows lingo &quot;ANSI&quot; means &quot;the default system locale&quot; (or &quot;Language for Non-Unicode programs&quot;, in XP UI terminology).</p>
<p>This includes double byte code pages like 932 (Japanese), 936 (Chinese Simplified), 949 (Korean), and 950 (Chinese Traditional).</p>
<p>They can still be considered 8-bit if you consider the &quot;coding unit&quot; (Unicode terminology), but is confusing.</p>
<p>In for this article, just ANSI should suffice.</p>
<ol>
<li>I agree that it is not really possible to make the detection smarter. But there are a couple of easy improvements:
<p>a. when I select &quot;Save As&#8230;&quot; and UTF-8, also give me a BOM option (I am in &quot;help the application&quot; mode anyway)</p>
<p>b. when opening a UTF-8 no-BOM file and the encoding is properly detected, don&#8217;t add the BOM &quot;just in case.&quot; It was probably no-BOM for a reason.</li>
</ol>
<p>I will not even try to suggest &quot;if you cannot detect the encoding 100% reliable, ask the user&quot; :-) Would be nice, but for this there are some free tools out there, and easy to find.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494203">
				<div id="div-comment-494203" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nick</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494203">
			April 17, 2007 at 12:50 pm</a>		</div>

		<p>Adam&#8211;</p>
<p>The IE behavior is varied and unpredictable. I&#8217;ve seen it to cause stylesheets to refuse to load unless one manually refreshes the page with an F5 (regardless if the page is already cached). It can also result in bizarre encoding vomit characters to be output, and sometimes extra line breaks. But the most annoying is the stylesheet issue.</p>
<p>To be fair, some people say that PHP or the SSI on your server of choice should be able to detect the &quot;first&quot; include and strip the BOM from subsequent ones, but it seems like this would be hard to figure out, especially considering that output buffering may or may not be off (if output buffering is on, the order of includes is not necessarily the order they appear on the page).</p>
<p>Side note:</p>
<p>It should also be noted that there&#8217;s a lot of misinformation on the issue, especially since HTTP&#8217;s concept of expressing encoding is through &quot;charset&quot;, when it&#8217;s specifying not a character set (HTML is Unicode) but instead an encoding. (I personally find the whole idea of referring to UTF-16 as &quot;Unicode&quot; to refer to both the encoding and the character set, as Notepad&#8217;s save dropdown does, terribly confusing. I mean, you have &quot;UTF-8, Unicode, Unicode big endian&quot;. What? They&#8217;re all Unicode. But, to MS&#8217;s credit, I do believe that&#8217;s standard practice.)</p>
<p>Some linkage from the Google:</p>
<p><a rel="nofollow" target="_new" href="http://neosmart.net/blog/2006/expression-web-designer-and-internet-explorer-think-again/" rel="nofollow">http://neosmart.net/blog/2006/expression-web-designer-and-internet-explorer-think-again/</a></p>
<p><a rel="nofollow" target="_new" href="http://drupal.org/node/64155" rel="nofollow">http://drupal.org/node/64155</a></p>
<p><a rel="nofollow" target="_new" href="http://copia.ogbuji.net/blog/2005-10-20/Today_s_XM" rel="nofollow">http://copia.ogbuji.net/blog/2005-10-20/Today_s_XM</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494213">
				<div id="div-comment-494213" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Tyler Reddun</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494213">
			April 17, 2007 at 12:50 pm</a>		</div>

		<p>It because of this sort of issue that the XML spec is very specific about how a file begins. An XML file must start with &quot;&lt;xml&quot; in the Latin character set. This means that if the file is lacking a BOM (or a mime type with the encoding) you can read the first few characters of the file and work out a few things. If it&#8217;s 8 or 16 bit encoding and the byte order of the 16-bit encoding. The only thing you can&#8217;t learn is if it&#8217;s UTF-8 or 8-Bit ANSI.</p>
<p>It&#8217;s suppose to assume UTF-8 (as that is the &#8216;correct&#8217; 8-bit formatting), but many parsers will downshift to 8-Bit ANSI if they find none UTF-8 strings in the file.</p>
<p>Of course none of this else helps with the Notepad case, it&#8217;s just an interesting contrast.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494233">
				<div id="div-comment-494233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Red Armstrong</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494233">
			April 17, 2007 at 1:35 pm</a>		</div>

		<blockquote><p>
  If a BOM is found, then life is easy, since the BOM tells you what</p>
<p>  encoding the file uses.
</p></blockquote>
<p>Actually that&#8217;s not entirely true; even if there &quot;appears&quot; to be a BOM, the file might be one of several ANSI codepages that have characters that can look like a UTF8 BOM. &nbsp;You really don&#8217;t know, in the general case, unless you&#8217;re told what encoding it is.</p>
<p>In practice you can just assume that if it looks like a BOM, it is a BOM.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494243">
				<div id="div-comment-494243" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Gabe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494243">
			April 17, 2007 at 1:36 pm</a>		</div>

		<p>Although I don&#8217;t think it&#8217;s necessarily a good idea to implement this, I do believe I can think of a way to make the heuristic a bit &quot;smarter&quot;.</p>
<p>Unicode has a number of defined character ranges (some being for private use). The detector could go with the encoding that minimizes the out-of-range characters in the file. If there are &quot;too many&quot; invalid characters in the file, assume it&#8217;s 8-bit ANSI.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494273">
				<div id="div-comment-494273" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Hadrien</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494273">
			April 17, 2007 at 1:50 pm</a>		</div>

		<p>Usually I don&#8217;t care making my text files Notepad friendly by adding a BOM. As mentioned in comments above, what really upsets me is having to use U+000D U+000A instead of single U+000A for endlines :-( I didn&#8217;t try Vista, is it now corrected ?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494313">
				<div id="div-comment-494313" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494313">
			April 17, 2007 at 2:25 pm</a>		</div>

		<p>Sometimes I wonder how different it would be if 20 years ago everybody knew the problems we had today.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494323">
				<div id="div-comment-494323" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dusty</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494323">
			April 17, 2007 at 2:29 pm</a>		</div>

		<p>The reason I use notepad is that I always thought that it only edited ANSI text. &nbsp;Whenever, I wanted to see a the &quot;bytes&quot; of a file as some characters, I would use notepad. &nbsp;Kind of like a hex editor, but without the hex. &nbsp;If I needed something that showed &quot;pretty&quot; text I use WordPad instead.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494343">
				<div id="div-comment-494343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">-</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494343">
			April 17, 2007 at 2:42 pm</a>		</div>

		<p>Hadrien: Of course it is not corrected. Not many long-standing bugs have been fixed in Vista, to be honest :(</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494353">
				<div id="div-comment-494353" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">cmov</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494353">
			April 17, 2007 at 3:08 pm</a>		</div>

		<p>&quot;you are going to be flat-out wrong when you run into a Unicode file that lacks a BOM, since you&#8217;re going to misinterpret it as either UTF-8 or (more likely) 8-bit ANSI&quot;</p>
<p>UTF-8 is also a Unicode encoding, right? So a UTF-8 file is also a Unicode file.</p>
<p>Ofcourse, the real problem here is with the handling of file types and file metadata. If a file type could be perfectly transported in a platform independent way, this problem would not exist. Unfortunately, we have kludges like using the part after a period to judge the file type. A content-type header from HTTP is never saved along the file, and it would be lost anyway when the file is transmitted to, for instance, an FTP server.</p>
<p>Mac OS uses a data fork for the file and a resource fork to store metadata, but it too can&#8217;t be psychic when it recieves a &quot;text/plain&quot; file over HTTP. It does, however, allow the user to rename the file to anything.</p>
<p>Nautilus (and AFAIK Konqueror too) sniffs the mime type from the file contents itself, but it warns about a security risk when there&#8217;s a mismatch with the filename and refuses to open it until the name matches the actual type of file.</p>
<p>Now about the problem with IE and a BOM in the middle of a page&#8230; I haven&#8217;t heard of it before, but it might be avoidable by doing something like this:</p>
<p>&lt;?php</p>
<p>echo &#8216;&lt;!&#8211;&#8216;;</p>
<p>include(&#8216;something.inc.php&#8217;);</p>
<p>echo &#8216;&#8211;&gt;&#8217;;</p>
<p>?&gt;</p>
<p>Or try it with a javascript:</p>
<p>&lt;?php</p>
<p>echo &#8216;&lt;script type=&quot;text/javascript&quot;&gt;</p>
<p>var x = &quot;&#8217;;</p>
<p>include(&#8216;something.inc.php&#8217;);</p>
<p>echo &#8216;&quot;;</p>
<p>&lt;/script&gt;&#8217;;</p>
<p>?&gt;</p>
<p>The theory, ofcourse, is that the parser is in a different state when it reads the BOM. Inside a comment, it may just skip over anything but &quot;&#8211;&gt;&quot; as quickly as possible.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494373">
				<div id="div-comment-494373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">cmov</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494373">
			April 17, 2007 at 3:17 pm</a>		</div>

		<p>One more thing, you listed UTF-8 and UTF-16 as supported Unicode files in Notepad. However, it supports UCS-2 as well. I have converted a UTF-8 file to UTF-8 with CRLF line endings using &#8220;flip&#8221;, and then converted it to UCS-2 with &#8220;iconv&#8221;. It shows up fine in Notepad, including the special characters. I did all that because I wanted to include the file in a program as a resource.</p>
<div class=post>[<i>Um, UCS-2 is a subset of UTF-16, so there is obviously need to call it out specifically. Hey, did you know that Notepad also supports 7-bit ASCII? -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494383">
				<div id="div-comment-494383" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://deusexmachina.org' rel='external nofollow' class='url'>Deus</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494383">
			April 17, 2007 at 4:08 pm</a>		</div>

		<p>One solution that hasn&#8217;t been considered is to create a new file extension specifically for UTF8 or UCS text. You saw something similar to this during the BBS era, where text files with ANSI colour codes had the extension .ans while plain ASCII text used .asc.</p>
<p>Anyway, the first thing most experienced developers who work with plaintext do when setting up a system is to install a third-party editor, due to the deficiencies of Notepad. My personal fav is Notepad++ (<a rel="nofollow" target="_new" href="http://notepad-plus.sourceforge.net/" rel="nofollow">http://notepad-plus.sourceforge.net/</a>) a Scintilla-based editor which supports code folder, macros and even a hex editor.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494393">
				<div id="div-comment-494393" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mihai</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494393">
			April 17, 2007 at 4:19 pm</a>		</div>

		<p>&lt;&lt;A content-type header from HTTP is never saved along the file&gt;&gt;</p>
<p>In fact you can use</p>
<p>&lt;meta http-equiv=Content-Type content=&quot;text/html; charset=utf-8&quot;&gt;</p>
<p>in the head section.</p>
<p>Which I would always recommend.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494403">
				<div id="div-comment-494403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.ultrafractal.com/' rel='external nofollow' class='url'>Frederik Slijkerman</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494403">
			April 17, 2007 at 4:21 pm</a>		</div>

		<p>The problem with LF line endings and Notepad is that Notepad is basically a window around the Win32 Edit control. The Edit control doesn&#8217;t support LF line endings and presumably it would give backwards compatibility headaches if it started to&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494413">
				<div id="div-comment-494413" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">cmov</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494413">
			April 17, 2007 at 4:44 pm</a>		</div>

		<p>&#8220;Um, UCS-2 is a subset of UTF-16, so there is obviously need to call it out specifically. Hey, did you know that Notepad also supports 7-bit ASCII?&#8221;</p>
<p>I&#8217;m sorry I didn&#8217;t know UCS-2 is actually a subset of UTF-16. Thanks for mentioning it. No reason to act childish to me.</p>
<p>@Mihai: That doesn&#8217;t help you when you save the file and try to open it.</p>
<div class=post>[<i>Sorry, I assume people do some basic research before asking a question. If you&#8217;re going to complain about Notepad&#8217;s UCS-2 support, you probably should know what UCS-2 is. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-dwalker-wk odd alt thread-odd thread-alt depth-1" id="comment-494423">
				<div id="div-comment-494423" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/DWalker' rel='external nofollow' class='url'>DWalker</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494423">
			April 17, 2007 at 5:08 pm</a>		</div>

		<p>Raymond: &nbsp;Thanks for pointing us to the &quot;Mobile PC Team Blog&quot; &#8212; but it&#8217;s defunct.</p>
<p>There were 5 messages in September 2005, 1 in October 2005, and 1 in November 2005. &nbsp;</p>
<p>None since then.</p>
<p>I don&#8217;t even see a way to contact the authors of the blog to ask questions &#8212; assuming they haven&#8217;t changed departments or companies since November 2005.</p>
<p>I know it&#8217;s not YOUR blog, but if there&#8217;s no way for us to contact the authors of that blog, it&#8217;s kind of a useless resource.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494443">
				<div id="div-comment-494443" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">d.n.hotch</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494443">
			April 17, 2007 at 5:58 pm</a>		</div>

		<blockquote><p>
  In fact you can use</p>
<p>  &lt;meta &#8230;</p>
<p>  in the head section.
</p></blockquote>
<p>But how would you recognize it&#8217;s the META anyway? Hope for something ASCII-compatible? You might need the encoding before you get the encoding. This is a hen-egg problem.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494043">
				<div id="div-comment-494043" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Adam</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494043">
			April 17, 2007 at 11:13 am</a>		</div>

		<p>Surely the problem is worse than you&#8217;re saying. If you have no idea what encoding the file is supposed to be in, why limit yourself to just Windows-1252 in the 8-bit ANSI case? The file could presumably be in *any* 8-bit character set where those two characters are defined.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494463">
				<div id="div-comment-494463" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.divelements.co.uk' rel='external nofollow' class='url'>Tim Dawson</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494463">
			April 17, 2007 at 6:20 pm</a>		</div>

		<p>There needs to be a metric from the IsTextUnicode (or preferably a replacement) API that gives the caller a measure of probability rather than a boolean value. If there&#8217;s a BOM, it&#8217;s pretty sure. If there&#8217;s a fair bit of text, it&#8217;s going to be pretty sure too. If it&#8217;s not sure (we want a probability score here, let&#8217;s say less than 70% for the sake of argument) then the user is prompted.</p>
<p>And of course, no user wants to be prompted about code pages. My grandmother doesn&#8217;t know anything about code pages. You simply show some UI with a short preview of text for all the probable unicode options and it&#8217;s easy for them to choose which looks right by clicking on it.</p>
<p>This is better than getting it wrong and displaying garbage, and allowing morons to come up with conspiracy theories.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494473">
				<div id="div-comment-494473" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Puckdropper</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494473">
			April 17, 2007 at 6:29 pm</a>		</div>

		<p>Now that Raymond pointed out in a comment that the Open File dialog (CTRL+O) in Notepad gives you an encoding option, I&#8217;m of the opinion that Notepad&#8217;s done the best that can be done. &nbsp;Sure, giving metrics and such about how &quot;Unicody&quot; the file is sounds like a good idea, but there&#8217;s always going to be cases that rate highly and are the wrong choice.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494483">
				<div id="div-comment-494483" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">steveg</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494483">
			April 17, 2007 at 7:47 pm</a>		</div>

		<p>If mixed file encodings are a regular problem while editing (programmatically it&#8217;s a whole different problem) then switch to another editor which does allow encodings to be switched easily (I use Notepad2, despite a couple of crash bugs) many others exist &#8212; I also replace Notepad.exe with the Notepad2.exe).</p>
<p>And people calling for Notepad to recognise all line endings 0x0A, 0x0D, 0x0A+0x0D, 0x0D+0x0A &#8212; what should notepad do when a file contains mixed endings or new lines are added to the document? Should Save always change a file to DOS line endings? I have occasionally used Notepad to edit .exe files &#8212; which is one very good thing about Notepad, what comes in goes out verbatim. All of a sudden there are backwards compatibility issues&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494493">
				<div id="div-comment-494493" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">cmov</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494493">
			April 17, 2007 at 8:03 pm</a>		</div>

		<p>&quot;Sorry, I assume people do some basic research before asking a question.&quot;</p>
<p>Yes, I&#8217;d assume that too. But I wasn&#8217;t asking anything. I was just pointing out something, and wasn&#8217;t aware that I had missed a memo.</p>
<p>&quot;If you&#8217;re going to complain about Notepad&#8217;s UCS-2 support, you probably should know what UCS-2 is.&quot;</p>
<p>I&#8217;m not complaining at all! Why would I complain about notepad anyway? Just because I could? Maybe I could please you by trying to be a nitpicker, but I&#8217;m not bothering. As others have pointed out already, a coder always happily installs his/her favorite editor that makes notepad look like a clay tablet. Notepad is a fine clay tablet, there&#8217;s still a use for it sometimes.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494283">
				<div id="div-comment-494283" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">pcooper</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494283">
			April 17, 2007 at 1:53 pm</a>		</div>

		<p>Really, the problem is that there&#8217;s not really a concept of a &quot;plain text&quot; file. *Any* file needs additional information (such as that given in the HTTP Content-Type header) in order for an application to know what the bytes are supposed to mean. Windows tries to encode that information in the file&#8217;s extension, and does a good job 99% of the time, but it&#8217;s really not enough unless we can get people to name their files file.txt.UTF-8, file.txt.windows-1252, and so on (and we add corresponding application support).</p>
<p>A UTF-8 text file is a *different* type of file than a windows-1252 text file, just like they&#8217;re both different from an HTML or Microsoft Word file.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494523">
				<div id="div-comment-494523" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://benpoint.com' rel='external nofollow' class='url'>Ben Bryant</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494523">
			April 17, 2007 at 10:36 pm</a>		</div>

		<p>Amazing that Raymond does not even know that notepad auto-detects UTF-8 without a BOM &#8211; yes it actually runs through the file and if the non-ASCII byte sequences are valid UTF-8 then it knows it is UTF-8. This is a key point in this discussion that everyone seems completely unaware of. Saying notepad uses IsTextUnicode I think shows a lack of knowledge about how notepad works.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-dean-harding even thread-even depth-1" id="comment-494573">
				<div id="div-comment-494573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Dean+Harding' rel='external nofollow' class='url'>Dean Harding</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494573">
			April 18, 2007 at 12:24 am</a>		</div>

		<p>Ben, where did Raymond say that it did not detect UTF-8 without a BOM?</p>
<p>Saying that notepad does NOT use IsTextUnicode shows a lack of knowledge about how notepad (and indeed IsTextUnicode) works. IsTextUnicode is EXACTLY how notepad does its auto-detection.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494433">
				<div id="div-comment-494433" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Adam</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494433">
			April 17, 2007 at 5:52 pm</a>		</div>

		<p>Nick &#8211; that does sound bizarre, especially from the links posted. The oddest report of all is when it appears to output the characters that are the Windows-1252 interpretations of the UTF-8 BOM bytes &#8211; makes it sound like IE is interpreting /part/ of a UTF-8 stream as Win-1252?!?</p>
<p>WRT the server-side removing the BOM, I&#8217;d say that it should strip a BOM (if present) from *all* of the files it reads. it should be sending a &quot;content-type&quot; HTTP header back with the correct charset for the rest of the page, so none of the BOMs will be necessary in the output.</p>
<p>As for the charset/encoding distinction &#8211; most of the time it does not matter. A character encoding implicitly defines a character set; it is the set of characters expressible by the encoding. Similarly, a character set is nearly always defined in terms of a specific encoding &#8211; even Unicode is defined in terms of a specific encoding &#8211; UCS-4. Unicode is just different from most other charsets in that it defines a number of encodings that can express it.</p>
<p>Also, HTML doesn&#8217;t have to be in unicode &#8211; it&#8217;s perfectly acceptable to store it in Windows-1252 and have &quot;Content-type: text/html; charset=Windows-1252&quot; as an HTTP header or HTML META tag. And Windows-1252 is as much a character set as it is an encoding.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494623">
				<div id="div-comment-494623" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nick</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494623">
			April 18, 2007 at 2:31 am</a>		</div>

		<p>Adam&#8211;</p>
<p>Hmm. I think I do stand corrected as to my blanket &quot;HTML is a Unicode charset&quot; statement.</p>
<p>I think what confuses the pants off me is that you can take an HTML file, save it as iso-8859-1, and then shove in an HTML entity reference relating to a Unicode code point. Like take some crazy character that&#8217;s not in iso-8859-1, like &quot;Upwards Double Arrow&quot; (&amp;#8607;). 8607 corresponds to a Unicode code point that the browser looks up, but the actual &amp;, #, 8, 6, 0, and 7 characters were transmitted to the browser in Windows Latin 1. That 8607 never changes regardless of the text file&#8217;s encoding because &quot;that part&quot; of HTML is Unicode. Right?</p>
<p>That popping noise was my brain exploding.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494633">
				<div id="div-comment-494633" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Miral</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494633">
			April 18, 2007 at 3:12 am</a>		</div>

		<p>If server-side-includes are printing BOMs into the output, then it&#8217;s the SSI code that&#8217;s broken, not whatever app is trying to parse it (although it should be able to tolerate it, under the &quot;70% of the web is broken&quot; rule).</p>
<p>Imagine including three files, one of which is UTF-8, another UTF-16, and a third is ANSI with a Cyrillic codepage. &nbsp;Whoever is constructing the output is responsible for ensuring the result is in a single unified format (so it can be specified in the headers), so they&#8217;ll have to perform the necessary character conversion before outputting it.</p>
<p>In an ideal world, at least. &nbsp;Of course in practice most don&#8217;t give a damn and just assume that everything is in the same encoding. &nbsp;But that&#8217;s not technically correct behaviour.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494643">
				<div id="div-comment-494643" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">jondr</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494643">
			April 18, 2007 at 3:54 am</a>		</div>

		<p>OMG! &nbsp;I just figured out why my JSP was not transforming an XML file (using either a DTD or Schema)! &nbsp;Kept getting error message about having data in the XML head. &nbsp;Of course: the BOM. &nbsp;GAH! &nbsp;</p>
<p>The insanity when a dotNET nut is given the assignment to do Java! &nbsp;</p>
<p>So I guess the Xerces/Xanal XML parser methods in Java can&#8217;t deal with a real UTF-8 encoded XML with a BOM. That&#8217;s real convenient. Crikey, can&#8217;t even get it in to filer. And NetBeans 5.5 uses UTF-8 as default.</p>
<p>Well, it is nearly 2am so I&#8217;m glad I took a break to come here. &nbsp;Gotta get up in 4 hours. At least I solved the problem. Thanks. Just ignore this.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494673">
				<div id="div-comment-494673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jonathan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494673">
			April 18, 2007 at 4:21 am</a>		</div>

		<p>IE has its own heuristics about guess, since a lot of pages neglect to specify their charset properly (in Content-Type header of the equivalent &lt;meta http-equiv=Content-Type&#8230;). It usually gets it right, even in the difficult case of Hebrew, where there are several charsets that support it &#8211; Hebrew-Windows, Hebrew-DOS, Hebrew-ISO-Logical, Hebrew-ISA-Visual &lt;shudder&gt;, and of course full-Unicode charsets like UTF-8.</p>
<p>But when it doesn&#8217;t, most users have learned to change the encoding to everything with &quot;Hebrew&quot; in it until it looks OK. I&#8217;ve seen many otherwise non-sophisticated users accomplish this. I wish Notepad has this option (and not only during open).</p>
<p>BTW, using &quot;Unicode&quot; when meaning &quot;UTF-16 LE&quot; is a historical remnant from the time where Unicode thought &quot;16-bit should be enough for everyone!&quot;, which is about the formative years of Windows NT and Win32 (I think, don&#8217;t quote me on that).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494683">
				<div id="div-comment-494683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">mfx</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494683">
			April 18, 2007 at 6:30 am</a>		</div>

		<blockquote><p>
  So I guess the Xerces/Xanal XML parser methods in Java</p>
<p>  can&#8217;t deal with a real UTF-8 encoded XML with a BOM.
</p></blockquote>
<p>The Java XML parsers can cope with a BOM, but you have to present them</p>
<p>with an unparsed byte sequence. Most likely, you have unwittingly converted</p>
<p>the bytes into a String (using some erroneous auto-guessed encoding like</p>
<p>iso-latin-1), and presented the resulting string (which contained a</p>
<p>2-characters sequence 0x00FE 0x00FF (or 0x00FF 0x00FE) instead of</p>
<p>a one-character preamble 0xFEFF (or 0xFFFE).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494733">
				<div id="div-comment-494733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494733">
			April 18, 2007 at 7:14 am</a>		</div>

		<blockquote><p>
  You already have the option to specify the</p>
<p>  encoding manually: Ctrl+O.
</p></blockquote>
<p>I do not. &nbsp;The options presented are ANSI (Shift-JIS, in which a very small minority of the characters are 8 bits), and three varieties of Unicode. &nbsp;If a file contains European characters then some versions of Word sometimes provide more possibilities and even provide previews, but Notepad doesn&#8217;t. &nbsp;If I choose any Notepad option the result will be garbage.</p>
<p>Why does Notepad call an API that has such a heavy bias towards guessing a usually wrong encoding? &nbsp;Most files are Shift-JIS, a few are other ANSI encodings (some of which are 8-bit encodings), and a few are Unicode. &nbsp;If there&#8217;s no obvious indicator then the first attempt should be the user&#8217;s ANSI code page, and if that doesn&#8217;t work then the second attempt should be the system&#8217;s ANSI code page, and Unicode should come after that.</p>
<p>Tuesday, April 17, 2007 2:25 PM by John</p>
<blockquote><p>
  Sometimes I wonder how different it would be</p>
<p>  if 20 years ago everybody knew the problems</p>
<p>  we had today.
</p></blockquote>
<p>Everybody did, except for one country.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494743">
				<div id="div-comment-494743" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Doug</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494743">
			April 18, 2007 at 7:32 am</a>		</div>

		<p>&quot;Yes, I&#8217;d assume that too. But I wasn&#8217;t asking anything. I was just pointing out something, and wasn&#8217;t aware that I had missed a memo.&quot;</p>
<p>You must be new here.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494753">
				<div id="div-comment-494753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nick Lamb</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494753">
			April 18, 2007 at 8:45 am</a>		</div>

		<p>To explain the references to HTML being Unicode earlier, the situation is that the HTML standard is (these days) explicitly Unicode. Thus when you send a Windows 1252 HTML file, the HTML standard considers that as a Unicode document which merely happens to be encoded as Windows 1252, just as other Unicode documents might be encoded as UTF-8 or UCS-2. There are a great many corner cases that are simplified by this assertion.</p>
<p>The practical consequence is that you must program for the web using Unicode, because it&#8217;s virtually impossible to implement the standard correctly without doing so. Most web browsers and similar tools convert to their internal Unicode representation (usually UTF-8 or native endian UTF-16) during or soon after downloading.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494763">
				<div id="div-comment-494763" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://benpoint.com' rel='external nofollow' class='url'>Ben Bryant</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494763">
			April 18, 2007 at 9:52 am</a>		</div>

		<blockquote><p>
  IsTextUnicode is EXACTLY how notepad does its auto-detection
</p></blockquote>
<p>Dean, what a completely false statement! As far as I can tell, if IsTextUnicode is used at all, it is ONLY used to detect the UTF-16 BOM. It doesn&#8217;t even detect a UTF-8 BOM! And it doesn&#8217;t have UTF-8 byte sequence auto-detection. None of the IsTextUnicode UTF-16 statistical likeness detection is used because that would give notepad a behavior that could be deemed inconsistent.</p>
<p>All in all, notepad makes the right choices, but IsTextUnicode has little to do with it.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494803">
				<div id="div-comment-494803" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.geeknews.net/?p=730' rel='external nofollow' class='url'>Plethora of Links &laquo; Geek News</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494803">
			April 18, 2007 at 10:49 am</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://www.geeknews.net/?p=730" rel="nofollow">http://www.geeknews.net/?p=730</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494823">
				<div id="div-comment-494823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://benpoint.com' rel='external nofollow' class='url'>Ben Bryant</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494823">
			April 18, 2007 at 10:54 am</a>		</div>

		<p>Oh, I see it actually uses IsTextUnicode for UTF-16 auto-detection, I was wrong, I missed the memo. All the testing I did was in relation to UTF-8 and I shouldn&#8217;t have assumed.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-494853">
				<div id="div-comment-494853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://benpoint.com' rel='external nofollow' class='url'>Ben Bryant</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494853">
			April 18, 2007 at 11:33 am</a>		</div>

		<p>But why is there no discussion here of the UTF-8 auto-detection which is not from IsTextUnicode and is much more statistically reliable but still not 100%? I wonder if it is being removed in Vista.</p>
<p>The same way you can trick notepad into thinking &#8216;this app can break&#8217; is UTF-16, you can make it think &#8216;Â©&#8217; is UTF-8. On a machine with Windows-1252 locale, open notepad, paste Â© in and save. Re-open you&#8217;ll find it is just ©. Save it and it will add the UTF-8 BOM (use file Properties to see it go from 2 to 5 bytes).</p>
<p>I am amazed that notepad would make such a blunder to use IsTextUnicode for UTF-16 auto-detection because it is so obviously unreliable I would never have imagined the notepad team could be so dumb. You can specify the encoding on File Open for unusual cases of UTF-16 without BOM! Why would they do this?!!</p>
<div class="post">[<i>I took extra time in the article to discuss this; please read it again. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-494893">
				<div id="div-comment-494893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://benpoint.com' rel='external nofollow' class='url'>Ben Bryant</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-494893">
			April 18, 2007 at 1:34 pm</a>		</div>

		<p>Thanks for responding to say re-read. You did touch the important points, but I guess I&#8217;m adding:</p>
<p>a) notepad&#8217;s UTF-8 auto-detection is not from IsTextUnicode. I guess you were referring to this auto-detection where you said &quot;looks like valid UTF-8&quot;</p>
<p>b) UTF-8 auto-detection is *much* more reliable (despite the example I gave which breaks it), so it can be seriously considered, whereas UTF-16 auto-detection should not be even remotely considered, especially since the BOM is always recommended for UCS-2 and UTF-16.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-495043">
				<div id="div-comment-495043" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dileepa</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-495043">
			April 19, 2007 at 7:20 am</a>		</div>

		<p>In Windows XP, if I press Windows+TAB to &#8216;tab&#8217; through the buttons on the taskbar and then press the &#8216;space&#8217; key on one of the taskbar buttons, I see a big stripe (the entire length of the taskbar and about the same height) covering the taskbar. Is that a bug or a feature?</p>
<p>(I don&#8217;t know if this happens in Vista non-aero mode too).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-495183">
				<div id="div-comment-495183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mihai</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-495183">
			April 19, 2007 at 1:04 pm</a>		</div>

		<p>@cmov: &quot;That doesn&#8217;t help you when you save the file and try to open it.&quot;</p>
<p>True. But as a nice bonus: the Visual Studio 2005 editor does. And it also saves the file according to the meta.</p>
<p>@d.n.hotch: &quot;Hope for something ASCII-compatible? You might need the encoding before you get the encoding.&quot;</p>
<p>All the popular code pages are ASCII-compatible enough for you to recognize the meta. Exceptions are EBCDIC (and using EBCDIC in an HTML is a WTF :-), and UTF-16/UTF-32</p>
<p>For UTF16/32 the recommendation is to use a BOM: <a rel="nofollow" target="_new" href="http://www.w3.org/TR/html401/charset.html#h-5.2.1.1" rel="nofollow">http://www.w3.org/TR/html401/charset.html#h-5.2.1.1</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-495333">
				<div id="div-comment-495333" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ctrl+O sux</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-495333">
			April 20, 2007 at 7:14 am</a>		</div>

		<p>You can&#8217;t specify encoding when drag&#8217;n&#8217;dropping files on notepad!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-495353">
				<div id="div-comment-495353" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James Risto</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-495353">
			April 20, 2007 at 8:46 am</a>		</div>

		<p>OldNewThing, with all due respect, I think you need to thicken your skin a bit. You are a public figure now. Those of us less knowledgeable just want to understand &#8230; some of us are NOT here to MS-bash &#8230; just MS-understand.</p>
<div class="post">[<i>Oh great, now I&#8217;m a public figure. Remember when blogging was about just being yourself? How can I stop being a public figure? -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-495813">
				<div id="div-comment-495813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/michkap/archive/2007/04/22/2239345.aspx' rel='external nofollow' class='url'>Sorting It All Out</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-495813">
			April 22, 2007 at 9:59 pm</a>		</div>

		<p>A few days ago, Raymond was talking about the Notepad file encoding problem , again. And the comments</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-495833">
				<div id="div-comment-495833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Private figure</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-495833">
			April 22, 2007 at 11:38 pm</a>		</div>

		<blockquote><p>
  How can I stop being a public figure?
</p></blockquote>
<p>Use a time machine and shoot yourself before you start this blog.</p>
<p>[Nitpicker&#8217;s corner: &nbsp;The above is not an order. &nbsp;In fact it&#8217;s not even a serious answer.]</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-495873">
				<div id="div-comment-495873" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James Risto</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-495873">
			April 23, 2007 at 10:49 am</a>		</div>

		<p>My apologies if your questions were rhetorical, but if they were not &#8230; yes somehow being senior in MS, and writing a book, your &quot;inside knowledge&quot; and sharing level, and &quot;tight ship&quot; blog has made you more than a casual blogger. Nobody wants to be a public figure (for long). It should not be, but what we want and reality are two different things. Feel free to ignore this, and if I am wrong or irrelevant then no loss.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-496973">
				<div id="div-comment-496973" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jon Asbury</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-496973">
			April 26, 2007 at 11:19 am</a>		</div>

		<blockquote><p>
  My favorite notepad &quot;bug&quot; is that it (unlike write.exe) won&#8217;t recognize unix-style line endings&#8230;
</p></blockquote>
<p>Or Mac line endings &#8211; CRs with no LF</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-553653">
				<div id="div-comment-553653" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/pranavwagh/archive/2007/09/25/mails-that-i-really-really-don-t-want-to-receive-2.aspx' rel='external nofollow' class='url'>MSDN Blog Postings &raquo; Mails that I really, really don't want to receive - 2</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-553653">
			September 25, 2007 at 11:19 am</a>		</div>

		<p>PingBack from <a href="http://blogs.msdn.com/pranavwagh/archive/2007/09/25/mails-that-i-really-really-don-t-want-to-receive-2.aspx" rel="nofollow">http://blogs.msdn.com/pranavwagh/archive/2007/09/25/mails-that-i-really-really-don-t-want-to-receive-2.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-650523">
				<div id="div-comment-650523" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.sasak.net/modules/wordpress/?p=358' rel='external nofollow' class='url'>SASAK.NET - Blogger &raquo; KEANEHAN PADA WINDOWS BISA DITELUSURI SECARA ILMIAH</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-650523">
			July 30, 2008 at 5:38 am</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://www.sasak.net/modules/wordpress/?p=358" rel="nofollow">http://www.sasak.net/modules/wordpress/?p=358</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-650673">
				<div id="div-comment-650673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://zahidhadromi.wordpress.com/2008/07/30/keanehan-pada-windows-bisa-ditelusuri-secara-ilmiah/' rel='external nofollow' class='url'>KEANEHAN PADA WINDOWS BISA DITELUSURI SECARA ILMIAH &laquo; Berdakwah dengan ilmu dan santun</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-650673">
			July 30, 2008 at 10:35 am</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://zahidhadromi.wordpress.com/2008/07/30/keanehan-pada-windows-bisa-ditelusuri-secara-ilmiah/" rel="nofollow">http://zahidhadromi.wordpress.com/2008/07/30/keanehan-pada-windows-bisa-ditelusuri-secara-ilmiah/</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-679293">
				<div id="div-comment-679293" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://josfc.wordpress.com/2008/11/02/acertijo-windows/' rel='external nofollow' class='url'>Acertijo Windows &laquo; Josfc Beta</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-679293">
			November 1, 2008 at 9:09 pm</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://josfc.wordpress.com/2008/11/02/acertijo-windows/" rel="nofollow">http://josfc.wordpress.com/2008/11/02/acertijo-windows/</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-680343">
				<div id="div-comment-680343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://dorinlazar.wordpress.com/2008/11/05/conspiratia-teoriei/' rel='external nofollow' class='url'>Conspira??ia teoriei &laquo; Fly on the Windscreen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-680343">
			November 5, 2008 at 2:59 am</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://dorinlazar.wordpress.com/2008/11/05/conspiratia-teoriei/" rel="nofollow">http://dorinlazar.wordpress.com/2008/11/05/conspiratia-teoriei/</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-734473">
				<div id="div-comment-734473" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://wiert.wordpress.com/2009/05/08/stuf-receiving-data-from-a-provider-where-utf-8-is-in-fact-iso-8859/' rel='external nofollow' class='url'>StUF &#8211; receiving data from a provider where UTF-8 is in fact ISO-8859 &laquo; The Wiert Corner</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20070417-00/?p=27223#comment-734473">
			May 9, 2009 at 6:38 pm</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://wiert.wordpress.com/2009/05/08/stuf-receiving-data-from-a-provider-where-utf-8-is-in-fact-iso-8859/" rel="nofollow">http://wiert.wordpress.com/2009/05/08/stuf-receiving-data-from-a-provider-where-utf-8-is-in-fact-iso-8859/</a></p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>