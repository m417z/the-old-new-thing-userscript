<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (9)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="/oldnewthing/20180302-00/?p=98145#respond" style="display:none;">Cancel reply</a></small></h3>			<form action="https://blogs.msdn.microsoft.com/oldnewthing/wp-comments-post.php" method="post" id="commentform" class="comment-form">
				<p class="comment-form-comment"><textarea id="comment" name="comment" cols="45" rows="4" aria-required="true"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit btn btn-default" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='98145' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="73b8066ca1" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="28"/></p>			</form>
			</div><!-- #respond -->
	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment byuser comment-author-jeremytais even thread-even depth-1 parent" id="comment-1327475">
				<div id="div-comment-1327475" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/SimonRev' rel='external nofollow' class='url'>SimonRev</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145#comment-1327475">
			March 2, 2018 at 8:36 am</a>		</div>

		<p>Here I was expecting the article to be about some thread that decided to return 253 as its exit code.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145&#038;replytocom=1327475#respond' onclick='return addComment.moveForm( "div-comment-1327475", "1327475", "respond", "98145" )' aria-label='Reply to SimonRev'>Reply</a></div>
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-msn odd alt depth-2 parent" id="comment-1327595">
				<div id="div-comment-1327595" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/poizan42' rel='external nofollow' class='url'>poizan42</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145#comment-1327595">
			March 3, 2018 at 4:58 am</a>		</div>

		<p>GetExitCode(Process|Thread) has always seemed badly designed to me. They could just have returned a DWORD instead with an error code including the possibility of ERROR_STILL_RUNNING or something like that. Instead we get a function returning a bool, setting the error with SetLastError() while returning the exitcode in an out parameter while making one possible value ambiguous.</p>
<p>Also the documentation for the functions does not give the best advice. They advice you to not return 253. Better advice would be to always check whether a thread is running with WaitForSingleObject(hThread, 0) and only get the exit code if it has exited.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145&#038;replytocom=1327595#respond' onclick='return addComment.moveForm( "div-comment-1327595", "1327595", "respond", "98145" )' aria-label='Reply to poizan42'>Reply</a></div>
				</div>
		<ol class="children">
		<li class="comment even depth-3" id="comment-1327615">
				<div id="div-comment-1327615" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145#comment-1327615">
			March 3, 2018 at 9:42 am</a>		</div>

		<p>To be fair your best advice is what I do. In continuation, I think the best way to check if running is WaitForSingleObject with zero timeout.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145&#038;replytocom=1327615#respond' onclick='return addComment.moveForm( "div-comment-1327615", "1327615", "respond", "98145" )' aria-label='Reply to Joshua'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 parent" id="comment-1327485">
				<div id="div-comment-1327485" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">R P (MSFT)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145#comment-1327485">
			March 2, 2018 at 9:13 am</a>		</div>

		<p>That&#8217;s all well and good, but can I use the handle from _beginthread to get the thread&#8217;s exit code?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145&#038;replytocom=1327485#respond' onclick='return addComment.moveForm( "div-comment-1327485", "1327485", "respond", "98145" )' aria-label='Reply to R P (MSFT)'>Reply</a></div>
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-oldnewthing bypostauthor even depth-2" id="comment-1327535">
				<div id="div-comment-1327535" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145#comment-1327535">
			March 2, 2018 at 4:01 pm</a>		</div>

		<p>Indeed, it is guaranteed <u>not</u> to work! <a href="https://blogs.msdn.microsoft.com/oldnewthing/20170929-00/?p=97115">Once the thread exits, the handle becomes invalid</a>, so you can&#8217;t use it to get the exit code.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145&#038;replytocom=1327535#respond' onclick='return addComment.moveForm( "div-comment-1327535", "1327535", "respond", "98145" )' aria-label='Reply to Raymond Chen - MSFT'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment odd alt thread-even depth-1 parent" id="comment-1327855">
				<div id="div-comment-1327855" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Koro</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145#comment-1327855">
			March 5, 2018 at 11:12 am</a>		</div>

		<p>At this point, you might as well just change _beginthread to return a dummy invalid handle on success to force people to not rely on this value.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145&#038;replytocom=1327855#respond' onclick='return addComment.moveForm( "div-comment-1327855", "1327855", "respond", "98145" )' aria-label='Reply to Koro'>Reply</a></div>
				</div>
		<ol class="children">
		<li class="comment even depth-2" id="comment-1327975">
				<div id="div-comment-1327975" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145#comment-1327975">
			March 5, 2018 at 8:21 pm</a>		</div>

		<p>Bad idea. I&#8217;ve come up with uses that are guaranteed to work. See DuplicateHandle for why it&#8217;s possible. (Note that you have to be synchronizing with the newly created thread somewhere or this is still racy).</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145&#038;replytocom=1327975#respond' onclick='return addComment.moveForm( "div-comment-1327975", "1327975", "respond", "98145" )' aria-label='Reply to Joshua'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1327905">
				<div id="div-comment-1327905" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">mikeb</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145#comment-1327905">
			March 5, 2018 at 11:25 am</a>		</div>

		<p>To be fair to the customer, the way the documentation for the return value of _beginthread is written, it makes it seems like there is an chance that using the handle could work, maybe with some effort.</p>
<p>In my opinion, the documentation should include a direct statement of what you say in your article:  &#8220;The return value from _begin­thread should not be used for anything other than determining whether the thread was started successfully&#8221;</p>
<p>While the docs as written aren&#8217;t incorrect, without a clear, direct statement the documentation leaves the impression that there might be a way to use the handle safely.  Why force users to figure this out for themselves and possibly get it wrong, when you can just say what you mean?  (please keep in mind that the &#8216;you&#8217; here refers to Microsoft, not Raymond).</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145&#038;replytocom=1327905#respond' onclick='return addComment.moveForm( "div-comment-1327905", "1327905", "respond", "98145" )' aria-label='Reply to mikeb'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-wndsks even thread-even depth-1" id="comment-1328135">
				<div id="div-comment-1328135" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/skSdnW' rel='external nofollow' class='url'>skSdnW</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145#comment-1328135">
			March 6, 2018 at 8:54 am</a>		</div>

		<p>Schrödinger&#8217;s handle. We know it was valid when we started but now, who knows. And we can&#8217;t even check.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://blogs.msdn.microsoft.com/oldnewthing/20180302-00/?p=98145&#038;replytocom=1328135#respond' onclick='return addComment.moveForm( "div-comment-1328135", "1328135", "respond", "98145" )' aria-label='Reply to skSdnW'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>
<!-- COMMENTS END -->
</div></td></tr></table>