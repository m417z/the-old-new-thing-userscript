<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (12)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-924373">
				<div id="div-comment-924373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Koro</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110713-00/?p=10173#comment-924373">
			July 13, 2011 at 9:10 am</a>		</div>

		<p>Why import a whole DLL and add more dependencies to your executable when you can do it in a simple one-liner:</p>
<p>((IMAGE_NT_HEADERS*)(((LPBYTE)(&amp;__ImageBase))+pDosHeader-&gt;e_lfanew))-&gt;FileHeader.TimeDateStamp</p>
<p>Replace (&amp;__ImageBase) with an HMODULE to find the timestamp of something else than the current module.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-924393">
				<div id="div-comment-924393" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Csaboka</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110713-00/?p=10173#comment-924393">
			July 13, 2011 at 9:16 am</a>		</div>

		<p>This is the kind of one-liner I would rather see expanded into three or four lines :)</p>
<p>Admittedly, I don&#39;t do a lot of C coding these days, but those casts are a bit hard to follow&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-924463">
				<div id="div-comment-924463" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110713-00/?p=10173#comment-924463">
			July 13, 2011 at 10:42 am</a>		</div>

		<p>@Ken Hagan: You do realize he&#39;s asking an already loaded DLL right?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-924493">
				<div id="div-comment-924493" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James Curran</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110713-00/?p=10173#comment-924493">
			July 13, 2011 at 12:27 pm</a>		</div>

		<p>Many years ago (definitely before connect.microsoft.com, possibly before <a href="http://www.microsoft.com" rel="nofollow">http://www.microsoft.com</a>) I made the suggestion (most likely via Microsoft&#39;s CompuServe forum) of a simple change to LINK.EXE : If it encountered an otherwise undefined external named (for example) &quot;$$DATE&quot;, it should define it with the current date/time. &nbsp;I simple solution to all the problems like this.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-924553">
				<div id="div-comment-924553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">David Walker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110713-00/?p=10173#comment-924553">
			July 13, 2011 at 2:29 pm</a>		</div>

		<p>@James Curran: &nbsp;You&#39;re asking the linker to interpret the name of an undefined variable, and figure out what it should hold? &nbsp;Does it need to allow for names such as $$DATE in all supported languages? &nbsp;It would need a table of variables and some sort of way to determine what the variable should be replaced with.</p>
<p>There aren&#39;t that many different variables that can be replaced with obvious values. &nbsp;The constant Pi, and maybe $$DATE, and $$TIME, and c (for the speed of light in a vacuum), and &#8230; what else?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-yuhong-bao odd alt thread-odd thread-alt depth-1" id="comment-924563">
				<div id="div-comment-924563" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Yuhong+Bao' rel='external nofollow' class='url'>Yuhong Bao</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110713-00/?p=10173#comment-924563">
			July 13, 2011 at 2:33 pm</a>		</div>

		<p>David Walker: MS&#39;s linker already has a built-in variable called __ImageBase.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-924583">
				<div id="div-comment-924583" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Stephen Oberholtzer</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110713-00/?p=10173#comment-924583">
			July 13, 2011 at 2:53 pm</a>		</div>

		<p>I wrote a program once that parsed and displayed all of the nitty gritty details (image flags and whatnot) from a PE executable. &nbsp;One of the things I learned is that, because the timestamp is only used to optimize the loader, there&#39;s not actually a standard. &nbsp;For example, MS linkers use a time_t format, but Borland&#39;s linker used (maybe still uses?) an internal time format used by DOS for something or other.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-924383">
				<div id="div-comment-924383" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Koro</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110713-00/?p=10173#comment-924383">
			July 13, 2011 at 9:13 am</a>		</div>

		<p>This is what I get for typing code on the fly without checking&#8230; I meant to write this:</p>
<p>((IMAGE_NT_HEADERS*)(((LPBYTE)(&amp;__ImageBase))+((IMAGE_DOS_HEADER*)(&amp;__ImageBase))-&gt;e_lfanew))-&gt;FileHeader.TimeDateStamp</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-924603">
				<div id="div-comment-924603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Not Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110713-00/?p=10173#comment-924603">
			July 13, 2011 at 4:57 pm</a>		</div>

		<p>Why is it that every time someone tries to be smart and write some convoluted code in a comment, they almost invariably end up having to correct themselves?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-924443">
				<div id="div-comment-924443" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ken Hagan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110713-00/?p=10173#comment-924443">
			July 13, 2011 at 10:37 am</a>		</div>

		<p>@Csaboka: By the time you&#39;ve added proper validation that the bytes in front of you *are* a PE image, and possibly coded up x86 and x64 flavours of the same, I expect that even Koro would want to break this up into three or four lines, or maybe even use IMAGEHLP.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-924633">
				<div id="div-comment-924633" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Worf</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110713-00/?p=10173#comment-924633">
			July 13, 2011 at 11:51 pm</a>		</div>

		<p>@David Walker: It&#39;s not an undefined variable. The linker works with symbols &#8211; it knows little about the language below. We&#39;re just asking that the linker perhaps define __LinkDateTime (32-bit value) as one of its symbols.</p>
<p>The linker certainly can do that, and we can ignore it or use it (it&#39;s a discardable symbol).</p>
<p>Heck, programs can GetProcAddress that too to see if they&#39;re loading 9ld stuff or new stuff.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-925533">
				<div id="div-comment-925533" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110713-00/?p=10173#comment-925533">
			July 18, 2011 at 7:25 pm</a>		</div>

		<p>This doesn&#39;t work on WinCE 5.0+ because programs cannot read it&#39;s own images any longer, they do not have read access to their own image files. Why? Nobody at ms support knows why this change was made.</p>
<p>And secondly, this blog software suck, please fix it.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>