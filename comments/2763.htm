<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (40)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-1086653">
				<div id="div-comment-1086653" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Damien</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086653">
			November 1, 2013 at 7:08 am</a>		</div>

		<p>SystemTimeToFileTime + FileTimeToLocalFileTime	+ FileTimeToSystemTime?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1086663">
				<div id="div-comment-1086663" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Grzechooo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086663">
			November 1, 2013 at 7:18 am</a>		</div>

		<p>I&#39;m waiting for a snarky remark on how Windows sets BIOS to local time.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1086673">
				<div id="div-comment-1086673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Henke37</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086673">
			November 1, 2013 at 7:19 am</a>		</div>

		<p>I&#39;d figure out how to host a JavaScript engine and then use the Date class.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1086683">
				<div id="div-comment-1086683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Adam Rosenfield</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086683">
			November 1, 2013 at 7:21 am</a>		</div>

		<p>Exercise: Just increment/decrement by the current time zone offset (expressed in 100-nanosecond intervals).</p>
<p>Your nice little commutative diagram fails to render the arrows in Firefox, and they render at a tiny size in Chrome. &nbsp;I don&#39;t know if the problem is in the browsers or in the SVG, but either way, only IE gets it right.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1086693">
				<div id="div-comment-1086693" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Damien</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086693">
			November 1, 2013 at 7:21 am</a>		</div>

		<p>Also, given the theme of todays post &#8211; was this also meant to be your semi-annual &quot;the clocks change in most of the US this Sunday&quot; reminder post?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1086703">
				<div id="div-comment-1086703" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">voo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086703">
			November 1, 2013 at 7:24 am</a>		</div>

		<p>Interestingly enough chrome doesn&#39;t show the arrows correctly in the diagram &#8211; IE does fine though. I&#39;m by no means a webdev, but from a short glance into the html it looks like a SVG graphic &#8211; aren&#39;t those non-standard IE extensions or just not supported by chrome?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1086713">
				<div id="div-comment-1086713" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">@voo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086713">
			November 1, 2013 at 7:52 am</a>		</div>

		<p>Don&#39;t work in Firefox either&#8230;</p>
<p>It&#39;s HTML5 inline SVG. All modern browsers support it, perhaps Raymond used some SVG tags that the other browsers don&#39;t support.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1086723">
				<div id="div-comment-1086723" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Zenju</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086723">
			November 1, 2013 at 7:55 am</a>		</div>

		<p>The table above makes time conversions look too easy! :)</p>
<p>It should mention the second way to get from UTC FILETIME to local SYSTEMTIME which ends up with a slightly different result for FAT/NTFS:</p>
<p>FileTimeToSystemTime + SystemTimeToTzSpecificLocalTime </p>
<p>Reference: <a rel="nofollow" target="_new" href="http://msdn.microsoft.com/en-us/library/ms724277(VS.85).aspx">msdn.microsoft.com/&#8230;/ms724277(VS.85).aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1086733">
				<div id="div-comment-1086733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">David</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086733">
			November 1, 2013 at 8:29 am</a>		</div>

		<p>Well, it is annoying that Windows sensibly uses UTC internally, but has no supported way to set the BIOS in UTC, thus allowing DST to be handled correctly in systems that multi-boot.</p>
<p>(Yes, there is the undocumented registry setting, but unfortunately even when RealtimeIsUniversal is set SetWaitableTimer()/SetWaitableTimerEx() still set wake alarms in local time, so Scheduled Tasks wake the computer at the wrong time [or fail to wake it at all].)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1086743">
				<div id="div-comment-1086743" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">David</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086743">
			November 1, 2013 at 8:45 am</a>		</div>

		<p>Sorry, to follow up on my own comment, but intriguingly RealTimeIsUniversal is now documented as &#39;recommended&#39; for some scenarios (in Windows Embedded, at least): <a rel="nofollow" target="_new" href="http://msdn.microsoft.com/en-us/library/ff793798%28v=winembedded.60%29.aspx">msdn.microsoft.com/&#8230;/ff793798%28v=winembedded.60%29.aspx</a></p>
<p>(But it still says &#39;This is an unsupported feature of Windows, and the Windows UI might not honor this registry entry. Therefore, the CMOS clock should be set to UTC within the BIOS and not within Windows.&#39; here: <a rel="nofollow" target="_new" href="http://msdn.microsoft.com/en-us/library/ff794720%28v=winembedded.60%29.aspx#CMOSUTC">msdn.microsoft.com/&#8230;/ff794720%28v=winembedded.60%29.aspx</a> )</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1086753">
				<div id="div-comment-1086753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086753">
			November 1, 2013 at 8:58 am</a>		</div>

		<p>That&#39;s bad. Due to multiple overlapping scenarios, HKEY_LOCAL_MACHINESYSTEMCurrentControlSetControlTimeZoneInformationRealTimeIsUniversal should be fully supported.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-jader3rd odd alt thread-odd thread-alt depth-1" id="comment-1086763">
				<div id="div-comment-1086763" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/jader3rd' rel='external nofollow' class='url'>jader3rd</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086763">
			November 1, 2013 at 9:12 am</a>		</div>

		<p>I&#39;ve wondered for a while, why is it called File Time in the first place?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1086773">
				<div id="div-comment-1086773" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">DWalker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086773">
			November 1, 2013 at 9:39 am</a>		</div>

		<p>SYSTEMTIME stNow;</p>
<p>FILETIME ftNow;</p>
<p>GetSystemTime(&amp;st);</p>
<p>SystemTimeToFileTime(&amp;stNow, &amp;ftNow);</p>
<p>Shouldn&#39;t &amp;st be &amp;stnow in the second line?</p>
<div class="post">[<em>Fixed thanks. Normally I delete simple typos, but the follow-up comment was funny, so I&#39;m leaving both. Hey, this time I wrote two lines of code and <a href="http://blogs.msdn.com/b/oldnewthing/archive/2013/05/01/10415282.aspx">only one of them was wrong</a>! (Well, okay, they&#39;re still both wrong, but only one of them was blatantly wrong.) -Raymond</em>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1086783">
				<div id="div-comment-1086783" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">V-SHorn</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086783">
			November 1, 2013 at 10:02 am</a>		</div>

		<p>@DWalker: Only if your line numbers start at 0.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1086813">
				<div id="div-comment-1086813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">dave</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086813">
			November 1, 2013 at 11:12 am</a>		</div>

		<p>&gt;I&#39;ve wondered for a while, why is it called File Time in the first place?</p>
<p>In the kernel, the &#39;64-bit count of 100-nS units&#39; is called a &#39;system time&#39; as indeed it should be, since it&#39;s the time format used by the system.</p>
<p>I suppose that the Win32 API already had a SYSTEMTIME (possibly because Win16 had one), so it had to invent a new name for the same concept. &nbsp;And the first place 64-bit times showed up in Win32 was (more guessing) in the file system APIs.</p>
<p>(The file system APIs are closer to kernel thinking than other places: e.g., they know 0 can be a valid HANDLE)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1086823">
				<div id="div-comment-1086823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">avakar86</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086823">
			November 1, 2013 at 11:26 am</a>		</div>

		<p>The documentation of FILETIME says that it is the number of 100ns intervals from January 1, 1601 (UTC) and that&#39;s what GetSystemTimeAsFileTime returns. So what exactly is FILETIME in local form? Is it the number of 100ns intervals since January 1, 1601 (local)? And finally, how does FileTimeToSystemTime determine which form the FILETIME is in?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1086853">
				<div id="div-comment-1086853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Myria</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086853">
			November 1, 2013 at 1:16 pm</a>		</div>

		<p>I just had to implement gmtime_r on Windows for an open-source project that wasn&#39;t using Visual Studio (so no gmtime_s), so this topic was on my mind =) &nbsp;Windows really does handle time much better than UNIX. &nbsp;A coworker once whined at me about how Windows uses the &quot;really strange&quot; epoch of January 1, 1601 N.S. UTC, but I explained how that&#39;s actually an ingenious choice of epoch. &nbsp;The period of the Gregorian calendar is 400 years, so choosing a year that is either a multiple of 400 or the year after makes a lot of sense for making conversion to calendar dates simpler.</p>
<p>The one thing I wish Windows would add to its time API is the ability to look up a TimeZoneKeyName given a POSIX time zone name. &nbsp;For example, to map &quot;America/Los_Angeles&quot; to &quot;Pacific Standard Time&quot;.</p>
<p>@Maurits: Why doesn&#39;t FileTimeToLocalFileTime just work directly? &nbsp;As for a &quot;local FILETIME&quot;, if you divide by 10000000 and subtract 11644473600LL, you have a local time_t. &nbsp;I do find it interesting that FileTimeToLocalFileTime is prohibited in Windows Store programs.</p>
<p>@David: I would love to be able to use RealTimeIsUniversal on my work machine. &nbsp;My primary work machine has both Windows 7 and Mountain Lion installed, and both are on the NT domain. &nbsp;Every time I switch back to Mac OS, I have to log in as a local user and fix the time, because Mac OS&#39;s Kerberos authentication stuff rejects the tickets coming off Active Directory&#39;s domain controllers.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-maurits odd alt thread-odd thread-alt depth-1" id="comment-1086863">
				<div id="div-comment-1086863" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Maurits+%5BMSFT%5D' rel='external nofollow' class='url'>Maurits [MSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086863">
			November 1, 2013 at 1:59 pm</a>		</div>

		<p>@Myria: I understand the utility of a (UTC time_t &lt;=&gt; UTC FILETIME) formula.</p>
<p><a rel="nofollow" target="_new" href="http://support.microsoft.com/kb/167296">support.microsoft.com/&#8230;/167296</a></p>
<p>I also understand that you can use the same formula to do (&quot;local time_t&quot; &lt;=&gt; &quot;local FILETIME&quot;). But isn&#39;t that just converting a chimera from one language to another? What would you do with the &quot;local time_t&quot; once you had it?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-andycadley2 even thread-even depth-1" id="comment-1086873">
				<div id="div-comment-1086873" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/AndyCadley' rel='external nofollow' class='url'>AndyCadley</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086873">
			November 1, 2013 at 2:13 pm</a>		</div>

		<p>&quot;How would you implement the System­Time­To­Local­Time function?&quot;</p>
<p>Well first I&#39;d write a function that enumerates every possible LocalTime&#8230;. ;-)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1086893">
				<div id="div-comment-1086893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">dave</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086893">
			November 1, 2013 at 2:29 pm</a>		</div>

		<p>&gt;But isn&#39;t that just converting a chimera from one language to another? </p>
<p>This all depends on what the definitions are.</p>
<p>A FILETIME is a 64-bit integer representing the number of 100-nS units since 1601-01-01 UTC.</p>
<p>time_t is simply an arithmetic type suitable for storing system time values in standard C. It is undefined what the values mean: no definition of start of the range, no definition of what time interval is represented by a unit increase in the value, etc. </p>
<p>So a FILETIME is by its own definition a bad choice for a local time value; time_t is just fine.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-hankhein even thread-even depth-1" id="comment-1086903">
				<div id="div-comment-1086903" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Henri+Hein' rel='external nofollow' class='url'>Henri Hein</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086903">
			November 1, 2013 at 4:06 pm</a>		</div>

		<p>OT: is it possible to tell when a post is closed to comments? &nbsp;As it is, I cannot tell if the comment box is missing because I&#39;m not logged in, or missing because comments are closed.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1086913">
				<div id="div-comment-1086913" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">hexatron</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086913">
			November 1, 2013 at 4:32 pm</a>		</div>

		<p>I used the GetSystemTime &#8211; SystemTimeToFileTime construct. In my defense, 1. I needed SYSTEMTIME before I needed FILETIME 2. GetSystemTime has a shorter name, so it probably runs faster than SystemTimeToFileTime, and 3. Thinking about this takes orders of magnitude more time than doing it the slower way.</p>
<p>I was dealing with a SQL Server database, and using SystemTimeToVariantTime (number of days since 30Dec1899 as a double) which seems not to have a FILETIME version.</p>
<p>SystemTimeToVariantTime also trashes milliseconds, so I use SystemTimeToVariantTime(&amp;st, &amp;vt); vt += st.wMilliSeconds/86400000.0;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-maurits even thread-even depth-1" id="comment-1086923">
				<div id="div-comment-1086923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Maurits+%5BMSFT%5D' rel='external nofollow' class='url'>Maurits [MSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086923">
			November 1, 2013 at 5:25 pm</a>		</div>

		<p>@Henri Hein: this blog allows anonymous comments, so if you see&#8230;</p>
<p>&#8230; no boxes, it means the post is closed;</p>
<p>&#8230; only a comment box, it means the post is open, and you&#39;re signed in;</p>
<p>&#8230; both a comment box and a username box, it means the post is open, and you&#39;re not signed in.</p>
<p>There&#39;s also another way to tell whether you&#39;re signed in; the top right corner of the site will show your username if you&#39;re signed in, or &quot;Sign in&quot; if you&#39;re not.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1086933">
				<div id="div-comment-1086933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">avakar86</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086933">
			November 1, 2013 at 6:09 pm</a>		</div>

		<p>The concept of &quot;local FILETIME&quot; seems inherently flawed to me. There is only one &quot;number of time units since epoch&quot;. It makes no sense to talk about &quot;UTC&quot; and &quot;local&quot; forms of that number. Time zones do not enter the picture until you start showing the time to the user (in a SYSTEMTIME-like form).</p>
<p>I&#39;m guessing that the intent of FileTimeToLocalFileTime is for it to look at the numbers on local clocks at the specified FILETIME, and then search for a FILETIME at which the numbers on UTC clocks are the same (thus allowing you to use FileTimeToSystemTime to format local time). This search can fail in the presence of leap seconds though: there is for instance no FILETIME at which UTC clocks would show &quot;2012-07-01, 00:59:60&quot;, a perfectly valid local time in +01:00 time zone.</p>
<p>@Myria, as for Windows Store programs, I hope that supporting leap seconds one day is one of the motivations for disallowing FileTimeToLocalFileTime.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-maurits even thread-even depth-1" id="comment-1086833">
				<div id="div-comment-1086833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Maurits+%5BMSFT%5D' rel='external nofollow' class='url'>Maurits [MSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086833">
			November 1, 2013 at 12:24 pm</a>		</div>

		<p>&gt; what exactly is FILETIME in local form</p>
<p>A chimera. When you have a chimera, it is a signal that perhaps there is a better way. I find the documentation for FileTimeToLocalFileTime to be interesting:</p>
<p>&#8212; begin quote &#8212;</p>
<p><a rel="nofollow" target="_new" href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms724277(v=vs.85).aspx" rel="nofollow">msdn.microsoft.com/&#8230;/ms724277(v=vs.85).aspx</a></p>
<p>To account for daylight saving time when converting a file time to a local time, use the following sequence of functions in place of using FileTimeToLocalFileTime: </p>
<p>1. FileTimeToSystemTime </p>
<p>2. SystemTimeToTzSpecificLocalTime </p>
<p>3. SystemTimeToFileTime </p>
<p>&#8212; end quote &#8212;</p>
<p>You have the following perfectly sensible data at the various stages:</p>
<p>1) START: you have a FILETIME (which is by definition in UTC.)</p>
<p>2) After FileTimeToSystemTime you have a SYSTEMTIME in UTC.</p>
<p>3) After SystemTimeToTzSpecificLocalTime you have a SYSTEMTIME in your local time zone.</p>
<p>This gets you to every point of the diagram except the top right corner. The documentation then says you *can* get to the top right corner by calling SystemTimeToFileTime again.</p>
<p>But why do you *want* to get to the top right corner? What would you do with a &quot;local FILETIME&quot;?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-fleet-command odd alt thread-odd thread-alt depth-1" id="comment-1086963">
				<div id="div-comment-1086963" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Fleet+Command' rel='external nofollow' class='url'>Fleet Command</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086963">
			November 2, 2013 at 1:24 am</a>		</div>

		<p>Ah, a post that reminds me what a pain running Windows and Linux in a multi-boot setting is. Windows sets the BIOS time to local time and Linux sets the BIOS time to UTC time. Result: What Max Payne calls &quot;an old familiar feeling&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1086973">
				<div id="div-comment-1086973" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">smf</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086973">
			November 2, 2013 at 3:14 am</a>		</div>

		<p>Anyone who thinks that Linux is right for storing UTC should set all the clocks in their house to UTC. It would have been better to come up with a protocol for marking whether the RTC has already been adjusted for DST.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1086983">
				<div id="div-comment-1086983" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Neil</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086983">
			November 2, 2013 at 3:53 am</a>		</div>

		<p>smf: Does bit 1 of CMOS byte 0x0B do what you want?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1086993">
				<div id="div-comment-1086993" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">jwatt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1086993">
			November 2, 2013 at 5:48 am</a>		</div>

		<p>What is the intention of the SVG &#39;switch&#39; element in the markup of this post? Only one of the direct children of a switch should be showing at once, but you seem to be relying on a bug in IE which means that both direct children show. Firefox obeys the spec, so your diagram doesn&#39;t show correctly there. It&#39;d at least be interesting to know why you&#39;re using &#39;switch&#39;.</p>
<div class="post">[<em>IE correctly shows only one of the switch children. I am using a switch so that I can show HTML arrows only on browsers that don&#39;t support SVG. -Raymond</em>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1087003">
				<div id="div-comment-1087003" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">jwatt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1087003">
			November 2, 2013 at 5:52 am</a>		</div>

		<p>To be clear, you seem to be wanting both direct children of the &#39;switch&#39; to show, so I don&#39;t understand why you&#39;ve wrapped them in a &#39;switch&#39; element. The only effect seems to be to break the diagrams for non-IE, spec compliant browsers. Spec text is here: <a href="http://www.w3.org/TR/SVG11/struct.html#SwitchElement" rel="nofollow" target="_new">http://www.w3.org/&#8230;/struct.html</a></p>
<div class="post">[<em>I want only one of the switches to display. One draws the arrows via SVG. The other draws the arrows via Unicode. I like how people ascribe to malice what can be more easily explained by stupidity. -Raymond</em>]</div>
<div class="post">[<em>I want only one. The HTML should appear in browsers which don&#39;t support SVG, and the SVG should appear in browsers that do. Otherwise, you get double sets of arrows. -Raymond</em>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1087013">
				<div id="div-comment-1087013" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Toby</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1087013">
			November 2, 2013 at 7:32 am</a>		</div>

		<p>Using GetSystemTime followed by SystemTimeToFileTime is useful if you want to write code which works on both desktop Windows and Windows CE.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1087023">
				<div id="div-comment-1087023" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Neil</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1087023">
			November 2, 2013 at 10:59 am</a>		</div>

		<p>The &lt;g&gt; draws some nice arrows when I delete the &lt;foreignObject&gt; so I don&#39;t know why the latter exists at all.</p>
<p>Chrome appears to render the &lt;foreignObject&gt; (which is a set of text arrow characters) with a 100% width and height, while Firefox defaults to zero width and height, which is why it doesn&#39;t show anything at all.</p>
<div class="post">[<em>It&#39;s there for browser which don&#39;t support SVG. I tweaked it and I think it&#39;s better now. (I find it interesting that nobody seemed too upset that three browsers all disagree on the behavior here.) -Raymond</em>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1087033">
				<div id="div-comment-1087033" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">voo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1087033">
			November 2, 2013 at 4:38 pm</a>		</div>

		<p>@smf: I assume you&#39;re also complaining to intel why they implemented binary arithmetic because hey nobody does their math in binary? Talk about apologists..</p>
<p>Storing the time in UTC avoids the usual problems with several OSes as well as DST. And computers are surprisingly capable of converting the UTC to the user&#39;s local time before displaying it (I know it&#39;s amazing).</p>
<p>Heck Windows stores the time internally as UTC anyhow. The only reason it&#39;s still stored in local time is backcomp with earlier versions and I don&#39;t see that changing anytime soon :(</p>
<div class="post">[<em>BIOSes are not very good at converting between UTC and local time. It&#39;s not like Phoenix sends out firmware updates every time Brazil changes a time zone rule. -Raymond</em>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1087053">
				<div id="div-comment-1087053" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Kapil_K</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1087053">
			November 3, 2013 at 1:08 am</a>		</div>

		<p>I believe you start with offering the user a full screen modal dialog asking them the time required for their daily commute. Then you try to get their email address from outlook or windows contacts and &nbsp;stick it into linkedin&#39;s web API to find their place of work. Next you get the traffic congestion and traffic speed limit information from google maps and calculate an approximate perimeter of their location. Next you record background noise from their microphone to determine proximity to a freeway, playground, etc and narrow down the location. Once you&#39;re close enough, pick the location that rhymes with awesome. Now that you have the location, its time to find the time. Approximate the earths location in time by running a big-bang simulation using location information determined earlier. To get current state of the universe, reflash the the wi-fi radio firmware to pickup the cosmic microwave background radiation. You now have the local time. Now.. I know what you&#39;re thinking. This still leaves one more important thing to consider. If we get rid of the SYSTEMTIME input parameter, how many apps will it break? Sorry.. you have to think about that yourself.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1087073">
				<div id="div-comment-1087073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Deduplicator</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1087073">
			November 3, 2013 at 9:44 am</a>		</div>

		<p>BIOSes don&#39;t do any time conversion? Nice to know.</p>
<p>I thought in addition to thoroughly and layman-compatibly explaining all their myriad options they could auto-config everything and certainly do that trivial time-adjustment.</p>
<p>You really seriously suppose that displaying the local time together with all these unexplained arcanae is such a clear win as to outshine any disadvantages regarding multiboot/dst/rescue-systems/uniform treatment of time offsets?</p>
<p>Then why doesn&#39;t windows consequently do it for NTFS and ban all UTC functions?</p>
<p>Well, mostly I woulddn&#39;t actually care that much, if RealtimeIsUniversal was officially supported and completely worked in Windows. That way anyone needing or wanting sensible behavior could get it. It doesn&#39;t though, at least till Win7. Is it any better for Win8?</p>
<p>As a bonus, whenever RealtimeIsUniversal is activated/gets mandatory one can drop the auto-set DST checkbox.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1087103">
				<div id="div-comment-1087103" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">voo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1087103">
			November 3, 2013 at 5:40 pm</a>		</div>

		<p>[BIOSes are not very good at converting between UTC and local time. It&#39;s not like Phoenix sends out firmware updates every time Brazil changes a time zone rule. -Raymond]</p>
<p>I&#39;m not talking about the BIOS, I&#39;m talking about the OS. Sure the BIOS would show the UTC time, but then what? It&#39;s not as if your average user would just stumble into the BIOS and be surprised that some field called &quot;UTC&quot; wouldn&#39;t show her local time.</p>
<p>Heck they&#39;ll be a whole lot more confused by all the other cryptic fields they&#39;ll see in there. PCIE clock, CPU clock ratio, CPU northbridge frequency, HT link width,.. your average user will be confused by every single one of those settings &#8211; on the other hand a reasonably educated person should know very well what UTC is (just tested it with a friend who&#39;s studying psychology and econ, she didn&#39;t seem very confounded &#8211; well apart from me asking her such a thing out of the blue).</p>
<div class="post">[<em>&quot;When I turn on my computer, it told me CMOS battery failure, and then asked me to enter the current time in UTC. I didn&#39;t understand the question, so I just entered the current time. How was I supposed to know I needed to enter the current time in Iceland!?&quot; -Raymond</em>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1087163">
				<div id="div-comment-1087163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Muzer</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1087163">
			November 4, 2013 at 5:22 am</a>		</div>

		<p>&#39;I&#39;m not talking about the BIOS, I&#39;m talking about the OS. Sure the BIOS would show the UTC time, but then what? It&#39;s not as if your average user would just stumble into the BIOS and be surprised that some field called &quot;UTC&quot; wouldn&#39;t show her local time.&#39;</p>
<p>According to previous posts on this blog, they do &#8211; or at least, used to.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1087183">
				<div id="div-comment-1087183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Marc K</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1087183">
			November 4, 2013 at 6:10 am</a>		</div>

		<p>Alex Trebek: &quot;The API call that returns the time format used internally by the operating system and doesn&#39;t involve a data conversion:</p>
<p>Get­System­Time­As­File­Time</p>
<p>Get­System­Time </p>
<p>Get­Local­Time&quot;</p>
<p>Contestant: &quot;What is Get­System­Time, Alex?&quot;</p>
<p>Alex Trebek: &quot;Oh, I&#39;m sorry. &nbsp;That&#39;s going to cost you.&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-hankhein even thread-even depth-1" id="comment-1087403">
				<div id="div-comment-1087403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Henri+Hein' rel='external nofollow' class='url'>Henri Hein</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1087403">
			November 4, 2013 at 11:44 am</a>		</div>

		<p>@Maurits: thanks. &nbsp;I knew about the upper right, but sometimes when I log in, not all the elements on the page refresh. &nbsp;(In general, not specifically on MSDN). &nbsp;Before refreshing like crazy, it&#39;s nice to know if there is a point to it or not. &nbsp;Now I know what to look for, at least on MSDN blogs.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1087433">
				<div id="div-comment-1087433" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">DWalker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20131101-00/?p=2763#comment-1087433">
			November 4, 2013 at 1:40 pm</a>		</div>

		<p>@V-SHorn: &nbsp;Well, I was going to call it the 3nd line, but that wouldn&#39;t work. &nbsp;Maybe I&#39;ll have my line numbers start at -1 from now on. &nbsp;:-)</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>