<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (23)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-1164343">
				<div id="div-comment-1164343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Arde</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164343">
			November 28, 2014 at 9:09 pm</a>		</div>

		<p>Is there a book on Windows Security programming which explains the security / crypto API? Or rather gives a overview of the best practices? My search turned up nothing useful. MSDN is good for the nitty-gritties, but not for the overall big picture and best practices</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1164353">
				<div id="div-comment-1164353" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dioksin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164353">
			November 30, 2014 at 2:47 am</a>		</div>

		<p>Arde, look at this book &quot;Programming Windows Security&quot; by Keith Brown</p>
<p><a rel="nofollow" target="_new" href="http://www.amazon.com/Programming-Windows-Security-Keith-Brown/dp/0201604426">http://www.amazon.com/&#8230;/0201604426</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1164363">
				<div id="div-comment-1164363" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">stickboy</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164363">
			November 30, 2014 at 12:29 pm</a>		</div>

		<p>Why can&#39;t local users make use of SID history? &nbsp;What are home users supposed to do when buying a new computer and trying to access data on external storage? &nbsp;All of this SID business is incredibly convoluted and hard for anyone to get right. &nbsp;It seems like it&#39;d be simpler to allow administrators to explicitly set a user&#39;s SID at account creation time; local administrators can already reset the ownership/permissions on local files anyway.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cheong odd alt thread-odd thread-alt depth-1" id="comment-1164373">
				<div id="div-comment-1164373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/cheong00' rel='external nofollow' class='url'>cheong00</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164373">
			November 30, 2014 at 6:00 pm</a>		</div>

		<p>@stickboy: In local account case, if your user account migration tool is doing things right, the objects transferred to new computer should already be under the new SID, therefore no SID history is needed.</p>
<p>In the case where Active Directory is involved, since the other machines may not be switched on at the time of SID change, therefore SID history would be necessary.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cheong even thread-even depth-1" id="comment-1164383">
				<div id="div-comment-1164383" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/cheong00' rel='external nofollow' class='url'>cheong00</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164383">
			November 30, 2014 at 6:03 pm</a>		</div>

		<p>As for allow administrators to explicitly set user SID, just imagine what happens if you accidentally (or intentionally) choose to create an account with the same SID as someone in domain, or for more complicated cases, a trusted domain in different forest.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1164403">
				<div id="div-comment-1164403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">kermi</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164403">
			December 1, 2014 at 4:51 am</a>		</div>

		<p>I believe in the case of home users and USB drives, the default NTFS permissions grant RWX permissions to the Users group, which all users are part of by default. Changing computers should not cause problems accessing data, unless you have modified the permissions by hand.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1164453">
				<div id="div-comment-1164453" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Avenida</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164453">
			December 1, 2014 at 9:18 am</a>		</div>

		<p>I like that you used e and pi as your placeholder numbers.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-zlynx odd alt thread-odd thread-alt depth-1" id="comment-1164473">
				<div id="div-comment-1164473" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Zan+Lynx%27' rel='external nofollow' class='url'>Zan Lynx'</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164473">
			December 1, 2014 at 10:57 am</a>		</div>

		<p>@Engywuck: There&#39;s a security reason for it? I can&#39;t imagine&#8230;</p>
<p>As you say, an Admin can overwrite the file permissions. Lesser known methods include using impersonation to read the files without touching the ownership or attaching the disk to a Linux machine and reading it as root.</p>
<p>Being able to add an old identity to your current identity seems much more secure than those other options.</p>
<div class="post">[<em>Suppose you connect to a network resource and hand it your token. &quot;Hello, this is WORKGROUPzan, but I used to be known as REDMONDbillg, so, y&#39;know, let me access anything that REDMONDbillg can.&quot; -Raymond</em>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1164393">
				<div id="div-comment-1164393" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Engywuck</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164393">
			December 1, 2014 at 3:20 am</a>		</div>

		<p>@cheong00: probably stickboy meant NTFS-formatted external (USB-)drives, which obviously get the SID from the local system, but may or may not be accessible at time of migration.</p>
<p>Those media usually aren&#39;t fully usable on other computers anyway, but this may be OK. Otherwise you&#39;d have to use a filesystem like FAT which is writable for anyone accessing the device, but if you don&#39;t want to use ExFAT there are some limits in using it (file size and maximum file system (formatting) size being the worst)</p>
<p>When you migrate the computer (or as most do (re)install) with new OS your old SID are lost and you *have* to go the hard way to access the NTFS-formatted external media (make yourself Owner, then hammer your access through and give new ACLs). There&#39;s no (obvious) way to say the computer &quot;oh, btw, I was S-1-5-21-OLDCOMP-1034 before you even existed&quot;. Of course, there&#39;s a security reason for that, but I see the problem it may cause. &nbsp;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1164513">
				<div id="div-comment-1164513" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">foo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164513">
			December 1, 2014 at 3:33 pm</a>		</div>

		<p>@Avenida. Hah neat! I skimmed too fast to notice that. But now I see that the 1-5-21 part == binary 1, 101, 10101 sequence.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1164443">
				<div id="div-comment-1164443" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164443">
			December 1, 2014 at 8:14 am</a>		</div>

		<p>@kermi: I&#39;ll bet it does *now* but it didn&#39;t always.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cheong odd alt thread-odd thread-alt depth-1" id="comment-1164523">
				<div id="div-comment-1164523" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/cheong00' rel='external nofollow' class='url'>cheong00</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164523">
			December 1, 2014 at 5:15 pm</a>		</div>

		<p>@Engywuck: Hope you&#39;re aware that &quot;convert.exe&quot; has an option named &quot;/NoSecurity&quot; that&#39;d allow all users full access right to the filesystem.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1164533">
				<div id="div-comment-1164533" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Engywuck</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164533">
			December 1, 2014 at 11:25 pm</a>		</div>

		<p>convert.exe only converts from FAT to NTFS, right? But now you have a &#8211; say &#8211; 64GB USB Stick (or an external HDD) and want to use it. Happy formatting to FAT32 with windows included tools before converting with convert.exe :-)</p>
<p>@foo: nice find. Never thought about the numbers before &#8211; in hex it&#39;s even better: S-0x1-0x5-0x15 :-)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1164563">
				<div id="div-comment-1164563" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">kermi</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164563">
			December 2, 2014 at 4:36 am</a>		</div>

		<p>@Joshua</p>
<p>Wonder how much time back do we have to go for that not to have happened. As far as i can recall, it hasnt&#39; been issue in the 21st century..</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1164623">
				<div id="div-comment-1164623" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164623">
			December 2, 2014 at 8:19 am</a>		</div>

		<p>@kermi: Windows 2000 did it wrong for sure. I think early XP as well (fixed in SP1?).</p>
<p>[Suppose you connect to a network resource and hand it your token. &quot;Hello, this is WORKGROUPzan, but I used to be known as REDMONDbillg, so, y&#39;know, let me access anything that REDMONDbillg can.&quot; -Raymond]</p>
<p>Non-issue as SIDs don&#39;t cross like that. I can generate token for REDMONDbillg SID directly on a workstation but it doesn&#39;t work cross-network either. The only machines that can set it up are the machine it&#39;s expected to work on are the machine interpreting the SID or the domain controller thereof.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-fjeldse odd alt thread-odd thread-alt depth-1" id="comment-1164703">
				<div id="div-comment-1164703" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Erik+F' rel='external nofollow' class='url'>Erik F</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164703">
			December 2, 2014 at 3:06 pm</a>		</div>

		<p>External trusts add another level of complexity as SIDs are quarantined by default, which may prevent SID histories from authenticating resources (see <a rel="nofollow" target="_new" href="http://technet.microsoft.com/en-us/library/cc755321%28v=ws.10%29.aspx">technet.microsoft.com/&#8230;/cc755321%28v=ws.10%29.aspx</a> : it&#39;s an interesting read!)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1164713">
				<div id="div-comment-1164713" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164713">
			December 2, 2014 at 4:07 pm</a>		</div>

		<p>Wow, the guy who wrote that document actually believes that making it difficult to modify the OS (by means of a disk editor) is a practical security measure. The attack may be difficult but if made attractive somebody will release the tool, just like the password reset tool was released.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cheong odd alt thread-odd thread-alt depth-1" id="comment-1164753">
				<div id="div-comment-1164753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/cheong00' rel='external nofollow' class='url'>cheong00</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164753">
			December 2, 2014 at 5:23 pm</a>		</div>

		<p>@Engywuck: Not only from FAT to NTFS, also from NTFS to &quot;NTFS with full access to everyone&quot;. I&#39;m pretty sure I&#39;ve done this a few time with my flash drives before.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cheong even thread-even depth-1" id="comment-1164773">
				<div id="div-comment-1164773" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/cheong00' rel='external nofollow' class='url'>cheong00</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164773">
			December 2, 2014 at 5:39 pm</a>		</div>

		<p>Btw, even without that tool, nothing blocks you to give full access to &quot;Authenticated Users&quot; &#8211; it&#39;s SID is the same for all system ( <a rel="nofollow" target="_new" href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa379649(v=vs.85).aspx">msdn.microsoft.com/&#8230;/aa379649(v=vs.85).aspx</a> ) to the base folder of the flash drive, and let folders inherit that access.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1164803">
				<div id="div-comment-1164803" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">kermi</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164803">
			December 2, 2014 at 9:41 pm</a>		</div>

		<p>@Joshua</p>
<p>Well it wasn&#39;t really a problem on XP, since admins have full controll over everything, and everyone was part of admin group :D</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1164813">
				<div id="div-comment-1164813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ROT-13</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164813">
			December 2, 2014 at 10:01 pm</a>		</div>

		<p>Well thank goodness I encrypt all me lucky charms.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1164833">
				<div id="div-comment-1164833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Engywuck</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164833">
			December 3, 2014 at 12:29 am</a>		</div>

		<p>@cheong00: &quot;Volume M: is already a NTFS-Filesystem&quot; (translated) &#8211; so convert.exe really only likes FAT, at least on Win7</p>
<p>I&#39;ve also tested the whole NTFS formatting on external drives with Win7 Pro:</p>
<p>&#8211; on USB sticks it sets Everyone: (OI)(CI)(F) (&quot;Full Access, Inheritable&quot;)</p>
<p>&#8211; on external (USB-)HDDs it sets Administrators and SYSTEM: (F) and (OI)(CI)(IO)(F) [Full, Inheritable], Authenticated Users: (M) and (OI)(CI)(IO)(M) [Modify, Inheritable], Users: (RX) and (OI)(CI)(IO)(GR,GE) [Read, Execute, Inheritable]</p>
<p>I concur now that everyone should be able to use it on any computer by default. Could have sworn it wasn&#39;t like that, but maybe I (mis)remember some XP formatted drive. If that&#39;s the case then it&#39;s an example of the many small changes to make Windows better with each new iteration that nobody really notices ;-)</p>
<p>Can&#39;t test with Win8 or Server 2k12 right now &#8211; all machines are virtual :-)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-fjeldse even thread-even depth-1" id="comment-1164863">
				<div id="div-comment-1164863" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Erik+F' rel='external nofollow' class='url'>Erik F</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141128-00/?p=43513#comment-1164863">
			December 3, 2014 at 3:24 am</a>		</div>

		<p>@Engywuck: I&#39;m pretty sure that devices recognized as HDDs have always had stricter permissions on the assumption that they are not shared between computers; a system partition with Everyone: (OI)(CI)(F) at the root seems like a bad idea IMO. You can always do &quot;cacls m: /g everyone:f&quot; to get the effect that you want in any case.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>