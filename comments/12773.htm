<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (8)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-862513">
				<div id="div-comment-862513" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Christopher Walken</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100923-00/?p=12773#comment-862513">
			September 23, 2010 at 7:14 am</a>		</div>

		<p>Excellent post Raymond. We are always grateful when you explain in detail the mysterious shenanigans that go on in the background of GDI. Thanks!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-862593">
				<div id="div-comment-862593" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">steven</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100923-00/?p=12773#comment-862593">
			September 23, 2010 at 8:30 am</a>		</div>

		<p>Very insightful post, as usual. I think this explains why I had trouble with bit of a GDI-drawn logo being missing when saving the DIB section to a custom file format. I wish I&#39;d found the GdiFlush function back then rather than the embarrassing workaround I ended up using.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-862623">
				<div id="div-comment-862623" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ivo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100923-00/?p=12773#comment-862623">
			September 23, 2010 at 9:11 am</a>		</div>

		<p>The docs for GdiFlush say that &quot;Calling any GDI function that does not return a Boolean value&quot; will flush GDI. Does &quot;GDI function&quot; mean &quot;a function from Gdi32.lib&quot;? Will SelectObject or GetCurrentObject cause a flush, and if so &#8211; why?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-862633">
				<div id="div-comment-862633" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Bob</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100923-00/?p=12773#comment-862633">
			September 23, 2010 at 9:32 am</a>		</div>

		<p>You also have to call GdiFlush if you pass GDI objects between threads, even if you don&#39;t access the bitmap directly (the batching is per thread, so if thread A uses a GDI object and then passes it to thread B w/o calling GdiFlush, thread B doesn&#39;t know that there are still pending operations on it).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-862793">
				<div id="div-comment-862793" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100923-00/?p=12773#comment-862793">
			September 23, 2010 at 3:21 pm</a>		</div>

		<p>Then when will the graphic subsystem in windows be thread safe?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-862863">
				<div id="div-comment-862863" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Simon Buchan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100923-00/?p=12773#comment-862863">
			September 23, 2010 at 6:44 pm</a>		</div>

		<p>@640k: A bit after that ever becomes a good idea for immediate mode rasterizers.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-862923">
				<div id="div-comment-862923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Neil</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100923-00/?p=12773#comment-862923">
			September 24, 2010 at 3:31 am</a>		</div>

		<p>The last time I had to use GdiFlush was to port Mozilla 1.7 to run on Windows NT 3.51, whose batching was more aggressive than that in later versions of Windows.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-863403">
				<div id="div-comment-863403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Worf</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20100923-00/?p=12773#comment-863403">
			September 24, 2010 at 10:56 pm</a>		</div>

		<p>@Neil &#8211; makes sense as graphicx drivers in NT 3.5 series were user mode, so GDI operations had to undergo kernel task switches. Doing this for every GDI call would just bog things to the point of unusability with all the IPC going on.</p>
<p>NT 4 onwards moved the display driver into the kernel, so things were much faster and thus, less batching is needed as each call is faster.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>