<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (18)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-942933">
				<div id="div-comment-942933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Damien</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-942933">
			October 26, 2011 at 7:07 am</a>		</div>

		<p>Exercise 2: I&#39;d guess that the window isn&#39;t destroyed at this point, only hidden, since after you dismiss the error message, the run dialog reappears.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-942953">
				<div id="div-comment-942953" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Bob</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-942953">
			October 26, 2011 at 7:22 am</a>		</div>

		<p>Exercise 1: &nbsp;A thread can have more than one window and we can&#39;t restrict the callback to only one window.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-942963">
				<div id="div-comment-942963" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Niels</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-942963">
			October 26, 2011 at 7:25 am</a>		</div>

		<p>Exercise 1: We registered for events for all windows owned by that thread, not one particular window. Better check it really is that event we wanted before acting on it.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-942983">
				<div id="div-comment-942983" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">parkrrrr</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-942983">
			October 26, 2011 at 8:05 am</a>		</div>

		<p>Exercise 1: EVENT_OBJECT_DESTROY is fired for the caret object, so we&#39;ll get one when focus leaves the edit box.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-943053">
				<div id="div-comment-943053" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">aolszowka</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-943053">
			October 26, 2011 at 11:28 am</a>		</div>

		<p>Raymond I love these automation related articles! I&#39;ve been working on a project where we&#39;ve been doing a bit of this to black box test our application. While the UIAutomation Framework provided by Microsoft is great, it doesn&#39;t cover all of our use cases and sometimes we end up having to roll our own.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-943073">
				<div id="div-comment-943073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">WS</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-943073">
			October 26, 2011 at 11:48 am</a>		</div>

		<p>INDEXID_CONTAINER==INDEXID_OBJECT==CHILDID_SELF, but why so many names for the same thing?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-943083">
				<div id="div-comment-943083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-943083">
			October 26, 2011 at 11:56 am</a>		</div>

		<p>Hmmm.</p>
<p>This seems somewhat of a dangerous procedure if you expect it to work across version upgrades, documented or not.</p>
<p>Then again, maybe expecting this kind of automation to work across version upgrades is the dangerous idea.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-chuckop odd alt thread-odd thread-alt depth-1" id="comment-943103">
				<div id="div-comment-943103" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/ChuckOp' rel='external nofollow' class='url'>ChuckOp</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-943103">
			October 26, 2011 at 12:39 pm</a>		</div>

		<p>Good ole WinEventHook (LauraBu and I share a couple of patents on that multi-headed monster). &nbsp;Going places where CBT Hooks would never dare to tread.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-943133">
				<div id="div-comment-943133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Aaron.E</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-943133">
			October 26, 2011 at 2:47 pm</a>		</div>

		<p>@JamesJohnston: &nbsp;I think you have the right idea, but the example code you posted doesn&#39;t quite make sense to me. &nbsp;When an error is dismissed by the user, the Run window is displayed again. &nbsp;Immediately afterward, UnloadRunWindow() is called. &nbsp;Did you intend to have a return statement at the end of the if block?</p>
<p>Another clue for this behavior might be that the run window fades in when &quot;Run&quot; is clicked from the start menu (with Aero anyway), but when the error is dismissed, the run window appears immediately.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-943013">
				<div id="div-comment-943013" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/johnstonj_4000_inn_2D00_soft.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>johnstonj@inn-soft.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-943013">
			October 26, 2011 at 9:54 am</a>		</div>

		<p>Exercise 2: &nbsp;Open Run, type some garbage into edit control and click OK. &nbsp;Error message appears. &nbsp;After the error message goes away, Run dialog reappears in *exactly the same position that you left it when you clicked OK.* &nbsp;It&#39;s obvious that the code in Run might look like this:</p>
<p>void OKClicked() {</p>
<p> &nbsp; &nbsp;SetRunWindowVisible(false);</p>
<p> &nbsp; &nbsp;if (!ShellExecuteEx(&#8230;)) {</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;ShowLastError();</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;SetRunWindowVisible(true);</p>
<p> &nbsp; &nbsp;}</p>
<p> &nbsp; &nbsp;UnloadRunWindow();</p>
<p>}</p>
<p>Therefore, the test program won&#39;t unload until you click Cancel, or the Run dialog succeeds in starting a program. &nbsp;If you want your test program to close, you&#39;d need to check for a different event (maybe EVENT_OBJECT_HIDE ?) in addition to the EVENT_OBJECT_DESTROY event.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-943143">
				<div id="div-comment-943143" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">lixiong</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-943143">
			October 26, 2011 at 7:15 pm</a>		</div>

		<p>I think a better and formal way is to use UIAutomation API, which really means accessibility.</p>
<p>Try WindowPattern.WindowClosedEvent:</p>
<p><a rel="nofollow" target="_new" href="http://msdn.microsoft.com/en-us/library/system.windows.automation.windowpattern.windowclosedevent.aspx" rel="nofollow">msdn.microsoft.com/&#8230;/system.windows.automation.windowpattern.windowclosedevent.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-943183">
				<div id="div-comment-943183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nick</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-943183">
			October 27, 2011 at 2:39 am</a>		</div>

		<p>@JamesJohnston: Raymond correct me if I&#39;m wrong but I believe EVENT_OBJECT_HIDE is only for cursors&#8230; (i.e. not fired if a window is hidden)&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-943363">
				<div id="div-comment-943363" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/johnstonj_4000_inn_2D00_soft.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>johnstonj@inn-soft.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-943363">
			October 27, 2011 at 11:03 am</a>		</div>

		<p>@Aaron: &quot;Did you intend to have a return statement at the end of the if block?&quot; &#8211; yes, I did mean to have that &#8211; oops!</p>
<p>Good catch with the window fading &#8211; I never noticed that subtle behavior before!</p>
<p>@Nick: &nbsp;I was only stabbing at suspiciously-named events without reading documentation. :) &nbsp;(My point being that there&#39;s probably something else in there that can be monitored if somebody wants to read through all the docs).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-943543">
				<div id="div-comment-943543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">parkrrrr</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-943543">
			October 28, 2011 at 7:05 am</a>		</div>

		<p>@JamesJohnston: Don&#39;t worry; Nick&#39;s wrong: EVENT_OBJECT_HIDE does fire for windows.</p>
<p>And for the various commenters who are treating SetWinEventHook as if it were some sort of scary undocumented hack: MSAA has been documented since before Windows 98 shipped. It&#39;s not new, it&#39;s not a hack, and it&#39;s not scary. And unlike UIA, it works on every version of NT since NT4 SP6.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-943553">
				<div id="div-comment-943553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nick</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-943553">
			October 28, 2011 at 7:21 am</a>		</div>

		<p>@parkrrr: <a rel="nofollow" target="_new" href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd318066%28v=vs.85%29.aspx" rel="nofollow">msdn.microsoft.com/&#8230;/dd318066%28v=vs.85%29.aspx</a></p>
<p>My interpretation of the documentation says that the system does not send EVENT_OBJECT_HIDE for windows:</p>
<p>&quot;An object is hidden. The system sends this event for the following user interface elements: caret and cursor.&quot;</p>
<p>Could we get some clarification here Raymond?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-943603">
				<div id="div-comment-943603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Tergiver</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-943603">
			October 28, 2011 at 8:04 am</a>		</div>

		<p>Wouldn&#39;t the lighter-weight CBTHook be a better choice if all you want to know is when a window is destroyed?</p>
<p>[<i>CBTHook is really heavy. It gets called for <span style="text-decoration:underline;">every</span> window, and for many more events than just window destruction, and they are synchronous rather than asynchronous. -Raymond</i>]</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-943703">
				<div id="div-comment-943703" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">parkrrrr</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-943703">
			October 28, 2011 at 11:53 am</a>		</div>

		<p>@Nick: regardless of what the documentation says, EVENT_OBJECT_HIDE is indeed sent for windows, and always has been. Microsoft provides a tool called AccEvent that can be used to verify this. Note, too, that EVENT_OBJECT_SHOW <em>is</em> documented to fire for windows. I suspect a documentation error.</p>
<p>(And I think ChuckOp, above, is the guy who could confirm or deny this better than Raymond.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-943713">
				<div id="div-comment-943713" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">parkrrrr</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20111026-00/?p=9263#comment-943713">
			October 28, 2011 at 12:04 pm</a>		</div>

		<p>I found a possible reason for the documentation and the reality disagreeing here: the MSAA 1.3 documentation also said &quot;This event is not sent consistently by the system. This is a known problem and is being addressed.&quot; So it&#39;s possible that they elected to not document the window behavior, since it couldn&#39;t be counted on.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>