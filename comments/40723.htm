<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (15)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-141403">
				<div id="div-comment-141403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/mnolton' rel='external nofollow' class='url'>Mathew Nolton</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040206-00/?p=40723#comment-141403">
			February 6, 2004 at 7:33 am</a>		</div>

		<p>Turn away from the darkside young skywalker. Walk into the light ;)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-141413">
				<div id="div-comment-141413" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">geraldH</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040206-00/?p=40723#comment-141413">
			February 6, 2004 at 9:14 am</a>		</div>

		<p>Note: Diagram only visible in Internet Explorer. Mozilla and Opera won&#8217;t display any arrows nor the right structure.</p>
<p>Please, Raymond&#8230; next time, use a format everybody can see?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-141423">
				<div id="div-comment-141423" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/jeffdav' rel='external nofollow' class='url'>jeffdav</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040206-00/?p=40723#comment-141423">
			February 6, 2004 at 10:33 am</a>		</div>

		<p>Hm.  I always wondered how that worked.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-141433">
				<div id="div-comment-141433" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jim Causey</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040206-00/?p=40723#comment-141433">
			February 6, 2004 at 11:24 am</a>		</div>

		<p>Raymond&#8217;s diagrams work just fine in Mozilla Firebird; maybe you need to upgrade your browser?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-141443">
				<div id="div-comment-141443" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">rfredell</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040206-00/?p=40723#comment-141443">
			February 6, 2004 at 12:44 pm</a>		</div>

		<p>Works fine in Mozilla 1.6 too.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-141463">
				<div id="div-comment-141463" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">brion</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040206-00/?p=40723#comment-141463">
			February 6, 2004 at 4:35 pm</a>		</div>

		<p>No arrows in Mozilla 1.6 here (tested Win98 and Mac OS X). Positioning of the cells looks okay, but it&#8217;s kind of unclear without the arrows.</p>
<p>For one thing I suspect that Mozilla doesn&#8217;t believe it&#8217;s kosher to slip XML into a document which isn&#8217;t parsable as well-formed XML and is labeled clearly as HTML 4.0 Transitional to boot. ;)<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-141483">
				<div id="div-comment-141483" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040206-00/?p=40723#comment-141483">
			February 7, 2004 at 11:24 pm</a>		</div>

		<p>Sorry, I thought it was well-formed XML. Aside from a missing &lt;/TD&gt; in the first table, everything seems to parse okay.  What did I mess up?</p>
<p>&lt;v:shapetype id=&quot;arrow&quot; coordsize=&quot;1,1&quot;<br />
<br /> strokecolor=&quot;black&quot; strokeweight=&quot;1pt&quot;&gt;<br />
<br /> &lt;v:stroke endarrow=&quot;classic&quot; /&gt;<br />
<br /> &lt;v:path v=&quot;m0,0 l 100,0 e&quot; /&gt;<br />
<br />&lt;/v:shapetype&gt;<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-141493">
				<div id="div-comment-141493" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">brion</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040206-00/?p=40723#comment-141493">
			February 8, 2004 at 2:55 am</a>		</div>

		<p>The page as a whole declares itself to be HTML 4.0 Transitional, but doesn&#8217;t validate as either HTML 4.0 or XML. (Try validator.w3.org&#8230; it&#8217;s very nitpicky!)</p>
<p>However, as far as I can tell nothing supports VML except IE/Win anyway.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-141513">
				<div id="div-comment-141513" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040206-00/?p=40723#comment-141513">
			February 8, 2004 at 7:56 am</a>		</div>

		<p>Alas, the claim to be HTML 4.0 Transitional is coming from the blog software, not from me.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-141583">
				<div id="div-comment-141583" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://alias:ndiamond@msdn.discussions.microsoft.com' rel='external nofollow' class='url'>Norman Diamond</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040206-00/?p=40723#comment-141583">
			February 8, 2004 at 7:30 pm</a>		</div>

		<p>No arrows here in Internet Explorer,<br />
<br />Version: 6.0.2800.1106.xpsp2.030422-1633<br />
<br />[&#8230;]<br />
<br />???????:; SP1; 3823; Q330994; Q824145; Q832894;</p>
<p>(Also I really love how Internet Explorer lets me read that information and type it back in myself at the keyboard.  If I had to use the mouse to copy and paste, it would be too easy.  Internet Explorer is as helpful as Visual Studio .NET 2003 is in this regard.)<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-141603">
				<div id="div-comment-141603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Fuggles</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040206-00/?p=40723#comment-141603">
			February 8, 2004 at 9:15 pm</a>		</div>

		<p>If one is interested in the underlying COM mechanisms it is useful to read the &#8216;COM Programmer&#8217;s Cookbook&#8217; as samples are largely provided in C. This removes the fog of the underlying compiler tricks.</p>
<p><a target="_new" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dncomg/html/msdn_com_co.asp" rel="nofollow">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dncomg/html/msdn_com_co.asp</a></p>
<p>The layout of CSample as a C struct would be:</p>
<p>typedef struct {<br />
<br />	IPersist IPersistIFace;<br />
<br />	IQueryService IQueryServiceIFace</p>
<p>	LONG m_cRef;<br />
<br />} CSample;</p>
<p>The author provides an &#8216;adjustor thunk macro&#8217;. So to implement the thunk function for IQueryService::QueryInterface:</p>
<p>STDMETHODIMP IQS_QueryInterface(IQueryService * This, REFIID riid, void ** ppv)<br />
<br />{<br />
<br />	CSample * ThisObj = IMPL (CSample, IQueryServiceIFace, This);</p>
<p>	return CSBase_QueryInterface(ThisObj, riid, ppv);<br />
<br />}</p>
<p>The definition for IMPL is essentially:<br />
<br />#define IMPL(class, member, pointer)<br />
<br />((class *) (((long) pointer) &#8211; offsetof (class, member)))</p>
<p>So:</p>
<p>CSample * ThisObj = This &#8211; 4;</p>
<p>The author also provides a FindImpl function which relieves us from having to include these thunk functions by &#8216;searching&#8217; for the base class.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-141623">
				<div id="div-comment-141623" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040206-00/?p=40723#comment-141623">
			February 8, 2004 at 10:42 pm</a>		</div>

		<p>Aw phooey. I edited this entry to add the link, and in the process I destroyed the arrows. Let me fix them.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-267153">
				<div id="div-comment-267153" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/oldnewthing/archive/2005/03/24/401701.aspx' rel='external nofollow' class='url'>The Old New Thing</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040206-00/?p=40723#comment-267153">
			March 24, 2005 at 12:15 pm</a>		</div>

		
		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-496343">
				<div id="div-comment-496343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/oldnewthing/archive/2007/04/24/2252261.aspx' rel='external nofollow' class='url'>The Old New Thing</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040206-00/?p=40723#comment-496343">
			April 24, 2007 at 12:12 pm</a>		</div>

		<p>Use the vtable.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-601363">
				<div id="div-comment-601363" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/larryosterman/archive/2008/02/15/casting-from-one-interface-to-another.aspx' rel='external nofollow' class='url'>Larry Osterman's WebLog</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20040206-00/?p=40723#comment-601363">
			February 15, 2008 at 6:11 pm</a>		</div>

		<p>A co-worker came by to ask what he thought was a coding &quot;style&quot; question that turned into a correctness</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>