<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (6)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="/oldnewthing/20181228-00/?p=100585#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://blogs.msdn.microsoft.com/oldnewthing/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Foldnewthing%2F20181228-00%2F%3Fp%3D100585">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment byuser comment-author-matteo even thread-even depth-1" id="comment-1374735">
				<div id="div-comment-1374735" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Matteo+Italia' rel='external nofollow' class='url'>Matteo Italia</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20181228-00/?p=100585#comment-1374735">
			December 28, 2018 at 2:43 pm</a>		</div>

		<p>I have a long standing bug that really looks like this, let&#8217;s hope it&#8217;s something similar!</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/oldnewthing/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Foldnewthing%2F20181228-00%2F%3Fp%3D100585">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-ibookstein odd alt thread-odd thread-alt depth-1" id="comment-1374745">
				<div id="div-comment-1374745" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/DoomMuffins' rel='external nofollow' class='url'>DoomMuffins</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20181228-00/?p=100585#comment-1374745">
			December 29, 2018 at 12:31 am</a>		</div>

		<p>Exercise #1: I&#8217;m guessing the state provably has top 3 bytes all zero at that point, so it&#8217;s a viable code density optimization.<br />
Exercise #2: COMDAT folding merged the two instantiations of this templated function.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/oldnewthing/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Foldnewthing%2F20181228-00%2F%3Fp%3D100585">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-akraus1 even thread-even depth-1" id="comment-1374765">
				<div id="div-comment-1374765" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Alois' rel='external nofollow' class='url'>Alois</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20181228-00/?p=100585#comment-1374765">
			December 30, 2018 at 3:31 pm</a>		</div>

		<p>I think Exercise 2 is solved by DoomMuffins already.<br />
But Exercise 1 is different. The numbers put into [ebp-4] look like indicies to the guard clauses. The other 3 bytes are probably only there to check in the exception handler if a stack corruption did occur. If the other 3 bytes are non zero then the application should terminate hard without any exception unwinding to prevent reliability and security issues.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/oldnewthing/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Foldnewthing%2F20181228-00%2F%3Fp%3D100585">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-billy-oneal odd alt thread-odd thread-alt depth-1" id="comment-1374825">
				<div id="div-comment-1374825" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Billy.Oneal' rel='external nofollow' class='url'>Billy.Oneal</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20181228-00/?p=100585#comment-1374825">
			December 31, 2018 at 5:09 pm</a>		</div>

		<p>&gt; Fix the destructor so it doesn&#8217;t throw any exceptions.</p>
<p>Note that if this code wasn&#8217;t compiled in a nonstandard mode, they wouldn&#8217;t be able to throw exceptions, since destructors are noexcept by default in standard C++. I think lots of Windows though compiles with /Zc:implicitNoexcept- though.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/oldnewthing/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Foldnewthing%2F20181228-00%2F%3Fp%3D100585">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-dwalker-wk even thread-even depth-1" id="comment-1374985">
				<div id="div-comment-1374985" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/DWalker' rel='external nofollow' class='url'>DWalker</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20181228-00/?p=100585#comment-1374985">
			January 2, 2019 at 9:41 am</a>		</div>

		<p>The article already says &#8220;(This code is so old that it predates C++11&#8217;s rule that destructors are noexcept by default where possible.)&#8221;</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/oldnewthing/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Foldnewthing%2F20181228-00%2F%3Fp%3D100585">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-knapek-mar odd alt thread-odd thread-alt depth-1" id="comment-1375085">
				<div id="div-comment-1375085" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Marek+Kn%C3%A1pek' rel='external nofollow' class='url'>Marek Kn√°pek</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20181228-00/?p=100585#comment-1375085">
			January 3, 2019 at 10:09 am</a>		</div>

		<p>I had similar problem. AFX_MAINTAIN_STATE2 RAII-style-class failed to revert change of global variable inside COM interface function. That function was introduced by two weird macros (one for header file one for cpp, STDMETHOD and STDMETHODIMP) which added something like __declspec(nothrow) and extern &#8220;C&#8221; attributes to it. There was also try-catch-all block around all code inside the function. Yet still, there was a rare exception thrown and destructor of the RAII object was not called.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/oldnewthing/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Foldnewthing%2F20181228-00%2F%3Fp%3D100585">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>
<!-- COMMENTS END -->
</div></td></tr></table>