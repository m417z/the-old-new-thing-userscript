<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (3)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment byuser comment-author-wndsks even thread-even depth-1 parent" id="comment-1249765">
				<div id="div-comment-1249765" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/skSdnW' rel='external nofollow' class='url'>skSdnW</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20160520-00/?p=93497#comment-1249765">
			May 20, 2016 at 7:30 am</a>		</div>

		<p>A more interesting question is; when can you free the memory backing the HSTRING you created with WindowsCreateStringReference? </p>
<p>MSDN gives you a clue: &#8220;When passing a string reference into the Windows Runtime, it is the caller’s responsibility to ensure that the string’s contents are unchanging and NUL terminated for the duration of the call. The Windows Runtime releases all references to the string reference when the call returns.&#8221; It sounds pretty simple but all it takes is one bug somewhere in all of WinRT where someone forgets to duplicate a input string if they need said string later after the function has returned&#8230;</p>

		
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-fjeldse odd alt depth-2" id="comment-1249795">
				<div id="div-comment-1249795" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Erik+F' rel='external nofollow' class='url'>Erik F</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20160520-00/?p=93497#comment-1249795">
			May 20, 2016 at 9:00 am</a>		</div>

		<p>Reading between the lines, I think that this statement means that string references aren&#8217;t thread-safe. The recommended behaviour for creating a string reference appears to be to create the string on the stack, make a reference, use it, and then delete the reference before going out of scope. The implied rule for callees then is to make deep copies of passed-in HSTRINGs with WindowsDuplicateString (notice what happens if you give that function a reference.)</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-iboyd even thread-odd thread-alt depth-1" id="comment-1249805">
				<div id="div-comment-1249805" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/IanBoyd' rel='external nofollow' class='url'>IanBoyd</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20160520-00/?p=93497#comment-1249805">
			May 20, 2016 at 9:32 am</a>		</div>

		<p>It&#8217;s always nice to see the reasons *why* something the way it is. It makes it easier to reason about things probably work in future situations.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>