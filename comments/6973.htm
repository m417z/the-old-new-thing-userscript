<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (17)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-1002573">
				<div id="div-comment-1002573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">pete.d</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1002573">
			August 2, 2012 at 7:27 am</a>		</div>

		<p>Or, you could just call &quot;exit /b&quot; instead of &quot;exit&quot;.</p>
<p>And &quot;endlocal&quot; is optional before exiting the batch file. It&#39;s required only if you want to get your original environment back within the batch file for some reason.</p>
<p>Batch files are a great place to see lots of examples of stuff that was done wrong ages ago, but which can&#39;t be fixed due to backward compatibility issues.</p>
<p>E.g. it&#39;s silly that &quot;setlocal&quot; isn&#39;t the default; someone trying to write a batch file that permanently affects the CLI environment would notice right away if they forgot to enable that, but a batch file not intended to do so can be in the wild for months or even years before someone notices that it&#39;s missing the all-important &quot;setlocal&quot;.</p>
<p>Don&#39;t even get me started on the differences between argument handling for batch files vs. the CRT or .NET (such as extra special characters besides spaces and quotes, like = and ,).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1002663">
				<div id="div-comment-1002663" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Adam Rosenfield</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1002663">
			August 2, 2012 at 7:55 am</a>		</div>

		<p>So &quot;call file.bat&quot; is like a fork()+exec(), while just &quot;file.bat&quot; is like a plain exec(). &nbsp;Oh the things that must be done for backwards compatibility&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1002683">
				<div id="div-comment-1002683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">dalek</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1002683">
			August 2, 2012 at 8:14 am</a>		</div>

		<p>I&#39;m starting to like Batch File Week &#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1002733">
				<div id="div-comment-1002733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dan Bugglin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1002733">
			August 2, 2012 at 8:44 am</a>		</div>

		<p>@pete.d setlocal isn&#39;t default for legacy batch file support; you may wish for a batch file to modify existing environment variables such as the path or whatever. &nbsp;Also I was going to say everything you just said, I just made a batch file which used for expansion since I realized I could use it to automate a build process of mine.</p>
<p><a rel="nofollow" target="_new" href="http://pastebin.com/jnqXSEMz" rel="nofollow">http://pastebin.com/jnqXSEMz</a> if you want a look</p>
<p>I forgot you could do &quot;procedures&quot; in batch though. &nbsp;I&#39;ll have to remember that.</p>
<p>@Adam Nope, call file.bat will wait for file.bat to return. &nbsp;The only forks happen if you launch a GUI program from a batch file (most of the time). &nbsp;You can use start /wait if you want to wait on one, though. &nbsp;Calling a batch file without using call traditionally results in the caller terminating as soon as the callee does; however it seems this doesn&#39;t happen anymore (just realized I made a batch file that forgot to use call and this didn&#39;t happen).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1002743">
				<div id="div-comment-1002743" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dan Bugglin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1002743">
			August 2, 2012 at 8:48 am</a>		</div>

		<p>Also I found an interesting oddity (bug?)&#8230; in my pastebin example above the 7zip for loop originally had the %version%_chrome_installer.exe parameter &quot; quoted, but for did not like that and started ignoring the quotes around the 7-zip command line (&quot;&#39;C:Program&#39; is not recognized as an internal or external command, operable program or batch file.&quot;, if you set sevenzip to a path with spaces in it). &nbsp;The syntax seems right though.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1002763">
				<div id="div-comment-1002763" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Rob K</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1002763">
			August 2, 2012 at 8:56 am</a>		</div>

		<p>Batch programming makes my stomach hurt, and this is why I always install cygwin and use bash.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1002783">
				<div id="div-comment-1002783" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">frymaster</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1002783">
			August 2, 2012 at 9:04 am</a>		</div>

		<p>@robk &#8211; any reason you don&#39;t use the other built-in options? WSH or powershell?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1002813">
				<div id="div-comment-1002813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Programmerman</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1002813">
			August 2, 2012 at 9:20 am</a>		</div>

		<p>It does feel like the single greatest skill a batch file writer can have is complete knowledge of the FOR command and all the ways it can be abused.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1002853">
				<div id="div-comment-1002853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Stefan Kanthak</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1002853">
			August 2, 2012 at 9:52 am</a>		</div>

		<p>EXIT and EXIT /B have another advantage over GOTO :EOF</p>
<p>they can return an errorlevel.</p>
<p>BUT: dont try to use IF ERRORLEVEL with negative values</p>
<p>&#8212; ERRORLEVEL.CMD &#8212;</p>
<p>%SystemRoot%System32Cmd.Exe /C Exit -1</p>
<p>Echo ERRORLEVEL: %ERRORLEVEL%</p>
<p>If ERRORLEVEL 0 (Echo OK [0 ^&gt; -1]) Else (Echo ERROR [0 ^&lt;= -1])</p>
<p>&#8212; eof &#8212;</p>
<p>@Raymond: it doesnt hurt to write always GOTO :label</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-wndsks odd alt thread-odd thread-alt depth-1" id="comment-1002873">
				<div id="div-comment-1002873" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/skSdnW' rel='external nofollow' class='url'>skSdnW</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1002873">
			August 2, 2012 at 10:04 am</a>		</div>

		<p>A big problem with exiting batch files is that they don&#39;t set the exit/error code used by cmd.exe for &amp;&amp; and || handling:</p>
<p>test.cmd:</p>
<p>@echo off</p>
<p>call FailThisLine.exe</p>
<p>if errorlevel 1 (echo.ErrorMessageHere&amp;exit /b 1)</p>
<p>echo Should not get here</p>
<p>Then in cmd.exe run: test&amp;&amp;echo.OK||echo.Failed</p>
<p>To fix it you can use ugly workarounds:</p>
<p>@echo off</p>
<p>call FailThisLine.exe</p>
<p>if errorlevel 1 (echo.ErrorMessageHere&amp;goto dieerrlvl)</p>
<p>echo Should not get here</p>
<p>:dieerrlvl</p>
<p>%comspec% /c exit %errorlevel%</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1002893">
				<div id="div-comment-1002893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">pinwing</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1002893">
			August 2, 2012 at 10:11 am</a>		</div>

		<p>Hmm, the number of floppies seem to be at least 2.</p>
<p>I guess DISK should be initialized to 1?</p>
<p>Also, if I have files a.txt (1 byte), b.txt (1474560-512 bytes) and c.txt (1 byte), then it may come to the conclusion that all files need on their own floppy (instead of putting a.txt and c.txt together).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1002963">
				<div id="div-comment-1002963" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Skyborne</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1002963">
			August 2, 2012 at 12:42 pm</a>		</div>

		<p>@pinwing, I think we&#39;re looking at an instance of the Knapsack Problem, in which case finding the optimal packing knowing everything beforehand is NP-complete&#8230; and the batch file only looks at items streaming past one loop at a time.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1002983">
				<div id="div-comment-1002983" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">voo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1002983">
			August 2, 2012 at 1:55 pm</a>		</div>

		<p>@Skyborne Think so too. So clearly the next step is dynamic programming with batch files!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1002993">
				<div id="div-comment-1002993" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1002993">
			August 2, 2012 at 2:21 pm</a>		</div>

		<p>@Skyborne: I can reduce away this Knapsack problem easily if it were worth my while.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1003043">
				<div id="div-comment-1003043" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">DavidPLB</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1003043">
			August 2, 2012 at 6:11 pm</a>		</div>

		<p>(This algorithm erroneously reports that no files require one disk. Fixing that is left as an exercise.)</p>
<p>change</p>
<p>set DISKSIZE=1474560</p>
<p>set CLUSTER=512</p>
<p>set DISKS=1</p>
<p>set TOTAL=0</p>
<p>to</p>
<p>set DISKSIZE=1474560</p>
<p>set CLUSTER=512</p>
<p>set DISKS=0</p>
<p>set TOTAL=%DISKSIZE%</p>
<p>so set the imaginary 0 disk to be full such that teh firt fil will alwasy &#39;not fit&#39; and overflow to first disk.</p>
<p>:D</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1003103">
				<div id="div-comment-1003103" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Kenn</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1003103">
			August 3, 2012 at 3:23 am</a>		</div>

		<p>@WndSys</p>
<p>You can work around this by always using CALL to run a batch file. &nbsp;</p>
<p>Let&#39;s say script.bat exits with EXIT /B 0 on success and EXIT /B 1 on error. &nbsp;The following is not reliable when run from an interactive command prompt:</p>
<p>script.bat &amp;&amp; echo OK</p>
<p>script.bat || echo failed</p>
<p>However, this works:</p>
<p>call script.bat &amp;&amp; echo OK</p>
<p>call script.bat || echo failed</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-wndsks even thread-even depth-1" id="comment-1003223">
				<div id="div-comment-1003223" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/skSdnW' rel='external nofollow' class='url'>skSdnW</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120802-00/?p=6973#comment-1003223">
			August 3, 2012 at 8:34 am</a>		</div>

		<p>@Kenn:</p>
<p>This forces you to know when you are executing a batchfile, not really nice when you have a batch implementation of which etc</p>
<div class="post">[<i>You can play it safe and put <code>call</code> in front of everything. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>