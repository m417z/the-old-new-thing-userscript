<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (41)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-891283">
				<div id="div-comment-891283" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Aaron.E</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891283">
			January 28, 2011 at 10:56 am</a>		</div>

		<p>If you have a &quot;monster server whose sole purpose is running my one application and nothing else,&quot; which has some large amount of memory n GB (where n &gt;= 16), and the application does in fact use large pages and is configured to use up to (n &#8211; 4) GB of physical memory, does it still make sense to leave the page file on for the rest of the system, granting that there is never going to be more than 4GB of memory pressure outside of the &quot;sole purpose&quot; application?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-891293">
				<div id="div-comment-891293" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">mxn</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891293">
			January 28, 2011 at 11:40 am</a>		</div>

		<blockquote><p>
  &gt; does it still make sense to leave the page file on for the rest of the system
</p></blockquote>
<p>And does it make sense to turn it off ? Either you have no memory pressure outside, and thus you waste some GB of disk space on a 40K$ machine but no performance (it stays unused), or you have pressure and it&#39;s used.. I don&#39;t think you will find those GB on the system disk to be so valuable in that use-case.</p>
<p>On an aside, it depends also on how SQL Server uses large pages.. it may still use normal pages for some data structures, etc. so there will probably still be some memory pressure outside that (but I really don&#39;t know, just guessing).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-891303">
				<div id="div-comment-891303" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alex Grigoriev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891303">
			January 28, 2011 at 11:48 am</a>		</div>

		<p>I wonder what&#39;s the point in requesting large pages? To reduce TLB thrashing? Anything else?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-891323">
				<div id="div-comment-891323" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Aaron.E</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891323">
			January 28, 2011 at 12:35 pm</a>		</div>

		<p>mxm: &nbsp;I don&#39;t know if it makes sense to turn it off, but it&#39;s not wasting disk space I&#39;m worried about (though I think one could reasonably worry about that if it was a SSD-only server), but rather the IO cost of doing unnecessary disk operations. </p>
<p>Gabe: &nbsp;I wasn&#39;t thinking there would be no other user-mode applications running on the system, I was just thinking that if the ohter user-mode applications that are running are restricted to a known set, the memory pressure on the system could be analyzed and the large application (everyone is assuming SQL Server, so fine, let&#39;s say SQL Server) could be configured to leave enough physical memory that the other applications would never need to page-out to disk, you could just disable paging and save the IO overhead so that when SQL Server needs to do something IO intensive like rebuilding an index, it doesn&#39;t have as much other IO to contend with. &nbsp;</p>
<p>Now, maybe it&#39;s the case that SQL Server would benefit more from having that memory I&#39;m proposing setting aside for the rest of the system all to itself than it would from not having the IO contention, I don&#39;t know. &nbsp;I&#39;m a developer and not a sysadmin, so server configruation isn&#39;t my area of expertise, it just seemed like if there was ever a time when disabling the page file might be helpful, this scenario would be a contender. &nbsp;Then again, maybe there isn&#39;t.</p>
<div class="post">[<i>Disk access to the pagefile is not &quot;unnecessary&quot;; the memory manager is going to the pagefile because it has run out of RAM. The amount of physical memory you need leave for other applications would have to be equal to their <span style="text-decoration:underline;">theoretical peak</span> memory usage, which can be quite large. Seems wasteful to reserve that much memory for a rare scenario. If you were the head of a country&#39;s central bank, it sounds like you&#39;d declare the bank reserve rate to be 100%. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-891333">
				<div id="div-comment-891333" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">mxm</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891333">
			January 28, 2011 at 2:25 pm</a>		</div>

		<blockquote><p>
  &gt; but rather the IO cost of doing unnecessary disk operations.
</p></blockquote>
<p>If there is no pressure, there is no swap so no disk ops.</p>
<p>As an aside, I wonder about the fact that 4KB pages were deemed optimal ~25 years ago (as a balance of number of pages to swap, versus time to swap a page) .. is it still the optimal value ? Seems strange considering all the hardware changes, but I wonder :)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-891343">
				<div id="div-comment-891343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891343">
			January 28, 2011 at 3:06 pm</a>		</div>

		<p>[Disk access to the pagefile is not &quot;unnecessary&quot;; the memory manager is going to the pagefile because it has run out of RAM. The amount of physical memory you need leave for other applications would have to be equal to their theoretical peak memory usage, which can be quite large.]</p>
<p>You&#39;re gonna laugh but I had a machine that ran so badly until I turned paging off. The disk was so slow that it was better to let the memory pressure shrink the disk cache to zero rather than opportunistically page out idling programs.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-yuhong-bao even thread-even depth-1" id="comment-891353">
				<div id="div-comment-891353" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Yuhong+Bao' rel='external nofollow' class='url'>Yuhong Bao</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891353">
			January 28, 2011 at 4:24 pm</a>		</div>

		<p>&quot;Prior to Windows XP, allocating a very large page can take 15 seconds or more if your physical memory is fragmented. (And even machines with as much as 2GB of memory will probably have highly fragmented physical memory once they&#39;re running for a little while.)&quot;</p>
<p>MEM_LARGE_PAGE was actually introduced in Windows Server 2003.</p>
<div class="post">[<i>The MEM_LARGE_PAGE flag may have been introduced in Windows Server 2003, but large pages were in use since Windows 2000. Wikipedia says so, so it must be true. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-891363">
				<div id="div-comment-891363" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891363">
			January 28, 2011 at 7:46 pm</a>		</div>

		<p>Windows starts swapping long time before memory is full.</p>
<p>Put the page file on a ram disk. Problem solved.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-891373">
				<div id="div-comment-891373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ian</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891373">
			January 28, 2011 at 7:51 pm</a>		</div>

		<p>@640k &#8211; I see the humour in your comment :) &nbsp;At least I hope it was intended to be humourous &#8211; someone will take it as a good idea though.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-891383">
				<div id="div-comment-891383" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891383">
			January 28, 2011 at 8:01 pm</a>		</div>

		<p>Because windows&#39; memory manager is optimized to do lots of swapping (instead of using actual unused memory), it gets very slow if you turn off page file (newer windows version cannot even disable it). Better is to let windows think it&#39;s still swapping, but let it &quot;swap&quot; to a ramdisk instead.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-891393">
				<div id="div-comment-891393" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891393">
			January 28, 2011 at 8:04 pm</a>		</div>

		<p>Also, with 32-bit windows the kernel can allocate the ram disk at 2-4gb memory, address space which user apps cannot use anyway.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-891313">
				<div id="div-comment-891313" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Gabe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891313">
			January 28, 2011 at 12:12 pm</a>		</div>

		<p>Even if you *wanted* to swap out large pages, they would take orders of magnitude more time, and once paged out, it would have orders of magnitude more chance of having to get paged back in. One interesting optimization, though, would be to satifsy requests for huge blocks of memory with large pages whenever possible. Then break them up into small pages as necessary when they need to get paged out.</p>
<p>Alex: Not only does a large page require 3 or 4 orders of magnitude fewer TLB entries, it also requires commensurately fewer page table entries and of course requires fewer resources to create and maintain those PTEs.</p>
<p>Aaron: Even if you have a large computer dedicated to SQL Server, you&#39;ll still have other processes like backup agents, antivirus, report generators, administrative tools, and so on vying for memory. There&#39;s probably no reason to limit their abilities by restricting the available page file.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-891403">
				<div id="div-comment-891403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Billy O'Neal</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891403">
			January 29, 2011 at 12:06 am</a>		</div>

		<p>@640k: Please get sources before spewing mountains incorrect information.</p>
<ol>
<li>
<p>Why on earth would the memory manager be optimized to do lots of swapping? The memory manager is optimized to perform best for end user programs, not to make some internal operation run quickly. If making swapping fast makes the memory manager as a whole fast, that might be optimized, but not at the expense of being performant for other programs.</p>
</li>
<li>
<p>Hmm. Windows 7 x64 seems to have no problem disabling the page file (at least on my box).</p>
</li>
<li>
<p>Your comment about the kernel using the 2-4GB memory range shows a lack of understanding of how virtual memory operates. User programs may use all of a system&#39;s memory. The difference is that on a 32 bit machine, they may only use 2GB of it per process (or 3GB if the appropriate switch is turned on at boot). Physical memory is not subject to the 2GB split &#8212; that happens in the virtual address space, not the physical one.</p>
</li>
</ol>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-891423">
				<div id="div-comment-891423" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891423">
			January 29, 2011 at 3:09 am</a>		</div>

		<p>1.</p>
<p>Read again. &#8211;&gt; Windows (NT) starts swapping long time before memory is full.</p>
<p>I think it&#39;s supposed to be a feature. Maybe disk cache for app1 is more important than keeping app2 in memory. &quot;windows known what&#39;s best for you&quot;, and that&#39;s to start swapping before all memory is allocated. Raymond has also suggested that apps get swapped out when their window is minimized.</p>
<p>2.</p>
<p>Usually physical adresses at ~2-4gb is allocated by i/o (depending on installed hardware). To use more memory in 32-bit windows the kernel has to map it with PAE, which a 32-bit app usually doesn&#39;t use. But a ram disk using PAE-allocated memory can help performance considerably when ordinary 32-bit apps gets swapped out, if it gets swapped out to a PAE-allocated ram disk.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-891433">
				<div id="div-comment-891433" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anton</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891433">
			January 29, 2011 at 6:02 am</a>		</div>

		<p>@640K: actually on 32-bit windows physical address space is also 32 bit, and it is heavily reserved by graphics and other hardware. If 4Gb physical memory is installed not all of it will be ever accessed, google it. In this case if you setup 2Gb RAM disk, it will leave nothing for the rest of system.</p>
<div class="post">[<i>Sigh. Windows can use more than 4GB of physical memory on a 32-bit machine. Otherwise, what&#39;s the point of PAE? I spent <a href="http://blogs.msdn.com/b/oldnewthing/archive/2004/08/22/218527.aspx" rel="nofollow">two whole weeks</a> trying to explain this. Apparently I need to set aside another two weeks to try to explain it again. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-891443">
				<div id="div-comment-891443" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joseph Koss</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891443">
			January 29, 2011 at 8:27 am</a>		</div>

		<p>@640K</p>
<p>If you are commonly swapping out pages because your physical memory really is full (rather than being used for caching and other assorted benefits) then you simply do not have enough memory and thats all there is to it. Reserving some of this precious memory on a starved system, for a ramdisk, is NOT normally beneficial. Basically, 1990 called and it wants its ramdisk back.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-891453">
				<div id="div-comment-891453" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nawak</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891453">
			January 29, 2011 at 9:18 am</a>		</div>

		<p>Having an old laptop with XP and only 512MB of RAM, I also have noticed that the machine is better off with the pagefile disabled. Less disk trashing (and those laptop disks were slow), better windows startup time, better application startup time. Sometimes when I used the laptop for some unusual task, I got the &quot;low virtual memory&quot; popup, so eventually I decided for a small memory upgrade (now 1.5GB). Now, no more &quot;low virtual memory&quot; warning (and still no trashing).</p>
<p>Windows is supposed to swap only when necessary, but evidence show that it is not true (or that windows can adapt very well to low memory condition, so well that giving him slow &quot;disk memory&quot; is more a poison than a present)</p>
<p>I would advise people with old XP systems and disk-trashing problems to at least try it.</p>
<p>Because it&#39;s with less memory available that windows pages the more, the less memory you have, the more you can benefit from restricting windows memory usage even more! Of course if you try it and during your usual tasks windows complain about virtual memory, you lost this &quot;game&quot;&#8230; In that case I would advise removing unnecessary startup programs etc. This relative &quot;feature downgrade&quot; (often useless features) will be a lot more bearable than the constant disk trashing.</p>
<p>On my win7 desktop, I didn&#39;t feel the need to try this strange &quot;optimization&quot;, maybe it is the new memory manager, maybe it is the larger RAM, maybe the faster disk&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-891463">
				<div id="div-comment-891463" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jim</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891463">
			January 29, 2011 at 11:27 am</a>		</div>

		<p>&quot;[32-bit] Windows can use more than 4GB of physical memory on a 32-bit machine.&quot;</p>
<p>It could, up until XP SP2 I think (if not, SP3). &nbsp;Then it was disabled in client versions of Windows for &quot;driver compatibility reasons&quot; (it&#39;s still enabled in 32-bit server versions of Windows). &nbsp;There is a registry key that controls this behaviour, but it is in the license section of the registry, which is digitally signed, so in practice this could only be enabled by Microsoft. &nbsp;(This can be worked around, but only by violating your EULA.) &nbsp;So yes, 32-bit client versions can only use 4GB of physical address space, which amounts to somewhat less than 4GB of physical memory.</p>
<p>&quot;Otherwise, what&#39;s the point of PAE?&quot;</p>
<p>This is left on purely to allow the NX bit.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-891483">
				<div id="div-comment-891483" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dylan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891483">
			January 29, 2011 at 3:25 pm</a>		</div>

		<p>I&#39;ve had my share of issues from windows swapping out too much, but I find that running an app to restrict the disk cache to about a tenth of ram works much better than trying to disable swap.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-891493">
				<div id="div-comment-891493" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Luc Rooijakkers</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891493">
			January 29, 2011 at 4:25 pm</a>		</div>

		<p>Slightly OT&#8230; The page frame numbers returned by AllocateUserPhysicalPages are in user space and must later be passed back to MapUserPhysicalPages. In principle, modifying these numbers would allow you to access any page in the system (the documentation explicitly warns against modifying these numbers). Does anybody know if Windows contains checks against such behaviour?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-yuhong-bao even thread-even depth-1" id="comment-891503">
				<div id="div-comment-891503" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Yuhong+Bao' rel='external nofollow' class='url'>Yuhong Bao</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891503">
			January 29, 2011 at 5:15 pm</a>		</div>

		<p>On PAE and Windows, Geoff Chappell has an article about what happened. It is not 100% accurate, but here it is:</p>
<p><a rel="nofollow" target="_new" href="http://www.geoffchappell.com/viewer.htm?doc=notes/windows/license/memory.htm" rel="nofollow">http://www.geoffchappell.com/viewer.htm</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-yuhong-bao odd alt thread-odd thread-alt depth-1" id="comment-891513">
				<div id="div-comment-891513" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Yuhong+Bao' rel='external nofollow' class='url'>Yuhong Bao</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891513">
			January 29, 2011 at 5:20 pm</a>		</div>

		<p>&quot;This is left on purely to allow the NX bit.&quot;</p>
<p>Yea, it was XP SP2 that introduced support for the NX bit in the first place.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-891523">
				<div id="div-comment-891523" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891523">
			January 29, 2011 at 7:17 pm</a>		</div>

		<p>[Sigh. Windows can use more than 4GB of physical memory on a 32-bit machine. Otherwise, what&#39;s the point of PAE? I spent two whole weeks trying to explain this. Apparently I need to set aside another two weeks to try to explain it again. -Raymond]</p>
<p>It&#39;s because Microsoft went out of their way to make it not work on 32 bit consumer OSes and for years claimed it was a hardware limitation. Tell a lie long enough and people start to believe it.</p>
<div class="post">[<i>It&#39;s a driver compatibility limitation. But server-class machines will work (because driver compatibility on servers is a smaller problem &#8211; nobody runs strange drivers on servers). -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-yuhong-bao odd alt thread-odd thread-alt depth-1" id="comment-891533">
				<div id="div-comment-891533" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Yuhong+Bao' rel='external nofollow' class='url'>Yuhong Bao</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891533">
			January 29, 2011 at 9:25 pm</a>		</div>

		<p>[It&#39;s a driver compatibility limitation. But server-class machines will work (because driver compatibility on servers is a smaller problem &#8211; nobody runs strange drivers on servers). -Raymond]</p>
<p>The frustrating thing about it is there is no 32-bit version of Server 2008 R2, yet there is a 32-bit version of Windows 7.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-891553">
				<div id="div-comment-891553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Troll</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891553">
			January 30, 2011 at 9:30 am</a>		</div>

		<p>&quot;It&#39;s a driver compatibility limitation. But server-class machines will work (because driver compatibility on servers is a smaller problem &#8211; nobody runs strange drivers on servers&quot;</p>
<p>Let driver manufacturers solve it and produce a 32-bit version without the crippled limit of 4 GB. Microsoft has worded the 4 GB limit for 32-bit Windows so cunningly on their websites that I initially used to think it was a technical limitation but it&#39;s not. It&#39;s a licensing limit imposed by MS to prevent BSODs due to drivers accessing above 3 GB reserved area thinking they know best. I expect at least one last 32-bit Windows to be produced without this artificial limit.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-891563">
				<div id="div-comment-891563" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Stefan Kanthak</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891563">
			January 30, 2011 at 10:58 am</a>		</div>

		<p>&quot;Wikipedia says so, so it must be true.&quot;</p>
<p>Even the MSKB says it: &lt;<a rel="nofollow" target="_new" href="http://support.microsoft.com/kb/270715/en-us&gt;" rel="nofollow">support.microsoft.com/&#8230;/en-us&gt;</a></p>
<p>(&lt;<a rel="nofollow" target="_new" href="http://support.microsoft.com/kb/321938/en-us&gt;" rel="nofollow">support.microsoft.com/&#8230;/en-us&gt;</a> is not available any</p>
<p>more).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-yuhong-bao even thread-even depth-1" id="comment-891573">
				<div id="div-comment-891573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Yuhong+Bao' rel='external nofollow' class='url'>Yuhong Bao</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891573">
			January 30, 2011 at 11:18 am</a>		</div>

		<p>&quot;Let driver manufacturers solve it and produce a 32-bit version without the crippled limit of 4 GB. &quot;</p>
<p>Yea, I once was thinking of defaulting to /MAXMEM:4096, with a /NOMAXMEM option to lift the limit.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-yuhong-bao odd alt thread-odd thread-alt depth-1" id="comment-891583">
				<div id="div-comment-891583" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Yuhong+Bao' rel='external nofollow' class='url'>Yuhong Bao</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891583">
			January 30, 2011 at 11:43 am</a>		</div>

		<p>&quot;As for the memory confusion issues, the &quot;wasted memory&quot; that some ramdisk drivers are capable of using is remapped memory. &quot;</p>
<p>Yep, after Intel introduced PAE with the Pentium Pro, Intel introduced PSE36 in the Pentium II era, which allowed large pages to be mapped above the 4GB boundary without changing the page table format significantly.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-891543">
				<div id="div-comment-891543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">f0dder</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891543">
			January 30, 2011 at 5:34 am</a>		</div>

		<p>640kb: it&#39;s actually *older* versions of Windows that can&#39;t run without a pagefile &#8211; on Windows 2000, you&#39;re allowed to disable the pagefile, but the system then creates a small PF on system startup. For XP and later, there&#39;s on problem in disabling the pagefile as long as you have enough RAM.</p>
<p>Putting the pagefile on a ramdisk is moronic &#8211; better to turn it off.</p>
<p>As for the memory confusion issues, the &quot;wasted memory&quot; that some ramdisk drivers are capable of using is remapped memory. XP SP2 doesn&#39;t limit you to 4GB of memory, it limits you to the 4GB lower physical memory addresses (exactly for the driver compatibility reasons Raymond mentions &#8211; retarded 32bit driver developers who didn&#39;t expect to get PHYSICALADDRESSes with &gt;4GB addresses, even though we&#39;ve had PAE since PPro).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-891593">
				<div id="div-comment-891593" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Cheong</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891593">
			January 30, 2011 at 6:20 pm</a>		</div>

		<p>@Nawak: Windows (start from WinXP I think) in fact attempts to write a copy of pagable location on disk as it sees fit, so when you need more memory, if could just mark these memory block as &quot;paged&quot; and transfer the memory for new allocations, instead of requiring you to wait the slow I/O to page out the memory block to disk. So it&#39;s trying to do you a better service (if you can feel the startup become sluggish because of this, you&#39;d feel it even more sluggish when your application needs more RAM and need paging but Windows not chosen this strategy).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-891603">
				<div id="div-comment-891603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891603">
			January 31, 2011 at 6:48 am</a>		</div>

		<p>@Joseph</p>
<p>&gt; If you are commonly swapping out pages because your physical memory really is full (rather than being used for caching and other assorted benefits) then you simply do not have enough memory and thats all there is to it.</p>
<p>This is NOT true. Windows starts swapping out apps BEFORE memory is full:</p>
<p>1. Large disk cache for app1 is more important than keeping app2 in memory. This leads to several problems, the most prominent is with virus scanners which reads lots of files, then all other programs gets swapped out, and computer will become superslow until next reboot.</p>
<p>2. When a process&#39; window is minimized, the process gets swapped out.</p>
<p>&gt; Reserving some of this precious memory on a starved system, for a ramdisk, is NOT normally beneficial.</p>
<p>Reserving PAE-allocated memory for a ram disk is beneficial, because 32-bit apps cannot (usually) use that memory anyway.</p>
<div class="post">[<i>Shouldn&#39;t the virus scanner be doing a FILE_FLAG_NO_BUFFERING to say &quot;do not pollute the cache with this data&quot;? -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-891763">
				<div id="div-comment-891763" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alex Grigorief</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891763">
			January 31, 2011 at 7:59 am</a>		</div>

		<p>I&#39;ve been complaining about terrible file cache performance in XP for long time. It just wants to discard VM pages (executables, etc) for a big file being worked on. Example: Do a compare of large files between a DVD-R and the disk. Other processes will become terribly starved of working set and will fall to page-in loop.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-891783">
				<div id="div-comment-891783" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Simon</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891783">
			January 31, 2011 at 8:07 am</a>		</div>

		<p>2MB pages won&#39;t take a thousand times longer than 4KB pages to page out/in. Let&#39;s assume we have a old HD (no SSD) with a 80MB/s read/write burst rate and a 10ms random access time. This gives us total times of 22.5ms for 2MB and ~10.1ms for 4KB pages.</p>
<div class="post">[<i>Oh, wait, now you&#39;re require that the pages be contiguous in the pagefile too? In addition to defragmenting memory, you also have to defragment the pagefile. Now instead of 15 seconds to allocate your large page, it takes 15 minutes. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-891863">
				<div id="div-comment-891863" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Gabe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891863">
			January 31, 2011 at 8:48 am</a>		</div>

		<p>Simon: Even if your large page is contiguous in the pagefile, the pagefile still might not be contiguous on disk. You have no reason to assume that a 4MB page-in would take any less time than 1000 simultaneous 4k page-ins.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-891993">
				<div id="div-comment-891993" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James Schend</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-891993">
			January 31, 2011 at 11:14 am</a>		</div>

		<p>@Alex Grigorief: You complain about so many hundreds of things in every post, that I guess we just kind of lose track of the specifics. Let&#39;s just assume that if you&#39;re posting in this blog, you&#39;re complaining about Windows in some way and not worry about the specifics?</p>
<p>In any case, what are you expecting to happen? Do you think Microsoft is going to just bin Windows 7 and go back to XP development? What&#39;s the use of complaining about a product that&#39;s only alive because huge inflexible corporations take a long time to upgrade?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-892043">
				<div id="div-comment-892043" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alex Grigoriev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-892043">
			January 31, 2011 at 1:42 pm</a>		</div>

		<p>@James Schend:</p>
<p>OK. Now can I complain about Win7 indexing service starting in the middle of the boot and slowing it down every time, and going through all the unchanged files at every boot? And also allocating (together with Security Essentials) 1.5 GB of kernel paged pool in the process of doing that? I&#39;m not kidding you.</p>
<p>Oh, by the way, the problem with XP cache manager was clear since early 200x, way before Vista was out.</p>
<div class="post">[<i>Why does every article eventually turn into a &quot;why Windows sucks&quot; comment thread? -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-892113">
				<div id="div-comment-892113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James Schend</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-892113">
			January 31, 2011 at 4:27 pm</a>		</div>

		<p>Sorry Raymond. I over-estimated Alex Grigoriev&#39;s ability to get my point. (Which, to spell it out, was: &quot;please stop griping, we&#39;re all sick of it.&quot;)</p>
<p>I didn&#39;t anticipate in a million years that he&#39;d reply to that with even MORE griping even MORE off-topic!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-892203">
				<div id="div-comment-892203" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Pavel Lebedinsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-892203">
			January 31, 2011 at 10:45 pm</a>		</div>

		<p>@640k: Vista and win7 no longer empty the working set of the process when its main window is minimized.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-892343">
				<div id="div-comment-892343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Simon</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-892343">
			February 1, 2011 at 7:16 am</a>		</div>

		<p>&gt; [Oh, wait, now you&#39;re require that the pages be contiguous in</p>
<p>&gt; the pagefile too? In addition to defragmenting memory, you also</p>
<p>&gt; have to defragment the pagefile. Now instead of 15 seconds to</p>
<p>&gt; allocate your large page, it takes 15 minutes. -Raymond]</p>
<p>Microsoft&#39;s programmers wouldn&#39;t be that stupid. (Easiest explained solution) They could create a second pagefile that only holds 2MB pages. Coming up with better solutions is left to the reader as an exercise.</p>
<div class="post">[<i>Sure, let&#39;s rearchitect the pagefile model to handle a case <span style="text-decoration:underline;">nobody cares about</span>. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-892573">
				<div id="div-comment-892573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Geoff Chappell</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-892573">
			February 1, 2011 at 11:23 pm</a>		</div>

		<p>It is fascinating that it&#39;s even thought worth writing that paging large pages would be a lot of work for no good reason. I mean, that large pages aren&#39;t paged should be written somewhere, but as an incidental detail in the documentation, not as any sort of news to anyone.</p>
<p>Now, some people will much more easily run into a different frustration when trying to use large pages. It may be that large-page support has been disabled, whatever your security privileges, because you have an unlicensed physical processor. Will you tell us something of the thinking behind that?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-892773">
				<div id="div-comment-892773" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nik</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110128-00/?p=11643#comment-892773">
			February 2, 2011 at 1:44 pm</a>		</div>

		<p>Raymond, I feel your pain. Every time the page file is mentioned, it brings out the conspiracy theorists. &nbsp;It would be interesting to make a complete catalog of windows memory conspiracy theories. &nbsp;Then you could save time by replying &quot;you&#39;re a type 3 kook, see this table&quot;.</p>
<p>In the past you used to get irritated to the point of saying &quot;I will never write about topic X again&quot;, so I&#39;m surprised you still talk about virtual memory.</p>
<p>I&#39;m also a bit suprised that you mentioned the &quot;backwards compatibility time machine&quot; topic again, since it&#39;s also troll bait.</p>
<div class="post">[<i>Yeah, what was I thinking? -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>