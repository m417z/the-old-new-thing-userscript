<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (12)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment byuser comment-author-koldude even thread-even depth-1" id="comment-1344585">
				<div id="div-comment-1344585" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/kantos' rel='external nofollow' class='url'>kantos</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180606-00/?p=98925#comment-1344585">
			June 6, 2018 at 7:05 am</a>		</div>

		<p>If the addin developer was doing a .NET addin properly they would have their own app-domain and would be able to do this without issue within the CLR portion of their addin because this is appdomain specific in that case. Of Course this requires you find the code to do that which has long since been lost in the dark recesses of the internet.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 parent" id="comment-1344595">
				<div id="div-comment-1344595" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Luke</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180606-00/?p=98925#comment-1344595">
			June 6, 2018 at 7:17 am</a>		</div>

		<p>&gt; To work around rogue DLLs replacing the unhandled exception filter, Office detours the Set­Unhandled­Exception­Filter function.</p>
<p>It&#8217;s &#8220;what if two programs did this?&#8221; all the way down.</p>

		
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-oldnewthing bypostauthor even depth-2 parent" id="comment-1344635">
				<div id="div-comment-1344635" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180606-00/?p=98925#comment-1344635">
			June 6, 2018 at 9:25 am</a>		</div>

		<p>There is no lower turtle. The process controls its unhandled exception filter.</p>

		
				</div>
		<ol class="children">
		<li class="comment odd alt depth-3" id="comment-1344655">
				<div id="div-comment-1344655" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180606-00/?p=98925#comment-1344655">
			June 6, 2018 at 10:01 am</a>		</div>

		<p>I had a plan against a bad A/V to undetour a function. It&#8217;s tricky on 64 bit and I&#8217;m glad I never used it.</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even depth-2" id="comment-1344645">
				<div id="div-comment-1344645" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Antonio Rodríguez</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180606-00/?p=98925#comment-1344645">
			June 6, 2018 at 9:32 am</a>		</div>

		<p>No, Luke. It&#8217;s more like &#8220;my house, my rules&#8221;. I may have invited you to come over for a beer, but you aren&#8217;t allowed to put your feet on the couch or peek into the dressing room.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt depth-2" id="comment-1344695">
				<div id="div-comment-1344695" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Pierre B.</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180606-00/?p=98925#comment-1344695">
			June 6, 2018 at 12:30 pm</a>		</div>

		<p>&gt; To work around rogue DLLs replacing the unhandled exception filter, Office detours the Set­Unhandled­Exception­Filter function.</p>
<p>To work around this, launch another process, find the offset from teh base location to SetUnHandledExceptionFilter, send the result back to the main process, patch back the true entry point of the functions&#8230;</p>
<p>Then Office adds a timer to re-patch, so the DLL uses a shorter timer and detour CreateTimer. Then&#8230; well, long story short, that&#8217;s why Office now ships with a daughterboard with a separate CPU that you plug your CPU into.</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1344605">
				<div id="div-comment-1344605" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mason Wheeler</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180606-00/?p=98925#comment-1344605">
			June 6, 2018 at 8:24 am</a>		</div>

		<p>&gt; Besides, imagine what would happen if two plug-ins wanted to replace the unhandled exception filter.</p>
<p>They would both add a handler to the relevant event and there would be no problem? ;-)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1344615">
				<div id="div-comment-1344615" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">jon</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180606-00/?p=98925#comment-1344615">
			June 6, 2018 at 9:12 am</a>		</div>

		<p>Windows error reporting seems to constantly take over and prevent our unhandled exception filter from being called&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1344625">
				<div id="div-comment-1344625" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://geelaw.blog/' rel='external nofollow' class='url'>Gee Law</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180606-00/?p=98925#comment-1344625">
			June 6, 2018 at 9:22 am</a>		</div>

		<p>No wonder why the new Office add-in platform is built on JavaScript &#8212; it provides a big diaper for all the sh*ts the developers have created, which can be avoided in the first place. (Yes, I know diapers are not for sh*ts.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 parent" id="comment-1344715">
				<div id="div-comment-1344715" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">sean</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180606-00/?p=98925#comment-1344715">
			June 6, 2018 at 3:19 pm</a>		</div>

		<p>Due to GDPR, addin developers are no longer able to get crash dumps from Windows Error Reporting except for processes that the addin owns &#8212; which typically isn&#8217;t the addin host.</p>

		
				</div>
		<ol class="children">
		<li class="comment even depth-2" id="comment-1344825">
				<div id="div-comment-1344825" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Patrick Van Cauteren</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180606-00/?p=98925#comment-1344825">
			June 7, 2018 at 7:45 am</a>		</div>

		<p>Raymond, I completely agree.  If a process decides to set the UnhandledExceptionFilter, everyone else should keep their hands of it.  For developers using Oracle: set the DIAG_SIGHANDLER_ENABLED=FALSE configuration line in SQLNET.ORA, otherwise Oracle will also overrule the UnhandledExceptionFilter.<br />
By the way, it looks like .Net is overruling our UnhandledExceptionFilter as well.  Shouldn&#8217;t .Net keep its hands of it as well?</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-yuhong-bao odd alt thread-even depth-1" id="comment-1345455">
				<div id="div-comment-1345455" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Yuhong+Bao' rel='external nofollow' class='url'>Yuhong Bao</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180606-00/?p=98925#comment-1345455">
			June 8, 2018 at 4:40 pm</a>		</div>

		<p>&#8220;(Bonus: And then one of those plug-ins was unloaded.)&#8221;<br />
Well known security problem BTW.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>