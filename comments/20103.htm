<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (60)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-686273">
				<div id="div-comment-686273" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alexandre Grigoriev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686273">
			November 24, 2008 at 12:19 pm</a>		</div>

		<p>There&#8217;s been like 5 opportunitis to fix it. How many new OSes and service packs were released? Many new interfaces were created, and nobody would create a &#8216;2&#8217; version of this particular interface? That&#8217;s so lame. Oh, and &#8220;Safe removal&#8221; functionality is broken in Windows 2008. I suspect it&#8217;s partially because of UAC, but why the tooltip was replaced back with a dialog?</p>
<div class=post>[<i>Nice rant, but you didn&#8217;t answer the question: &#8220;If you expand a node [in the tree view] for an empty floppy drive, where is the &#8220;Sorry&#8221; message supposed to appear?&#8221; If only time were the only resource necessary for solving problems. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-dwalker-wk odd alt thread-odd thread-alt depth-1" id="comment-686283">
				<div id="div-comment-686283" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/DWalker' rel='external nofollow' class='url'>DWalker</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686283">
			November 24, 2008 at 12:36 pm</a>		</div>

		<p>The enumerator could return one item that said &quot;there is nothing here&quot;, but you would have to be able to visually distinguish this from an actual item whose name is &quot;there is nothing here&quot;. &nbsp;Although I think Raymond&#8217;s post says that this is not possible due to the structure of enumerators and so on.</p>
<p>If you did what the commenter asked, though, other people would ask why it wasn&#8217;t done the other way. &nbsp;You could add yet another user-configurable option, although MY view is &quot;who cares which was this is done?&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686293">
				<div id="div-comment-686293" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blog.koroirc.com/' rel='external nofollow' class='url'>Koro</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686293">
			November 24, 2008 at 12:37 pm</a>		</div>

		<p>We need a new interface then. The shell loves to do this (just look at IContextMenu and all it&#8217;s descendents).</p>
<p>The interface of course would be named IShellFolder3, and as usual of new interfaces, would have only one method more, GetExtendedError(LPWSTR errText, DWORD dwCb), that returns S_OK if errText was set, or S_FALSE if there is no error.</p>
<p>As for how to display that text in the explorer tree-view, I suggest you look at Visual Studio&#8217;s resource editor pane. When there is an error, there is a single child item with an MB_ICONSTOP lookalike icon and the error text. Unexpanding and re-expanding the tree will try to reload the resource file.</p>
<div class=post>[<i>And how does IShellFolder::CreateShellView decide whether to do things the old way or the new way? And what is the priority for fixing this problem, anyway? It&#8217;s not like this is a data loss bug. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686313">
				<div id="div-comment-686313" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nawak</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686313">
			November 24, 2008 at 1:12 pm</a>		</div>

		<p>I may not have understood everything&#8230; (despite frequent reading of this blog, I lack the hands-on experience to memorize these things)</p>
<p>Who shows the modal dialog? Because of your focus on return values of EnumObjects, it seems that it is EnumObjects&#8230; If so, aren&#8217;t these methods callable by non interactive programs? Does it make sense then &nbsp;to display a dialog? Shouldn&#8217;t this case be handled with a dedicated error code (EMPTY_DRIVE or something) in EnumObjects and a UI in the caller?</p>
<p>If it is CreateViewWindow that displays the dialog, then why doesn&#8217;t display the message in the created view? I understand that in this case, the view isn&#8217;t created, but what if it was? What would explorer do that it shouldn&#8217;t?</p>
<p>All in all, I&#8217;m sure it is quite clear in your mind why it is not easily possible, but for someone like me, the dots are too far apart&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686323">
				<div id="div-comment-686323" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Reginald Wellington III.</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686323">
			November 24, 2008 at 1:13 pm</a>		</div>

		<p>The commenter was not Anonymous, but rather &quot;AndrewSeven&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686333">
				<div id="div-comment-686333" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686333">
			November 24, 2008 at 1:19 pm</a>		</div>

		<p>I think you meant IShellFolder::CreateViewObject as opposed to IShellFolder::CreateViewWindow and IShellFolder::CreateShellView (which do not exist).</p>
<p>You can do what Koro says; as for how IShellFolder::CreateViewObject decides what to do, you could add a new interface (IShellView4, IID_IShellView4) and use the new behavior only for IShellView4 and later. &nbsp;Or add IShellFolder3 and use the behavior only for views created from IShellFolder3 objects. &nbsp;IShellFolder3 could have a method to control what behavior to display. &nbsp;It&#8217;s not impossible to do. &nbsp;Granted I don&#8217;t know the intricacies involved, but it doesn&#8217;t sound all that difficult. &nbsp;However, I don&#8217;t even see it as a problem worth &quot;fixing&quot;; I think it&#8217;s fine how it is.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686343">
				<div id="div-comment-686343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Pierre B.</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686343">
			November 24, 2008 at 1:26 pm</a>		</div>

		<p>The Shell interface already support returning special logical objects with no correspondence with any actual file (like the trashcan, the control panel, etc). So the &#8220;no media&#8221; could simply be a logical file with the proper information and PIDL.</p>
<p>For the tree view, simply skip the dialog and sub-tree. If it&#8217;s empty (no media) then there is nothing to show. I think an error is superfluous: not showing anything is the &#8220;error&#8221; for the tree view. If end-user testing show this to be confusing, simply put that logical file under the leaf.</p>
<div class=post>[<i>So the way to tell if a folder has sub-items is &#8220;Enumerate the objects. If the enumeration returns no objects, then the folder is empty. But if it returns exactly one object, then look more closely, because that object might be the &#8220;There are no objects&#8221; object.&#8221; And don&#8217;t break any apps which assumed that returning an object means that there&#8217;s an object. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686353">
				<div id="div-comment-686353" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Duke of New York</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686353">
			November 24, 2008 at 2:07 pm</a>		</div>

		<p>Obviously Microsoft needs to fix this by adding a dreaded &quot;hidden API,&quot; for which the slashdot crowd can then flog it mercilessly.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686373">
				<div id="div-comment-686373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark Jonson</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686373">
			November 24, 2008 at 2:49 pm</a>		</div>

		<p>Why not just use the returned error code from IShellFolder::EnumObjects to tell Explorer to output an error string in the view? An entire string doesn&#8217;t need to be returned, as it is evident from its current behavior that if an error code is enough to display a dialog with a string error, that the same can be applied to the view.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686383">
				<div id="div-comment-686383" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ton</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686383">
			November 24, 2008 at 3:12 pm</a>		</div>

		<p>&#8216;The view window calls IShellFolder::EnumObjects to figure out what to show in the viewâ€”and here is where the error dialog appears asking you to insert a disc into the drive.&#8217;</p>
<p>The IShellFolder object doesn&#8217;t seem to follow good OOP principles.Since its written in C++ there really aren&#8217;t any good excuses for this.If IShellFolder were implemented as a abstract class with all pure virtual methods then the behavior could be flexible enough for all objects that need to use it (including Explorer) provided that they provide a implementation for the methods that must be overridden. </p>
<p>Data stuctures for error handling would have to be redesigned to have a error code and a message but it could be done and the code would be much more flexible. A lot of the design issues here come from using error codes instead of structured exception handling and not leveraging Inversion Of Control techniques but the original designers were likely unaware.</p>
<div class=post>[<i>Redesign of external behavior = incompatibility. Oh, and IShellFolder implementations were not originally written in C++. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686403">
				<div id="div-comment-686403" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Gwyn</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686403">
			November 24, 2008 at 4:10 pm</a>		</div>

		<p>I think the way to resolve this issue is to post an uninformed rant on your blog!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686413">
				<div id="div-comment-686413" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Yuhong Bao</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686413">
			November 24, 2008 at 4:14 pm</a>		</div>

		<p>&quot;why navigating to a drive with no media displays a dialog instead of showing the error message in the view&quot;</p>
<p>BTW, what if a user (not programmer) asked about this? Because the explanation is quite technical.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686443">
				<div id="div-comment-686443" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">eth0</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686443">
			November 24, 2008 at 5:06 pm</a>		</div>

		<p>I&#8217;ll bite :)</p>
<p>In enduser speak:</p>
<p>&quot;why does navigating to a drive with no media display a dialog instead of showing the error message in the view?&quot;</p>
<p>In order to show something in the view, there has to be something there in the first place.</p>
<p>An empty folder is still a something.</p>
<p>When there&#8217;s no media, there is no something.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686453">
				<div id="div-comment-686453" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://jsbangs.wordpress.com' rel='external nofollow' class='url'>JS Bangs</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686453">
			November 24, 2008 at 5:08 pm</a>		</div>

		<p>I&#8217;m afraid that I share Nawak&#8217;s confusion. Who owns the modal dialog? Is IShellFolder::EnumObjects itself throwing up modal UI? That doesn&#8217;t seem right. Explorer.exe is the actual UI app that&#8217;s calling these interfaces&#8211;why doesn&#8217;t it notice that there are no objects to enumerate and then lay out a nice error screen?</p>
<div class=post>[<i>The enumerator is displaying the &#8220;Put a disc in the drive please&#8221; message. Explorer doesn&#8217;t know what&#8217;s going on; it&#8217;s just asking for a view and displaying it. Perhaps you&#8217;re suggesting that if there is no disc in the drive, then the attempt to create a view should still succeeed but show an error message instead of a list of items. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686463">
				<div id="div-comment-686463" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jason</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686463">
			November 24, 2008 at 5:16 pm</a>		</div>

		<p>What about the answer &#8220;it depends&#8221;?</p>
<p>If the error number is returned when expanding the tree, display the dialog but if it is during the binding of the details pane, place the message in that panel.</p>
<p>This would leave the interface as is and thus not break any existing applications.</p>
<div class=post>[<i>And how is the enumerator supposed to know whether it&#8217;s being called by the tree control or the details pane? -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686473">
				<div id="div-comment-686473" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Pierre B.</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686473">
			November 24, 2008 at 5:19 pm</a>		</div>

		<p>Raymond, I fail to see how this is different from any other special shell folders and shell items. If an application break due to this, then it will break when it sees other special shell items, like trashcans and the control panel. When queried, the item won&#8217;t have much functionality, but it is a valid item.</p>
<p>The only times this would matter is if an application is trying operations like deleting the folder, moving the folder contents, etc, which will fail anyway since there is no media, so no real harm done.</p>
<div class=post>[<i>Recycle Bin and Control Panel follow the rule that &#8220;if the view object can be created, then you have a valid view.&#8221; -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686483">
				<div id="div-comment-686483" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alexandre Grigoriev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686483">
			November 24, 2008 at 5:22 pm</a>		</div>

		<p>[And how does IShellFolder::CreateShellView decide whether to do things the old way or the new way? And what is the priority for fixing this problem, anyway? It&#8217;s not like this is a data loss bug. -Raymond]</p>
<p>QueryInterface does wonders for discovering any new functionality for the code that wants it&#8230;</p>
<div class=post>[<i>QueryInterface works great if you have an IUnknown you can invoke it on. <a href="http://msdn.microsoft.com/en-us/library/bb775064.aspx" rel="nofollow">Too bad there isn&#8217;t one</a>. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-dean-harding odd alt thread-odd thread-alt depth-1" id="comment-686493">
				<div id="div-comment-686493" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Dean+Harding' rel='external nofollow' class='url'>Dean Harding</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686493">
			November 24, 2008 at 5:40 pm</a>		</div>

		<p>No object to enumerate != No media</p>
<p>They&#8217;re two different conditions (no objects to enumerate is just an empty folder)</p>
<p>&quot;Who owns the modal dialog? Is IShellFolder::EnumObjects itself throwing up modal UI?&quot;</p>
<p>Yes, notice the first parameter to IShellFolder::EnumObjects is the HWND of the parent window. That&#8217;s used for any modal dialogs that need to be displayed.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686503">
				<div id="div-comment-686503" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">bdodson</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686503">
			November 24, 2008 at 6:05 pm</a>		</div>

		<p>Seems like a case where it might be worth versioning the interface and adding something like EnumObjectsEx that lets Explorer decide what to do in this case. Presumably the new version could return an appropriate error code to indicate that the drive was empty.</p>
<p>Even though it&#8217;s not a data loss issue, that&#8217;s no excuse for not finding an answer to these little annoyances that add up to worsened user experience.</p>
<p>Modal dialogs, and particularly message boxes, rarely seem like appropriate UI to me, since they require a click that imparts no information, they break the users train of thought, and they frequently don&#8217;t match the interface style of the UI.</p>
<p>[ok, now I&#8217;m stepping off my soapbox]</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686513">
				<div id="div-comment-686513" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686513">
			November 24, 2008 at 6:16 pm</a>		</div>

		<p>[Nice rant, but you didn&#8217;t answer the question: &#8220;If you expand a node [in the tree view] for an empty floppy drive, where is the &#8220;Sorry&#8221; message supposed to appear?&#8221; If only time were the only resource necessary for solving problems. -Raymond]</p>
<p>The little triangle (or plus) goes away, and a red x is overlayed on the drive icon.</p>
<p>[And how is the enumerator supposed to know whether it&#8217;s being called by the tree control or the details pane? -Raymond]</p>
<p>As other people have said, IShellFolder3. New interface can have &nbsp;EnumObjectsEx which takes a new parameter- dwFlags, and when called with ISF_FLAG_FAIL_ON_NO_MEDIA, it returns 80070458 (ERROR_NO_MEDIA_IN_DRIVE).</p>
<p>(It can have CreateViewObjectEx too)</p>
<p>Existing code wont call these methods, so they wont get the new behaviour, and the default with the Ex functions is to keep the old behaviour anyway.</p>
<div class=post>[<i>Okay, but that&#8217;s adding a flag for one specific implementation to a general-purpose interface. Some people might call that poor engineering. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686533">
				<div id="div-comment-686533" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Leo Davidson</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686533">
			November 24, 2008 at 6:34 pm</a>		</div>

		<p>I agree that you cannot change what IShellFolder::EnumObjects does. Nor can you make view creation fail when there&#8217;s no disc in the drive. Things depend on that.</p>
<p>But I don&#8217;t see why there couldn&#8217;t be a new interface derived from IShellFolder with an EnumObjects2 method that has the required flags and out values to do what&#8217;s needed. Old code would continue to call the old EnumObjects and get the old behaviour.</p>
<p>Showing a &quot;No disc in drive&quot; message in the tree under the drive (or indicating it as part of the drive label or as an infotip on the drive) seems like a good solution as well.</p>
<p>&lt;&lt; but designing in a special case to a general interface just for one program tends to create resentment for others: &quot;How come Explorer can do this but my program can&#8217;t?&quot; &gt;&gt;</p>
<p>I don&#8217;t understand why other programs couldn&#8217;t use the interface as well, i.e. call EnumObjects2 and take action accordingly.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686543">
				<div id="div-comment-686543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">SRS</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686543">
			November 24, 2008 at 6:41 pm</a>		</div>

		<p>&quot;And what is the priority for fixing this problem, anyway?&quot;</p>
<p>-1, clearly. This week anyway.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686553">
				<div id="div-comment-686553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anonymous Coward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686553">
			November 24, 2008 at 6:42 pm</a>		</div>

		<p>I think what people want to see here is a different icon on the tree and a message in the view side (a bit like the empty list text added to the ListViewCtrl recently). Rather than a message box.</p>
<p>I don&#8217;t see the need to add or change interfaces or behaviour of those that exist. Why not just create a different view in IShellFolder::CreateViewWindow. One that says &quot;hey, there&#8217;s no media in the drive&quot; instead of showing the files. Then you won&#8217;t need to change the enumerator (which seems like a bad idea). This shouldn&#8217;t break exisiting apps (except those that depend on the type or implementation detail of the usual view). You might even be able to do it in the original view. It has a pointer to the IShellFolder right? Why not check if the object is a removable media drive and if it has media before calling EnumObjects and then put up the message.</p>
<p>I&#8217;d agree that this is only a minor issue, but it is irritating when navigating down the tree view with the keyboard over a removable drive.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686563">
				<div id="div-comment-686563" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://lambert.geek.nz/' rel='external nofollow' class='url'>Miral</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686563">
			November 24, 2008 at 7:10 pm</a>		</div>

		<p>I don&#8217;t have a problem with Explorer displaying a message box if it wants to. &nbsp;What bothers me is that an enumeration function is displaying the messagebox itself instead of returning a failure code and letting the caller figure out how they want to show the error.</p>
<p>Still, at least it&#8217;s documented that way.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686573">
				<div id="div-comment-686573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Duke of New York</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686573">
			November 24, 2008 at 9:51 pm</a>		</div>

		<p>That would be consistent with my impression of how many COM interfaces have been born over the years.</p>
<p>Essentially, once upon a time there was code in Windows or Office that needed to be reused, so Microsoft cut around it with a jigsaw, made the cut an interface, and left the existing code untouched to avoid breakage.</p>
<p>Microsoft wouldn&#8217;t be the only company to develop a platform this way, although it might have kept going longer than anyone else. The downside is that parts of Windows look like jigsaw puzzles.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686583">
				<div id="div-comment-686583" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mike Dunn</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686583">
			November 24, 2008 at 10:05 pm</a>		</div>

		<p>Follow-up question: Does the enumerator also eject the CD tray if you click on an empty CD drive in Explorer?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-dean-harding even thread-even depth-1" id="comment-686593">
				<div id="div-comment-686593" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Dean+Harding' rel='external nofollow' class='url'>Dean Harding</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686593">
			November 24, 2008 at 10:41 pm</a>		</div>

		<p>Mike: It does for me on Vista.</p>
<p>Or are you asking whether the EnumObjects implementation itself does it, or some other component? It should be easy enough to write a test application to find out&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686603">
				<div id="div-comment-686603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686603">
			November 24, 2008 at 11:10 pm</a>		</div>

		<p>[Okay, but that&#8217;s adding a flag for one specific implementation to a general-purpose interface. Some people might call that poor engineering. -Raymond]</p>
<p>Perhaps, but it didn&#8217;t stop you guys from adding &lt;a href=&#8221;<a href="http://msdn.microsoft.com/en-us/library/bb774820" target=_new rel=nofollow rel="nofollow">http://msdn.microsoft.com/en-us/library/bb774820</a>(VS.85).aspx&#8221;&gt;IShellView3&lt;/a&gt;.</p>
<div class=post>[<i>Huh? That was not a special-case fix for a specific implementation. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686393">
				<div id="div-comment-686393" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ton</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686393">
			November 24, 2008 at 3:28 pm</a>		</div>

		<p>&#8216;[Redesign of external behavior = incompatibility. Oh, and IShellFolder implementations were not originally written in C++. -Raymond]&#8217;</p>
<p>For the first point,when I write of Inversion Of Control techniques, I&#8217;m actually speaking of a redesign of internal behavior. The external behavior or interface remains constant and allows more flexibility if the callers only depend on the external interface or behavior. </p>
<p>As for the second point now that IShellFolder is written in C++ since the scope resolution operator is not present in C then it follows that the refactoring that I describe is possible. </p>
<p>P.S. For those who are unfamiliar with IoC:</p>
<p><a href="http://en.wikipedia.org/wiki/Inversion_of_control" target=_new rel=nofollow rel="nofollow">http://en.wikipedia.org/wiki/Inversion_of_control</a></p>
<div class=post>[<i>Changing the behavior of IShellFolder = a change to external behavior. (Oh, and IShellFolder *is* an abstract class with all pure virtual methods. But the semantics of those virtual methods is an external behavior.) -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686613">
				<div id="div-comment-686613" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jango</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686613">
			November 24, 2008 at 11:49 pm</a>		</div>

		<p>I&#8217;d be very interested to know whether anyone ever inserts a disk when prompted. (can CEIP data track this?) I know I personally haven&#8217;t, over the years. So most of the time, it&#8217;s a nag.</p>
<p>And if there&#8217;s no disk, just return a damn error, forget the dialog.</p>
<p>If someone can&#8217;t work out that they couldn&#8217;t enumerate the files on a disk because there was no disk, they have more fundamental problems than the &quot;correctness&quot; of an enumerator making assumptions about intended behavior.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686623">
				<div id="div-comment-686623" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Drak</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686623">
			November 25, 2008 at 1:51 am</a>		</div>

		<p>Maybe I&#8217;m the only one to see it this way, but the way it is now makes it a lot easier for someone to make his own view of the filesystem doesn&#8217;t it? No need to take into account all those marginal behaviours like what to do if there&#8217;s no disk, it&#8217;s all take care of for you!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686633">
				<div id="div-comment-686633" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Kenneth</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686633">
			November 25, 2008 at 4:39 am</a>		</div>

		<p>Here is a way to have the special case in the view implementation instead of in the IShellFolder interface.</p>
<ol>
<li>Explorer calls IShellFolder::CreateViewWindow</li>
<li>
<p>The view calls IShellFolder::EnumObjects with a NULL HWND. If the call succeeds, great. If the call fails with an HRESULT indicating a drive with no media, show the error in the view and don&#8217;t proceed any further.</p>
</li>
<li>
<p>If the previous call failed with an error code that we don&#8217;t specifially handle in step 2, call IShellFolder::EnumObjects again, this time with a valid HWND.</p>
</li>
<li>
<p>If we got a valid IEnumIDList interface in step 2 or 3, display its objects in the view.</p>
</li>
</ol>
<p>The upshot of this is that we get the behaviour we want without changing the interface, and it&#8217;s also fairly backwards compatible: if the EnumObjects implementation doesn&#8217;t return the error codes we&#8217;re specifically looking for when the call fails with a NULL HWND, we revert to the previous behaviour.</p>
<p>The downshot is that in some failure cases, two calls are made to EnumObjects instead of one.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686643">
				<div id="div-comment-686643" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Carl</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686643">
			November 25, 2008 at 4:50 am</a>		</div>

		<p>&quot;No need to take into account all those marginal behaviours like what to do if there&#8217;s no disk, it&#8217;s all take care of for you!&quot;</p>
<p>A floppy disk not being in the drive is not marginal these days is it?? A card reader that sets itself up as 4 different drive letters; you&#8217;re not going to have a memory card in each of them at all times are you?</p>
<p>It might be all taken care of for me, but not in a very nice way if I have my own skinned app and no way to make this dialog &#8216;fit in&#8217;&#8230;</p>
<p>I just find it bad practice that a method with a name EnumObjects can raise a dialog rather than just returning an error code.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686663">
				<div id="div-comment-686663" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://levsblog.wordpress.com' rel='external nofollow' class='url'>Lev</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686663">
			November 25, 2008 at 7:35 am</a>		</div>

		<p>And why can&#8217;t the view handle the error by displaying a message?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686683">
				<div id="div-comment-686683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">eth0</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686683">
			November 25, 2008 at 8:33 am</a>		</div>

		<p>@Dean Harding:</p>
<p>[No object to enumerate != No media</p>
<p>They&#8217;re two different conditions (no objects to enumerate is just an empty folder)]</p>
<p>No, an empty folder is an object itself.</p>
<p>@Aaaargh!:</p>
<p>That would be much cleaner, perhaps levering the already present GPO flags for hiding driveletters could be used?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-dwalker-wk odd alt thread-odd thread-alt depth-1" id="comment-686713">
				<div id="div-comment-686713" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/DWalker' rel='external nofollow' class='url'>DWalker</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686713">
			November 25, 2008 at 10:33 am</a>		</div>

		<p>Really, people, Microsoft&#8217;s programmers have better things to do than &quot;fix&quot; this!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686753">
				<div id="div-comment-686753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">SuperKoko</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686753">
			November 25, 2008 at 11:18 am</a>		</div>

		<p>To fix something, it has to be broken in the first place.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686773">
				<div id="div-comment-686773" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alexandre Grigoriev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686773">
			November 25, 2008 at 11:33 am</a>		</div>

		<p>&#8220;[QueryInterface works great if you have an IUnknown you can invoke it on. Too bad there isn&#8217;t one. -Raymond]</p>
<p>Are you kidding me? IShellFolder::CreateViewObject &nbsp;returns an interface to a new object with a requested GUID. EACH OF THOSE INTERFACES IS DERIVED FROM IUnknown. YOU CAN CALL QueryInterface on any of those. </p>
<div class=post>[<i>Um, if you QI that, you&#8217;ll just be QI&#8217;ing yourself. That tells you nothing about your caller. I can&#8217;t believe I had to explain that. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686803">
				<div id="div-comment-686803" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Somebody</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686803">
			November 25, 2008 at 11:54 am</a>		</div>

		<p>You could add an interface to Explorer to allow an enumerator to set some error message on the explorer window. &nbsp;All old interfaces will continue to behave the same. &nbsp;Only the enumerators that are aware of the enhanced Explorer can set an error message before returning an error code from IShellFolder::EnumObjects. &nbsp;The old enumerators will continue to just show a message box.</p>
<div class=post>[<i>And you pass that new interface to the enumerator how? -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686813">
				<div id="div-comment-686813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686813">
			November 25, 2008 at 12:15 pm</a>		</div>

		<p>[Huh? That was not a special-case fix for a specific implementation. -Raymond]</p>
<p>I don&#8217;t follow you; how is IShellView3::CreateViewWindow3 any different from (the hypothetical) IShellFolder3::EnumObjectsEx? &nbsp;The situations look identical to me.</p>
<div class=post>[<i>CreateViewWindow3 added a dwViewFlags parameter which applies to all views; it&#8217;s not a special-case flag just for file systems. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686833">
				<div id="div-comment-686833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alexandre Grigoriev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686833">
			November 25, 2008 at 12:18 pm</a>		</div>

		<p>&#8220;Only the enumerators that are aware of the enhanced Explorer can set an error message before returning an error code from IShellFolder::EnumObjects.&#8221;</p>
<p>[And you pass that new interface to the enumerator how? -Raymond]</p>
<p>I don&#8217;t know, Raymond, if Seattle weather makes you thick, or you&#8217;re in &#8220;try to figure out how it CAN&#8217;T be done&#8221; mood, but here is the deal:</p>
<p>The <em>enumerator</em> provides an interface for the folder view and tree view. A <em>view</em> object queries the enumerator object for an extended interface. Extended interface function sets the enumerator instance to &#8220;no UI&#8221; mode (or privides EnumWithoutUI function). View object calls the enumerator, and if enumeration fails, no dialog shall be shown, but only an appropriate error code will be returned. I can&#8217;t believe I have to explain it all to you.</p>
<div class=post>[<i>There is no enumerator. IShellFolder::EnumObjects displays an error message and returns NULL. Even if it returned an enumerator (say an empty enumerator), it&#8217;s too late. You&#8217;re setting the parameters to suppress an error message that has already been displayed. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686873">
				<div id="div-comment-686873" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Somebody</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686873">
			November 25, 2008 at 1:33 pm</a>		</div>

		<p>[Poking into HWNDs to get interface pointers is not very COM-like. (What if the window belongs to another process?) -Raymond]</p>
<p>Reading more documentation, I just noticed the IShellFolder::BindToObject function. &nbsp;Maybe Explorer can pass that interface in the IBindCtx *pbc parameter. &nbsp;The IBindCtx::RegisterObjectParam function seems to be designed for things like this.</p>
<div class=post>[<i>That&#8217;s an interesting idea (the bind context is a great place to dump things like this), but the bind isn&#8217;t involved in the view creation&#8230; -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686883">
				<div id="div-comment-686883" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Lee Griffiths</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686883">
			November 25, 2008 at 1:38 pm</a>		</div>

		<p>I don&#8217;t think I understand the problem to well..</p>
<p>Surely Explorer could just <em>not</em> create the pop up box and instead of that action put the message in the folder view area?</p>
<div class=post>[<i>Right, and then the view creation would succeed even though it arguably should have failed. Maybe this is acceptable to you. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686893">
				<div id="div-comment-686893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686893">
			November 25, 2008 at 1:58 pm</a>		</div>

		<p>[CreateViewWindow3 added a dwViewFlags parameter which applies to all views; it&#8217;s not a special-case flag just for file systems. -Raymond]</p>
<p>Ok. &nbsp;Then replace IShellFolder3 with IShellFileSystemFolder. &nbsp;Now instead of a special-case flag on a general-purpose interface you have a special-case interface.</p>
<div class=post>[<i>Well, that just punts the problem to the hsot application. How many special-case interfaces should Explorer need to know about? -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686943">
				<div id="div-comment-686943" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Somebody</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686943">
			November 25, 2008 at 2:43 pm</a>		</div>

		<p>Explorer never calls IShellFolder::BindToObject? &nbsp;Does it only call IShellFolder::CreateViewObject then IShellView::CreateViewWindow? &nbsp;Then I guess you have to bypass COM entirely and create some &quot;int SetExplorerError(HWND hWnd, LPCTSTR lpText);&quot; function to be called from IShellFolder::EnumObjects. &nbsp;The function would use some internal WM_EXPLORER_XXX message to send the error text to the window.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686963">
				<div id="div-comment-686963" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">kristofr</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686963">
			November 25, 2008 at 3:21 pm</a>		</div>

		<p>I think there&#8217;s a pretty simple solution:</p>
<p>Add a new flag called SHCONTF_RETURN_ERROR_MESSAGE</p>
<p>If there&#8217;s an error and the flag is set, have EnumObjects return an error HRESULT and use ::SetErrorInfo with an IErrorInfo implementation that contains the text message.</p>
<p>If the flag isn&#8217;t set, revert to the old behavior.</p>
<p>APIs that pop up error message windows are kind of obnoxious.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686983">
				<div id="div-comment-686983" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686983">
			November 25, 2008 at 3:41 pm</a>		</div>

		<p>[Well, that just punts the problem to the hsot application. How many special-case interfaces should Explorer need to know about? -Raymond]</p>
<p>As many as the Shell team adds.</p>
<div class=post>[<i>So much for a generic unified browsing interface. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686673">
				<div id="div-comment-686673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Aaargh!</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686673">
			November 25, 2008 at 7:46 am</a>		</div>

		<p>Why is there a drive icon to click on in the first place ?</p>
<p>I don&#8217;t get Windows shows icons for *drives* if it&#8217;s a removable drive (CD/floppy), and for *filesystems* if it&#8217;s a fixed drive (harddisk). This doesn&#8217;t seem very logical or consistent.</p>
<p>I prefer the way Apple does it, I insert a memory stick/CD/etc. it shows up on the desktop, I remove it, it&#8217;s gone. If there is not disc/stick/memorycard/floppy in the drive there is simply no icon. So the whole problem goes away.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-687003">
				<div id="div-comment-687003" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alexandre Grigoriev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-687003">
			November 25, 2008 at 3:49 pm</a>		</div>

		<p>Raymond,</p>
<p>We all understand why it was done this way back then, but PLEASE, don&#8217;t BS us that it&#8217;s not feasible, can&#8217;t be done at all, bla bla bla. </p>
<div class=post>[<i>The original point of the article wasn&#8217;t that it can&#8217;t be done. It&#8217;s that it didn&#8217;t fit in with the design of the view model. People seem to be saying, &#8220;Well the view model sucks. I should be allowed to create views on things that don&#8217;t exist.&#8221; -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-687023">
				<div id="div-comment-687023" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ton</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-687023">
			November 25, 2008 at 4:42 pm</a>		</div>

		<p>&#8216;[The original point of the article wasn&#8217;t that it can&#8217;t be done. It&#8217;s that it didn&#8217;t fit in with the design of the view model. People seem to be saying, &quot;Well the view model sucks. I should be allowed to create views on things that don&#8217;t exist.&quot; -Raymond]&#8217;</p>
<p>This first sentence in this reply is exactly what I was trying to point out. It&#8217;s possible now it just wasn&#8217;t in the original design back then.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-687043">
				<div id="div-comment-687043" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Pierre B.</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-687043">
			November 25, 2008 at 5:10 pm</a>		</div>

		<p>&lt;&lt;Recycle Bin and Control Panel follow the rule that &#8220;if the view object can be created, then you have a valid view.&#8221; -Raymond&gt;&gt;</p>
<p>Obviously, both in the original poster and my suggestion, the view gets created successfully and is valid in the same sense that any special item view is valid. It&#8217;s just that it contains a single item showing the error.</p>
<p>I don&#8217;t know enough about the low-level implementation of CreateViewWindow to determine if doing this violate some part of its contract, but it would seem to me that it is allowed to create whatever view it want or need based on the content of the folder, even if the folder or its contents are virtual files.</p>
<div class=post>[<i>The original model was that if a view was created, it corresponded to a valid object. As opposed to &#8220;it&#8217;s a view that doesn&#8217;t do anything aside from showing an error message.&#8221; I guess this also means that if you type a path to a nonexistent directory into the Address bar, instead of getting an error message popup, you should navigate to an empty folder with the message &#8220;The folder name is invalid.&#8221; Not sure if people would actually like that. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686823">
				<div id="div-comment-686823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Somebody</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686823">
			November 25, 2008 at 12:16 pm</a>		</div>

		<p>[And you pass that new interface to the enumerator how? -Raymond]</p>
<p>HRESULT EnumObjects(</p>
<p>&nbsp; &nbsp;HWND hwndOwner,</p>
<p>&nbsp; &nbsp;SHCONTF grfFlags,</p>
<p>&nbsp; &nbsp;IEnumIDList **ppenumIDList</p>
<p>);</p>
<p>Can&#8217;t the enumerator call some GetNewExplorerInterface(hwndOwner) to get it? &nbsp;Checking first that hwndOwner isn&#8217;t null of course.</p>
<div class=post>[<i>Poking into HWNDs to get interface pointers is not very COM-like. (What if the window belongs to another process?) -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-dean-harding even thread-even depth-1" id="comment-687083">
				<div id="div-comment-687083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Dean+Harding' rel='external nofollow' class='url'>Dean Harding</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-687083">
			November 25, 2008 at 9:39 pm</a>		</div>

		<p>&quot;Not sure if people would actually like that.&quot;</p>
<p>It could probably go both ways. IE displays the error in a page rather than a dialog box, so people are at least somewhat used to it.</p>
<p>I think the real problem, though, is when that &quot;insert a CD&quot; dialog box pops up, you can insert a CD and it goes away automatically. I&#8217;m not sure how that would work if explorer navigated to some &quot;error&quot; view instead&#8230; would you expect it to automatically navigate to the &quot;real&quot; view when you insert a CD? Would there be a &quot;refresh&quot; or &quot;try again&quot; button on the error page to make it try again? etc</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-686923">
				<div id="div-comment-686923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Duke of New York</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686923">
			November 25, 2008 at 2:35 pm</a>		</div>

		<p>Gee whiz people, just create a window that handles WM_PARENTNOTIFY[WM_CREATE] and pass it as the parent window. The handler can close the new window and signal the view that EnumObjects failed. Was that so hard?</p>
<p>*waits for this to show up on thedailywtf*</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-686993">
				<div id="div-comment-686993" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alexandre Grigoriev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-686993">
			November 25, 2008 at 3:45 pm</a>		</div>

		<p>[There is no enumerator. IShellFolder::EnumObjects displays an error message and returns NULL. Even if it returned an enumerator (say an empty enumerator), it&#8217;s too late. You&#8217;re setting the parameters to suppress an error message that has already been displayed. -Raymond]</p>
<p>IShellFolder * pShellFolder;</p>
<p>// assume we got pShellFolder</p>
<p>IEnumFolderSuperAdvanced * pEnumInterface = NULL; // hypothetical new interface</p>
<p>if (SUCCEEDED(pShellFolder-&gt;QueryInterface(__uuidof(pEnumInterface), (void**) &amp; pEnumInterface)))</p>
<p>&nbsp; {</p>
<p>&nbsp; &nbsp; &nbsp;pEnumInterface-&gt;EnumObjectsNoUi(Whatever)</p>
<p>&nbsp; &nbsp; &nbsp;pEnumInterface-&gt;Release();</p>
<p>&nbsp; }</p>
<p>else</p>
<p>&nbsp; {</p>
<p>&nbsp; pShellFolder-&gt;EnumObjects(Whatever);</p>
<p>&nbsp; }</p>
<p>I can&#8217;t believe I have to write it down for you. And about hypothetical new interface: There were like 8 years of opportunity to add it.</p>
<div class=post>[<i>Sure, a new EnumObjects method would work. I thought you were trying to enhance EnumObjects. Mind you, this technique already exists without needing a new interface: Pass hwnd=NULL to EnumObjects to say &#8220;I want to enumerate with no UI.&#8221; Of course, Explorer actually does want UI. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-687113">
				<div id="div-comment-687113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://a.coward@slashdot.org' rel='external nofollow' class='url'>Anonymous Coward</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-687113">
			November 26, 2008 at 2:48 am</a>		</div>

		<p>Yes, you could change the behaviour using a new interface, as described in the comments above, and let applications that want that behaviour use that new interface. But as an end-user I&#8217;m happy with the current situation: if there&#8217;s no disk in the drive, I don&#8217;t want a fake view, I want an error message. And as a developer, I am kind of glad that I don&#8217;t have to code special logic for everything that could go wrong; keep it simple and reliable. So from my point of view this isn&#8217;t a bug, and therefore there&#8217;s nothing that needs fixing.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-687673">
				<div id="div-comment-687673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">me</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-687673">
			November 27, 2008 at 10:19 am</a>		</div>

		<blockquote><p>
  [And how does IShellFolder::CreateShellView decide whether to do things the old way or the new way?
</p></blockquote>
<p>Obviously, the program could check if the new interface is offered, and if not, use the old interface.</p>
<blockquote><p>
  And what is the priority for fixing this problem, anyway? It&#8217;s not like this is a data loss bug. -Raymond]
</p></blockquote>
<p>No, it&#8217;s not like any customer is going to be surprised when Windows is acting all retarded once again.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-687993">
				<div id="div-comment-687993" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-687993">
			November 28, 2008 at 2:46 pm</a>		</div>

		<p>Useful programs are written to be used. Not because it should be easy to develop them.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-688233">
				<div id="div-comment-688233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Igor Levicki</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-688233">
			November 30, 2008 at 3:34 am</a>		</div>

		<p>Raymond said: &gt;&gt;Okay, but that&#8217;s adding a flag for one specific implementation to a general-purpose interface. Some people might call that poor engineering.&lt;&lt;</p>
<p>As opposed to current solution being what? Good engineering?!? [From an end-user perspective of course.]</p>
<div class="post">[<i>So you believe that the way to solve solving a problem with bad engineering is to add more bad engineering on top of it. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-688243">
				<div id="div-comment-688243" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Igor Levicki</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081124-00/?p=20103#comment-688243">
			November 30, 2008 at 3:37 am</a>		</div>

		<blockquote><p>
  &gt;I guess this also means that if you type a path to a nonexistent directory into the Address bar, instead of getting an error message popup, you should navigate to an empty folder with the message &quot;The folder name is invalid.&quot; Not sure if people would actually like that.&lt;&lt;
</p></blockquote>
<p>The message &quot;The folder name is invalid. Click here if you wanted to create it.&quot; would be cool.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>