<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (19)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-925043">
				<div id="div-comment-925043" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Tringi</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925043">
			July 15, 2011 at 7:49 am</a>		</div>

		<p>It is far too common to assume that GetModuleHandle(NULL) is equivalent to something like GetCurrentModuleHandle (which is not that difficult to write yourself, google for it).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-925053">
				<div id="div-comment-925053" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925053">
			July 15, 2011 at 8:11 am</a>		</div>

		<p>I&#39;m in the habit of saving my HINSTANCE in DLLMain to avoid this kind of problem.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-jader3rd even thread-even depth-1" id="comment-925063">
				<div id="div-comment-925063" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/jader3rd' rel='external nofollow' class='url'>jader3rd</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925063">
			July 15, 2011 at 8:40 am</a>		</div>

		<p>My mom still believes that ignorant means going out of your way to be mean. We&#39;ve tried to tell her that that&#39;s not what it means, but she claims that&#39;s how everyone else (ie, everyone but her spouse and children) uses the word.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-925073">
				<div id="div-comment-925073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">David Walker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925073">
			July 15, 2011 at 9:43 am</a>		</div>

		<p>&quot;Two wrongs make a wronger&quot;. &nbsp;How true. &nbsp;I&#39;ll have to remember that phrase.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-925093">
				<div id="div-comment-925093" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Adam Rosenfield</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925093">
			July 15, 2011 at 9:46 am</a>		</div>

		<p>Ah, the politician&#39;s fallacy: &nbsp;&quot;Something must be done. &nbsp;This is something. &nbsp;Therefore we must do this.&quot; &nbsp;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-925103">
				<div id="div-comment-925103" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Disparato</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925103">
			July 15, 2011 at 9:54 am</a>		</div>

		<p>How can I get the correct HINSTANCE if my code lives in a static library that is used both for building EXEs and DLLs? Passing in an HINSTANCE is not an option.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-925113">
				<div id="div-comment-925113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Moi</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925113">
			July 15, 2011 at 10:08 am</a>		</div>

		<p>@Disparato</p>
<p>Raymond has covered this before. Search for __ImageBase.</p>
<p><a rel="nofollow" target="_new" href="http://blogs.msdn.com/b/oldnewthing/archive/2004/10/25/247180.aspx" rel="nofollow">blogs.msdn.com/&#8230;/247180.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-925123">
				<div id="div-comment-925123" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jeremy</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925123">
			July 15, 2011 at 10:32 am</a>		</div>

		<p>If a person knows or finds out that a valid library card is required to check out a book, I cannot believe that a &quot;reasonable person&quot; (<a rel="nofollow" target="_new" href="http://en.wikipedia.org/wiki/Reasonable_person" rel="nofollow">en.wikipedia.org/&#8230;/Reasonable_person</a>) would think that using someone else&#39;s library card without their knowledge would be a viable solution. &nbsp;I think in this case, ignorance is neglegence. &nbsp;We need some sort of protection against neglegent and reckless programmers!</p>
<p><a rel="nofollow" target="_new" href="http://en.wikipedia.org/wiki/Mens_rea" rel="nofollow">en.wikipedia.org/&#8230;/Mens_rea</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-maurits even thread-even depth-1" id="comment-925133">
				<div id="div-comment-925133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Maurits+%5BMSFT%5D' rel='external nofollow' class='url'>Maurits [MSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925133">
			July 15, 2011 at 11:39 am</a>		</div>

		<p>In Redmond, library cards require a PIN for self-checkout. &nbsp;Not sure how your identity is verified when you check out at the librarian&#39;s desk.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-925143">
				<div id="div-comment-925143" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark (The other Mark)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925143">
			July 15, 2011 at 12:20 pm</a>		</div>

		<p>Does anyone have a reference to the story in the footnote? That sounds interesting, but right now my searches mostly point to blogs copying this one.</p>
<div class="post">[<i>Reference: Personal communication. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-925183">
				<div id="div-comment-925183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Myria</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925183">
			July 15, 2011 at 4:57 pm</a>		</div>

		<p>If you don&#39;t like the __ImageBase trick, or you&#39;re using a different compiler like GCC, you can also do this, if you can require XP or later:</p>
<p>static const wchar_t s_empty[] = L&quot;&quot;;</p>
<p>if (!GetModuleHandleExW(GET_MODULE_HANDLE_EX_FLAG_FROM_ADDRESS | GET_MODULE_HANDLE_EX_FLAG_UNCHANGED_REFCOUNT, s_empty, &amp;wndclass.hInstance))</p>
<p>{</p>
<p>&nbsp;// error</p>
<p>}</p>
<p>s_empty will be within your module.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-925233">
				<div id="div-comment-925233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">MJP</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925233">
			July 17, 2011 at 4:51 pm</a>		</div>

		<p>@Ray: Try translating this article to german with the MS Translator&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-wndsks even thread-even depth-1" id="comment-925253">
				<div id="div-comment-925253" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/skSdnW' rel='external nofollow' class='url'>skSdnW</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925253">
			July 18, 2011 at 3:20 am</a>		</div>

		<p>@Myria: If you check the link posted by Moi you will see the GetModuleHandleEx trick and the older VirtualQuery variant&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-925263">
				<div id="div-comment-925263" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">hagenp</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925263">
			July 18, 2011 at 3:44 am</a>		</div>

		<p>&quot;When reading the documentation, they found that they needed to fill in the hInstance member of the WNDCLASS structure.&quot;&#8230;but no additional information or example that explains _why_ and how to use the function. Hence documentation-induced errors are created.</p>
<div class="post">[<i>Its purpose is explained in the <a href="http://msdn.microsoft.com/en-us/library/ms633574(v=VS.85).aspx" rel="nofollow">overview article</a>. And the &quot;Reference&quot; section of the WNDCLASS documentation links to all the overview articles. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-925283">
				<div id="div-comment-925283" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">henke37</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925283">
			July 18, 2011 at 6:09 am</a>		</div>

		<p>It is documented, it just so happens that the documentation assumes that the reader knows what an instance is in the first place.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-925503">
				<div id="div-comment-925503" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925503">
			July 18, 2011 at 6:48 pm</a>		</div>

		<p>API is not helping. Should be designed better.</p>
<div class="post">[<i><a href="http://blogs.msdn.com/b/oldnewthing/archive/2007/07/09/3769001.aspx" rel="nofollow">It&#39;s not enough to say that something is bad; you have to say what would be better</a>. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-925663">
				<div id="div-comment-925663" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925663">
			July 19, 2011 at 9:04 am</a>		</div>

		<p>I don&#39;t get paid for designing windows api, i&#39;m only the sucker who use them. Please google (or bing!) on &quot;pit of success&quot;.</p>
<div class="post">[<i>You don&#39;t have to design it, just say wat would be better &#8212; i.e., how you would prefer to use it. &quot;I don&#39;t want to have to pass an instance handle parameter. The system should just figure it out somehow.&quot; (Answer: &quot;Somehow&quot; involves guessing.) -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-925683">
				<div id="div-comment-925683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jules</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-925683">
			July 19, 2011 at 11:17 am</a>		</div>

		<p>@640k: to expand on Raymond&#39;s point a little, a guess is likely to be wrong in at least some cases, because there are at least three entirely different use cases for a DLL registering a window class: (1) the DLL is going to create windows itself, (2) the DLL is providing the behaviour for windows that the main application (or some other DLL also loaded by the application) is going to create, or (3) the DLL is simply registering the class on behalf of a caller, and is in no way involved with any interpretation of what the parameters mean. &nbsp;So either you expand the API to account for all these possibilities (possibly along with others I haven&#39;t thought of), or you require the DLL to provide details of a namespace of some kind. &nbsp;Now, the instance handle is probably the best bet for a namespace, because it is the only thing that changes if the same code is included twice in two different DLLs (e.g. because two different parts of an application are using two different versions of the same DLL).</p>
<p>The only other possibilityies increase the complexity of creating windows (because they prevent you from using constant class names to identify the type of window you&#39;re creating; you&#39;d need to use either some kind of window class handle or a pointer to a WNDCLASS structure or similar), which is hardly beneficial. &nbsp;All to save people having to store a handle in a global variable at startup time? &nbsp;Absurd.</p>
<p>Now, don&#39;t get me wrong, the Windows API is a long way from flawless, but this doesn&#39;t seem too bad to me. &nbsp;No other possible choices look all that much better from where I&#39;m sitting.</p>
<p>[Aside &#8212; I don&#39;t suppose anyone knows why I always have to enter my posts twice whenever I&#39;m trying to post here, do you? &nbsp;It&#39;s quite predictable. &nbsp;Using Firefox 3.6 on XP, noscript enabled but allowing scripts to run on msdn.com and microsoft.com]</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-926313">
				<div id="div-comment-926313" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20110715-00/?p=10133#comment-926313">
			July 22, 2011 at 1:35 am</a>		</div>

		<p>If there 3 completely different use cases for a single API function, that function should be spit into three different functions.</p>
<p>But if doesn&#39;t help, the whole architecture should be changed to not require the &quot;api user&quot; to guess.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>