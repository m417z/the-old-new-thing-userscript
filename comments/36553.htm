<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (46)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-251503">
				<div id="div-comment-251503" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.apptranslator.com' rel='external nofollow' class='url'>Serge Wautier</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251503">
			February 1, 2005 at 7:26 am</a>		</div>

		<blockquote><p>
  BOOL Is64BitProcessRunningOn64BitWindows() { return TRUE; } </p>
<p>It may have been interesting to have the function as an API though to already include a check for the day Win128 ships. Since there&#8217;s no such API, we&#8217;ll have to recompile. Or is it already known that there will be no Win128 within foreseable future ?</p>
<p>BTW, why would a 32-bits process be interested to know that it runs on Win64 ?
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251513">
				<div id="div-comment-251513" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://Isthepoweron?' rel='external nofollow' class='url'>Mike Weiss</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251513">
			February 1, 2005 at 7:30 am</a>		</div>

		<p>I noticed yesterday the reason codes for the InitiateSystemShutdown (and ExitWindowsEx, SHUTDOWN.EXE etc&#8230; ) there is this code:</p>
<p>SHTDN_REASON_MINOR_CORDUNPLUGGED</p>
<p>umm, if the code is unplugged how does any process get the chance to use this flag??<br />
<br />Maybe some type of UPS? I dunno, but I thought it was somewhat funny.</p>
<p>I suggest this one:<br />
<br />SHTDN_REASON_MINOR_CRUSHEDBY_50TON_WEIGHT</p>
<p></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251523">
				<div id="div-comment-251523" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://Isthepoweron?' rel='external nofollow' class='url'>Mike Weiss</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251523">
			February 1, 2005 at 7:32 am</a>		</div>

		<p>Oops, my point about the shutdown code above was in reference to Raymond&#8217;s comment about &quot;asking if the power is on?&quot;! </p>
<p>Not sure if I made that clear!!<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251533">
				<div id="div-comment-251533" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.cataraxia.com/' rel='external nofollow' class='url'>Kristoffer Henriksson</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251533">
			February 1, 2005 at 7:39 am</a>		</div>

		<blockquote><p>
  &gt; SHTDN_REASON_MINOR_CORDUNPLUGGED &lt;&lt;</p>
<p>Probably intended for use with laptops that can survive on their own without external power for a bit.</p>
</blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251543">
				<div id="div-comment-251543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Cooney</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251543">
			February 1, 2005 at 7:47 am</a>		</div>

		<blockquote><p>
  umm, if the code is unplugged how does any process get the chance to use this flag?? </p>
<p>Windows runs on laptops, too.
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251563">
				<div id="div-comment-251563" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blog.speedproject.de/' rel='external nofollow' class='url'>Sven</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251563">
			February 1, 2005 at 7:53 am</a>		</div>

		<p>IsWow64Process is unsupported on Windows 9x/ME/NT4/2000, so don&#8217;t forget to link dynamically.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251573">
				<div id="div-comment-251573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.livejournal.com/users/baljemmett/' rel='external nofollow' class='url'>Ben A L Jemmett</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251573">
			February 1, 2005 at 8:01 am</a>		</div>

		<p>SHTDN_REASON_MINOR_CORDUNPLUGGED might also be the reason code used when &quot;Power failure (cord unplugged)&quot; is selected as the reason for an unexpected shutdown.  There&#8217;s also &quot;Power failure (environmental)&quot;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251583">
				<div id="div-comment-251583" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John Elliott</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251583">
			February 1, 2005 at 8:09 am</a>		</div>

		<p>Just imagine if Win16 had included a function called something like GetSystemWordSize(). When Win95 came out, half-a-dozen crucial widely-distributed 16-bit apps would have promptly broken because this function was now returning 32. And a dozen more Win32 apps when it went to 64&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251593">
				<div id="div-comment-251593" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Memet</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251593">
			February 1, 2005 at 8:11 am</a>		</div>

		<p>My hands down favorite weird code is the IRQL in Windows kernel mode: POWER_LEVEL. It&#8217;s set way up at 30 (with only one more level above it). Masks pretty much all hardware IRQs.<br />
<br /> I really wonder what can trigger that IRQ, and what goes on when it does in fact get raised.<br />
<br /> Of course, having a other things to do, I&#8217;ve never actually investigated.<br />
<br /> Anyone care to shed some light on the issue?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251603">
				<div id="div-comment-251603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://sab39.dev.netreach.com/' rel='external nofollow' class='url'>Stuart Ballard</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251603">
			February 1, 2005 at 8:12 am</a>		</div>

		<p>Ah, but then what happens if the server is crushed by a 51-ton weight? I suggest a whole new field in the shutdown API to specify the exact weight that did the crushing&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251613">
				<div id="div-comment-251613" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Tim Robinson</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251613">
			February 1, 2005 at 8:40 am</a>		</div>

		<p>The BeOS kernel (<a target="_new" href="http://www.tycomsystems.com/beos/BeBook/The%20Kernel%20Kit/System.html" rel="nofollow">http://www.tycomsystems.com/beos/BeBook/The%20Kernel%20Kit/System.html</a>) exports two very useful system calls:</p>
<p>&#8211; is_computer_on returns 1 if the computer is turned on. If the computer is not turned on, the result is undefined.</p>
<p>&#8211; is_computer_on_fire returns the temperature of the motherboard if the computer is currently on fire. If the computer isn&#8217;t on fire, the function returns some other value.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251623">
				<div id="div-comment-251623" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Plum</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251623">
			February 1, 2005 at 8:41 am</a>		</div>

		<p>Out of curiosity, why would a 32-bit process care if it&#8217;s running on WOW or not?  Is there special action it might have to take?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251643">
				<div id="div-comment-251643" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.accidentalscientist.com' rel='external nofollow' class='url'>Simon Cooke [exMSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251643">
			February 1, 2005 at 8:52 am</a>		</div>

		<p>Plum &#8211;<br />
<br />Well, one reason would be so that you could go to your online update site, see that there&#8217;s a 64-bit version of the DLLs available for download, push them to the user, and then fixup everything to run that instead of the old 32-bit version next time they launch it.</p>
<p>Just an idea, mind you.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251663">
				<div id="div-comment-251663" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mr. Foot Pizza</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251663">
			February 1, 2005 at 9:15 am</a>		</div>

		<p>Not to brag or anything, but one of our apps still ships 32/16 thunk DLLs for interop with some 16 bit apps which our customers still use.  We haven&#8217;t had to rebuild them in a while though.  Luckily a couple of 16 bit apps owned by our group were finally EOL&#8217;ed last year.  Even though I&#8217;m a pack rat, I&#8217;m ready to get rid of my win31 SDK manuals&#8230;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251673">
				<div id="div-comment-251673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.oosterkamp.nl' rel='external nofollow' class='url'>Jeroen Pluimers</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251673">
			February 1, 2005 at 9:57 am</a>		</div>

		<p>Why not use wrap something like below in the ifdefs?<br />
<br />No need for dynamic imports as IntPtr.Size is available on all platforms.<br />
<br />Too C#&#8217;ish?</p>
<p>public static bool IsRunningOnWin64()<br />
<br />{<br />
<br />    return (IntPtr.Size == 8);<br />
<br />}</p>
<p>&#8211;jeroen<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251683">
				<div id="div-comment-251683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251683">
			February 1, 2005 at 10:02 am</a>		</div>

		<p>Ah, but that version erroneously returns TRUE for a 32-bit program running on 64-bit Windows under the emulator.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251693">
				<div id="div-comment-251693" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://Isthepoweron?' rel='external nofollow' class='url'>Mike Weiss</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251693">
			February 1, 2005 at 10:33 am</a>		</div>

		<p>In response to Windows running on laptops. Ummm, are you sure!?!? ;)</p>
<p>The full use to that &quot;cord unplugged&quot; flag is: SHTDN_REASON_MAJOR_POWER (combined with) | SHTDN_REASON_MINOR_CORDUNPLUGGED. </p>
<p><a target="_new" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/sysinfo/base/system_shutdown_reason_codes.asp" rel="nofollow">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/sysinfo/base/system_shutdown_reason_codes.asp</a></p>
<p>If the intention was this to be used for powering off in a low battery situation (UPS, laptop) it could be worded a bit better!</p>
<p>Anyway the BeOS kernal calls are great! Thanks Tim!<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251703">
				<div id="div-comment-251703" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://sab39.dev.netreach.com/' rel='external nofollow' class='url'>Stuart Ballard</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251703">
			February 1, 2005 at 10:38 am</a>		</div>

		<p>I wonder how many computers had to be destroyed during QA of the is_computer_on_fire function&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251713">
				<div id="div-comment-251713" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">nitpicker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251713">
			February 1, 2005 at 10:47 am</a>		</div>

		<p>Note that you should not call IsWow64Process directly.  Use GetProcAddress if you want this code to run on 32-bit XP.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251723">
				<div id="div-comment-251723" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">rellis</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251723">
			February 1, 2005 at 10:59 am</a>		</div>

		<p>We&#8217;ve got a lot of 32-bit processes running on 64-bit Windows, but unfortunately they&#8217;re things like WSH that don&#8217;t have access to API calls such as IsWow64Process.  I wish they did, though, because some of the registry and system directory fakeouts performed by the 64-bit OS causes confusion when we start launching 64-bit utilities (or use something like WMI) that are not subject to the fakeouts.  At times like those, I need to know if I&#8217;m running on 64-bit Windows so I can tell my 64-bit utility and/or WMI where to look for something.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251733">
				<div id="div-comment-251733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">nitpicker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251733">
			February 1, 2005 at 11:14 am</a>		</div>

		<p>for WSH and CMD files you can check the environment variable PROCESSOR_ARCHITEW6432</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251743">
				<div id="div-comment-251743" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Matt Green</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251743">
			February 1, 2005 at 11:14 am</a>		</div>

		<p>Well, write a program to call IsWow64Process() for you and call that through WMI.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251753">
				<div id="div-comment-251753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://24.odessa.ua/' rel='external nofollow' class='url'>AT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251753">
			February 1, 2005 at 11:20 am</a>		</div>

		<p>&quot;Is the power on ?&quot;<br />
<br />Why nope ?<br />
<br /><a target="_new" href="http://msdn.microsoft.com/library/en-us/power/base/getsystempowerstatus.asp" rel="nofollow">http://msdn.microsoft.com/library/en-us/power/base/getsystempowerstatus.asp</a></p>
<p>As well &#8211; there can be some kind of crazy BIOS code that will keep track of current time or Wake-on-XXX events. This code definitely requere &quot;IsPowerOn()&quot; method &#8211; as there can be several different &quot;Off&quot; states &#8211; &quot;Soft Off&quot; and &quot;Mechanical Off&quot;.<br />
<br /><a target="_new" href="http://msdn.microsoft.com/library/en-us/power/base/system_power_states.asp" rel="nofollow">http://msdn.microsoft.com/library/en-us/power/base/system_power_states.asp</a></p>
<p>Never trust in common logic. Always read documentation ;-)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251763">
				<div id="div-comment-251763" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jeremy Morton [MSFT]</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251763">
			February 1, 2005 at 11:42 am</a>		</div>

		<p>&quot;The full use to that &quot;cord unplugged&quot; flag is: SHTDN_REASON_MAJOR_POWER (combined with) | SHTDN_REASON_MINOR_CORDUNPLUGGED. </p>
<p><a target="_new" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/sysinfo/base/system_shutdown_reason_codes.asp" rel="nofollow">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/sysinfo/base/system_shutdown_reason_codes.asp</a> </p>
<p>If the intention was this to be used for powering off in a low battery situation (UPS, laptop) it could be worded a bit better!&quot;</p>
<p>The intention is to prompt the first administrator that logs onto the server after it comes up for the reason that the server was unexpectedly shutdown [how does it know the shutdown was unexpected? by using a heartbeat service]. In this scenario, it&#8217;s perfectly reasonable for the [sheepish] administrator to say it was because the cord was unplugged. I suspect that the reason the &quot;reason code&quot; is available for an API initiating a shutdown is just to have all the reason codes listed, even if it doesn&#8217;t make sense to say: &quot;I&#8217;m trying to shutdown because the cord is about to be unplugged.&quot; I would think that the reason code for power failure (environment) would be more likely to be used for UPS/laptop shutdowns than &quot;cord unplugged.&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251783">
				<div id="div-comment-251783" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">David Chapman</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251783">
			February 1, 2005 at 1:57 pm</a>		</div>

		<p>This was asked earlier in the thread but noone replied:</p>
<p>BOOL Is64BitProcessRunningOn64BitWindows()<br />
<br />{<br />
<br /> return TRUE;<br />
<br />}</p>
<p>Will there never be such a thing as 128 bit windows?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251793">
				<div id="div-comment-251793" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251793">
			February 1, 2005 at 2:33 pm</a>		</div>

		<p>You&#8217;re asking people to predict the future; no surprise nobody has taken you up on it.</p>
<p>Besides, even if your program detected 128-bit Windows, what can you do in response? Are you going to start passing undefined flags in the hopes that one of them suddenly means something on 128-bit Windows?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251803">
				<div id="div-comment-251803" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dean Harding</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251803">
			February 1, 2005 at 2:46 pm</a>		</div>

		<blockquote><p>
  Will there never be such a thing as 128 bit windows?</p>
<p>I can&#8217;t see why not.  It may seem like 64 bits is all we&#8217;ll ever need for now, but when 32-bit came out, I&#8217;m sure we thought the same thing then&#8230;</p>
<p>Still, given that 64 bit has taken so long to become mainstream, I don&#8217;t think anyone will try to lump 128 bit on us for a while.
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251813">
				<div id="div-comment-251813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">michaels</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251813">
			February 1, 2005 at 4:31 pm</a>		</div>

		<blockquote><p>
  Ah, but that version erroneously returns<br />
  <br />&gt; TRUE for a 32-bit program running on 64-bit<br />
  <br />&gt; Windows under the emulator. </p>
<p>But surely thats the whole <em>purpose</em> of the emulator? You run it saying &quot;Please pretend this program is running in 64bit windows&quot;. I would be upset if it <em>didn&#8217;t</em> detect 64bit in the emulator&#8230; wouldn&#8217;t you ?
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251833">
				<div id="div-comment-251833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251833">
			February 1, 2005 at 4:55 pm</a>		</div>

		<p>Yes, it&#8217;s the purpose of the emulator, but some people want to know that they are running inside an x86 emulator (for example, maybe they want to pass the REG_WOW64_64KEY flag to RegOpenKeyEx in order to open the 64-bit registry) &#8211; that&#8217;s the purpose of this exercise.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251883">
				<div id="div-comment-251883" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">doug</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251883">
			February 1, 2005 at 5:48 pm</a>		</div>

		<p>Hiya.  Can someone explain the &amp;f64 and f64 literals/variables/constants in the code snippet in the initial post?</p>
<p>I don&#8217;t have access the API or docs from where i am, and google isn&#8217;t helping.</p>
<p>thanks</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251893">
				<div id="div-comment-251893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">doug</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251893">
			February 1, 2005 at 5:57 pm</a>		</div>

		<p>ah, i see now.  i was just being a fool and missing the declation of f64 as a local var in the function.  (kinda hard to miss, you&#8217;d think!)</p>
<p>a little bird (MSDN) told me you also had to check for the presence of the IsWow64Process function.  another one of those migration problems we all hate.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251903">
				<div id="div-comment-251903" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Cheong</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251903">
			February 1, 2005 at 7:58 pm</a>		</div>

		<p>I have one maybe simple question.</p>
<p>Can I run 32-bit version of Windows on 64-bit systems? Just like in the days of 80386 I can run Windows 3.1 standard mode on a 386 machine? And does it have any impact on programs running on it?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251913">
				<div id="div-comment-251913" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dean Harding</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251913">
			February 1, 2005 at 8:44 pm</a>		</div>

		<blockquote><p>
  Can I run 32-bit version of Windows on 64-bit systems?</p>
<p>That&#8217;s a function of the architecture, not of Windows.  For example, the 80386 DX (I believe the DX was the first 32-bit processor) was fully backwards compatible with it&#8217;s 16-bit cousins.</p>
<p>However, Intel&#8217;s Itanium 64-bit architecture is not backwards compatible with the x86 architecture and so you can only run 64-bit Windows on it.</p>
<p>AMD&#8217;s X64 (and Intel&#8217;s copy of that, EM64T) /is/ backwards compatible with x86, and so 32-bit Windows will run fine on it.</p>
<p>Running 32-bit applications on a 64-bit Windows is different again, and is like running a Windows 3.1 app on Windows 2000/XP &#8211; it&#8217;ll work, but the OS has to pull off a number of tricks to make it to work.
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251923">
				<div id="div-comment-251923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Vorn</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251923">
			February 1, 2005 at 9:41 pm</a>		</div>

		<p>Why &quot;wow&quot;?</p>
<p>Vorn</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251933">
				<div id="div-comment-251933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">CN</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251933">
			February 1, 2005 at 10:42 pm</a>		</div>

		<p>Vorn: Windows on Windows.</p>
<p>Dean Harding: I&#8217;m quite sure the SX was also capable of i386 protected mode, but it had a cheaper 16-bit bus. But, I think the original 386s of all flavors (where I think the DX was introduced first) had some bugs that made them impossible to use in that mode, after all.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251943">
				<div id="div-comment-251943" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">beuges</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251943">
			February 1, 2005 at 11:03 pm</a>		</div>

		<p>wow means &quot;Windows on Windows&quot; afaik.  32bit windows uses wow to run 16bit code on 32bit windows, and 64bit windows uses wow to run 32bit code on 64bit windows.  I could be wrong but its kinda like an emulator for the 32bit subsystem on the 64bit operating system.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-251973">
				<div id="div-comment-251973" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.apptranslator.com' rel='external nofollow' class='url'>Serge Wautier</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251973">
			February 2, 2005 at 1:53 am</a>		</div>

		<p>Raymond wrote:</p>
<p>&gt; You&#8217;re asking people to predict the future; no surprise nobody has taken you up on it. </p>
<p>This is not what I initially asked. My original question was:</p>
<p>Is it already known that there will be no Win128 within foreseable future ?</p>
<p>Slightly different ! If the future cannot be predicted in this matter then the answer to the question is : No. And back to the problem at hand: Why then is there no Is64BitProcessRunningOn64BitWindows() API today to ensure further compatibility in non excluded future scenarios ?</p>
<p>What I would do with it if it existed ? I don&#8217;t know. Neither do I know what to do with IsWow64Process() today. And Simon Cooke&#8217;s suggestion remains valid for a possibly upcoming Win128 as well.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-251993">
				<div id="div-comment-251993" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.blacksun.org.uk/' rel='external nofollow' class='url'>Paul</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-251993">
			February 2, 2005 at 4:27 am</a>		</div>

		<p>Hey, let&#8217;s just add a &quot;RunningOnNBitWindows&quot; function call, with &quot;n&quot; passed in by the process&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-252023">
				<div id="div-comment-252023" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">RunningOnNBitWindows</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-252023">
			February 2, 2005 at 6:15 am</a>		</div>

		<p>&quot;n&quot; should be the return value of RunningOnNBitWindows(), else you have to call it several times to get the &quot;width&quot; of the current os.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-252133">
				<div id="div-comment-252133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anonymous</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-252133">
			February 2, 2005 at 8:24 am</a>		</div>

		<p>&quot;But how do you detect programmatically from your 64-bit process whether you are running on 64-bit Windows? Easy.</p>
<p>BOOL Is64BitProcessRunningOn64BitWindows()<br />
<br />{<br />
<br /> return TRUE;<br />
<br />}&quot;</p>
<p>LOL!  Thanks Raymond, that and your reply to the original blogger made my morning &#8230; keep em coming &#8230;<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-252493">
				<div id="div-comment-252493" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">DrPizza</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-252493">
			February 2, 2005 at 5:51 pm</a>		</div>

		<p>&quot;However, Intel&#8217;s Itanium 64-bit architecture is not backwards compatible with the x86 architecture and so you can only run 64-bit Windows on it. &quot;<br />
<br />Not true.  Not only does it have x86 emulation performed in hardware (albeit slowly), it also has (in Win2K3SP1 and up) software emulation (which I believe does fancy tricks like profiling and essentially recompile) which runs considerably faster than the hardware support.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-252433">
				<div id="div-comment-252433" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dean Harding</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-252433">
			February 2, 2005 at 2:26 pm</a>		</div>

		<p>&gt; Why then is there no Is64BitProcessRunningOn64BitWindows() API today?</p>
<p>Because until there *is* a 128-bit Windows, then knowing that you&#8217;re running on a 128-bit windows in 64-bit emulation mode is meaningless.  You only ever need to know you&#8217;re a 32-bit process running on 64-bit Windows if you want to take advantage of 64-bit features (e.g. like accessing the 64-bit registry as opposed to the WoW 32-bit registry).  So without an actual 128-bit platform to take advantage of, you can&#8217;t gain anything by knowing whether you&#8217;re running on it or not.</p>
<p>Of course, if 128-bit Windows ever does come out, then you&#8217;re going to have to modify your code to take advantage of it&#8217;s features anyway, so putting the call to Is64BitRunningOn128Bit is no problem.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-252843">
				<div id="div-comment-252843" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://geekswithblogs.net/khanna/archive/2005/02/04/21931.aspx' rel='external nofollow' class='url'>.NET Insights</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-252843">
			February 3, 2005 at 2:52 pm</a>		</div>

		
		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-252943">
				<div id="div-comment-252943" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Antoine</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-252943">
			February 4, 2005 at 2:38 am</a>		</div>

		<p>CN: Yes, 80386SX was able to run 32-bit protected mode programs, including 3.1 enhanced mode provided sufficient (extended) memory. Of course, it also could execute 32-bit instructions in 16-bit program too.</p>
<p>80386DX was a name put back (much like Win16), originally this processor was simply 80386.<br />
<br />The first released steps of this chip (B1 and prior, that is before 1997-04) had a 32-bit multiply bug, but AFAIK it did not prevent to use 32-bit mode, it &quot;just&quot; requires to replace a 32-bit MUL with (several) 16-bit ones (remember the Pentium bug, anyone?) Of course, it was much easier to explaine the customers they should not install 32-bit softwares and let softwares use 32-bit MUL without worrying!</p>
<p>And a very good problem I have no definitive answer to is how to detect if you are running on a 80286 or a 80386+, if you are in protected mode and do not want/can change the illegal instruction handler (one way to have 99% certainity is to check the upper word of SGDT, it is 0xFF with 80286; but this is a possible yet unlikely value for a 80386 too).</p>
<p>So here again, the solution is to rely to an API, exactly as Raymond highlighted. My best candidate is the DPMI function 0400h.</p>
<p>Btw: Win16 is not supported within Win64/x64, even if the processor allows execution of 16-bit protected mode code in long mode. I conjectured this is because the V86 mode is not available, and far too much Win16 programs may rely on it or on similar DOS-related things (such as allocating &#8216;real-mode&#8217; memory, or PSP). Any insight?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-253723">
				<div id="div-comment-253723" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.blacksun.org.uk/' rel='external nofollow' class='url'>Paul</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-253723">
			February 8, 2005 at 8:06 am</a>		</div>

		<p>&lt;quote&gt;&quot;n&quot; should be the return value of RunningOnNBitWindows(), else you have to call it several times to get the &quot;width&quot; of the current os.&lt;/quote&gt;</p>
<p>Yes, but at least then we can tell by the startup delay which programmers were daft enough to use it. ;-)</p>
<p>&quot;0-bit? no. How about 1-bit? No, okay, maybe 2-bit?&#8230;&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-416913">
				<div id="div-comment-416913" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/oldnewthing/archive/2006/09/06/742710.aspx' rel='external nofollow' class='url'>The Old New Thing</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20050201-00/?p=36553#comment-416913">
			September 6, 2006 at 10:00 am</a>		</div>

		<p>It&#8217;s what you&#8217;re compiling for.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>