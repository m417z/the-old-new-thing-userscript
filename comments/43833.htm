<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (18)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-1156083">
				<div id="div-comment-1156083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156083">
			October 16, 2014 at 7:04 am</a>		</div>

		<p>I call this boilerplate adapter.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1156093">
				<div id="div-comment-1156093" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Henke37</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156093">
			October 16, 2014 at 7:11 am</a>		</div>

		<p>Then using CreateRemoteThread must be the injected lackey pattern.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alexcohn even thread-even depth-1" id="comment-1156103">
				<div id="div-comment-1156103" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Alex+Cohn' rel='external nofollow' class='url'>Alex Cohn</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156103">
			October 16, 2014 at 7:38 am</a>		</div>

		<p>I understand this only makes sense for DLL_THREAD_* notifications, and it may be very useful if your EXE allows plugins that may create and terminate threads. You can add a simple global object with constructor and destructor, to have an equivalent of PROCESS_ATTACH and PROCESS_DETACH.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1156113">
				<div id="div-comment-1156113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">KJK::Hyperion</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156113">
			October 16, 2014 at 7:40 am</a>		</div>

		<p>Or use a TLS routine. It has almost the same signature as DllMain, except it returns void (it can&#39;t veto operations), it&#39;s called inside the loader lock like a DllMain, and the Microsoft linker and C runtime already come with built-in (if undocumented) support to add your own TLS routines</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alexcohn even thread-even depth-1" id="comment-1156133">
				<div id="div-comment-1156133" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Alex+Cohn' rel='external nofollow' class='url'>Alex Cohn</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156133">
			October 16, 2014 at 1:03 pm</a>		</div>

		<p>@KJK::Hyperion : thanks for the hint, I found this description of TLS callbacks (<a rel="nofollow" target="_new" href="http://www.nynaeve.net/?p=183">http://www.nynaeve.net/?p=183</a>) fascinating.</p>
<p>But void return should not be a problem, because &quot;When the system calls the DllMain function with any value other than DLL_PROCESS_ATTACH, the return value is ignored&quot;(<a rel="nofollow" target="_new" href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms682583(v=vs.85).aspx">msdn.microsoft.com/&#8230;/ms682583(v=vs.85).aspx</a>).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1156143">
				<div id="div-comment-1156143" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">igorsk</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156143">
			October 16, 2014 at 1:46 pm</a>		</div>

		<p>Yes, I&#39;m curious why Raymond did not mention TLS callbacks. I can&#39;t quite imagine him not knowing about them.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1156153">
				<div id="div-comment-1156153" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Rick C</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156153">
			October 16, 2014 at 2:22 pm</a>		</div>

		<p>Raymond frequently builds on a topic over several columns. &nbsp;A quick search for &quot;thread local storage old new thing&quot; shows he&#39;s mentioned TLS before. &nbsp;This post may well simply be the entre.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1156163">
				<div id="div-comment-1156163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Adam Rosenfield</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156163">
			October 16, 2014 at 3:53 pm</a>		</div>

		<p>I suspect that Raymond hasn&#39;t mentioned TLS callbacks because they&#39;re undocumented implementation details that well-behaved programs shouldn&#39;t rely on.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1156173">
				<div id="div-comment-1156173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">KC</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156173">
			October 16, 2014 at 4:50 pm</a>		</div>

		<p>Not to nitpick too much, but shouldn&#39;t Lakey return the value from calling g_lackeyNotification? &nbsp;The sample always returns TRUE</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1156183">
				<div id="div-comment-1156183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">foo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156183">
			October 16, 2014 at 4:57 pm</a>		</div>

		<p>If the lackey feels unappreciated and wants to take some time off it can insert a sneaky call to DisableThreadLibraryCalls() at the start of its DllMain.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1156203">
				<div id="div-comment-1156203" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">kme</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156203">
			October 16, 2014 at 9:41 pm</a>		</div>

		<p>What&#39;s the difference between a lackey, a flunky and a stooge?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1156213">
				<div id="div-comment-1156213" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Myria</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156213">
			October 16, 2014 at 10:00 pm</a>		</div>

		<p>@Adam Rosenfield: TLS callbacks are documented in Microsoft&#39;s published PE file format specification. &nbsp;Also, PIMAGE_TLS_CALLBACK is an exposed typedef in WinNT.h.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1156233">
				<div id="div-comment-1156233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Hildar</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156233">
			October 17, 2014 at 2:07 am</a>		</div>

		<p>TLS callbacks are also red flags to malware scanners, since malware has been known to sit in them so it can run before a breakpoint on main().</p>
<p>No one legitimately uses feature X? Better stop people ever using feature X!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1156253">
				<div id="div-comment-1156253" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Steve Macpherson</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156253">
			October 17, 2014 at 5:37 am</a>		</div>

		<p>&#8230;and you can always LoadLibrary() on the EXE itself if you especially want to &#8211; which would avoid having to distribute a DLL with your EXE.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1156263">
				<div id="div-comment-1156263" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156263">
			October 17, 2014 at 6:50 am</a>		</div>

		<p>@SteveMacphearson: With the consequence of can&#39;t link against libc (and I&#39;m sure there&#39;s more).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1156273">
				<div id="div-comment-1156273" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Hildar</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156273">
			October 17, 2014 at 6:58 am</a>		</div>

		<p>According to the documentation, no equivalent of DllMain is run if you LoadLibrary a .exe. So it wouldn&#39;t even work.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1156373">
				<div id="div-comment-1156373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156373">
			October 17, 2014 at 8:47 am</a>		</div>

		<p>@Hildar: A better read of the documentation is required. It will call the entry point of the .EXE expecting to find _DllMainCRTStartup there.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alegrigoriev odd alt thread-odd thread-alt depth-1" id="comment-1156553">
				<div id="div-comment-1156553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/alegr1' rel='external nofollow' class='url'>alegr1</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20141016-00/?p=43833#comment-1156553">
			October 20, 2014 at 11:36 am</a>		</div>

		<p>&gt;It will call the entry point of the .EXE expecting to find _DllMainCRTStartup there.</p>
<p>Only if IMAGE_FILE_DLL flag is present. Which makes it not an EXE.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>