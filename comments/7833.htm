<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (40)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-978593">
				<div id="div-comment-978593" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/stephen.oberholtzer_4000_freedompay.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>stephen.oberholtzer@freedompay.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978593">
			April 18, 2012 at 7:04 am</a>		</div>

		<p>&quot;Switch to 64-bit mode&quot;?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-978603">
				<div id="div-comment-978603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">acq</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978603">
			April 18, 2012 at 7:42 am</a>		</div>

		<p>Wait, did I understand it correctly, the whole frigging file is mapped into the process&#39; memory only for version info that&#39;s certainly only a few kilobytes to be read? Then, no wonder customers can&#39;t understand.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-978613">
				<div id="div-comment-978613" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978613">
			April 18, 2012 at 7:48 am</a>		</div>

		<p>@acq: &nbsp;GetFileVersionInfo() dates back to at least Windows 3.1, probably further. &nbsp;Those were simpler times.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-978623">
				<div id="div-comment-978623" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">acq</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978623">
			April 18, 2012 at 7:49 am</a>		</div>

		<p>To be more precise, there&#39;s this nice Win32 API function called MapViewOfFile with which only some small portion of the large file can be mapped. I&#39;m sorry but I don&#39;t understand the necessity to map the whole file except that it was easier to write that code without thinking too much.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-978633">
				<div id="div-comment-978633" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Raphael</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978633">
			April 18, 2012 at 7:50 am</a>		</div>

		<p>Well, mapping a file into memory is one of the faster methods of opening large files, so why not?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-978643">
				<div id="div-comment-978643" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jonathan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978643">
			April 18, 2012 at 7:52 am</a>		</div>

		<p>easier-to-write code + not thinking much ==&gt; win!</p>
<p>And it it creates an edge case where you can&#39;t see the version of a huge file, it&#39;s totally worth it IMO.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-978653">
				<div id="div-comment-978653" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">me2</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978653">
			April 18, 2012 at 7:53 am</a>		</div>

		<p>Makes you wonder how they get the icon from the resource section, doesn&#39;t it?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-978673">
				<div id="div-comment-978673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978673">
			April 18, 2012 at 8:37 am</a>		</div>

		<p>Which is why when I have giant resources, I use my own resource format. Bytes 124-127 point to my custom resource descriptor (These bytes are padding in the MS-DOS stub program). LoadLobraryEx doesn&#39;t try to map beyond the end of the PE file, but my data starts after it.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-978683">
				<div id="div-comment-978683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">dave</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978683">
			April 18, 2012 at 8:51 am</a>		</div>

		<blockquote><p>
  One customer apparently didn&#39;t understand the unpredictability of the cutover point and asked, &quot;Is there a way to change this limit?&quot;
</p></blockquote>
<p>Sure. &nbsp;Write yourself a plug-in which allocates a large part of the address space and holds onto it forever. &nbsp;Now your limit is much lower. &nbsp;Thanks for asking.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-978693">
				<div id="div-comment-978693" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Patje</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978693">
			April 18, 2012 at 8:58 am</a>		</div>

		<p>Was this behavior changed in Windows Vista? &nbsp;If it is, then this might explain a very specific problem I have.</p>
<p>I always link my application with the /SWAPRUN:NET option, to make sure that if my customer runs the executable over the network, that the whole executable is loaded in memory (just in case the network connection drops out, or the file server is rebooted while the application is running). &nbsp;However, since Windows Vista, this flag also causes the Windows Explorer to load the whole executable into memory, just to get the version information.</p>
<p>The end result is that with a folder filled with large (20MB) executables: In Windows versions before Vista, the Explorer immediately showed all icons; Since Windows Vista, you see the icons appearing slowly one by one (about 1 icon every 3 seconds).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-xpclientgmail-com even thread-even depth-1" id="comment-978703">
				<div id="div-comment-978703" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/xpclient' rel='external nofollow' class='url'>xpclient</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978703">
			April 18, 2012 at 9:04 am</a>		</div>

		<p>There is no Version tab. There is a Details tab that omits custom version information strings that the Version tab showed, does not show all of the same information as the Version tab and does not support quickly copying any of the displayed information to the clipboard. The status bar and Details pane also no longer show version information, although fortunately, the Details pane can be made to show version info by tweaking the registry.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-978713">
				<div id="div-comment-978713" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978713">
			April 18, 2012 at 9:16 am</a>		</div>

		<p>@xpclient: &nbsp;Yep, this is one of those seemingly small things that really bugs me about Vista and beyond (especially the inability to copy to clipboard). &nbsp;Alas the trend seems to be favoring simplification over functionality.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alegrigoriev even thread-even depth-1" id="comment-978723">
				<div id="div-comment-978723" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/alegr1' rel='external nofollow' class='url'>alegr1</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978723">
			April 18, 2012 at 10:37 am</a>		</div>

		<p>Patje:</p>
<p>Vista+ Explorer, it finds so many wretched ways to be a sloth&#8230; I think it&#39;s because underprogrammers are mindlessly executing the marketroids&#39; orders&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-978733">
				<div id="div-comment-978733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Rob</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978733">
			April 18, 2012 at 11:33 am</a>		</div>

		<p>@xpclient &#8211; you forget that Raymond writes some/all of these posts well in advance. When this post was written it could&#39;ve been referencing XP/2003/2003R2.</p>
<p>That aside, do you ever tire of posting off-topic rants?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-978743">
				<div id="div-comment-978743" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">jon</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978743">
			April 18, 2012 at 12:49 pm</a>		</div>

		<p>Has the bug been fixed where GetFileVersionInfo(Size) left a lock on any file that failed in this manner (too large to be mapped in)?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-978753">
				<div id="div-comment-978753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978753">
			April 18, 2012 at 12:56 pm</a>		</div>

		<p>In &quot;normal&quot; circumstances, surely this shouldn&#39;t happen unless the file is hundreds of megabytes, right?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-978763">
				<div id="div-comment-978763" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">AC</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978763">
			April 18, 2012 at 2:44 pm</a>		</div>

		<p>@Rob</p>
<blockquote><p>
  That aside, do you ever tire of posting off-topic rants?
</p></blockquote>
<p>Huh?? That&#39;s the sole reason for his existence. He even registered for maximum troll impact.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-978773">
				<div id="div-comment-978773" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/ian_4000_docsys.com.au/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>ian@docsys.com.au</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978773">
			April 18, 2012 at 4:23 pm</a>		</div>

		<p>@patje &#8211; not sure if you&#39;re the same Patrick who asked this question on ServerFault&#8230; &nbsp;<a rel="nofollow" target="_new" href="http://serverfault.com/questions/95264/performance-problem-in-vista-windows-explorer-if-swaprunnet-is-set-on-an-execu" rel="nofollow">serverfault.com/&#8230;/performance-problem-in-vista-windows-explorer-if-swaprunnet-is-set-on-an-execu</a></p>
<p>Makes sense that LoadLibrary would follow the flags. &nbsp;</p>
<p>It&#39;s not unreasonable for LoadLibrary to have been used for this purpose back when the resource extraction code was written. &nbsp;Yes it could be improved upon now &#8211; Raymond doesn&#39;t write about &quot;why things are perfect and needn&#39;t change&quot; after all :) &nbsp;As a maintainer of an app that first started 9 years ago I can appreciate how reasonable architecture decisions made back then (fortunately they&#39;ve dated fairly well in my case) can affect things today.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-978793">
				<div id="div-comment-978793" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Craig</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978793">
			April 18, 2012 at 6:02 pm</a>		</div>

		<p>If you need to load the entire file into memory, then you&#39;re doing it wrong. The algorithm needs to be improved.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-978803">
				<div id="div-comment-978803" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/jehokim_4000_live.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>jehokim@live.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978803">
			April 18, 2012 at 6:29 pm</a>		</div>

		<p>&quot;Is there a way to change this limit?&quot;</p>
<p>&quot;Well, use 64bit Windows.&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-xpclientgmail-com even thread-even depth-1" id="comment-978813">
				<div id="div-comment-978813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/xpclient' rel='external nofollow' class='url'>xpclient</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978813">
			April 18, 2012 at 8:55 pm</a>		</div>

		<p>@Rob</p>
<p>How well in advance do you think this post may have been written? Even earlier than 2006?</p>
<p>@AC</p>
<p>Offtopic? You must be blind or it&#39;s a case of pot calling the kettle black.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-978823">
				<div id="div-comment-978823" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dave</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978823">
			April 18, 2012 at 9:46 pm</a>		</div>

		<blockquote><p>
  You must be blind or it&#39;s a case of pot calling the kettle black.
</p></blockquote>
<p>Samovar is silver and zavarka pot is also silver. I understand not this saying.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-978833">
				<div id="div-comment-978833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ooh</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978833">
			April 19, 2012 at 2:05 am</a>		</div>

		<p>@Craig:</p>
<blockquote><p>
  If you need to load the entire file into memory, then you&#39;re doing it wrong.
</p></blockquote>
<p>I fail to see where Raymond wrote that the entire file is loaded into memory, sorry. LoadLibrary does not mean that the entire file is loaded from disk immediately.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-978853">
				<div id="div-comment-978853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">asdbsd</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978853">
			April 19, 2012 at 5:10 am</a>		</div>

		<p>@John: &quot;Alas the trend seems to be favoring simplification over functionality.&quot;</p>
<p>Don&#39;t worry, they changed it in Windows 8. Functionality and simplicity are equally wrecked now.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-978993">
				<div id="div-comment-978993" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">voo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978993">
			April 19, 2012 at 10:13 am</a>		</div>

		<p>@John If you want functionality over simplicity why are you using a GUI instead of the much more versatile and powerful commandline? Sigcheck should do all that stuff just fine. See, problem solved.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-978843">
				<div id="div-comment-978843" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Raphael</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-978843">
			April 19, 2012 at 3:21 am</a>		</div>

		<p>@Craig:</p>
<p>The file isn&#39;t *loaded* into memory. It&#39;s *mapped* into memory. Loading happens on demand.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-979073">
				<div id="div-comment-979073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Neil</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-979073">
			April 19, 2012 at 11:49 am</a>		</div>

		<p>I&#39;m surprised that LOAD_LIBRARY_AS_DATAFILE would still go ahead and load all the code segments, seeing as the handle is only useful for Find/LoadResource.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-979083">
				<div id="div-comment-979083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-979083">
			April 19, 2012 at 11:50 am</a>		</div>

		<p>The same problems must have existed with &gt;16MB files in windows 3.1. Ouch.</p>
<div class="post">[<i>You mean 16-bit Windows? 16-bit Windows didn&#39;t have memory-mapped files! -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-979093">
				<div id="div-comment-979093" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Neil</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-979093">
			April 19, 2012 at 11:52 am</a>		</div>

		<p>I mean map all the code, not load, of course.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-979113">
				<div id="div-comment-979113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-979113">
			April 19, 2012 at 12:57 pm</a>		</div>

		<p>@voo: &nbsp;Because the GUI was sufficiently functional until it was changed. &nbsp;Functionality and simplicity do not have to be mutually exclusive.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-979153">
				<div id="div-comment-979153" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-979153">
			April 19, 2012 at 2:34 pm</a>		</div>

		<p>[You mean 16-bit Windows? 16-bit Windows didn&#39;t have memory-mapped files! -Raymond]</p>
<p>I think it also can&#39;t run that big of executable.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-979163">
				<div id="div-comment-979163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-979163">
			April 19, 2012 at 2:39 pm</a>		</div>

		<p>[You mean 16-bit Windows? 16-bit Windows didn&#39;t have memory-mapped files! -Raymond]</p>
<p>Are you saying that perfectly working code was replaced by new code which couldn&#39;t load large files?</p>
<div class="post">[<i>News flash: 16-bit Windows did not contain any code to parse Win32 binaries. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cheong even thread-even depth-1" id="comment-979193">
				<div id="div-comment-979193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/cheong00' rel='external nofollow' class='url'>cheong00</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-979193">
			April 19, 2012 at 8:32 pm</a>		</div>

		<p>[News flash: 16-bit Windows did not contain any code to parse Win32 binaries. -Raymond]</p>
<p>Emmm&#8230; I think I was able to install Win32s to Win3.1 and run certain Win32 binaries&#8230;</p>
<p>Okay&#8230; I know it&#39;s a limited library and doesn&#39;t likely to provide such feature, and it doesn&#39;t come with Win3.1 as well&#8230; :X</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-andycadley2 odd alt thread-odd thread-alt depth-1" id="comment-979353">
				<div id="div-comment-979353" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/AndyCadley' rel='external nofollow' class='url'>AndyCadley</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-979353">
			April 22, 2012 at 3:58 am</a>		</div>

		<p>The truly shocking thing, highlighted by the commenters here, is just how few developers understand the difference between memory mapping a file and actually fetching any of those bits from disk.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-979363">
				<div id="div-comment-979363" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">@AndyCadley</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-979363">
			April 23, 2012 at 6:52 am</a>		</div>

		<p>I would also claim that this entry hints us that the whole concept of memory-mapped files is somewhat wrong: It gives the developer the impression that they can aviod bufferering and positioned reads/writes by mapping in the file and do simple pointer arithmetic. But as this topic shows, this does not even work flawlessly for things like reading ressources. In many cases, File Mapping seems to be the wrong solution.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-979463">
				<div id="div-comment-979463" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-979463">
			April 23, 2012 at 9:04 am</a>		</div>

		<p>[News flash: 16-bit Windows did not contain any code to parse Win32 binaries. -Raymond]</p>
<p>Once Win32s is installed, 16 bit programs such as progman.exe are able to extract icons from 32 bit binaries. I have no idea what is involved except it was not a change to progman.exe. I would indeed wonder if 640k is correct.</p>
<div class="post">[<i>Plain vanilla Windows 3.1 could not parse Win32 binaries. Or are you saying that Win32s should have been a required component in Windows 3.1? -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-979543">
				<div id="div-comment-979543" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-979543">
			April 23, 2012 at 10:31 am</a>		</div>

		<p>Let&#39;s try this again.</p>
<p>Win32s contains a parser for PE files that is somehow able to load resources from a 32 bit .EXE or .DLL for access by a 16 bit process. As you already stated, Win16 does not have any memory mapping API. Therefore, there exists a kernel routine for extracting resources that does not use memory mapping.</p>
<p>Since at that time, it was popular to write such code as would compile and run correctly on both Win16 and Win32, there is a decent chance the code in question would run correctly if compiled for Win32. I can&#39;t see the code history, but it is plausible the code was adapted from WinNT 3.1&#39;s resource parser. If that is the case, than 640k&#39;s apparently nonsensical question suddenly makes a lot of sense.</p>
<div class="post">[<i>The Win32s loader is almost certainly a completely unrelated code base from the standard Windows NT loader, since the underlying kernel services are totally different. (Win32s supports memory-mapped files, and the Win32s loader probably used that underlying functionality. As far as I&#39;m aware, standard resource extraction has always been done by memory-mapping, custom extractors notwithstanding.) -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-979663">
				<div id="div-comment-979663" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/johnstonj_4000_inn_2D00_soft.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>johnstonj@inn-soft.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-979663">
			April 23, 2012 at 1:02 pm</a>		</div>

		<p>@AndyCadley: yup, it&#39;s like they&#39;ve never heard of virtual memory and a memory hierarchy&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-979683">
				<div id="div-comment-979683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/johnstonj_4000_inn_2D00_soft.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>johnstonj@inn-soft.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-979683">
			April 23, 2012 at 1:07 pm</a>		</div>

		<p>@@AndyCadley: other than the limited address space, I fail to see why memory mapping is not a valid solution?</p>
<p>If the operating system provides adequate buffering under-the-covers so that performance doesn&#39;t suffer, why not do this? &nbsp;Using simple pointer arithmetic seems a lot simpler than having to deal with your own buffers, calling ReadFile repeatedly, and keeping track of that arithmetic! &nbsp;Let the kernel handle it all&#8230;</p>
<p>This post originated because of the limited 32-bit address space, which these days is a problem for a lot of applications &#8211; not just this one. &nbsp;(It&#39;s starting to feel like the artificial &quot;640k conventional memory&quot; limit from back in the MS-DOS days&#8230;) &nbsp;The best solution is just to switch to 64-bit, rather than engineer over-complicated solutions to fix edge cases like this.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-980073">
				<div id="div-comment-980073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">@AndyCadley</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120418-00/?p=7833#comment-980073">
			April 25, 2012 at 4:58 am</a>		</div>

		<p>@JamesJohnston: I think, 32 bit systems in general (not only Windows) will no die that fast, because of the many &quot;smart&quot; phones, tablets and the whole world of embedded devices.</p>
<p>Also, as far as I know, even 64 bit Windows does not offer the full 64 bit address range to processes. Also in 64 bit Windows, you have such strange things like Address Space Layout Randomization (spelling?) and lots of heaps, allocated by all sorts of libraries and plug-ins. On the other hand, video files and such are growing larger and larger.</p>
<p>Also, more than one part of the application can try to map in very large files (for example, multiple Explorer plug-ins). So sometimes in the future, even this huge address space may become fragmented, and the fragments may become too small. Your argument sounds a bit like the infamous &quot;640k is enough for everybody&quot;, only at a much higher level.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>