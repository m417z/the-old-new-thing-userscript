<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (9)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-1356795">
				<div id="div-comment-1356795" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Brian</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180817-00/?p=99515#comment-1356795">
			August 17, 2018 at 7:59 am</a>		</div>

		<p>&gt;&gt; The code has some nice diagrams in the comments about the stack layout. Too bad those diagrams are wrong<br />
Oh, I do so love incorrect comments.  They excel in muddifying issues.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1356805">
				<div id="div-comment-1356805" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Vas Crabb</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180817-00/?p=99515#comment-1356805">
			August 17, 2018 at 10:14 am</a>		</div>

		<p>I find the differences in ABIs for the same processor interesting.  OSX on 32-bit PowerPC reserved space at 4(R1) to save CR, and at 8(R1) to save LR.  As with WinNT, the parameter shadow space started at 24(SP), so there were three reserved words instead of five.  Classic MacOS used R2 to hold a table-of-contents pointer, but OSX did away with this and R2 had no special significance.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1356825">
				<div id="div-comment-1356825" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180817-00/?p=99515#comment-1356825">
			August 17, 2018 at 11:48 am</a>		</div>

		<p>With this particular epilogue code, I&#8217;m pretty sure if it ever took an exception that isn&#8217;t resolved by kernel page-in I want the process to crash immediately. That requires stack register r1 to be corrupted or something worse.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-aadsso-1live-com000340019af3cc36 odd alt thread-odd thread-alt depth-1 parent" id="comment-1356835">
				<div id="div-comment-1356835" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Richard+T+Russell' rel='external nofollow' class='url'>Richard T Russell</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180817-00/?p=99515#comment-1356835">
			August 17, 2018 at 2:22 pm</a>		</div>

		<p>&#8220;bringing us to 232 bytes. Since the stack must be 16-byte aligned, we round up to the next multiple of 16, but hey, it&#8217;s already a multiple of 16, so we&#8217;re good&#8221;.</p>
<p>I&#8217;m obviously misunderstanding something here: 232 isn&#8217;t a multiple of 16.</p>

		
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-oldnewthing bypostauthor even depth-2" id="comment-1356845">
				<div id="div-comment-1356845" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180817-00/?p=99515#comment-1356845">
			August 17, 2018 at 4:01 pm</a>		</div>

		<p>I am obviously unable to reverse-engineer very old kernel code. The stack alignment requirement is 8 not 16. I will update.</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment odd alt thread-even depth-1" id="comment-1356855">
				<div id="div-comment-1356855" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Yukkuri</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180817-00/?p=99515#comment-1356855">
			August 19, 2018 at 1:00 pm</a>		</div>

		<p>When your function calls need another call just to deal with the registers I feel something has gone wrong</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-wndsks even thread-odd thread-alt depth-1 parent" id="comment-1356885">
				<div id="div-comment-1356885" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/skSdnW' rel='external nofollow' class='url'>skSdnW</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180817-00/?p=99515#comment-1356885">
			August 20, 2018 at 10:22 am</a>		</div>

		<p>Since big-endian mode supports more features, did Microsoft ever consider using big-endian in the early days of NT? Too much porting work I&#8217;m guessing since some of the SDK structs (BMP headers etc.) are probably used in files and in memory?</p>

		
				</div>
		<ol class="children">
		<li class="comment odd alt depth-2" id="comment-1356905">
				<div id="div-comment-1356905" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Brian</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180817-00/?p=99515#comment-1356905">
			August 20, 2018 at 11:52 am</a>		</div>

		<p>It&#8217;s not just SDK structs.  Remember, the idea back then was to get people to port 16-bit Windows apps to the NT world.  Memory was insanely tight in those days (compared to today).  Every software vendor had bits and bytes stored carefully in their structs.  Forcing them to (optionally) swizzle every struct would have slowed down the porting efforts a lot.  Any big-endian architecture port would have been placed at the end of the list and no-one would have gotten that far down the list.</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1356965">
				<div id="div-comment-1356965" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Tom L</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180817-00/?p=99515#comment-1356965">
			August 21, 2018 at 5:14 am</a>		</div>

		<p>232 bytes&#8230; Anyone notice this post was made on day 232 of the year 2018? How long have you been planning that, Raymond?</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>