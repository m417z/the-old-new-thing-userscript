<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (8)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-118113">
				<div id="div-comment-118113" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jack Mathews</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20031226-00/?p=41343#comment-118113">
			December 26, 2003 at 8:54 am</a>		</div>

		<p>Well, someone could either:</p>
<p>Jam a new .cpl in the same dir as the EXE..  Or if they&#8217;re on a LUA, they could put a malicious .cpl in their home directory and set it as the current directory before running your program.  That would let them run their own code, bypassing policies.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-118153">
				<div id="div-comment-118153" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jordan Russell</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20031226-00/?p=41343#comment-118153">
			December 26, 2003 at 10:50 am</a>		</div>

		<p>&quot;What are the security implications of passing NULL as the first parameter to SearchPath?&quot;</p>
<p>A rogue access.cpl file could be placed in the current directory, and SearchPath would find it before the one in the system directory. (?)</p>
<p>BTW: Why do some functions (such as this CreateFile and this CreateActCtx) return INVALID_HANDLE_VALUE when they fail while others return zero?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-118163">
				<div id="div-comment-118163" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jordan Russell</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20031226-00/?p=41343#comment-118163">
			December 26, 2003 at 10:51 am</a>		</div>

		<p>Somehow I missed Jack&#8217;s comment. Whoops.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-118253">
				<div id="div-comment-118253" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.myshoggoth.com/' rel='external nofollow' class='url'>Andrew Boardman</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20031226-00/?p=41343#comment-118253">
			December 26, 2003 at 4:31 pm</a>		</div>

		<blockquote>
<pre><code>   if (cch &amp;gt; 0 &amp;amp;&amp;amp; cch &amp;lt; MAX_PATH) {
</code></pre>
<p>&gt;          RunControlPanel(hwnd, szPath);<br />
  <br />&gt;      }</p>
<p>Missing a }  :-)
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-118273">
				<div id="div-comment-118273" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20031226-00/?p=41343#comment-118273">
			December 26, 2003 at 5:50 pm</a>		</div>

		<p>Sorry bout that. Lost during editing.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-119843">
				<div id="div-comment-119843" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://alias:ndiamond@msdn.discussions.microsoft.com' rel='external nofollow' class='url'>Norman Diamond</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20031226-00/?p=41343#comment-119843">
			January 5, 2004 at 8:25 pm</a>		</div>

		<p>Why does INVALID_HANDLE_VALUE even exist?  When CreateFile() fails to open a file, its return value can be either 0 or -1.  The only reliable way to check is to ignore the MSDN Library and just test the result for &lt;= 0.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-119853">
				<div id="div-comment-119853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20031226-00/?p=41343#comment-119853">
			January 5, 2004 at 9:44 pm</a>		</div>

		<p>Believe it or not, that&#8217;s a topic I already had planned out for a future entry.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-144873">
				<div id="div-comment-144873" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">JBohm</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20031226-00/?p=41343#comment-144873">
			February 16, 2004 at 7:10 pm</a>		</div>

		<p>INVALID_HANDLE_VALUE is -1 cast to the data type HANDLE.  HANDLE is either ULONG_PTR or PVOID depending if STRICT is defined at compile time (always is for C++, optional for C).  In either case, the test &lt;= 0 is wrong because ((HANDLE)-200) is not an error (it is a real handle in some functions) and because ((ULONG_PTR)-1) &gt; 0 .</p>
<p>Anyway, INVALID_HANDLE_VALUE exists just for the benefit of people porting code from the POSIX/UNIX/C functions that return -1 on error rather then NULL, such as creat(), open() lseek() etc.</p>
<p>I have never heard of CreateFile returning NULL, but then my code routinly does:</p>
<p>if (h == INVALID_HANDLE_VALUE) h = NULL;<br />
<br />if (!h)<br />
<br />   ItFailed!</p>
<p>Oh and INVALID_HANDLE_VALUE is a valid handle to the current process (at least on ntoskrnl.exe based operating systems).  It is the success return value from GetCurrentProcess().</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>