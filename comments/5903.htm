<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (19)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment byuser comment-author-alegrigoriev even thread-even depth-1" id="comment-1024573">
				<div id="div-comment-1024573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/alegr1' rel='external nofollow' class='url'>alegr1</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024573">
			December 6, 2012 at 7:21 am</a>		</div>

		<p>&quot;I&#39;m too lazy to go get a screwdriver, so I&#39;ll just use a hammer for this screw. When I get a screwdriver, I&#39;ll just pull the screw out and drive it properly to the same hole.&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1024583">
				<div id="div-comment-1024583" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/j3anders_4000_gmail.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>j3anders@gmail.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024583">
			December 6, 2012 at 7:51 am</a>		</div>

		<p>Just yesterday I had to fix a bug&#8230; For some reason, long ago in our software someone decided to create a custom subclassed version of CButton for checkboxes. They handled the action of checking the box by watching for LBUTTONUP. The way other messages were handled was mangled &#8211; many passing through, but other being handled and reimplemented for no apparent reason. Of course, there were no comments explaining why. Recently, a customer discovered that when tapping the screen to wake the system up from a blank screen, it was possible to toggle a checkbox without any of the normal warnings screaming &quot;you&#39;ve changed something&quot; or other visual side effects of checking that box. They changed a few other unrelated settings, then ran the software, and had issues caused because of the setting being checked.</p>
<p>It turns out that the bad implementation allowed the LBUTTONDOWN to wake up the system, and the up event checked the box. The base class never got a complete click, so our event handler never triggered even though the state changed. Completely removing the subclassing and using a standard CButton fixed the problem &#8211; we&#39;re still testing to make sure we can&#39;t figure out what drove the original developer to implement it in the first place.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1024593">
				<div id="div-comment-1024593" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024593">
			December 6, 2012 at 8:33 am</a>		</div>

		<p>My solution to the problem was slightly more sane. I ran a second copy of the message loop in the input receiver until the temporary state was cleared (basically one cycle) then processed the input.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1024603">
				<div id="div-comment-1024603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Henning Makholm</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024603">
			December 6, 2012 at 8:55 am</a>		</div>

		<p>In an ideal world the function would probably have been called PostInput instead.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1024613">
				<div id="div-comment-1024613" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Lockwood</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024613">
			December 6, 2012 at 9:10 am</a>		</div>

		<p>Can I make a preemptive comment about autosorting the message queue, since WinGustavsonwhatever hasn&#39;t said anything on that line for a while?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-dwalker-wk odd alt thread-odd thread-alt depth-1" id="comment-1024633">
				<div id="div-comment-1024633" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/DWalker' rel='external nofollow' class='url'>DWalker</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024633">
			December 6, 2012 at 10:16 am</a>		</div>

		<p>Yep, painting a wall red and then blue is not the same as painting the wall blue and then red. &nbsp;The same is true of shift states, mouse clicks, etc&#8230;.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1024643">
				<div id="div-comment-1024643" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">spork</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024643">
			December 6, 2012 at 10:46 am</a>		</div>

		<p>perhaps a CBT hook would be a better fit for the user&#39;s use case.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1024653">
				<div id="div-comment-1024653" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jonathan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024653">
			December 6, 2012 at 10:49 am</a>		</div>

		<p>Re-processing input queues reminds me of something that used to happen with DOS Hebrew support. There were TSRs that hooked the keyboard interrupt (INT9), and changed English keystrokes into their Hebrew key equivalents. If there were 2 different TSRs loaded, this could result in double-translation: User pressed &#39;/&#39;, TSR1 translated that into &#39;.&#39;, and TSR2 translated that into ×¥.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1024663">
				<div id="div-comment-1024663" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">benjamin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024663">
			December 6, 2012 at 12:01 pm</a>		</div>

		<p>I used to see a case where the right mouse button acted as if it was stuck down all the time in XP. I wonder if I was running some program that was doing something similar.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-entegygmail-com odd alt thread-odd thread-alt depth-1" id="comment-1024673">
				<div id="div-comment-1024673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Entegy' rel='external nofollow' class='url'>Entegy</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024673">
			December 6, 2012 at 12:20 pm</a>		</div>

		<p>Lockwood, if you read his Twitter, he apparently &quot;gave up&quot; on Microsoft.</p>
<div class="post">[<em>He seems awfully engaged for somebody who gave up. -Raymond</em>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1024683">
				<div id="div-comment-1024683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024683">
			December 6, 2012 at 2:58 pm</a>		</div>

		<p>[He seems awfully engaged for somebody who gave up. -Raymond]</p>
<p>I gave up a decade ago. The company that hired me runs a Windows shop. The UNIX tools have given me such power as no one else in the company had seen before, and few could match.</p>
<p>But we&#39;re developing on Windows so for the moment I have to care. I&#39;m not buying MS stock though. Too high a risk.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1024693">
				<div id="div-comment-1024693" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">BC_Programmer</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024693">
			December 6, 2012 at 3:47 pm</a>		</div>

		<p>How did we go from &quot;Be careful messing with your input queue for the purpose of reprocessing&quot; to a lesson in Microsoft Stock purchases?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alegrigoriev even thread-even depth-1" id="comment-1024703">
				<div id="div-comment-1024703" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/alegr1' rel='external nofollow' class='url'>alegr1</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024703">
			December 6, 2012 at 8:56 pm</a>		</div>

		<blockquote><p>
  The UNIX tools have given me such power as no one else in the company had seen before, and few could match.
</p></blockquote>
<p>Behold! Kneel before me, puny humans!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1024713">
				<div id="div-comment-1024713" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Drak</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024713">
			December 6, 2012 at 10:12 pm</a>		</div>

		<p>Interesting.. This could be the cause of a certain browser &#39;typing&#39; every character twice into an input box in a dialog window. Except for control keys (backspace, arrows, etc.). Thanks for this insight, Raymond.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1024723">
				<div id="div-comment-1024723" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">ErikF</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024723">
			December 7, 2012 at 1:06 am</a>		</div>

		<p>Replaying events [aka Macro Recorder for everyone who remembers :-)] always seemed a little brittle and/or dangerous even before I knew about the Windows event model. It sort of reminded me of Logo, where you told the turtle to move but if the turtle wasn&#39;t where you thought it would be, all sorts of fun would happen (like the turtle running into walls or falling off the table)!</p>
<p>The only safe method of replaying events that I can think of is in your own application, where you can send yourself a list of what specific actions were queued up.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1024733">
				<div id="div-comment-1024733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/jas71_4000_hotmail.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>jas71@hotmail.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024733">
			December 7, 2012 at 5:21 am</a>		</div>

		<p>Key events getting eaten is a frequent bugbear for me &#8211; easy to encounter with remote control and virtualisation software. Use a keyboard shortcut to switch away from the remote control tool &#8211; the modifier keys&#39; keydown events get relayed to the target machine, the keyup stays on the host because you&#39;ve switched focus to another application by that point.</p>
<p>In this case, presumably the best way would be to pretend not to have handled it, so the message gets passed on to the next recipient &#8211; if you&#39;re trying to record whether the user has clicked inside a particular area yet, but still want clicks to get handled by whatever they clicked on: set the &#39;user has clicked here&#39; flag, then return &quot;these aren&#39;t the wndprocs you&#39;re looking for, keep looking&quot;? If it&#39;s a pop-up window and you want to pass the click through to the window underneath as if you weren&#39;t there, that&#39;ll be harder &#8211; though it&#39;s not something I can see much need for, being a pretty bizarre goal.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-joe_woodbury even thread-even depth-1" id="comment-1024833">
				<div id="div-comment-1024833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/JoeWoodbury' rel='external nofollow' class='url'>JoeWoodbury</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024833">
			December 7, 2012 at 10:37 am</a>		</div>

		<blockquote><p>
  The UNIX tools have given me such power as no one else in the company had seen before, and few could match.
</p></blockquote>
<p>Reminds me of the conversion I&#39;ve had more than once:</p>
<p>Him: &quot;These UNIX tools let me do this!&quot;</p>
<p>Me: &quot;I&#39;ve never needed to do that and can&#39;t conceive of ever needing to do so in the future.&quot;</p>
<p>Crickets chirping.</p>
<p>Him: &quot;These UNIX tools let me do this!&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1024893">
				<div id="div-comment-1024893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Douglas</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024893">
			December 7, 2012 at 2:01 pm</a>		</div>

		<p>@j3anders</p>
<p>It is correct to test button UP for mouse actions, but that&#39;s only the last step. The full procedure goes something like this:</p>
<p>Button Down : If hit, capture the mouse.</p>
<p>Button Up : If mouse is captured, un-capture it, and if hit, take action.</p>
<p>You can see this with the standard controls by clicking on something like a checkbox, keep holding and move the mouse away, then release. No check happens. Try again, but release when you return to the checkbox, it checks.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1024993">
				<div id="div-comment-1024993" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/j3anders_4000_gmail.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>j3anders@gmail.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20121206-00/?p=5903#comment-1024993">
			December 10, 2012 at 7:12 am</a>		</div>

		<p>@Douglas,</p>
<p>That&#39;s correct, which is why we were having issues. When I saw that the custom checkbox had a mouse up but not a mouse down handler I knew exactly what was going on.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>