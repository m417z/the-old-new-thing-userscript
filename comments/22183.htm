<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (13)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-633073">
				<div id="div-comment-633073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">waleri</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080527-00/?p=22183#comment-633073">
			May 27, 2008 at 10:42 am</a>		</div>

		<p>It would be much less confusing, if the rule applies in all cases. In WM_SETFONT I do exactly the same, yet the documentation says &quot;application should call the DeleteObject function to delete the font when it is no longer needed; for example, after it destroys the control.&quot;</p>
<p>So do I give it away or not?</p>
<p>How to know when do you give it away and when you don&#8217;t?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-633103">
				<div id="div-comment-633103" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080527-00/?p=22183#comment-633103">
			May 27, 2008 at 11:23 am</a>		</div>

		<p>Give it away, give it away, give it away now.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-633173">
				<div id="div-comment-633173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Brian</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080527-00/?p=22183#comment-633173">
			May 27, 2008 at 12:54 pm</a>		</div>

		<p>waleri, check MSDN:</p>
<p>For SetClipboardData():</p>
<p>&quot;If SetClipboardData succeeds, the system owns the object identified by the hMem parameter. The application may not write to or free the data once ownership has been transferred to the system&quot;</p>
<p>For WM_SETFONT:</p>
<p>&quot;The application should call the DeleteObject function to delete the font when it is no longer needed&quot;</p>
<p>Generally, if the documentation says you give it away, then you do. &nbsp;If the documentation says you do not, then you don&#8217;t.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-633233">
				<div id="div-comment-633233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Yuhong Bao</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080527-00/?p=22183#comment-633233">
			May 27, 2008 at 2:06 pm</a>		</div>

		<p>&quot;After the first call to SetClipboardData, the memory belongs to the clipboard. &quot;</p>
<p>You can&#8217;t share memory across processes in Win32 like you do in Win16, which means that the handle is probably freed by the time SetClipboardData returned</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-633193">
				<div id="div-comment-633193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">BryanK</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080527-00/?p=22183#comment-633193">
			May 27, 2008 at 1:13 pm</a>		</div>

		<p>Or, more specifically, if the documentation says that you have to free, or delete, or otherwise clean up after the object, then you still own it. &nbsp;(Since that&#8217;s what ownership is, at least most of the time: the responsibility to clean up after whatever object is being discussed.)</p>
<p>If the docs don&#8217;t say anything at all about who cleans up after the object (this is rare; I&#8217;ve only ever seen one instance), then I&#8217;m not sure. &nbsp;I would *guess* that you still own it.</p>
<p>(Yes, I&#8217;d agree that it would be less confusing if the docs always explicitly called out whether you were giving away any pointed-to object (including HANDLEs) or not, for any API. &nbsp;But on the other hand, it would be a huge pain to go back through every single API call and annotate each pointer-or-HANDLE parameter with that information. &nbsp;I&#8217;d guess it probably isn&#8217;t worth it, as long as the few cases where the information is missed get fixed quickly.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-633273">
				<div id="div-comment-633273" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Julian</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080527-00/?p=22183#comment-633273">
			May 27, 2008 at 3:08 pm</a>		</div>

		<p>Re the lottery: are you *absolutely* sure? </p>
<p>Perhaps the contract with the annuity company merely required the winner to pay them the winning amount each year, rather than the *actual* winnings. </p>
<p>In other words, provided the winner made arrangements to invest the lump sum from the lottery and then pay the correct amount to the annuity ompany each year (from another annuity (?!), bank interest, or &nbsp;investment income), it might all be above board.</p>
<p>Of course, I can&#8217;t see why any sane annuity company would do this &#8211; since they need to make a profit, one would expect their lump sum to be less than that available from the lottery who have already made a profit from all the losers). </p>
<p>The only explanation I can think of is strange tax laws that make this sort of arrangement worthwhile.</p>
<div class="post">[<i>Well, yeah, if you can cough up the money some other way, then go for it. But I bet you don&#8217;t. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-633493">
				<div id="div-comment-633493" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">waleri</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080527-00/?p=22183#comment-633493">
			May 28, 2008 at 2:40 am</a>		</div>

		<p>@Brian</p>
<p>I am aware of that.</p>
<p>All I am saying is, that it is confusing, since you have to check documentation for each function that sets something. Life would be much easier if there were logic to follow. Now where is that time machine&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-633523">
				<div id="div-comment-633523" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Roman</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080527-00/?p=22183#comment-633523">
			May 28, 2008 at 3:15 am</a>		</div>

		<p>Um, what is RegisterClipboardData? From the looks of it, you might have meant RegisterClipboardFormat instead.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-633563">
				<div id="div-comment-633563" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.1060.org/blogxter/publish/5' rel='external nofollow' class='url'>Steve Loughran</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080527-00/?p=22183#comment-633563">
			May 28, 2008 at 3:58 am</a>		</div>

		<p>Raymond, the belief that &quot;If something doesn&#8217;t belong to you, then you can&#8217;t give it away.&quot; is in fact an application of US/UK law that does not hold everywhere.</p>
<p>If you give someone a gift in France (like money) then the gifter has the right to revert that gift if the recipient commits some particularly outrageous act, like trying to kill the gifter.</p>
<p>So: in a french OS, it would be OK to give away data you gave to the clipboard, but only if the clipboard did something malicious to you first.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-mike-dimmick odd alt thread-odd thread-alt depth-1" id="comment-633573">
				<div id="div-comment-633573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Mike+Dimmick' rel='external nofollow' class='url'>Mike Dimmick</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080527-00/?p=22183#comment-633573">
			May 28, 2008 at 5:33 am</a>		</div>

		<p>That&#8217;s terrible documentation on WM_SETFONT. What it should say is that the font object you pass in the WM_SETFONT message must last as long as the control does, that is, you must not destroy it until either a) you&#8217;ve destroyed the control or b) you set a different font.</p>
<p>The reason is that the control will blindly pass the handle to SelectObject when handling WM_PAINT and if the handle no longer points to anything, or points to something that isn&#8217;t a font, you get very weird results.</p>
<p>I&#8217;ve added Community Content to this effect.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-633593">
				<div id="div-comment-633593" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">AndyB</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080527-00/?p=22183#comment-633593">
			May 28, 2008 at 6:53 am</a>		</div>

		<p>Re: the lottery.</p>
<p>Its more likely that the winner thought he had a lumpsum *and* an annuity, and decided to sell the unwanted annuity for a pile of cash to add to his other pile of cash winnings.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-635243">
				<div id="div-comment-635243" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://technage.blogspot.com/' rel='external nofollow' class='url'>Carter</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080527-00/?p=22183#comment-635243">
			June 2, 2008 at 7:03 pm</a>		</div>

		<p>So is the moral, plagiarize the memory and give away the pirated memory.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-710573">
				<div id="div-comment-710573" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/oldnewthing/archive/2009/02/20/9435239.aspx' rel='external nofollow' class='url'>The Old New Thing</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20080527-00/?p=22183#comment-710573">
			February 21, 2009 at 12:27 pm</a>		</div>

		<p>Get the owner to share it with you.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>