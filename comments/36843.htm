<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (16)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-238623">
				<div id="div-comment-238623" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nate</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041230-00/?p=36843#comment-238623">
			December 30, 2004 at 7:24 am</a>		</div>

		<p>I&#8217;ve always been baffled by the purpose of fibers, but it seems pretty clear where Raymond is going and I like what I see.</p>
<p>Do other platforms (UNIX, Mac) have constructs comparable to fibers?  I suppose that you could build fibers on top of threads using a couple of semaphores but that seems pretty roundabout.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-238633">
				<div id="div-comment-238633" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Igor Tandetnik</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041230-00/?p=36843#comment-238633">
			December 30, 2004 at 8:56 am</a>		</div>

		<p>&quot;it seems pretty clear where Raymond is going&quot;</p>
<p>Probably the same place Matthew Wilson has gone in C++ Users Journal&#8217;s February 2004 article &quot;Callback Enumeration APIs &amp; the Input Iterator Concept&quot;</p>
<p><a target="_new" href="http://www.cuj.com/documents/s=8188/cuj0402wilson/0402wilson.htm" rel="nofollow">http://www.cuj.com/documents/s=8188/cuj0402wilson/0402wilson.htm</a></p>
<p>(paid subscription required).</p>
<p>In this article, Matthew uses fibers to wrap EnumWindows API into STL-like iterator.</p>
<p>&quot;Do other platforms (UNIX, Mac) have constructs comparable to fibers?&quot;</p>
<p>POSIX has (deprecated) functions getcontext, setcontext, swapcontext and makecontext. These are effectively equivalent to fibers.</p>
<p>Then there&#8217;s GNU Pth library that supports non-preemtive cooperatively scheduled &quot;threads&quot; (which are closer to Windows fibers than to Windows or POSIX threads)</p>
<p><a target="_new" href="http://www.gnu.org/software/pth/" rel="nofollow">http://www.gnu.org/software/pth/</a></p>
<p>Disclaimer: I have not personally used Windows fibers, nor getcontext et al, nor Pth</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-238643">
				<div id="div-comment-238643" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Cooke</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041230-00/?p=36843#comment-238643">
			December 30, 2004 at 9:37 am</a>		</div>

		<p>I&#8217;m getting a hankering for co-routines.</p>
<p>(I&#8217;m also starting to get the idea that Fibers are basically just co-routines, but I&#8217;ll wait until tomorrow to see if I&#8217;m right!)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-238683">
				<div id="div-comment-238683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Memet</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041230-00/?p=36843#comment-238683">
			December 30, 2004 at 10:19 am</a>		</div>

		<p>Amen Raymond. I&#8217;ve been waiting to see a use of Fibers all my (programming) life.<br />
<br /> Enough with the previews already, Get on with the show! =)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-238693">
				<div id="div-comment-238693" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.studentclub.ro/ovidiupl/' rel='external nofollow' class='url'>Ovidiu</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041230-00/?p=36843#comment-238693">
			December 30, 2004 at 10:30 am</a>		</div>

		<p>Besides SQL Server, is there any other product on the market that can actually use fibers for something useful?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-238703">
				<div id="div-comment-238703" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://david.acz.org/' rel='external nofollow' class='url'>David Phillips</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041230-00/?p=36843#comment-238703">
			December 30, 2004 at 10:33 am</a>		</div>

		<p>UNIX has ucontext, but it is not implemented everywhere:</p>
<p><a target="_new" href="http://www.opengroup.org/onlinepubs/007908799/xsh/ucontext.h.html" rel="nofollow">http://www.opengroup.org/onlinepubs/007908799/xsh/ucontext.h.html</a></p>
<p>This paper describes a portable method to do the above:</p>
<p><a target="_new" href="http://xmailserver.org/rse-pmt.pdf" rel="nofollow">http://xmailserver.org/rse-pmt.pdf</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-238723">
				<div id="div-comment-238723" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.excastle.com/blog/' rel='external nofollow' class='url'>Joe White</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041230-00/?p=36843#comment-238723">
			December 30, 2004 at 11:13 am</a>		</div>

		<p>Indy can use fibers. Indy is an open-source TCP/IP library (with classes for just about every Internet protocol you&#8217;ve ever heard of, both clients and servers), written in Delphi, usable from both Win32 (in Delphi) and .NET (from any .NET language). Last I knew, though, the fiber support was only in the Win32 version. I&#8217;m pretty sure Indy-with-fibers is used in some high-end products, because the fiber support took them a lot of engineering. I couldn&#8217;t offhand tell you which high-end apps it&#8217;s used in, but you could check out their Web site (<a target="_new" href="http://www.indyproject.org/" rel="nofollow">http://www.indyproject.org/</a>).</p>
<p>I heard Kudzu (Chad Hower, one of the main coders on Indy) talk about this stuff at last year&#8217;s BorCon, so I know a decent bit about it. If you compile Indy with fiber support, then it uses manually-scheduled fibers together with some sort of low-level OS calls (might be I/O completion ports, but don&#8217;t quote me on that) to build very high-performance TCP servers. (Transparent, too &#8212; you write the same code either way, then just compile Indy with fibers or not.) I don&#8217;t remember all the details, but if you&#8217;ve got hundreds or thousands of simultaneous connections, it&#8217;s supposed to be a substantial performance boost. (On the other hand, if you&#8217;ve only got a few connections, it actually slows things down compared to the non-fiber implementation, so you have to plan accordingly. Why can&#8217;t optimization ever be easy? (grin))</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-238733">
				<div id="div-comment-238733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://david.acz.org/' rel='external nofollow' class='url'>David Phillips</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041230-00/?p=36843#comment-238733">
			December 30, 2004 at 12:17 pm</a>		</div>

		<p>I&#8217;m looking forward to seeing tomorrows blog.  While we are waiting, here is a way to do this sort of thing in C cleanly using the preprocessor.  It still requires a state machine, but the state machine is generated for you automatically:</p>
<p><a target="_new" href="http://www.chiark.greenend.org.uk/~sgtatham/coroutines.html" rel="nofollow">http://www.chiark.greenend.org.uk/~sgtatham/coroutines.html</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-238773">
				<div id="div-comment-238773" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/archive/2004/12/31/344799.aspx' rel='external nofollow' class='url'>The Old New Thing</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041230-00/?p=36843#comment-238773">
			December 31, 2004 at 10:00 am</a>		</div>

		<p>Fibers let both sides think they&#8217;re in control.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-239043">
				<div id="div-comment-239043" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Cooney</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041230-00/?p=36843#comment-239043">
			January 3, 2005 at 10:44 am</a>		</div>

		<p>Joe:<br />
<br />(On the other hand, if you&#8217;ve only got a few connections, it actually slows things down compared to the non-fiber implementation, so you have to plan accordingly. Why can&#8217;t optimization ever be easy? (grin))</p>
<p>Is it really a problem? With 10 connections, the relative overhead may be more, but does it impact performance?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-239183">
				<div id="div-comment-239183" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://thor.prohosting.com/bmm6o' rel='external nofollow' class='url'>Brian</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041230-00/?p=36843#comment-239183">
			January 4, 2005 at 4:47 pm</a>		</div>

		<p>David:  An interesting article.  A downside not addressed there is that by using static storage instead of a second stack, you pick up reentrancy issues.  But if that&#8217;s not a concern, it&#8217;s a clever hack.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-241833">
				<div id="div-comment-241833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Richard</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041230-00/?p=36843#comment-241833">
			January 11, 2005 at 5:25 am</a>		</div>

		<blockquote><p>
  I&#8217;m getting a hankering for co-routines. </p>
<p>You have seen this&#8230; using fibers to implement co-routines?</p>
<p><a target="_new" href="http://msdn.microsoft.com/msdnmag/issues/03/09/CoroutinesinNET/default.aspx" rel="nofollow">http://msdn.microsoft.com/msdnmag/issues/03/09/CoroutinesinNET/default.aspx</a>
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-241933">
				<div id="div-comment-241933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/oldnewthing/' rel='external nofollow' class='url'>Raymond Chen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041230-00/?p=36843#comment-241933">
			January 11, 2005 at 7:30 am</a>		</div>

		<p>Noting that the article uses undocumented CLR functions and even admits that it can deadlock with the garbage collector. Makes you wonder why anybody would follow the advice in that article in a real program. The last sentence of the article should scare everybody.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-247843">
				<div id="div-comment-247843" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.wisniewski-online.com/cs/blogs/wizzys_world/archive/2005/01/20/4.aspx' rel='external nofollow' class='url'>Wizzy's World</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041230-00/?p=36843#comment-247843">
			January 20, 2005 at 6:32 pm</a>		</div>

		<p>A while back there was an article in MSDN magazine about wrapping up the unmaged fibers API to implement&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-460353">
				<div id="div-comment-460353" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://excastle.com/blog/archive/2007/01/11/10280.aspx' rel='external nofollow' class='url'>Joe White's Blog</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041230-00/?p=36843#comment-460353">
			January 11, 2007 at 10:19 pm</a>		</div>

		
		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-460383">
				<div id="div-comment-460383" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://excastle.com/blog/archive/0001/01/01/10280.aspx' rel='external nofollow' class='url'>Joe White's Blog</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20041230-00/?p=36843#comment-460383">
			January 11, 2007 at 10:21 pm</a>		</div>

		
		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>