<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (4)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1 parent" id="comment-1306795">
				<div id="div-comment-1306795" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Torsten</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170818-00/?p=96845#comment-1306795">
			August 18, 2017 at 7:09 am</a>		</div>

		<p>For the exercise: Write a tiny loop with LDQ_L and STQ_C that only does a compare-and-swap for aligned quads.  Then build an outer loop that loads the old value, does whatever calculations it needs, and does the compare-and-swap as its final step.</p>

		
				</div>
		<ol class="children">
		<li class="comment odd alt depth-2 parent" id="comment-1306805">
				<div id="div-comment-1306805" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170818-00/?p=96845#comment-1306805">
			August 18, 2017 at 7:35 am</a>		</div>

		<p>I&#8217;m pretty sure the tiny loop isn&#8217;t a loop but this seems to be the general idea.</p>

		
				</div>
		<ol class="children">
		<li class="comment even depth-3 parent" id="comment-1306845">
				<div id="div-comment-1306845" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Voigt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170818-00/?p=96845#comment-1306845">
			August 18, 2017 at 2:47 pm</a>		</div>

		<p>It&#8217;s more efficient if it is.  If the store conditional failed spuriously and the comparison is still satisfied, there&#8217;s no need to repeat the (expensive) calculation step.</p>

		
				</div>
		<ol class="children">
		<li class="comment odd alt depth-4" id="comment-1306886">
				<div id="div-comment-1306886" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Martin Bonner</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170818-00/?p=96845#comment-1306886">
			August 20, 2017 at 10:24 pm</a>		</div>

		<p>It&#8217;s only more efficient if spurious failures are relatively common.  I don&#8217;t know if that&#8217;s true or not.</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>