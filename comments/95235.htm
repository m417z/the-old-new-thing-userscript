<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (19)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1 parent" id="comment-1280905">
				<div id="div-comment-1280905" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Damien</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1280905">
			January 23, 2017 at 7:11 am</a>		</div>

		<p>I once encountered a clever <i>attempt</i> to stop administrators from stopping a service &#8211; a set of 5 (IIRC) services that were implementing a mutual anti-suicide pact. They were monitoring each other in a ring and as soon as one disappeared, the next/previous in line would start it the missing one again.</p>
<p>As you say, ultimately the administrator can win &#8211; we actually wanted these services so didn&#8217;t just remove all of them during the next startup &#8211; so got very used to having to pause all of the services before killing any of them.</p>

		
				</div>
		<ol class="children">
		<li class="comment odd alt depth-2" id="comment-1280915">
				<div id="div-comment-1280915" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Karellen</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1280915">
			January 23, 2017 at 7:24 am</a>		</div>

		<p>That reminds me of Robin Hood and Friar Tuck &#8211; <a href="http://www.catb.org/jargon/html/meaning-of-hack.html" rel="nofollow">http://www.catb.org/jargon/html/meaning-of-hack.html</a></p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-martin-baschnegger even thread-odd thread-alt depth-1 parent" id="comment-1280925">
				<div id="div-comment-1280925" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Martin+Ba.+_' rel='external nofollow' class='url'>Martin Ba. _</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1280925">
			January 23, 2017 at 7:58 am</a>		</div>

		<p>I&#8217;m not sure whether I find this post &#8220;willfully ignorant&#8221; :-)</p>
<p>Sure, given (local?) Admin Rights, I can do pretty much anything, *given enough time and Google Search Foo*.</p>
<p>On the other hand, it does seems my AV solution manages just fine to prevent me to kill it, even though I *am* local admin. (Because you can&#8217;t use a dev box with some tools +10yrs old without local admin rights.)</p>
<p>So it seems reasonable enough for me to look for a modest garden fence, even against local admins. (Against normal users, the default concrete wall works anyway.)</p>

		
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-mngoldeneagle odd alt depth-2 parent" id="comment-1280946">
				<div id="div-comment-1280946" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/MNGoldenEagle' rel='external nofollow' class='url'>MNGoldenEagle</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1280946">
			January 23, 2017 at 8:14 am</a>		</div>

		<p>AV software tends to defend its processes fairly rigorously since they&#8217;re often targeted by the viruses that they&#8217;re supposed to protect you from. :-) That said, as an administrator you could uninstall the program, change the ACLs on the executable to prevent it from running, suspend the executable, or break in with a debugger and force it to terminate.  Or tell the AV service to stop, since most AV software runs as a service anyway.</p>

		
				</div>
		<ol class="children">
		<li class="comment even depth-3 parent" id="comment-1281065">
				<div id="div-comment-1281065" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dmitry</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1281065">
			January 23, 2017 at 1:27 pm</a>		</div>

		<p>Modern viruses are using fairly advanced social engineering to trick users to accept UAC and gain home admin privileges. Enterprise solutions have to deal with users that already have local admin privileges and google at hand. So, AV software must protect itself from elevated &#8220;net stop avservice&#8221;, and they are going really far to use most advanced rootkit technologies available.</p>

		
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-wndsks odd alt depth-4" id="comment-1281105">
				<div id="div-comment-1281105" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/skSdnW' rel='external nofollow' class='url'>skSdnW</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1281105">
			January 24, 2017 at 4:55 am</a>		</div>

		<p>There are several UAC bypass tricks that work when UAC is in the default mode, as long as Windows thinks it is a Windows action there is no dialog to deal with&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even depth-2" id="comment-1281005">
				<div id="div-comment-1281005" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ken Hagan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1281005">
			January 23, 2017 at 9:18 am</a>		</div>

		<p>Once upon a time, we had some AV software that had made some effort to stop local administrators from stopping it. (I didn&#8217;t look too hard because it was company policy to leave it running and presumably even if I could stop it I wouldn&#8217;t be able to hide the fact that it wasn&#8217;t running anymore.) However, the rest of the package was so badly written that if you tried to scan a file using their nifty shell extension, the background service would crash. *That* stops a service, no matter what. :)</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-mzzt odd alt thread-even depth-1 parent" id="comment-1280945">
				<div id="div-comment-1280945" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/The+MAZZTer' rel='external nofollow' class='url'>The MAZZTer</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1280945">
			January 23, 2017 at 8:09 am</a>		</div>

		<p>&gt; How do I prevent users from terminating a service?</p>
<p>My first thought was this was going to be about users who call in to customer support to cancel their service only to be given the runaround.</p>

		
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-bboorman even depth-2" id="comment-1280985">
				<div id="div-comment-1280985" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Brian_EE' rel='external nofollow' class='url'>Brian_EE</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1280985">
			January 23, 2017 at 9:06 am</a>		</div>

		<p>[Big Cable Company] who wasn&#8217;t allowed to merge with [Other Big Cable Company] a few years back has a monopoly on preventing users from terminating service. Lot&#8217;s of [big online video site] videos you can watch/listen to.</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1280967">
				<div id="div-comment-1280967" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Voigt (Visual Studio and Development Technologies MVP with C++ focus)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1280967">
			January 23, 2017 at 8:46 am</a>		</div>

		<p>I interpreted it as the customer misusing the term &#8220;service&#8221;, based on &#8220;set to auto-start when the user logs in&#8221;.  Real services running in service accounts don&#8217;t care about mundane problems like how many users are logged in, and definitely should not be assuming a singular user.  So it seemed like the customer is actually talking about a GUI process running within each user login session for the duration of that session, possibly communicating with a true service to perform privileged operations, possibly just acting inside the account.  Those processes typically are subject to manipulation by the user whose account is logged in.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 parent" id="comment-1280975">
				<div id="div-comment-1280975" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Seva</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1280975">
			January 23, 2017 at 8:51 am</a>		</div>

		<p>Could be a case of domain admins restricting local ones. There&#8217;s another airtight hatchway there, on the domain level.</p>

		
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-warrenelven-ca odd alt depth-2 parent" id="comment-1281025">
				<div id="div-comment-1281025" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/warrens' rel='external nofollow' class='url'>warrens</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1281025">
			January 23, 2017 at 9:43 am</a>		</div>

		<p>In terms of working with Active Directory schema, contents, etc., sure&#8230;.. but Domain Admins don&#8217;t have a higher privilege level on desktops / member servers than an a user in the local Administrators group.  Anything a Domain Admin does, a local Administrator can undo, up to and including leaving the domain.</p>

		
				</div>
		<ol class="children">
		<li class="comment even depth-3 parent" id="comment-1281036">
				<div id="div-comment-1281036" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1281036">
			January 23, 2017 at 11:28 am</a>		</div>

		<p>Ah good somebody has learned that &#8220;Domain Admin &gt;&gt; Local Admin&#8221; isn&#8217;t really true for the box that has local admin. GPO-knockout tools probably will get classified as hacktools if they weren&#8217;t so rare. [They] classified netcat as a hacktool.</p>

		
				</div>
		<ol class="children">
		<li class="comment odd alt depth-4" id="comment-1281075">
				<div id="div-comment-1281075" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dmitry</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1281075">
			January 23, 2017 at 1:30 pm</a>		</div>

		<p>There is no point to leave domain. You will loose access to domain resources, but gain nothing compared to safe boot mode.</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even depth-3" id="comment-1281405">
				<div id="div-comment-1281405" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alex Cohn</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1281405">
			January 25, 2017 at 11:39 am</a>		</div>

		<p>Except if the local admin stops the service that the domain admin considers critical, the latter can get a notice from the monitoring service and send an <i>administrative</i> (in the pre-computer sense) order to restart the service promptly.</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 parent" id="comment-1281045">
				<div id="div-comment-1281045" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">tiraniddo</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1281045">
			January 23, 2017 at 1:03 pm</a>		</div>

		<p>Of course there&#8217;s things like Protected Process Light which _should_ stop an admin from stopping the service (although you need an ELAM cert which most companies probably can&#8217;t get). Of course while in theory stopping a PPL service will fail as an admin from user mode it&#8217;s really a total lie and it&#8217;s trivial for an admin to stop a PPL service even without resorting to a kernel driver. You wonder why go to the effort of building it if it really has so little benefit (other than being user hostile, although perhaps that was the point)?</p>

		
				</div>
		<ol class="children">
		<li class="comment even depth-2" id="comment-1281085">
				<div id="div-comment-1281085" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1281085">
			January 23, 2017 at 2:46 pm</a>		</div>

		<p>Is there a way to turn this boneheaded behavior off? We&#8217;ve had too many cases of Windows Defender process going runaway.</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-scott-brickey odd alt thread-even depth-1 parent" id="comment-1281125">
				<div id="div-comment-1281125" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Scott+Brickey' rel='external nofollow' class='url'>Scott Brickey</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1281125">
			January 24, 2017 at 8:00 am</a>		</div>

		<p>Generally true, except that most AV services cannot be stopped, even by a local administrator. Not that the admin can&#8217;t do other things equally damaging, like uninstalling the service&#8230; but clearly some sort of middle ground was discovered&#8230; my guess (since I never had to investigate further, since I could just uninstall), was exactly as you said &#8211; the ACLs were modified for that service, to only include SYSTEM or something similar&#8230; but for the sake of this article it&#8217;d be interesting to identify.</p>

		
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-wndsks even depth-2" id="comment-1281145">
				<div id="div-comment-1281145" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/skSdnW' rel='external nofollow' class='url'>skSdnW</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170123-00/?p=95235#comment-1281145">
			January 24, 2017 at 9:09 am</a>		</div>

		<p>I would imagine AV software to be more evil than that, they are probably block/modifying access rights in kernel mode when apps call OpenProcess and the service API.</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>