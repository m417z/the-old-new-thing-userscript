<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (5)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="/oldnewthing/20180125-00/?p=97885#respond" style="display:none;">Cancel reply</a></small></h3>			<form action="https://blogs.msdn.microsoft.com/oldnewthing/wp-comments-post.php" method="post" id="commentform" class="comment-form">
				<p class="comment-form-comment"><textarea id="comment" name="comment" cols="45" rows="4" aria-required="true"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit btn btn-default" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='97885' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="4e7d6a81fd" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="194"/></p>			</form>
			</div><!-- #respond -->
	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment byuser comment-author-ranta even thread-even depth-1" id="comment-1322335">
				<div id="div-comment-1322335" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/ranta' rel='external nofollow' class='url'>ranta</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180125-00/?p=97885#comment-1322335">
			January 25, 2018 at 9:01 am</a>		</div>

		<p>Jumping ahead, I imagine one can handle the multithreaded case by calling MapViewOfFile twice to map two views of the same section object to different virtual addresses. The program would access the data via the first view; the exception handler would change the page protection at the corresponding address in the second view, populate the data there, and change the protection in the first view. I suppose the exception handler would need to enter a critical section as well. That makes me worry about ill-behaved antivirus software possibly causing another exception within the vectored exception handler.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://blogs.msdn.microsoft.com/oldnewthing/20180125-00/?p=97885&#038;replytocom=1322335#respond' onclick='return addComment.moveForm( "div-comment-1322335", "1322335", "respond", "97885" )' aria-label='Reply to ranta'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 parent" id="comment-1322375">
				<div id="div-comment-1322375" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Peter Doubleday</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180125-00/?p=97885#comment-1322375">
			January 25, 2018 at 10:01 am</a>		</div>

		<p>Is there a good reason to &#8220;simulate&#8221; a memory-mapped file that passes the -100 points test?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://blogs.msdn.microsoft.com/oldnewthing/20180125-00/?p=97885&#038;replytocom=1322375#respond' onclick='return addComment.moveForm( "div-comment-1322375", "1322375", "respond", "97885" )' aria-label='Reply to Peter Doubleday'>Reply</a></div>
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-oldnewthing bypostauthor even depth-2" id="comment-1322556">
				<div id="div-comment-1322556" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180125-00/?p=97885#comment-1322556">
			January 26, 2018 at 9:52 am</a>		</div>

		<p>Pointer swizzling is the example I gave.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://blogs.msdn.microsoft.com/oldnewthing/20180125-00/?p=97885&#038;replytocom=1322556#respond' onclick='return addComment.moveForm( "div-comment-1322556", "1322556", "respond", "97885" )' aria-label='Reply to Raymond Chen - MSFT'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt depth-2" id="comment-1322705">
				<div id="div-comment-1322705" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.silverbacknetworks.tech' rel='external nofollow' class='url'>Joshua Bowman</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180125-00/?p=97885#comment-1322705">
			January 26, 2018 at 11:22 pm</a>		</div>

		<p>Anything that includes &#8220;the database file&#8221; has already passed +100 and beyond; when customers are willing to pay millions of dollars to avoid Oracle&#8217;s tens of millions of dollars for more assurance and a few performance optimizations, you dig into the nitty-gritty of user page faults to squeeze out every micro-optimization.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://blogs.msdn.microsoft.com/oldnewthing/20180125-00/?p=97885&#038;replytocom=1322705#respond' onclick='return addComment.moveForm( "div-comment-1322705", "1322705", "respond", "97885" )' aria-label='Reply to Joshua Bowman'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1322626">
				<div id="div-comment-1322626" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Woah There</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20180125-00/?p=97885#comment-1322626">
			January 26, 2018 at 11:33 am</a>		</div>

		<p>Is there a way to do this technique in a way that handles COW smarter?</p>
<p>e.g. if a process reads from the database the page is mapped in and swizzled. This page of memory can be evicted by the OS at any time and not backed up by the OS&#8217;s swap file since it can be deterministically generated. If another process maps in the same and reads from the same page, this page is shared between processes.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://blogs.msdn.microsoft.com/oldnewthing/20180125-00/?p=97885&#038;replytocom=1322626#respond' onclick='return addComment.moveForm( "div-comment-1322626", "1322626", "respond", "97885" )' aria-label='Reply to Woah There'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>
<!-- COMMENTS END -->
</div></td></tr></table>