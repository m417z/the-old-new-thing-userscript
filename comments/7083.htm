<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (12)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-999633">
				<div id="div-comment-999633" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/arcangelpip_4000_hotmail.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>arcangelpip@hotmail.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120720-00/?p=7083#comment-999633">
			July 20, 2012 at 7:13 am</a>		</div>

		<p>This person is getting the icon directory header and entries only. Which happens to just contain 3 enteries if I calculated that correctly.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-999643">
				<div id="div-comment-999643" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/arcangelpip_4000_hotmail.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>arcangelpip@hotmail.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120720-00/?p=7083#comment-999643">
			July 20, 2012 at 7:14 am</a>		</div>

		<p>Err, forgot to mention, to get the icon itself, the customer would need to search for the RT_ICON resource type, not RT_GROUP_ICON.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-999653">
				<div id="div-comment-999653" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/chazste_4000_yahoo.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>chazste@yahoo.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120720-00/?p=7083#comment-999653">
			July 20, 2012 at 8:16 am</a>		</div>

		<p>So I am going to vote for a future article on the history of &quot;the icon selection algorithm&quot;. I know that there is some amount of unofficial stuff on-line that suggests that the order of the entries in the icon directory matters for certain version of Windows.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-999663">
				<div id="div-comment-999663" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ken Hagan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120720-00/?p=7083#comment-999663">
			July 20, 2012 at 9:01 am</a>		</div>

		<p>@Charles: I can interpret your suggestion in two ways.</p>
<p>Either different versions of Windows make different-but-equally-legitimate choices depending on the order of entries, or some versions of Windows make a definitely-bad choice unless the order is such-and-such. Since I&#39;ve never knowingly used a tool that let me control the order of entries, the latter possibility might be something worth knowing about.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-999683">
				<div id="div-comment-999683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blogs.msdn.com/johnstonj_4000_inn_2D00_soft.com/ProfileUrlRedirect.ashx' rel='external nofollow' class='url'>johnstonj@inn-soft.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120720-00/?p=7083#comment-999683">
			July 20, 2012 at 10:44 am</a>		</div>

		<p>I guess he&#39;d need to reconstruct the icon file format by hand by gathering all the different pieces together?</p>
<p>Or better, don&#39;t store the resource as an ICON, so that the compiler doesn&#39;t split it apart?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-999693">
				<div id="div-comment-999693" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">laonianren</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120720-00/?p=7083#comment-999693">
			July 20, 2012 at 11:12 am</a>		</div>

		<p>@Charles &amp; Ken</p>
<p>This article (<a rel="nofollow" target="_new" href="http://msdn.microsoft.com/en-us/library/ms997538.aspx" rel="nofollow">msdn.microsoft.com/&#8230;/ms997538.aspx</a>) says that Windows chooses the application icon thus:</p>
<p>&quot;Windows NT simply chooses the first resource listed in the application&#39;s RC script. On the other hand, Windows 95&#39;s algorithm is to choose the alphabetically first named group icon if one exists. If one such group resource does not exist, Windows chooses the icon with the numerically lowest identifier.&quot;</p>
<p>Compiled resources are split into named and numbered resources (names first), and each category is sorted by the resource identifier. &nbsp;So you can&#39;t normally control the order of resources, other than by changing the IDs.</p>
<p>Which suggests that Windows 9x was looking at RT_GROUP_ICON resources, which are ordered by ID, and Windows NT was (is) looking at RT_ICON resources, whose IDs can match the order of icons in the RC file because they are auto-generated.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-999703">
				<div id="div-comment-999703" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Troy Martin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120720-00/?p=7083#comment-999703">
			July 21, 2012 at 3:12 am</a>		</div>

		<p>Raymond, a comment on the post that is the second link you included in today&#39;s post links to a Microsoft Support document (<a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;282423&amp;Product=winxp" target="_new" rel="nofollow">support.microsoft.com/default.aspx</a>) that says &quot;No 16-bit code can run, except for recognized InstallShield and Acme installers (these are hard-coded in Wow64 to allow them to work).&quot; How does WoW64 support these legacy fragments of code in a processor mode that does not support v86 mode?</p>
<div class="post">[<i>Hm, I thought it was obvious. I guess not&#8230; (Hint: Why does it have to be &quot;recognized&quot;?) -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-999743">
				<div id="div-comment-999743" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Troy Martin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120720-00/?p=7083#comment-999743">
			July 21, 2012 at 1:23 pm</a>		</div>

		<blockquote><p>
  [Hm, I thought it was obvious. I guess not&#8230; (Hint: Why does it have to be &quot;recognized&quot;?) -Raymond]
</p></blockquote>
<p>My train of thought leads me to the idea that WoW64 extracts the contents of a &quot;recognized&quot; installer and puts up its own install method or translates it to a newer InstallShield platform. I&#39;m probably wrong, though.</p>
<p>&#8230;ooor there&#39;s a software emulator or translator built into Windows for the specific purpose of executing enough BIOS crud to get through a tried-and-true stable installer. That would be nifty.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-999753">
				<div id="div-comment-999753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Cherry</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120720-00/?p=7083#comment-999753">
			July 21, 2012 at 1:32 pm</a>		</div>

		<p>&lt;a href=&quot;<a rel="nofollow" target="_new" href="http://my.safaribooksonline.com/book/-/9780735671294/wow64/id3362927#X2ludGVybmFsX0ZsYXNoUmVhZGVyP3htbGlkPTk3ODA3MzU2NzEyOTQvaWQzMzYyOTI3&quot;&gt;This" rel="nofollow">my.safaribooksonline.com/&#8230;/id3362927</a> book&lt;/a&gt; says:</p>
<p>&lt;blockquote&gt;&quot;Whenever a 16-bit process is about to be created using the CreateProcess() API, Ntvdm64.dll is loaded and control is transferred to it to inspect whether the 16-bit executable is one of the supported installers. If it is, another CreateProcess is issued to launch a 32-bit version of the installer with the same command-line arguments.&quot;&lt;/blockquote&gt;</p>
<p>I assume these installers were not packed at all, instead they had an executable file and some data files, so all Windows needs to do is call the 32-bit version of the installer (which is probably shipped with Windows) so that the 32-bit installer may install the data files originally belonging to the 16-bit installer.</p>
<p>Thus, the wording &quot;No 16-bit code can run, except for&#8230;&quot; is technically incorrect, since no 16-bit code will ever be actually running.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-999763">
				<div id="div-comment-999763" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Cherry</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120720-00/?p=7083#comment-999763">
			July 21, 2012 at 1:34 pm</a>		</div>

		<p>Sorry, I assumed a limited HTML set was allowed.</p>
<p><a rel="nofollow" target="_new" href="http://my.safaribooksonline.com/book/-/9780735671294/wow64/id3362927#X2ludGVybmFsX0ZsYXNoUmVhZGVyP3htbGlkPTk3ODA3MzU2NzEyOTQvaWQzMzYyOTI3" rel="nofollow">my.safaribooksonline.com/&#8230;/id3362927</a></p>
<p>This is the complete link.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-999773">
				<div id="div-comment-999773" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Troy Martin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120720-00/?p=7083#comment-999773">
			July 21, 2012 at 1:44 pm</a>		</div>

		<p>After a bit of poking around, I found that in driverland you can poke HAL.DLL to emulate a real mode BIOS environment (at least, on Windows XP x64): <a rel="nofollow" target="_new" href="http://x86asm.net/articles/calling-bios-from-driver-in-windows-xp-x64/" rel="nofollow">x86asm.net/&#8230;/calling-bios-from-driver-in-windows-xp-x64</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-999793">
				<div id="div-comment-999793" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20120720-00/?p=7083#comment-999793">
			July 22, 2012 at 11:13 pm</a>		</div>

		<p>I&#39;ve never understood why (32/64-bit) windows is trying to hide the bitmap data. If I didn&#39;t know better, I would have guessed it was because it was only on disk and/or in graphics memory. But that&#39;s not true, it has never been true. It&#39;s allocated in the process, gimme my data!</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>