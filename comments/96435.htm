<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (18)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-1300035">
				<div id="div-comment-1300035" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Yukkuri</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300035">
			June 20, 2017 at 7:48 am</a>		</div>

		<p>As a highly paid security consultant that only knows how to check header flags I will keep telling my clients that explorer is dreadfully vulnerable. Sorry but I need to justify those consulting fees somehow :)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1300045">
				<div id="div-comment-1300045" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">middings</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300045">
			June 20, 2017 at 9:18 am</a>		</div>

		<p>Would the phrase &#8220;termination on corruption of heap&#8221; satisfy everybody?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1300055">
				<div id="div-comment-1300055" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">BZ</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300055">
			June 20, 2017 at 9:47 am</a>		</div>

		<p>@middings,<br />
no, that would need to be &#8220;corruption of the heap&#8221; at which point it might be too long</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-yuhong-bao odd alt thread-odd thread-alt depth-1 parent" id="comment-1300065">
				<div id="div-comment-1300065" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Yuhong+Bao' rel='external nofollow' class='url'>Yuhong Bao</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300065">
			June 20, 2017 at 9:50 am</a>		</div>

		<p>It used to be possible to run the 32-bit version of Explorer in 64-bit Windows. I wonder why this was broken in Win7 (I think).</p>

		
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-oldnewthing bypostauthor even depth-2 parent" id="comment-1300075">
				<div id="div-comment-1300075" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300075">
			June 20, 2017 at 10:05 am</a>		</div>

		<p>You weren&#8217;t ever supposed to be able to run the 32-bit version of Explorer on 64-bit Windows. If you could, it was a bug. I guess Windows 7 finally fixed that bug.</p>

		
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-alegrigoriev odd alt depth-3" id="comment-1300145">
				<div id="div-comment-1300145" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/alegr1' rel='external nofollow' class='url'>alegr1</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300145">
			June 21, 2017 at 6:56 am</a>		</div>

		<p>Bob: &#8220;So we just went ahead and fixed the glitch.&#8221;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even depth-3" id="comment-1300605">
				<div id="div-comment-1300605" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300605">
			June 24, 2017 at 9:17 pm</a>		</div>

		<p>The reason to run 32 bit explorer is to get at that shell extension that doesn&#8217;t come in 64 bit. Since the binary actually *works* on 64 bit Windows, defeating the &#8220;am I on 64 bit windows&#8221; check makes it work again. This is trivial if one possesses a debugger. But then again, 32 bit only shell extensions are broken.</p>
<p>The one that got on my nerves was mstsc.exe; there&#8217;s no good reason why that program should forward to the 64 bit version if somebody launched the 32 bit version; and gethostbyname() by somebody&#8217;s VPN solution stopped working.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-yuhong-bao odd alt depth-3" id="comment-1300637">
				<div id="div-comment-1300637" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Yuhong+Bao' rel='external nofollow' class='url'>Yuhong Bao</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300637">
			June 25, 2017 at 4:34 pm</a>		</div>

		<p>Vista/Server 2008 &#8220;View 32-bit Control Panel Items&#8221; used the 32-bit version of explorer.exe.</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even depth-2" id="comment-1300125">
				<div id="div-comment-1300125" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua Schaeffer</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300125">
			June 20, 2017 at 5:55 pm</a>		</div>

		<p>Fortunately you can still run a 32-bit Explorer clone just fine. All those IShellFolder and IContextMenu posts pay off sooner or later.</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-scott-brickey odd alt thread-even depth-1 parent" id="comment-1300085">
				<div id="div-comment-1300085" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Scott+Brickey' rel='external nofollow' class='url'>Scott Brickey</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300085">
			June 20, 2017 at 10:06 am</a>		</div>

		<p>Re: single instance&#8230; so what would happen if explorer crashes, and task manager is used to specifically open the x86 build? would the x86 recognize that it&#8217;s running on x64 platform and hand off the instance, or would it just look to see if &#8216;explorer.exe&#8217; is running (finding that it&#8217;s not) and allow it to start?</p>

		
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-oldnewthing bypostauthor even depth-2" id="comment-1300105">
				<div id="div-comment-1300105" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300105">
			June 20, 2017 at 11:12 am</a>		</div>

		<p>I don&#8217;t remember. You could always try it and see.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt depth-2" id="comment-1300215">
				<div id="div-comment-1300215" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://geelaw.blog/' rel='external nofollow' class='url'>GL</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300215">
			June 21, 2017 at 9:20 am</a>		</div>

		<p>If you start <code>C:\Windows\SysWoW64\explorer.exe</code>, it will instead start an <code>C:\Windows\explorer.exe</code>. My guess is that the 32-bit explorer will always start the 64-bit explorer with appropriate command line and leave the &#8220;handling the single-instance thing&#8221; to the 64-bit one. Not verified though.</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-yuhong-bao even thread-odd thread-alt depth-1 parent" id="comment-1300095">
				<div id="div-comment-1300095" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Yuhong+Bao' rel='external nofollow' class='url'>Yuhong Bao</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300095">
			June 20, 2017 at 10:32 am</a>		</div>

		<p>Don&#8217;t forget that a lot of shell extensions use ATL too, and /NXCOMPAT might break them without ATL thunk emulation.</p>

		
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-oldnewthing bypostauthor odd alt depth-2" id="comment-1300115">
				<div id="div-comment-1300115" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Raymond+Chen+-+MSFT' rel='external nofollow' class='url'>Raymond Chen - MSFT</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300115">
			June 20, 2017 at 11:14 am</a>		</div>

		<p>Isn&#8217;t that what I said in the article? &#8220;as a backward-compatibility concession to shell extensions which are not DEP-compatible.&#8221;</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1300245">
				<div id="div-comment-1300245" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">640k</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300245">
			June 21, 2017 at 11:20 am</a>		</div>

		<p>What an unusual move by MS, now sloppy developers need to actually fix bugs in their plugins when they recompile the code for x64. Not just pressing Ctrl+Shift+B with the eyes closed.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-iboyd odd alt thread-odd thread-alt depth-1 parent" id="comment-1300366">
				<div id="div-comment-1300366" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/IanBoyd' rel='external nofollow' class='url'>IanBoyd</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300366">
			June 22, 2017 at 6:36 am</a>		</div>

		<p>How do i opt into *Termination on Heap Corruption*?</p>
<p>I know how to opt into NX: </p>
<p>    MapAndLoad(pathToExe, null, out li, false, false);<br />
    LI.FileHeader.OptionalHeader.DllCharacteristics ^= IMAGE_DLLCHARACTERISTICS_NX_COMPAT;<br />
    UnMapAndLoad(li);</p>
<p>Microsoft Security Research and Defense blog says: </p>
<p>&gt; These improvements are enabled by default (with the exception of termination on heap corruption) </p>
<p>**Note**: There are compilers besides Visual Studio and GCC that create native Windows executables. I&#8217;m using one such compiler (which is why i have to edit PE flags directly)</p>

		
				</div>
		<ol class="children">
		<li class="comment even depth-2" id="comment-1300375">
				<div id="div-comment-1300375" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">laonianren</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300375">
			June 22, 2017 at 7:13 am</a>		</div>

		<p>Raymond wrote: &#8220;Explorer is also opted out of termination on heap corruption, but that&#8217;s harder to detect from a static analysis.&#8221;</p>
<p>Which implies that the option isn&#8217;t configured with a flag in the PE file.  Call HeapSetInformation.</p>

		
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment odd alt thread-even depth-1" id="comment-1300475">
				<div id="div-comment-1300475" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Barteks2x</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20170620-00/?p=96435#comment-1300475">
			June 22, 2017 at 9:10 pm</a>		</div>

		<p>Probably not very relevant but reading this remineded me of something:</p>
<p>Back when I used windows XP (32-bit), after a clean system reinstall + (maybe, I don&#8217;t remember) instaling an antivirus, I started getting message that said that &#8220;Data Execution Prenention&#8221; prevented Explorer.exe from working (or something like that, worded differently). It was the first time I&#8217;ve seen tat windows even has such feature!</p>
<p>Even now if I got such error, I would di the same thing as I did back then &#8211; reinstall windows again.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>