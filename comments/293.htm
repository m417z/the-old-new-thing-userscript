<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (11)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-1143593">
				<div id="div-comment-1143593" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140808-00/?p=293#comment-1143593">
			August 8, 2014 at 7:08 am</a>		</div>

		<p>Ah yes ROMI they decided to not believe me when I told them straight up it wasn&#39;t one. There&#39;s no such thing as a slow (weeks) heart attack.</p>
<p>While there valid uses of TerminateThread, any uses of that pattern where the program is a whole-prohram transform (no COM for you whatsoever and most of GDI is walking on eggshells after that.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alegrigoriev odd alt thread-odd thread-alt depth-1" id="comment-1143603">
				<div id="div-comment-1143603" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/alegr1' rel='external nofollow' class='url'>alegr1</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140808-00/?p=293#comment-1143603">
			August 8, 2014 at 7:31 am</a>		</div>

		<p>The checklist:</p>
<p>1. TerminateThread, SuspendThread.</p>
<p>2. _exit.</p>
<p>3. CreateThread, _beginthread (instead of proper _beginthreadex).</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-maurits even thread-even depth-1" id="comment-1143623">
				<div id="div-comment-1143623" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Maurits+%5BMSFT%5D' rel='external nofollow' class='url'>Maurits [MSFT]</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140808-00/?p=293#comment-1143623">
			August 8, 2014 at 8:31 am</a>		</div>

		<p>TIL ~~[thread-id] syntax.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1143653">
				<div id="div-comment-1143653" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">JM</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140808-00/?p=293#comment-1143653">
			August 8, 2014 at 10:58 am</a>		</div>

		<p>@Joshua: haven&#39;t you ever watched House? Everybody lies. Even if they seemingly have no reason to. :-)</p>
<p>Besides, can you imagine the headlines if a patient dies of a heart attack and the doctors have to defend themselves with &quot;he told us it couldn&#39;t be one&quot;? If nothing else, who says the symptoms you were feeling for weeks couldn&#39;t be unrelated and you happened to have a heart attack at that very moment? As unlikely as it is, if the test is sufficiently cheap, there&#39;s no reason not to do it. Hickam&#39;s dictum: patients can have as many diseases as they damn well please.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1143673">
				<div id="div-comment-1143673" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dan Bugglin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140808-00/?p=293#comment-1143673">
			August 8, 2014 at 12:30 pm</a>		</div>

		<p>@JM &quot;OF COURSE I TRIED REBOOTING ARE YOU CALLING ME A LIAR oh hey it works now thanks&quot;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1143683">
				<div id="div-comment-1143683" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ken Hagan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140808-00/?p=293#comment-1143683">
			August 8, 2014 at 12:46 pm</a>		</div>

		<p>ROMI is actually different from &quot;the light is better&quot;. The logic behind ROMI is that the cost of the condition is so high that you need to test for that one first. The logic of the lamp-post is that the cost of the test is so low that it doesn&#39;t hurt to do that one first. (The two could actually conflict, if testing for MI was greater than testing for TT.)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1143733">
				<div id="div-comment-1143733" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Gabe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140808-00/?p=293#comment-1143733">
			August 9, 2014 at 9:42 am</a>		</div>

		<p>In order to be able to reproduce this problem reliably, I&#39;m going to guess that they start a worker thread, determine the work item is unnecessary, and cancel it via TerminateThread. Since the system is under heavy load, the thread has not finished initializing before being terminated, leaving the loader lock abandoned.</p>
<p>So I guess if you want to make sure you can safely terminate a thread, do it from the loader lock?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1143743">
				<div id="div-comment-1143743" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joshua</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140808-00/?p=293#comment-1143743">
			August 9, 2014 at 10:32 am</a>		</div>

		<p>@Gabe: HeapAlloc! I wasn&#39;t kidding about whole program transform.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1143753">
				<div id="div-comment-1143753" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">immibis</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140808-00/?p=293#comment-1143753">
			August 9, 2014 at 7:27 pm</a>		</div>

		<p>@Gabe: Nothing makes the loader lock special. The thread could be holding any other lock.</p>
<p>You could try and terminate the thread while holding every lock, but good luck with that.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cheong odd alt thread-odd thread-alt depth-1" id="comment-1143783">
				<div id="div-comment-1143783" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/cheong00' rel='external nofollow' class='url'>cheong00</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140808-00/?p=293#comment-1143783">
			August 10, 2014 at 6:40 pm</a>		</div>

		<p>@Joshua: Although heart attacks usually comes quick and sudden, blockage of blood vassals can take months to develop.</p>
<p>There could be case that the reduced blood flow won&#39;t affect daily activities (for now), but will case problem when he&#39;s doing exercise.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1144303">
				<div id="div-comment-1144303" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Marc K</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20140808-00/?p=293#comment-1144303">
			August 14, 2014 at 6:02 am</a>		</div>

		<p>@The MAZZTer: &quot;Yes, I could reboot and that would probably temporarily resolve the problem. &nbsp;But, then we would lose this opportunity for you to find the bug in your product and develop a permanent fix.&quot; is something I find myself telling vendors these days. &nbsp;To me, rebooting is no longer a suitable resolution unless you already have enough information to produce a root cause analysis.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>