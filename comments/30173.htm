<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (11)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-407813">
				<div id="div-comment-407813" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://www.darklock.com/blog/' rel='external nofollow' class='url'>Caliban Darklock</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060810-06/?p=30173#comment-407813">
			August 10, 2006 at 11:45 am</a>		</div>

		<p>And where else have we seen this (bad) practice? </p>
<p>Why, under DOS, when installing ISRs for background processing. Which just goes to show that people never, ever, EVER learn.<br /></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-407833">
				<div id="div-comment-407833" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">nksingh</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060810-06/?p=30173#comment-407833">
			August 10, 2006 at 12:58 pm</a>		</div>

		<p>Well, it&#8217;s never ever the same people every time. &nbsp;It&#8217;s like Nietzsche&#8217;s Eternal Recurrence of inexperienced (too smart for their own good) programmers. &nbsp;Also, old programmers never die, they just move up the management hierarchy.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-407843">
				<div id="div-comment-407843" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Joseph Bruno</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060810-06/?p=30173#comment-407843">
			August 10, 2006 at 1:11 pm</a>		</div>

		<p>There was also the problem that there was a bug in the debug kernel of Windows 3.1 that made it crash if you used SetWindowsHookEx. The only cure was to go back to the deprecated SetWindowsHook.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-407853">
				<div id="div-comment-407853" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Kevin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060810-06/?p=30173#comment-407853">
			August 10, 2006 at 1:29 pm</a>		</div>

		<p>This is all well and good, but how does one restore GDI objects? By calling SelectObject and passing the old value, of course. So is it so hard to understand why programmers get confused? I&#8217;m not blaming MS in particular here, but this is a common problem when there are inconsistencies across an API. In this case SetWindowsHook should not have returned something that was a valid parameter for a subsequent call (although given the rampant casting required under Win16 that wouldn&#8217;t have stopped some people from still trying!).</p>
<div CLASS=post>[<i>Um, but there can be multiple hooks, but only one bitmap selected into a DC. Different models. You don&#8217;t &#8220;chain to the previous bitmap&#8221; in a DC. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-407883">
				<div id="div-comment-407883" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Coderjoe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060810-06/?p=30173#comment-407883">
			August 10, 2006 at 3:27 pm</a>		</div>

		<p>Right, but inexperienced programmers in a rush could wind up with the mistaken impression that there is only one hook, or something, and treat it like the do GDI objects.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-407893">
				<div id="div-comment-407893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Shog9</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060810-06/?p=30173#comment-407893">
			August 10, 2006 at 3:40 pm</a>		</div>

		<p>Joe/Kevin:<br />
<br />You know, most of us have probably seen and/or made enough newbie mistakes to recognize the strange logic that goes into making them.<br />
<br />It doesn&#8217;t make them any less stupid.</p>
<p>Now, misunderstanding the difference between selecting a bitmap into a DC and selecting anything else&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-407923">
				<div id="div-comment-407923" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Merit</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060810-06/?p=30173#comment-407923">
			August 10, 2006 at 6:10 pm</a>		</div>

		<p>I think it has to do with the requirement that you save the old value in a global variable. &nbsp;Without stopping to think about it pretty hard thats a really strange requirement, so people might have assumed that you needed to keep it around in order to do the unhook.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-407933">
				<div id="div-comment-407933" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Kevin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060810-06/?p=30173#comment-407933">
			August 10, 2006 at 7:49 pm</a>		</div>

		<p>[Um, but there can be multiple hooks, but only one bitmap selected into a DC. Different models. You don&#8217;t &#8220;chain to the previous bitmap&#8221; in a DC. -Raymond] <br />But will a programmer writing his first (and only one in that program) windows hook necessarily realize that? Would it not be better to design API calls, where possible, so that this kind of mistake is impossible or at least unlikely, even for programmers who might miss a detail in the docs? The tone of some of these comments is starting to remind me of cases of &#8220;blame the user&#8221;, which I believe Raymond&#8217;s written about in the past. In this case it&#8217;s &#8220;blame the user of this API for not understanding the model the author had in mind, when there&#8217;s an incorrect but superficially similar model in the same general space (ie Win16 development) that the user has probably been using all along&#8221;. Whose fault is that?</p>
<div CLASS=post>[<i>You&#8217;d think a function called <code>CallNextHook</code> would be an extremely strong indication that there can be multiple hooks. Setting the current object into a container and installing a hook into a container are very different concepts. It actually surprises me that people think they&#8217;re related&#8230; -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-407943">
				<div id="div-comment-407943" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Norman Diamond</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060810-06/?p=30173#comment-407943">
			August 10, 2006 at 9:42 pm</a>		</div>

		<blockquote><p>
  I still have no idea why they used this<br />
  <br />&gt; strange technique instead of doing the right<br />
  <br />&gt; thing</p>
<p>Although I know (after taking too long to learn this) not to blame you for two possible reasons, nonetheless there are two pretty obvious possible reasons.</p>
<p>1. &nbsp;Not everyone was a Win16 programmer, no problem. &nbsp;Some people who weren&#8217;t Win16 programmers were learning to be Win16 programmers, no problem. &nbsp;Some people who weren&#8217;t Win16 programmers were doing Win16 programming in products to be released, without anyone else checking and fixing their work, oops.</p>
<p>2. &nbsp;Some people don&#8217;t always have time to experiment to see which 75% of MSDN is correct, so they skip MSDN and just do the experiments.</p>
<p>I also agree with Merit&#8217;s suggestion that the use of a global variable provides some pretty powerful intuition that the global variable was intended to be used that way, and then add the fact that it seemed to work sometimes&#8230;
</p></blockquote>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-407963">
				<div id="div-comment-407963" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mihai</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060810-06/?p=30173#comment-407963">
			August 10, 2006 at 11:29 pm</a>		</div>

		<p>I think it was inspired by DOS and TSR.<br />
<br />The only way to unhook an interrupt was to set the previous interrupt address.</p>
<p>The rigth way was to GetInterrupt (ah=35h), compare it to the saved interrupt address, and not uninstall yourself if different, only set a flag to disable processing in your own interrupt routine.<br />
<br />But I have seen enough applications that just restored the original interrupt handler, &quot;killing&quot; other TSR or even the system.</p>
<p>Fun times :-)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-408263">
				<div id="div-comment-408263" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Ben Hutchings</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20060810-06/?p=30173#comment-408263">
			August 11, 2006 at 4:34 pm</a>		</div>

		<p>Well, they would have to had to know about UnhookWindowsHook, and that&#8217;s not an obvious counterpart to SetWindowsHook. The name SetWindowsHook doesn&#8217;t suggest that any counterpart exists (except maybe GetWindowsHook). (Further thought would lead to the realisation that this can&#8217;t work for out-of-order removal, but there are plenty of hook mechanisms that are broken in that way.) The lesson I would draw is that functions that attach and detach functions from hooks should be done using names that suggest an inverse function exists. For example, Attach/Detach, Install/Remove, Add/Remove, Register/Unregister, Subscribe/Unsubscribe.</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>