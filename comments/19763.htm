<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (43)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment byuser comment-author-dwalker-wk even thread-even depth-1" id="comment-694033">
				<div id="div-comment-694033" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/DWalker' rel='external nofollow' class='url'>DWalker</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694033">
			December 22, 2008 at 10:18 am</a>		</div>

		<p>From reading Koro&#8217;s question, it sounds to me like he wasn&#8217;t TRYING to fight the emulator &#8212; he just didn&#8217;t realize that he needed to recompile his installer as a 64-bit program.</p>
<p>Let&#8217;s hope that your answer pointed him in the right direction.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694073">
				<div id="div-comment-694073" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark (The other Mark)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694073">
			December 22, 2008 at 10:55 am</a>		</div>

		<p>Since you bring it up, consider this the obligatory tired old joke about System32 versus SysWoW64.</p>
<p>Nitpickers Corner- I know you didn&#8217;t code it. I know it makes perfect sense from a certain point of view. I&#8217;ll even admit this might be the best way of doing it. I&#8217;m not asking it to be changed. It&#8217;s still amusing to me.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694083">
				<div id="div-comment-694083" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anonymous Coward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694083">
			December 22, 2008 at 10:56 am</a>		</div>

		<p>Mark Russinovich talked a little about this a few years ago; he eventually went with disabling the file system redirection, because he didn&#8217;t like the added complexity of having a separate installer for 64-bit. &nbsp;I guess if you are installing a small, simple program, it makes more sense to do that, whereas a dedicated 64-bit installer may make more sense for larger and more complicated installs.</p>
<p><a rel="nofollow" target="_new" href="http://blogs.technet.com/markrussinovich/archive/2005/05/07/running-everyday-on-64-bit-windows.aspx" rel="nofollow">http://blogs.technet.com/markrussinovich/archive/2005/05/07/running-everyday-on-64-bit-windows.aspx</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694123">
				<div id="div-comment-694123" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://killprog.com' rel='external nofollow' class='url'>Killer{R}</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694123">
			December 22, 2008 at 12:57 pm</a>		</div>

		<p>I still do not understand why system32 is redirected to SysWOW64 for x86 apps while really contains x64 binaries. Why you didn&#8217;t simple rename system32 to system64 like you did in win16-&gt;win32 times? Old bad 32bit apps would be happy cause all files in their hardcoded %windir%System32, new 64 bit apps should be written so they know already that system directory is System64 for them. And there no need for that hacky FS redirection at all.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694143">
				<div id="div-comment-694143" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://coldacid.net/' rel='external nofollow' class='url'>Chris Charabaruk</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694143">
			December 22, 2008 at 1:41 pm</a>		</div>

		<p>@Killer: In a perfect world, this would have been the solution. However, common sense isn&#8217;t, especially when it comes to application development.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694153">
				<div id="div-comment-694153" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://weblogs.asp.net/kdente' rel='external nofollow' class='url'>Kevin Dente</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694153">
			December 22, 2008 at 1:41 pm</a>		</div>

		<p>The requirement for a separate 64-bit installer is a real pain &#8211; especially for managed code for which there literally is no difference between the 32-bit and 64-bit binaries. Hopefully &quot;the system&quot; will improve at some point, as this is become an increasingly common scenario.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694173">
				<div id="div-comment-694173" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Chunky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694173">
			December 22, 2008 at 2:03 pm</a>		</div>

		<p>[quote]If a 32-bit program tries to look at the system, it will see a 32-bit system. For example, if the program calls the GetSystemInfo function to see what processor is running, it will be told that it&#8217;s running on a 32-bit processor[/quote]</p>
<p>[quote]Have the 32-bit installer detect that it&#8217;s running on a 64-bit system and launch the 64-bit installer instead.[/quote]</p>
<p>Except&#8230; the 32-bit installer doesn&#8217;t have a way to detect that it&#8217;s running on a 64-bit system, because that&#8217;s the point of the emulation layer? What&#8217;s the correct way for a 32-bit app on windows to realise that it&#8217;s running a on 64-bit system?</p>
<p>Gary (-;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694193">
				<div id="div-comment-694193" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://www.robertwray.co.uk/blog/' rel='external nofollow' class='url'>Robert Wray</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694193">
			December 22, 2008 at 2:19 pm</a>		</div>

		<p>Chunky, search engines are your friend&#8230;</p>
<p>I searched (you could even say I googled, but I&#8217;ll never tell ;-) &quot;How to detect if you&#8217;re running on 64bit windows from a 32bit application&quot; and the first result was <a rel="nofollow" target="_new" href="http://www.berezniker.com/content/pages/visual-foxpro/how-detect-64-bit-os" rel="nofollow">http://www.berezniker.com/content/pages/visual-foxpro/how-detect-64-bit-os</a> which gives exactly what&#8217;s needed to determine if a 32bit app is running on 64bit windows..</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694203">
				<div id="div-comment-694203" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://x86asm.net' rel='external nofollow' class='url'>MazeGen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694203">
			December 22, 2008 at 2:24 pm</a>		</div>

		<p>Unfortunately, 32-bit program&#8217;s IDT and GDT bases in WoW64 are at addresses higher that 4GB so that instructions SIDT and SGDT are broken &#8211; they return only the low 32 bits of the base, which is useless.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694213">
				<div id="div-comment-694213" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Anonymous</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694213">
			December 22, 2008 at 2:25 pm</a>		</div>

		<p>You can use this to determine if a process is wow64:</p>
<p><a rel="nofollow" target="_new" href="http://msdn.microsoft.com/en-us/library/ms684139" rel="nofollow">http://msdn.microsoft.com/en-us/library/ms684139</a>(VS.85).aspx</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694233">
				<div id="div-comment-694233" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark (The other Mark)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694233">
			December 22, 2008 at 2:28 pm</a>		</div>

		<p>@Chunky</p>
<p>This article should help.</p>
<p><a rel="nofollow" target="_new" href="http://msdn.microsoft.com/en-us/library/ms684139" rel="nofollow">http://msdn.microsoft.com/en-us/library/ms684139</a>(VS.85).aspx</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694243">
				<div id="div-comment-694243" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">gtopala</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694243">
			December 22, 2008 at 2:29 pm</a>		</div>

		<p>A 32-bit app can check if the IsWow64Process function is exported by kernel32.dll</p>
<p><a rel="nofollow" target="_new" href="http://msdn.microsoft.com/en-us/library/ms684139" rel="nofollow">http://msdn.microsoft.com/en-us/library/ms684139</a>(VS.85).aspx</p>
<p>Thanks,</p>
<p>Gabriel Topala</p>
<p><a href="http://www.gtopala.com" rel="nofollow">http://www.gtopala.com</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694263">
				<div id="div-comment-694263" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark (The other Mark)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694263">
			December 22, 2008 at 2:47 pm</a>		</div>

		<p>Gabriel,</p>
<p>You can&#8217;t just check to see if the IsWow64Process is there, you have to actually call it.</p>
<p>Old, 32 bit Windows- IsWow64Process doesn&#8217;t exists</p>
<p>New, 32 bit- IsWow64Process does exists, will return 0.</p>
<p>New, 64 bit- IsWow64Process does exists, will return 1.</p>
<p>I think there is a MSDN Article detailing this for you, wonder if someone could link it?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694283">
				<div id="div-comment-694283" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Jody</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694283">
			December 22, 2008 at 3:05 pm</a>		</div>

		<p>Why go through the trouble of writing an installation program when everyone should be using Windows Installer and MSI files?</p>
<p>Just use WiX. It is free and easy.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694313">
				<div id="div-comment-694313" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">DriverDude</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694313">
			December 22, 2008 at 4:22 pm</a>		</div>

		<p>I wonder if the System32/SysWOW64 redirection could have been avoided if Windows had locked down the system folders &#8211; like Vista did &#8211; before 64-bit support was rolled out.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694333">
				<div id="div-comment-694333" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Nolan Johannes</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694333">
			December 22, 2008 at 4:37 pm</a>		</div>

		<p>Something I&#8217;ve always wondered about XP and Vista x64: does running 64-bit and 32-bit processes at the same time incur a more pronounced performance penalty? That is, would both types of apps running incur both the cost of a context switch plus some overhead for adjusting registers/memory allocation differences/whatever?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694343">
				<div id="div-comment-694343" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Dorfl</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694343">
			December 22, 2008 at 4:49 pm</a>		</div>

		<p>What kind of performance penalty, if any, is incurred when running a 32-bit program on a 64-bit OS, such an WinXP 32-bit? If I buy a new PC and OS, and money&#8217;s no object, and gaming&#8217;s my intent, which should I go for &#8211; a 32-bit or a 64-bit OS?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694353">
				<div id="div-comment-694353" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">x64 vs x86 for gaming</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694353">
			December 22, 2008 at 5:31 pm</a>		</div>

		<p>If money is no object, then you&#8217;ll likely be getting 8GB of ram (or higher if your mobo supports it) so you&#8217;ll want to get Vista 64-bit ;)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694363">
				<div id="div-comment-694363" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">asf</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694363">
			December 22, 2008 at 5:47 pm</a>		</div>

		<p>for the guy with the original question; NSIS has a header file called x64.nsh with helper functions to detect and disable 64bit and redirection, the registry commands also support 64bit</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694373">
				<div id="div-comment-694373" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alexander Grigoriev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694373">
			December 22, 2008 at 6:20 pm</a>		</div>

		<p>&quot;In a perfect world, this would have been the solution. However, common sense isn&#8217;t, especially when it comes to application development.&quot;</p>
<p>Maybe it&#8217;s finally time for MS to stop catering to bad ignorant developers that skip on reading the documentation? I suppose that&#8217;s what big A did.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694383">
				<div id="div-comment-694383" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">frymaster</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694383">
			December 22, 2008 at 6:38 pm</a>		</div>

		<p>Dorfl &#8211; some games (I&#8217;m thinking of Crysis here) have started to include 64-bit binaries to take advantage of some faster floating point calculations. &nbsp;Also, on 32-bit, you&#8217;re stuck with 4.0-x gigs of RAM (where x is probably between 0.5 and 1.0 for a gaming machine), which basically means you get 2x1GB RAM, which means a 32-bit process using all of its virtual memory can&#8217;t all fit into RAM at once. &nbsp;Whereas on 64-bit (I have 8 gigs of RAM), not only is your process all in RAM at once, but you get a hefty amount left over for J.Random apps you might have open (IRC, voice comms etc.) plus, more significantly, disk cache.</p>
<p>8 gigs is probably overkill for that (I also use a lot of VMs) but 4 gigs is definately useful.</p>
<p>The only downside of 64-bit, in my opinion, is slightly worse driver support. &nbsp;This is nowhere near as bad as it used to be, and it&#8217;ll be usb consumer printers and the like that you might have problems with (getting drivers for my USB bluetooth dongle was waaay harder than it should have been). &nbsp;As long as you check your hardware and peripherals for support beforehand, you&#8217;re fine</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694393">
				<div id="div-comment-694393" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">James</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694393">
			December 22, 2008 at 6:56 pm</a>		</div>

		<p>Some MFs always want to ice skate uphill&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694413">
				<div id="div-comment-694413" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://brandonlive.com/2008/12/22/why-does-windows-put-64-bit-binaries-in-system32/' rel='external nofollow' class='url'>Brandon Paddock's Blog &raquo; Blog Archive &raquo; Why does Windows put 64-bit binaries in System32?</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694413">
			December 22, 2008 at 9:32 pm</a>		</div>

		<p>PingBack from <a rel="nofollow" target="_new" href="http://brandonlive.com/2008/12/22/why-does-windows-put-64-bit-binaries-in-system32/" rel="nofollow">http://brandonlive.com/2008/12/22/why-does-windows-put-64-bit-binaries-in-system32/</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694423">
				<div id="div-comment-694423" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://brandonlive.com' rel='external nofollow' class='url'>Brandon Paddock</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694423">
			December 22, 2008 at 9:34 pm</a>		</div>

		<p>Alexander said:</p>
<p>&quot;Maybe it&#8217;s finally time for MS to stop catering to bad ignorant developers that skip on reading the documentation? I suppose that&#8217;s what big A did.&quot;</p>
<p>You&#8217;re making some big assumptions there that I don&#8217;t think are correct. &nbsp;For more, check the link above to my post on that subject.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694493">
				<div id="div-comment-694493" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Andrew Fidel</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694493">
			December 23, 2008 at 2:33 am</a>		</div>

		<p>Please don&#8217;t tell people to chainload installers! It makes silent and scripted installs hard to make work if you it can be made to work at all. The are many of us out here in real world land trying to implement this stuff and telling developers to hack around the stupid redirection routines just makes our lives harder.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694503">
				<div id="div-comment-694503" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">SuperKoko</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694503">
			December 23, 2008 at 4:04 am</a>		</div>

		<p>@Killer{R}:</p>
<p>When compiling old 32 bits projects to 64 bits Windows, programmers will fix the visible bugs, but, will probably overlook changing &quot;system32&quot; to &quot;system64&quot;, especially when refering to rarely-installed DLLs, since it will seem to work&#8230; until somebody installs a 32 bits applications using the same DLL.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694513">
				<div id="div-comment-694513" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">@</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694513">
			December 23, 2008 at 4:05 am</a>		</div>

		<blockquote><p>
  &gt; Just use WiX. It is free and easy.
</p></blockquote>
<p>Because often it&#8217;s a p.i.t.a. (for example it restarts the installer if you overwrite a DLL making a patching process more difficult, etc.).</p>
<p>Of course other free alternative exists so I agree that either WI or one of the others (for example NSIS) should fit any needs.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694533">
				<div id="div-comment-694533" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blog.wisefaq.com' rel='external nofollow' class='url'>Dale</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694533">
			December 23, 2008 at 5:31 am</a>		</div>

		<p>&quot;in a world with a 32-bit sky and 32-bit birds in the 32-bit trees.&quot;</p>
<p>One of the funnier phrases I&#8217;ve heard this year, thanks Raymond</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694553">
				<div id="div-comment-694553" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Mark (The other Mark)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694553">
			December 23, 2008 at 9:04 am</a>		</div>

		<p>@Andrew Fidel</p>
<p>I hear you man. However, properly supporting command line arguements (And properly documenting them! And making the documentation availible and easy to find!) goes a long way towards helping this issue.</p>
<p>Any program that wants to sell to Corporate Customers should, at very least, support silent installs with the option to turn off all the &quot;Corporation Repelling Additional Programs&quot;. EULA&#8217;s, Product Activation, Internet Surveys, etc.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694593">
				<div id="div-comment-694593" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Pointless ranter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694593">
			December 23, 2008 at 2:10 pm</a>		</div>

		<p>Well, apparently the emulator failed to emulate GlobalMemoryStatus, which contrary to the documentation will not clamp its result to 2GB. That causes some&#8230; interesting behavior on x64 machines with 4 (or 8, or&#8230;) GB of RAM.</p>
<p>Apparently five years and a few billion dollars can&#8217;t afford MS a backcompat test machine with 4 GB of RAM. I mean, the amount of stuff this breaks is staggering. Any amount of testing would have caught it.</p>
<p>For really old stuff not all hope is lost though: Windows 98/95 compatibility mode does clamp it to 256 megs. Nice way of saying &quot;we almost got it right! Almost&#8230;&quot;</p>
<p>BTW, the real system32 is available as %windir%Sysnative under emulation. But shh, don&#8217;t tell anybody. Consider this a retaliation for not showing the Compatibility Files button under x64 Explorer.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694633">
				<div id="div-comment-694633" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Steven Edwards</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694633">
			December 23, 2008 at 3:14 pm</a>		</div>

		<p>SuperKoko:</p>
<p>This is the lamest answer. Ever.</p>
<p>The simple fact is someone was an idiot and I mean a world class idiot when they made the system32 being 64bit and the SysWow64 being 32bit call. Linux does it right</p>
<p>/lib &#8211; 64bit libs if thats your think</p>
<p>/usr/lib &#8211; ditto</p>
<p>/usr/local/lib &nbsp;&#8211; ditto</p>
<p>/lib32 &#8211; 32bit libs (ia32-libs installed)</p>
<p>/usr/lib32 &#8211; ditto</p>
<p>/usr/local/lib32 &#8211; ditto</p>
<p>etc, etc, etc</p>
<p>It works for me and every other Linux user on the planet and I have no trouble with applications getting confused because ld takes care of all of the magic for me. If your running a 32bit app, the LD_LIBRARY_PATH is set to the correct locations automagically. If your hardcoding your app, your asking for trouble. Its not like Microsoft does not even have a solution for older broken apps if someone really needs to run a hardcoded Win32 app on a 64bit host. Its called a VM. They had lots of shots for a clean break with Win64 and they blew it here.</p>
<p>The simple fact is someone at Microsoft really blew it with this insane design and they should be canned. In fact they should publish the name of whoever it was that did it so they can never work in software development again.</p>
<p>In case anyone wants to play this off as standard Microsoft bashing, I&#8217;ll give credit where credit is due, the Visual Studio guys did an outstanding job to support the 32 to 64bit transition. Its whoever on the OS team that made this call that is a total idiot.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694653">
				<div id="div-comment-694653" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Aaargh!</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694653">
			December 23, 2008 at 5:12 pm</a>		</div>

		<p>Isn&#8217;t it cleaner to just make the installer a fat binary containing both the 32 and 64 bit installers instead of chaining them ? </p>
<div class=post>[<i>Whatever. You&#8217;re missing the forest for the trees. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694663">
				<div id="div-comment-694663" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">chrismcb</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694663">
			December 23, 2008 at 5:35 pm</a>		</div>

		<p>@Steven Edwards</p>
<p>I&#8217;m not sure I follow you. You say Linux works better because it works magically. Unless &quot;If your hardcoding your app, your asking for trouble.&quot; then you go on to imply Microsoft sucks because they don&#8217;t even have a solution for older broken apps if someone really needs to run a hardcoded Win32 app on a 64bit host.</p>
<p>So linux is ok, but you are in trouble if you hardcode, and Microsoft sucks because you hardcoded?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-dean-harding odd alt thread-odd thread-alt depth-1" id="comment-694693">
				<div id="div-comment-694693" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Dean+Harding' rel='external nofollow' class='url'>Dean Harding</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694693">
			December 23, 2008 at 7:36 pm</a>		</div>

		<p>chrismcb: I think he&#8217;s complaining because the directory for 64-bit binaries has &quot;32&quot; in the name, and the directory for 32-bit binaries has &quot;64&quot; in the name&#8230; after all, the only difference between the Windows solution and the Linux one is the name of the directories.</p>
<p>I don&#8217;t see how this is anything to get so worked up over!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694703">
				<div id="div-comment-694703" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alexander Grigoriev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694703">
			December 23, 2008 at 7:36 pm</a>		</div>

		<p>Koko,</p>
<p>&#8220;will probably overlook changing &#8220;system32&#8221; to &#8220;system64&#8243;&#8221;</p>
<p>1. grep or &#8220;Find in files&#8221; VS function makes WONDERS. You won&#8217;t believe that, but it&#8217;s possibly to find all &#8220;system32&#8221; strings in the code.</p>
<p>2. Most general purpose software doesn&#8217;t have a business to install or read files in Windows and system32. Folks, you have your program directory already, and any LoadLibrary call will look there. Stop tossing your crap into Windows.</p>
<div class=post>[<i>Good, you found the ones hard-coded into source code. Now find all the other ones. -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694843">
				<div id="div-comment-694843" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://killprog.com' rel='external nofollow' class='url'>Killer{R}</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694843">
			December 24, 2008 at 4:06 am</a>		</div>

		<p>@Chris Charabaruk</p>
<p>@Killer: In a perfect world, this would have been the solution. However, common sense isn&#8217;t, especially when it comes to application development.</p>
<p>Its just a words. I&#8217;m intresting what binary backward compatibility problem was solved by this redirection.</p>
<p>And I think that simple grep&#8217;ping for hardcoded &quot;system32&quot; in source and changing it to predefined macro would be simpliest problem from all stuff that usually neccessary to port x86 app written by ignorant developers to x64 platform. And this small text replacement doesn&#8217;t worth that FS redirection hack. Futhermore, I think that System32-SysWOW64 redirection brought more chaos into cross platform development than solved problems.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694863">
				<div id="div-comment-694863" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://blog.paulbetts.org' rel='external nofollow' class='url'>Paul Betts</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694863">
			December 24, 2008 at 6:28 am</a>		</div>

		<p>If you really, really, really have to use a 32-bit app on x64 for this, there&#8217;s an AppCompat patch that can help you out here that I wrote a few months ago:</p>
<p><a rel="nofollow" target="_new" href="http://support.microsoft.com/kb/950407" rel="nofollow">http://support.microsoft.com/kb/950407</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-694893">
				<div id="div-comment-694893" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://web.me.com/weatherley/Site/Kerala.html' rel='external nofollow' class='url'>JamesW</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694893">
			December 24, 2008 at 8:30 am</a>		</div>

		<p>@Steven Edwards</p>
<p>As others have pointed put, Linux is hardly any better than Windows on this front. Perhaps OS X gets it right? There aren&#8217;t special locations for the 64bit and 32bit apps. Everything is in /Applications, /bin, /sbin, &#8230;, but the binaries themselves can contain 32 and 64 bit code. Indeed they can contain x86 or PPC code of varying bit-iness. The loader selects the correct segments on executing the binary.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694903">
				<div id="div-comment-694903" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='http://killprog.com' rel='external nofollow' class='url'>Killer{R}</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694903">
			December 24, 2008 at 10:24 am</a>		</div>

		<p>And as for registry &#8211; it also can be done by another way, instead of silent redirection one key to another. MS could just claim that x64 software should use something like HKLMSoftware64.</p>
<p>And all &#8216;shared&#8217; registry keys could be implemented via old good but almost not documented registry key links. Did MS forget about feature that it was invented many years ago? &#8211;</p>
<p>&nbsp; &nbsp;HKEY k;</p>
<p>&nbsp; &nbsp;RegCreateKeyExW(HKEY_LOCAL_MACHINE, L&quot;Software\Test&quot;, 0, 0, REG_OPTION_CREATE_LINK, KEY_ALL_ACCESS, 0, &amp;k, 0);</p>
<p>&nbsp; &nbsp;std::wstring target = L&quot;\REGISTRY\MACHINE\Software&quot;;</p>
<p>&nbsp; &nbsp;RegSetValueExW(k, L&quot;SymbolicLinkValue&quot;, 0, REG_LINK, (LPBYTE)target.c_str(), target.size()*2 );</p>
<p>&nbsp; &nbsp;RegCloseKey(k);</p>
<p>So it was possible to keep simple plain FS and registry, without any problems with binary compatibility with legacy 32 bit code, and without additional complexity level that introduced by redirection.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-dwalker-wk odd alt thread-odd thread-alt depth-1" id="comment-694943">
				<div id="div-comment-694943" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/DWalker' rel='external nofollow' class='url'>DWalker</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694943">
			December 24, 2008 at 12:21 pm</a>		</div>

		<p>Nitpicking on the commenters: &nbsp;Why do so many people who sound like native English speakers have trouble spelling &quot;definitely&quot;? &nbsp;Someone spelled it wrong in comments to the Seattle weather post, and someone else (or maybe the same person) spelled it wrong in these comments.</p>
<p>Bring back the teching of English grammar and spelling! &nbsp;:-)</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-694983">
				<div id="div-comment-694983" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Alexander Grigoriev</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-694983">
			December 24, 2008 at 2:02 pm</a>		</div>

		<p>DWalker59,</p>
<p>Check Muphry&#8217;s Law</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-695053">
				<div id="div-comment-695053" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Steven Edwards</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-695053">
			December 24, 2008 at 6:13 pm</a>		</div>

		<p>chrismcb, others, et al&#8230;</p>
<p>Yes I am because the solution is the same on both. If you have an older broken app, you can VM it. This is not 1995 and its not like the transition to 64bit is forced like the Win 3.1 to Win9x switch. 32bit support is going to be around for a long long long time. If you have a broken app, run it on a 32bit system or VM it. You don&#8217;t need to introduce OS level convoluted hacks like the System32 being 64bit an SysWow64 being 32bit mess.</p>
<p>I don&#8217;t see how this is so hard to understand. The loader can figure this out. Take a PE32 app, the loader should be smart enough to know, hey I can&#8217;t call a PE+ 64bit dll and try to lookup functions. Ditto the reverse case. The loader knows, oh I loaded a 64bit executable, it would not be a good idea for me to try and load a normal 32bit dll.</p>
<p>I just cannot wrap my mind around how this is for &#8216;compatibility&#8217; as the libs that are in system32 are now 64bit! If you&#8217;ve got a hardcoded 32bit app that tries to do a LoadLibrary then its going to get redirected using the Microsoft system. If they had just left</p>
<p>system32 &#8211; 32bit crap</p>
<p>system64 &#8211; 64bit crap</p>
<p>The only problem you would have would be some idiot writing a 64bit program and then hardcoding it to system32. </p>
<div class=post>[<i>Running the app in a virtual machine is great if you don&#8217;t expect it to interact with any other apps. But <a href="http://blogs.msdn.com/oldnewthing/archive/2005/10/05/477317.aspx" rel="nofollow">most people want their productivity apps to work together</a>. Oh, and along the way we lost sight of the original question. How would a 32-bit application running in a virtual machine access the 64-bit file system? -Raymond</i>]</div>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-695593">
				<div id="div-comment-695593" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">Steven Edwards</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20081222-00/?p=19763#comment-695593">
			December 26, 2008 at 11:51 am</a>		</div>

		<p>Raymond: My point which I thought I made clear was that you do not want to VM everything. Of course it has limitations. The point was that if you have a really broken application then a VM is an acceptable solution.</p>
<p>My point in vocalizing the system32 being 64bit and SysWow64 being 32bit nonsense, is that none of the arguments for it make sense. Fine, you think a VM is never an acceptable solution. I can buy that. As I stated, the logic on why 64bit apps have to have a folder called System32 and how 32bit apps are not supposed to get even more confused by finding a system32 folder contain 64bit binaries is lost I me. Instead the system does all of this extra magic behind your back in the name of &#8216;compatibility&#8217; which does nothing but adds more complexity to the system.</p>
<p>Back to the original point about Program Files and your filesystem question, I think its a question that needs more information. Why does he need to interact with the 64bit Program Files directory from the 32bit application? Without knowing that I can&#8217;t see why given the even oddities of WOW64, he needs to do it. But I don&#8217;t think its unreasonable for him to ask if he has a valid reason. After all you guys give 32bit applications the ability to detect if they are running under Wow via IsWow64Process().</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>