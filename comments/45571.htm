<table class="commenttable" cellspacing="0" cellpadding="0"><tr><td><div class="commentdiv"><div class="commentdivhdr">
<!-- COMMENTS START -->
Comments (11)	</div>

	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment byuser comment-author-wndsks even thread-even depth-1" id="comment-1243696">
				<div id="div-comment-1243696" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/skSdnW' rel='external nofollow' class='url'>skSdnW</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150519-00/?p=45571#comment-1243696">
			May 19, 2015 at 7:16 am</a>		</div>

		<p>And how often do you have THREAD_SET_­CONTEXT but not PROCESS_VM_WRITE+PROCESS_VM_OPERATION so you cannot inject the &quot;normal&quot; way?</p>
<p>If someone were to put this in a reusable library you might start running into the &quot;what if another application also did this&quot; problem unless it picks a random string. You also litter the users drive with strange folders which are sure to ring some alarm bells&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-anonymouscommenter odd alt thread-odd thread-alt depth-1" id="comment-1243686">
				<div id="div-comment-1243686" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">anonymouscommenter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150519-00/?p=45571#comment-1243686">
			May 19, 2015 at 7:28 am</a>		</div>

		<p>Sounds like somebody tried to create threads running as different users in the same process. While you can do this (and I know why you might want to), the threads are not secured from each other, so don&#39;t run code from a different user in such a thread.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-anonymouscommenter even thread-even depth-1" id="comment-1243676">
				<div id="div-comment-1243676" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">anonymouscommenter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150519-00/?p=45571#comment-1243676">
			May 19, 2015 at 8:22 am</a>		</div>

		<p>I fail to see how step 3 is relevant. </p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-anonymouscommenter odd alt thread-odd thread-alt depth-1" id="comment-1243666">
				<div id="div-comment-1243666" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">anonymouscommenter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150519-00/?p=45571#comment-1243666">
			May 19, 2015 at 8:37 am</a>		</div>

		<p>Doesn&#39;t step 5 also require Administrator privileges to write into a subdirectory of C:Windows NT? &nbsp;Or are there compatibility shims that allow that to work without being an Administrator?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-fredericmagnyf even thread-even depth-1" id="comment-1243656">
				<div id="div-comment-1243656" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Medinoc' rel='external nofollow' class='url'>Medinoc</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150519-00/?p=45571#comment-1243656">
			May 19, 2015 at 8:41 am</a>		</div>

		<p>SetThreadContext() also allows you to directly set the Instruction Pointer register for this thread, so you can directly make it call LoadLibrary()&#8230; Oh, and you control the Stack Pointer, too.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-bboorman odd alt thread-odd thread-alt depth-1" id="comment-1243646">
				<div id="div-comment-1243646" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Brian_EE' rel='external nofollow' class='url'>Brian_EE</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150519-00/?p=45571#comment-1243646">
			May 19, 2015 at 10:12 am</a>		</div>

		<p>&gt;Doesn&#39;t step 5 also require Administrator privileges to write into a subdirectory of C:Windows NT? </p>
<p>Since &quot;C:Windows NT&quot; doesn&#39;t exist (at least not on Win7 Enterprise), unless there is a group policy in place preventing users from creating folders in the root folder, anyone can create a new folder named &quot;Windows NT&quot; and sub-folders thereof.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-anonymouscommenter even thread-even depth-1" id="comment-1243636">
				<div id="div-comment-1243636" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">anonymouscommenter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150519-00/?p=45571#comment-1243636">
			May 19, 2015 at 10:15 am</a>		</div>

		<p>Oh right, duh. &nbsp;Things that are not the same: {C:Windows, C:Windows NT}.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-anonymouscommenter odd alt thread-odd thread-alt depth-1" id="comment-1243626">
				<div id="div-comment-1243626" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">anonymouscommenter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150519-00/?p=45571#comment-1243626">
			May 19, 2015 at 11:11 am</a>		</div>

		<p>The set of {PROCESS_CREATE_THREAD, PROCESS_DUP_HANDLE, PROCESS_VM_OPERATION, PROCESS_VM_WRITE, THREAD_SET_­CONTEXT} should just have been a single access right. The way it is now just makes people think that you can grant one of them without giving full access to your process &#8211; in reality every one of them implies full access except for PROCESS_VM_OPERATION &#8211; but why would you change the protection of pages in the process without doing anything else to it anyways?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-anonymouscommenter even thread-even depth-1" id="comment-1243596">
				<div id="div-comment-1243596" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">anonymouscommenter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150519-00/?p=45571#comment-1243596">
			May 20, 2015 at 1:27 am</a>		</div>

		<p>It feels like &quot;It rather involved being on the other side of this airtight hatchway&quot; should be a tag by now.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-metac_kozelcu odd alt thread-odd thread-alt depth-1" id="comment-1243586">
				<div id="div-comment-1243586" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href='https://social.msdn.microsoft.com/profile/Pyjong' rel='external nofollow' class='url'>Pyjong</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150519-00/?p=45571#comment-1243586">
			May 20, 2015 at 5:16 am</a>		</div>

		<p>I love how Raymond elaborates the presented attempt and then says &quot;nope, doesn&#39;t work&quot; in the last sentence :D</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-anonymouscommenter even thread-even depth-1" id="comment-1243566">
				<div id="div-comment-1243566" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn">anonymouscommenter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/oldnewthing/20150519-00/?p=45571#comment-1243566">
			May 20, 2015 at 11:49 am</a>		</div>

		<p>yet another way to steal your own money</p>

		
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
			<p class="no-comments">Comments are closed.</p>
<!-- COMMENTS END -->
</div></td></tr></table>